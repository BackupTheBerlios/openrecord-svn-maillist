<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openrecord-svn] r394 - in trunk: documentation repositories source/archive source/model source/plugins/create_new_plugin
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openrecord-svn/2005-December/index.html" >
   <LINK REL="made" HREF="mailto:openrecord-svn%40lists.berlios.de?Subject=Re%3A%20%5Bopenrecord-svn%5D%20r394%20-%20in%20trunk%3A%20documentation%20repositories%20source/archive%20source/model%20source/plugins/create_new_plugin&In-Reply-To=%3C200512130033.jBD0Xn3f008325%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000375.html">
   <LINK REL="Next"  HREF="000377.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openrecord-svn] r394 - in trunk: documentation repositories source/archive source/model source/plugins/create_new_plugin</H1>
    <B>skinner at BerliOS</B> 
    <A HREF="mailto:openrecord-svn%40lists.berlios.de?Subject=Re%3A%20%5Bopenrecord-svn%5D%20r394%20-%20in%20trunk%3A%20documentation%20repositories%20source/archive%20source/model%20source/plugins/create_new_plugin&In-Reply-To=%3C200512130033.jBD0Xn3f008325%40sheep.berlios.de%3E"
       TITLE="[openrecord-svn] r394 - in trunk: documentation repositories source/archive source/model source/plugins/create_new_plugin">skinner at berlios.de
       </A><BR>
    <I>Tue Dec 13 01:33:49 CET 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000375.html">[openrecord-svn] r393 - trunk/documentation
</A></li>
        <LI>Next message: <A HREF="000377.html">[openrecord-svn] r395 - in trunk: documentation source/plugins
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#376">[ date ]</a>
              <a href="thread.html#376">[ thread ]</a>
              <a href="subject.html#376">[ subject ]</a>
              <a href="author.html#376">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: skinner
Date: 2005-12-13 01:33:27 +0100 (Tue, 13 Dec 2005)
New Revision: 394

Modified:
   trunk/documentation/to_do_list.txt
   trunk/repositories/open_agenda.json
   trunk/source/archive/StubArchive.js
   trunk/source/model/2005_june_axiomatic_items.json
   trunk/source/model/World.js
   trunk/source/plugins/create_new_plugin/create_new_plugin.js
Log:
Changed the &quot;node&quot; used in the UUIDs for plugins.  Added a new axiomatic user to the 2005_june_axiomatic_items.json file, to represent the user &quot;Automatic Plugin Creator&quot;.  Gave the new user account a real MAC node instead of a pseudonode.  Changed create_new_plugin.js so that the Items and Entries for new plugins are created by the user Automatic Plugin Creator.

Modified: trunk/documentation/to_do_list.txt
===================================================================
--- trunk/documentation/to_do_list.txt	2005-12-13 00:12:46 UTC (rev 393)
+++ trunk/documentation/to_do_list.txt	2005-12-13 00:33:27 UTC (rev 394)
@@ -45,8 +45,8 @@
 Who    | Estimate | Actual  | Task
 -------+----------+---------+----------------------------------------------
        |          |         |  1. Document the Data model public API
-       |          |         |  2. Change the &quot;node&quot; used in the UUIDs for plugins
-mignon |          |    0.05 |  3. Add validation code to create_new_plugin.html to check the supplied ClassName
+brian  |          | 0.1  IED|  2. Change the &quot;node&quot; used in the UUIDs for plugins
+mignon |          | 0.05 IED|  3. Add validation code to create_new_plugin.html to check the supplied ClassName
        |          |         |  4. Add instructions on the create_new_plugin.html page
        |          |         |  5. Add list of suggested plugins to the create_new_plugin.html page
        |          |         |  6. Make the 4 original plugins conform to the new plugin API (if possible)

Modified: trunk/repositories/open_agenda.json
===================================================================
--- trunk/repositories/open_agenda.json	2005-12-13 00:12:46 UTC (rev 393)
+++ trunk/repositories/open_agenda.json	2005-12-13 00:33:27 UTC (rev 394)
@@ -3131,4 +3131,35 @@
          &quot;uuid&quot;: &quot;bfd3dc10-4b3a-11da-87ec-000c414ce854&quot;,
        &quot;record&quot;: &quot;f1598550-0c6f-11da-beea-000c414ce854&quot;,
         &quot;value&quot;: &quot;11da0c6ff159855049dfc611cb5c6294&quot;  }
-}
\ No newline at end of file
+},
+  // =======================================================================
+  { &quot;Transaction&quot;: [
+{ &quot;Item&quot;: { &quot;uuid&quot;: &quot;2fd62580-65f4-11da-ba24-cbd0c9855ce2&quot; } },
+{ &quot;Entry&quot;: {
+         &quot;uuid&quot;: &quot;2fd62581-65f4-11da-ba24-8e8c531e103c&quot;,
+         &quot;type&quot;: &quot;00001020-ce7f-11d9-8cd5-0011113ae5d6&quot;,
+    &quot;attribute&quot;: &quot;00001001-ce7f-11d9-8cd5-0011113ae5d6&quot;,
+         &quot;item&quot;: &quot;2fd62580-65f4-11da-ba24-cbd0c9855ce2&quot;,
+        &quot;value&quot;: &quot;Super Foo&quot;  }
+},
+{ &quot;Entry&quot;: {
+         &quot;uuid&quot;: &quot;2fd62582-65f4-11da-ba24-898097682846&quot;,
+         &quot;type&quot;: &quot;00001020-ce7f-11d9-8cd5-0011113ae5d6&quot;,
+    &quot;attribute&quot;: &quot;00001002-ce7f-11d9-8cd5-0011113ae5d6&quot;,
+         &quot;item&quot;: &quot;2fd62580-65f4-11da-ba24-cbd0c9855ce2&quot;,
+        &quot;value&quot;: &quot;MySuperFooView&quot;  }
+},
+{ &quot;Entry&quot;: {
+         &quot;uuid&quot;: &quot;2fd62583-65f4-11da-ba24-c25c7f602c54&quot;,
+         &quot;type&quot;: &quot;00001020-ce7f-11d9-8cd5-0011113ae5d6&quot;,
+    &quot;attribute&quot;: &quot;0000100f-ce7f-11d9-8cd5-0011113ae5d6&quot;,
+         &quot;item&quot;: &quot;2fd62580-65f4-11da-ba24-cbd0c9855ce2&quot;,
+        &quot;value&quot;: &quot;MySuperFooView&quot;  }
+},
+{ &quot;Entry&quot;: {
+         &quot;uuid&quot;: &quot;2fd62584-65f4-11da-ba24-a27dc89f9af2&quot;,
+         &quot;type&quot;: &quot;00001050-ce7f-11d9-8cd5-0011113ae5d6&quot;,
+         &quot;item&quot;: [&quot;2fd62580-65f4-11da-ba24-cbd0c9855ce2&quot;, &quot;00040201-ce7f-11d9-8cd5-0011113ae5d6&quot;],
+    &quot;attribute&quot;: [&quot;00001005-ce7f-11d9-8cd5-0011113ae5d6&quot;, &quot;0000100c-ce7f-11d9-8cd5-0011113ae5d6&quot;]  }
+}  ]
+  }
\ No newline at end of file

Modified: trunk/source/archive/StubArchive.js
===================================================================
--- trunk/source/archive/StubArchive.js	2005-12-13 00:12:46 UTC (rev 393)
+++ trunk/source/archive/StubArchive.js	2005-12-13 00:33:27 UTC (rev 394)
@@ -532,8 +532,10 @@
     return false;
   }
 
-  if (user.getUuidString() == orp.model.World.UUID.USER_AMY) {
-    // nobody is allowed to log in as the axiomatic user
+  if ((user.getUuidString() == orp.model.World.UUID.USER_AMY_GOD) ||
+      (user.getUuidString() == orp.model.World.UUID.USER_PLUGIN_GOD)) {
+    // nobody is allowed to log in as &quot;Amy the Axiomatic User&quot;
+    // nobody is allowed to log in as the &quot;Otto the Automatic Plugin Creator&quot;
     return false;
   }
   

Modified: trunk/source/model/2005_june_axiomatic_items.json
===================================================================
--- trunk/source/model/2005_june_axiomatic_items.json	2005-12-13 00:12:46 UTC (rev 393)
+++ trunk/source/model/2005_june_axiomatic_items.json	2005-12-13 00:33:27 UTC (rev 394)
@@ -3,10 +3,14 @@
   &quot;records&quot;: [
   // =======================================================================
   { &quot;Transaction&quot;: [  // Axiomatic items
-    { &quot;Item&quot;: {                                               // User: Amy ex machina
+    { &quot;Item&quot;: {                                               // User: Amy the Axiomatic User
              &quot;uuid&quot;: &quot;00001000-ce7f-11d9-8cd5-0011113ae5d6&quot; }
     },
     // -----------------------------------------------------------------------
+    { &quot;Item&quot;: {                                               // User: Otto the Automatic Plugin Creator
+             &quot;uuid&quot;: &quot;00001800-65f4-11da-ba24-0011111f4abe&quot; }
+    },
+    // -----------------------------------------------------------------------
     { &quot;Item&quot;: {                                               // Attribute: Name
              &quot;uuid&quot;: &quot;00001001-ce7f-11d9-8cd5-0011113ae5d6&quot; }
     },
@@ -123,14 +127,22 @@
              &quot;uuid&quot;: &quot;00001214-ce7f-11d9-8cd5-0011113ae5d6&quot; }
     },
     // -----------------------------------------------------------------------
-    { &quot;Entry&quot;: {                                              // &quot;Amy ex machina&quot;
+    { &quot;Entry&quot;: {                                              // &quot;Amy the Axiomatic User&quot;
              &quot;uuid&quot;: &quot;0001000a-ce7f-11d9-8cd5-0011113ae5d6&quot;,
         &quot;attribute&quot;: &quot;00001001-ce7f-11d9-8cd5-0011113ae5d6&quot;,  // (Name)
-             &quot;item&quot;: &quot;00001000-ce7f-11d9-8cd5-0011113ae5d6&quot;,  // User: Amy ex machina
+             &quot;item&quot;: &quot;00001000-ce7f-11d9-8cd5-0011113ae5d6&quot;,  // User: Amy the Axiomatic User
              &quot;type&quot;: &quot;00001020-ce7f-11d9-8cd5-0011113ae5d6&quot;,  // TextValue
-            &quot;value&quot;: &quot;Amy ex machina&quot; }
+            &quot;value&quot;: &quot;Amy the Axiomatic User&quot; }
     },
     // -----------------------------------------------------------------------
+    { &quot;Entry&quot;: {                                              // &quot;Otto the Automatic Plugin Creator&quot;
+             &quot;uuid&quot;: &quot;0001800a-65f4-11da-ba24-0011111f4abe&quot;,
+        &quot;attribute&quot;: &quot;00001001-ce7f-11d9-8cd5-0011113ae5d6&quot;,  // (Name)
+             &quot;item&quot;: &quot;00001800-65f4-11da-ba24-0011111f4abe&quot;,  // User: Otto the Automatic Plugin Creator
+             &quot;type&quot;: &quot;00001020-ce7f-11d9-8cd5-0011113ae5d6&quot;,  // TextValue
+            &quot;value&quot;: &quot;Otto the Automatic Plugin Creator&quot; }
+    },
+    // -----------------------------------------------------------------------
     { &quot;Entry&quot;: {                                              // &quot;Name&quot;
              &quot;uuid&quot;: &quot;0001001a-ce7f-11d9-8cd5-0011113ae5d6&quot;,
         &quot;attribute&quot;: &quot;00001001-ce7f-11d9-8cd5-0011113ae5d6&quot;,  // (Name)

Modified: trunk/source/model/World.js
===================================================================
--- trunk/source/model/World.js	2005-12-13 00:12:46 UTC (rev 393)
+++ trunk/source/model/World.js	2005-12-13 00:33:27 UTC (rev 394)
@@ -106,7 +106,8 @@
   // NULL:                        &quot;00000000-ce7f-11d9-8cd5-0011113ae5d6&quot;,
   // IDENTITY:                    &quot;00000001-ce7f-11d9-8cd5-0011113ae5d6&quot;,
 
-  USER_AMY:                       &quot;00001000-ce7f-11d9-8cd5-0011113ae5d6&quot;,
+  USER_AMY_GOD:                       &quot;00001000-ce7f-11d9-8cd5-0011113ae5d6&quot;,
+  USER_PLUGIN_GOD:                    &quot;00001800-65f4-11da-ba24-0011111f4abe&quot;,
 
   ATTRIBUTE_NAME:                     &quot;00001001-ce7f-11d9-8cd5-0011113ae5d6&quot;,
   ATTRIBUTE_SHORT_NAME:               &quot;00001002-ce7f-11d9-8cd5-0011113ae5d6&quot;,

Modified: trunk/source/plugins/create_new_plugin/create_new_plugin.js
===================================================================
--- trunk/source/plugins/create_new_plugin/create_new_plugin.js	2005-12-13 00:12:46 UTC (rev 393)
+++ trunk/source/plugins/create_new_plugin/create_new_plugin.js	2005-12-13 00:33:27 UTC (rev 394)
@@ -34,6 +34,7 @@
 dojo.require(&quot;dojo.text.*&quot;);
 dojo.require(&quot;dojo.event.*&quot;);
 dojo.require(&quot;orp.uuid.TimeBasedUuid&quot;);
+dojo.require(&quot;orp.model.World&quot;);
 
 function startHere() {
   var createButton = document.getElementById(&quot;button&quot;);
@@ -56,32 +57,33 @@
     var name      = nameField.value;
     var author    = authorField.value;
     generatedContents = generateContents(className, name, author);
+  } else {
+    generatedContents = 'Error: ClassName must contain only alphanumeric characters ' + 
+                        'and underscores, and must start with an uppercase letter.  \n\n' +
+                        'Examples: \n' + 
+                        '  &quot;MySuperFooView&quot; is valid. \n' +
+                        '  &quot;mySuperFooView&quot; is not valid. \n' +
+                        '  &quot;23 is a fine #&quot; is not valid. \n';
   }
-  else {
-    generatedContents = &quot;Error: ClassName must contain only alphanumeric characters &quot; + 
-                        &quot;and underscores, and must start with an uppercase letter.  &quot; +
-                        &quot;Example: MySuperFooView&quot;;
-  }
 
   outputArea.value = generatedContents;
   outputArea.style.visibility = &quot;visible&quot;;
-  // alert(generatedContents);
-  
-  // var uuid = new orp.uuid.TimeBasedUuid();
-  // alert(uuid);
-  
-  // var string = &quot;     Just Foo    &quot;;
-  // var trimmedString = dojo.text.trim(string);
-  // alert(trimmedString);
 }
 
 function generateContents(className, name, author) {
   var templateFileContents = dojo.hostenv.getText(&quot;create_new_plugin_template.js&quot;);
-  var itemUuid = new orp.uuid.TimeBasedUuid();
-  var entryUuid1 = new orp.uuid.TimeBasedUuid();
-  var entryUuid2 = new orp.uuid.TimeBasedUuid();
-  var entryUuid3 = new orp.uuid.TimeBasedUuid();
-  var entryUuid4 = new orp.uuid.TimeBasedUuid();
+
+  // Get the 'node' from the UUID that identifies the axiomatic user account
+  // that we use for creating new plugins, &quot;Otto the Automatic Plugin Creator&quot;
+  var uuidForTheUserWhoCreatesPlugins = orp.model.World.UUID.USER_PLUGIN_GOD;
+  var arrayOfUuidParts = uuidForTheUserWhoCreatesPlugins.split('-');
+  var nodeForUserWhoCreatesPlugins = arrayOfUuidParts[4]; // the 'node' is part [4] of the UUID
+
+  var itemUuid   = new orp.uuid.TimeBasedUuid({node: nodeForUserWhoCreatesPlugins});
+  var entryUuid1 = new orp.uuid.TimeBasedUuid({node: nodeForUserWhoCreatesPlugins});
+  var entryUuid2 = new orp.uuid.TimeBasedUuid({node: nodeForUserWhoCreatesPlugins});
+  var entryUuid3 = new orp.uuid.TimeBasedUuid({node: nodeForUserWhoCreatesPlugins});
+  var entryUuid4 = new orp.uuid.TimeBasedUuid({node: nodeForUserWhoCreatesPlugins});
   
   var intermediateResult = templateFileContents;
   intermediateResult = intermediateResult.replace(/%\(AUTHOR\)/g, author);
@@ -97,9 +99,22 @@
   return finalString;
 }
 
-dojo.event.connect(window, &quot;onload&quot;, startHere);
+// -----------------------------------------------------------
+// Register the startHere() function so that it will be called 
+// after the loading is done
 
+// this is an okay way
+dojo.addOnLoad(startHere); 
 
+// we can use connect(), if we've done a dojo.require(&quot;dojo.event.*&quot;);
+// dojo.event.connect(dojo, &quot;loaded&quot;, startHere); 
+// dojo.event.connect(dojo, &quot;loaded&quot;, someObject, &quot;methodName&quot;); 
+
+// don't do it this way -- the window will have loaded, but dojo may not have
+// dojo.event.connect(window, &quot;onload&quot;, startHere); 
+//
+// -----------------------------------------------------------
+
 // -------------------------------------------------------------------
 // End of file
 // -------------------------------------------------------------------


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000375.html">[openrecord-svn] r393 - trunk/documentation
</A></li>
	<LI>Next message: <A HREF="000377.html">[openrecord-svn] r395 - in trunk: documentation source/plugins
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#376">[ date ]</a>
              <a href="thread.html#376">[ thread ]</a>
              <a href="subject.html#376">[ subject ]</a>
              <a href="author.html#376">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openrecord-svn">More information about the openrecord-svn
mailing list</a><br>
</body></html>
