<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openrecord-svn] r208 - in trunk: . documentation source source/view
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openrecord-svn/2005-July/index.html" >
   <LINK REL="made" HREF="mailto:openrecord-svn%40lists.berlios.de?Subject=Re%3A%20%5Bopenrecord-svn%5D%20r208%20-%20in%20trunk%3A%20.%20documentation%20source%20source/view&In-Reply-To=%3C200507021954.j62JsH1h013374%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000193.html">
   <LINK REL="Next"  HREF="000195.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openrecord-svn] r208 - in trunk: . documentation source source/view</H1>
    <B>Brian Douglas Skinner at BerliOS</B> 
    <A HREF="mailto:openrecord-svn%40lists.berlios.de?Subject=Re%3A%20%5Bopenrecord-svn%5D%20r208%20-%20in%20trunk%3A%20.%20documentation%20source%20source/view&In-Reply-To=%3C200507021954.j62JsH1h013374%40sheep.berlios.de%3E"
       TITLE="[openrecord-svn] r208 - in trunk: . documentation source source/view">skinner at berlios.de
       </A><BR>
    <I>Sat Jul  2 21:54:17 CEST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000193.html">[openrecord-svn] r207 - trunk/source
</A></li>
        <LI>Next message: <A HREF="000195.html">[openrecord-svn] r209 - in trunk: documentation source
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#194">[ date ]</a>
              <a href="thread.html#194">[ thread ]</a>
              <a href="subject.html#194">[ subject ]</a>
              <a href="author.html#194">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: skinner
Date: 2005-07-02 21:54:15 +0200 (Sat, 02 Jul 2005)
New Revision: 208

Added:
   trunk/source/view/EntryView.js
   trunk/source/view/LintTest.html
   trunk/source/view/LintTest.js
   trunk/source/view/SuggestionBox.js
Removed:
   trunk/source/TextView.js
Modified:
   trunk/dashboard.html
   trunk/demo_page.html
   trunk/documentation/release_planning.txt
   trunk/dogfood.html
   trunk/source/LintTest.js
   trunk/source/LoginView.js
   trunk/source/MultiEntriesView.js
   trunk/source/PageView.js
   trunk/source/SectionView.js
   trunk/source/TablePlugin.js
   trunk/source/TestSuite.html
   trunk/source/base_style.css
Log:
Renamed TextView.js to be EntryView.js, and moved it down into the the new /view directory.  Broke SuggestionBox code out of EntryView and into its own file.

Modified: trunk/dashboard.html
===================================================================
--- trunk/dashboard.html	2005-07-02 19:27:18 UTC (rev 207)
+++ trunk/dashboard.html	2005-07-02 19:54:15 UTC (rev 208)
@@ -27,7 +27,8 @@
     &lt;script type=&quot;text/javascript&quot; src=&quot;source/LoginView.js&quot;&gt;&lt;/script&gt;
     &lt;script type=&quot;text/javascript&quot; src=&quot;source/MultiEntriesView.js&quot;&gt;&lt;/script&gt;
     &lt;script type=&quot;text/javascript&quot; src=&quot;source/NavbarView.js&quot;&gt;&lt;/script&gt;
-    &lt;script type=&quot;text/javascript&quot; src=&quot;source/TextView.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;source/view/SuggestionBox.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;source/view/EntryView.js&quot;&gt;&lt;/script&gt;
     &lt;script type=&quot;text/javascript&quot; src=&quot;source/PluginView.js&quot;&gt;&lt;/script&gt;
     &lt;script type=&quot;text/javascript&quot; src=&quot;source/TablePlugin.js&quot;&gt;&lt;/script&gt;
     &lt;script type=&quot;text/javascript&quot; src=&quot;source/OutlinePlugin.js&quot;&gt;&lt;/script&gt;

Modified: trunk/demo_page.html
===================================================================
--- trunk/demo_page.html	2005-07-02 19:27:18 UTC (rev 207)
+++ trunk/demo_page.html	2005-07-02 19:54:15 UTC (rev 208)
@@ -27,7 +27,8 @@
     &lt;script type=&quot;text/javascript&quot; src=&quot;source/LoginView.js&quot;&gt;&lt;/script&gt;
     &lt;script type=&quot;text/javascript&quot; src=&quot;source/MultiEntriesView.js&quot;&gt;&lt;/script&gt;
     &lt;script type=&quot;text/javascript&quot; src=&quot;source/NavbarView.js&quot;&gt;&lt;/script&gt;
-    &lt;script type=&quot;text/javascript&quot; src=&quot;source/TextView.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;source/view/SuggestionBox.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;source/view/EntryView.js&quot;&gt;&lt;/script&gt;
     &lt;script type=&quot;text/javascript&quot; src=&quot;source/PluginView.js&quot;&gt;&lt;/script&gt;
     &lt;script type=&quot;text/javascript&quot; src=&quot;source/TablePlugin.js&quot;&gt;&lt;/script&gt;
     &lt;script type=&quot;text/javascript&quot; src=&quot;source/OutlinePlugin.js&quot;&gt;&lt;/script&gt;

Modified: trunk/documentation/release_planning.txt
===================================================================
--- trunk/documentation/release_planning.txt	2005-07-02 19:27:18 UTC (rev 207)
+++ trunk/documentation/release_planning.txt	2005-07-02 19:54:15 UTC (rev 208)
@@ -293,7 +293,7 @@
        |          |         | 45. Add support for repository merging
        |          |         | 46. BUG: back button is broken
        |          |         | 47. BUG: &quot;Waiting for localhost...&quot;
-       |          |         | 48. BUG: &quot;Node was not found&quot; exception in TextView/LoginView?
+       |          |         | 48. BUG: &quot;Node was not found&quot; exception in EntryView/LoginView?
        |          |         | 49. Do some testing to find other existing bugs
        |          |         | 50. Have explicit save instead of (or in addition to) autosave
        |          |         | 51. Be able to cancel out of creating a new account
@@ -514,11 +514,11 @@
  + Bug: &quot;Node was not found&quot; exception
     Load the demo_page.html page from <A HREF="file:///...">file:///...</A>
     Go into Edit mode and change some entry.  
-    You get an exception in TextView.js:
+    You get an exception in EntryView.js:
       Util.handleError()
       uncaught exception: [Exception... &quot;Node was not found&quot;  
       code: &quot;8&quot; nsresult: &quot;0x80530008 (NS_ERROR_DOM_NOT_FOUND_ERR)&quot;  
-      location: &quot;<A HREF="file:///K:/www/htdocs/openrecord/demo/current/trunk/source/TextView.js">file:///K:/www/htdocs/openrecord/demo/current/trunk/source/TextView.js</A> Line: 221&quot;]
+      location: &quot;<A HREF="file:///K:/www/htdocs/openrecord/demo/current/trunk/source/EntryView.js">file:///K:/www/htdocs/openrecord/demo/current/trunk/source/EntryView.js</A> Line: 221&quot;]
       line: 0
     
 ===========================       
@@ -529,4 +529,4 @@
 + Should we rename &quot;World&quot;?
 + BUG: need to convert HTML entity codes back at client-server layer
 + BUG: Can't really create own plugins yet (e.g. UUID need to be assigned, plugin item created)
-+ Q: Do we (and how) need a concept of focus for Views? Currently, only Text input and Textarea gets keyboard focus. We need it for table selections and possibly selecting &quot;lozenges&quot; (item references stored in the TextView)
\ No newline at end of file
++ Q: Do we (and how) need a concept of focus for Views? Currently, only Text input and Textarea gets keyboard focus. We need it for table selections and possibly selecting &quot;lozenges&quot; (item references stored in the EntryView)
\ No newline at end of file

Modified: trunk/dogfood.html
===================================================================
--- trunk/dogfood.html	2005-07-02 19:27:18 UTC (rev 207)
+++ trunk/dogfood.html	2005-07-02 19:54:15 UTC (rev 208)
@@ -27,7 +27,8 @@
     &lt;script type=&quot;text/javascript&quot; src=&quot;source/LoginView.js&quot;&gt;&lt;/script&gt;
     &lt;script type=&quot;text/javascript&quot; src=&quot;source/MultiEntriesView.js&quot;&gt;&lt;/script&gt;
     &lt;script type=&quot;text/javascript&quot; src=&quot;source/NavbarView.js&quot;&gt;&lt;/script&gt;
-    &lt;script type=&quot;text/javascript&quot; src=&quot;source/TextView.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;source/view/SuggestionBox.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;source/view/EntryView.js&quot;&gt;&lt;/script&gt;
     &lt;script type=&quot;text/javascript&quot; src=&quot;source/PluginView.js&quot;&gt;&lt;/script&gt;
     &lt;script type=&quot;text/javascript&quot; src=&quot;source/TablePlugin.js&quot;&gt;&lt;/script&gt;
     &lt;script type=&quot;text/javascript&quot; src=&quot;source/OutlinePlugin.js&quot;&gt;&lt;/script&gt;

Modified: trunk/source/LintTest.js
===================================================================
--- trunk/source/LintTest.js	2005-07-02 19:27:18 UTC (rev 207)
+++ trunk/source/LintTest.js	2005-07-02 19:54:15 UTC (rev 208)
@@ -63,7 +63,6 @@
     &quot;LoginView.js&quot;,
     &quot;NavbarView.js&quot;,
     &quot;SectionView.js&quot;,
-    &quot;TextView.js&quot;,
     &quot;MultiEntriesView.js&quot;,
     &quot;TablePlugin.js&quot;,
     &quot;OutlinePlugin.js&quot;,

Modified: trunk/source/LoginView.js
===================================================================
--- trunk/source/LoginView.js	2005-07-02 19:27:18 UTC (rev 207)
+++ trunk/source/LoginView.js	2005-07-02 19:54:15 UTC (rev 208)
@@ -37,7 +37,7 @@
 /*global document  */
 /*global Util  */
 /*global Cookie  */
-/*global SuggestionBox  */
+/*global UserSuggestionBox  */
 // -------------------------------------------------------------------
 
 
@@ -192,7 +192,7 @@
     this.passwordInput.onkeypress = this._signinPasswordKeyPress.bindAsEventListener(this);
     this.passwordInput.onfocus = this._signinPasswordFocus.bindAsEventListener(this);
 
-    this._myUsernameSuggestionBox = new SuggestionBox(this.usernameInput, this.getWorld().getUsers(), this.passwordInput);
+    this._myUsernameSuggestionBox = new UserSuggestionBox(this.usernameInput, this.getWorld().getUsers(), this.passwordInput);
 
     var signinButton = document.createElement(&quot;input&quot;);
     signinButton.value = &quot;Sign in&quot;;
@@ -388,16 +388,16 @@
 // -------------------------------------------------------------------
 // Suggestion box methods
 // -------------------------------------------------------------------
-function SuggestionBox(inHTMLInputField, inListOfEntries, inNextHTMLField) {
+function UserSuggestionBox(inHTMLInputField, inListOfEntries, inNextHTMLField) {
   this._myInputField = inHTMLInputField;
-  this._myListOfEntries = inListOfEntries.sort(SuggestionBox.compareEntryDisplayNames);
+  this._myListOfEntries = inListOfEntries.sort(UserSuggestionBox.compareEntryDisplayNames);
   this._myNextField = inNextHTMLField;
   
-  this._mySuggestionBoxDivElement = document.createElement('div');
-  // this._mySuggestionBoxDivElement.style.visibility = &quot;hidden&quot;;
-  this._mySuggestionBoxDivElement.style.zIndex = 11;
-  this._mySuggestionBoxDivElement.style.display = &quot;none&quot;;
-  document.body.appendChild(this._mySuggestionBoxDivElement);
+  this._myUserSuggestionBoxDivElement = document.createElement('div');
+  // this._myUserSuggestionBoxDivElement.style.visibility = &quot;hidden&quot;;
+  this._myUserSuggestionBoxDivElement.style.zIndex = 11;
+  this._myUserSuggestionBoxDivElement.style.display = &quot;none&quot;;
+  document.body.appendChild(this._myUserSuggestionBoxDivElement);
   
   this._myInputField.onkeyup = this._keyPressOnInputField.bindAsEventListener(this);
   this._myInputField.onfocus = this._focusOnInputField.bindAsEventListener(this);
@@ -405,7 +405,7 @@
   this._keyPressOnInputField();
 }
 
-SuggestionBox.compareEntryDisplayNames = function (inEntryOne, inEntryTwo) {
+UserSuggestionBox.compareEntryDisplayNames = function (inEntryOne, inEntryTwo) {
   var displayNameOne = inEntryOne.getDisplayName();
   var displayNameTwo = inEntryTwo.getDisplayName();
   if (displayNameOne == displayNameTwo) {
@@ -415,30 +415,30 @@
   }
 };
 
-SuggestionBox.prototype._focusOnInputField = function (inEventObject) {
+UserSuggestionBox.prototype._focusOnInputField = function (inEventObject) {
   this._myInputField.value = &quot;&quot;;
-  this._redisplaySuggestionBox();
+  this._redisplayUserSuggestionBox();
 };
 
 
-SuggestionBox.prototype._keyPressOnInputField = function (inEventObject) {
-  this._redisplaySuggestionBox();
+UserSuggestionBox.prototype._keyPressOnInputField = function (inEventObject) {
+  this._redisplayUserSuggestionBox();
 };
 
 
-SuggestionBox.prototype._blurOnInputField = function (inEventObject) {
+UserSuggestionBox.prototype._blurOnInputField = function (inEventObject) {
   // make the suggestion box disappear
-  this._mySuggestionBoxDivElement.style.display = &quot;none&quot;;
+  this._myUserSuggestionBoxDivElement.style.display = &quot;none&quot;;
 };
 
 
-SuggestionBox.prototype._clickOnSelection = function (inEventObject, inString) {
+UserSuggestionBox.prototype._clickOnSelection = function (inEventObject, inString) {
   this._myInputField.value = inString;
   this._myNextField.select();
 };
 
 
-SuggestionBox.prototype._redisplaySuggestionBox = function () {
+UserSuggestionBox.prototype._redisplayUserSuggestionBox = function () {
   var partialInputString = this._myInputField.value;
   var listOfMatchingStrings = [];
   var key;
@@ -457,9 +457,9 @@
   
   if (listOfMatchingStrings.length === 0) {
     // make the suggestion box disappear
-    this._mySuggestionBoxDivElement.style.display = &quot;none&quot;;
+    this._myUserSuggestionBoxDivElement.style.display = &quot;none&quot;;
   } else {
-    View.removeChildrenOfElement(this._mySuggestionBoxDivElement);
+    View.removeChildrenOfElement(this._myUserSuggestionBoxDivElement);
     var table = document.createElement('table');
     var rowNumber = 0;
     var columnNumber = 0;
@@ -472,20 +472,20 @@
       cell.onmousedown = this._clickOnSelection.bindAsEventListener(this, string);
       rowNumber += 1;
     }
-    this._mySuggestionBoxDivElement.appendChild(table);
+    this._myUserSuggestionBoxDivElement.appendChild(table);
     
     // set-up the suggestion box to open just below the input field it comes from
     var suggestionBoxTop = Util.getOffsetTopFromElement(this._myInputField) + this._myInputField.offsetHeight;
     var suggestionBoxLeft = Util.getOffsetLeftFromElement(this._myInputField);
-    this._mySuggestionBoxDivElement.style.top = suggestionBoxTop + &quot;px&quot;; 
-    this._mySuggestionBoxDivElement.style.left = suggestionBoxLeft + &quot;px&quot;;
+    this._myUserSuggestionBoxDivElement.style.top = suggestionBoxTop + &quot;px&quot;; 
+    this._myUserSuggestionBoxDivElement.style.left = suggestionBoxLeft + &quot;px&quot;;
     // alert(this._myInputField.offsetWidth);
-    this._mySuggestionBoxDivElement.style.width = (this._myInputField.offsetWidth - 2)+ &quot;px&quot;;
+    this._myUserSuggestionBoxDivElement.style.width = (this._myInputField.offsetWidth - 2)+ &quot;px&quot;;
     
-    // this._mySuggestionBoxDivElement.style.zIndex = 11;
-    this._mySuggestionBoxDivElement.className = &quot;suggestion_box&quot;;
-    this._mySuggestionBoxDivElement.style.visibility = &quot;visible&quot;;
-    this._mySuggestionBoxDivElement.style.display = &quot;block&quot;;
+    // this._myUserSuggestionBoxDivElement.style.zIndex = 11;
+    this._myUserSuggestionBoxDivElement.className = &quot;suggestion_box&quot;;
+    this._myUserSuggestionBoxDivElement.style.visibility = &quot;visible&quot;;
+    this._myUserSuggestionBoxDivElement.style.display = &quot;block&quot;;
   }
 };
 

Modified: trunk/source/MultiEntriesView.js
===================================================================
--- trunk/source/MultiEntriesView.js	2005-07-02 19:27:18 UTC (rev 207)
+++ trunk/source/MultiEntriesView.js	2005-07-02 19:54:15 UTC (rev 208)
@@ -37,7 +37,7 @@
 /*global document  */
 /*global Util  */
 /*global Item  */
-/*global TextView  */
+/*global EntryView  */
 // -------------------------------------------------------------------
 
 
@@ -151,7 +151,7 @@
 
 
 /**
- * Sets a function to be used when onclick is called to the TextView
+ * Sets a function to be used when onclick is called to the EntryView
  *
  * @scope    public instance method
  * @param    inEventObject    An event object. 
@@ -165,8 +165,8 @@
 /**
  *
  */
-MultiEntriesView.prototype._handleClick = function(inEvent, inTextView) {
-  if (this._clickFunction &amp;&amp; this._clickFunction(inEvent, inTextView)) {
+MultiEntriesView.prototype._handleClick = function(inEvent, inEntryView) {
+  if (this._clickFunction &amp;&amp; this._clickFunction(inEvent, inEntryView)) {
     return true;
   }
   return false;
@@ -186,8 +186,8 @@
 /**
  *
  */
-MultiEntriesView.prototype._keyPressOnEditField = function(inEvent, inTextView) {
-  Util.assert(inTextView instanceof TextView);
+MultiEntriesView.prototype._keyPressOnEditField = function(inEvent, inEntryView) {
+  Util.assert(inEntryView instanceof EntryView);
   var asciiValueOfKey = inEvent.keyCode;
   var move, doCreateNewEntry;
   switch (asciiValueOfKey) {
@@ -198,29 +198,29 @@
         doCreateNewEntry = true;
         break;
       }
-      if (inTextView != this._entryViews[this._entryViews.length-1]) {move=1;}
+      if (inEntryView != this._entryViews[this._entryViews.length-1]) {move=1;}
       break;
     default: 
       move = 0; 
       break;
   }
   if (doCreateNewEntry) {
-    inTextView.stopEditing();
+    inEntryView.stopEditing();
     this._addSeparator();
     this._addEntryView(null).startEditing();
     return true;
   }
   if (move !== 0) {
-    var index = Util.getArrayIndex(this._entryViews, inTextView);
+    var index = Util.getArrayIndex(this._entryViews, inEntryView);
     Util.assert(index != -1);
     index += move;
     if (index &gt;= 0 &amp;&amp; index &lt; this._entryViews.length) {
-      inTextView.stopEditing();
+      inEntryView.stopEditing();
       this._entryViews[index].startEditing();
       return true;
     }
   }
-  if (this._keyPressFunction &amp;&amp; this._keyPressFunction(inEvent, inTextView)) {
+  if (this._keyPressFunction &amp;&amp; this._keyPressFunction(inEvent, inEntryView)) {
     return true;
   }
   return false;
@@ -233,17 +233,17 @@
 MultiEntriesView.prototype._addEntryView = function(inEntry) {
   var spanElt = document.createElement(&quot;span&quot;);
   spanElt.style.width = '100%';
-  var aTextView = new TextView(this, spanElt, this._item, this._attribute, inEntry, this._className);
-  this._entryViews.push(aTextView);
+  var anEntryView = new EntryView(this, spanElt, this._item, this._attribute, inEntry, this._className);
+  this._entryViews.push(anEntryView);
   this.getHTMLElement().appendChild(spanElt);
-  aTextView.refresh();
+  anEntryView.refresh();
   if (this.isInEditMode()) {
     var listener = this;
-    aTextView.setSuggestions(this._suggestions);
-    aTextView.setKeyPressFunction(function (evt, aTxtView) {return listener._keyPressOnEditField(evt, aTxtView);});
-    aTextView.setClickFunction(function (evt, aTxtView) {return listener._handleClick(evt, aTxtView);});
+    anEntryView.setSuggestions(this._suggestions);
+    anEntryView.setKeyPressFunction(function (evt, entryView) {return listener._keyPressOnEditField(evt, entryView);});
+    anEntryView.setClickFunction(function (evt, entryView) {return listener._handleClick(evt, entryView);});
   }
-  return aTextView;
+  return anEntryView;
 };
 
 

Modified: trunk/source/PageView.js
===================================================================
--- trunk/source/PageView.js	2005-07-02 19:27:18 UTC (rev 207)
+++ trunk/source/PageView.js	2005-07-02 19:54:15 UTC (rev 208)
@@ -37,7 +37,7 @@
 /*global document, HTMLElement  */
 /*global Util  */
 /*global Item  */
-/*global RootView, SectionView, TablePlugin, TextView  */
+/*global RootView, SectionView, TablePlugin, EntryView  */
 // -------------------------------------------------------------------
 
 
@@ -154,11 +154,11 @@
   var pageDivElement = this.getHTMLElement();
   
   var headerElement = View.createAndAppendElement(pageDivElement, &quot;h1&quot;);
-  this._headerText = new TextView(this, headerElement, this._pageItem, attributeCalledName,
+  this._headerText = new EntryView(this, headerElement, this._pageItem, attributeCalledName,
     this._pageItem.getSingleEntryFromAttribute(attributeCalledName), PageView.CSS_CLASS_PAGE_HEADER, false);
 
   var summaryViewDiv = View.createAndAppendElement(pageDivElement, &quot;div&quot;);
-  this._pageSummaryView = new TextView(this, summaryViewDiv, this._pageItem, attributeCalledSummary,
+  this._pageSummaryView = new EntryView(this, summaryViewDiv, this._pageItem, attributeCalledSummary,
     this._pageItem.getSingleEntryFromAttribute(attributeCalledSummary), SectionView.CSS_CLASS_SUMMARY_TEXT, true);
 
   // add &lt;div&gt; elements for each of the sections on the page

Modified: trunk/source/SectionView.js
===================================================================
--- trunk/source/SectionView.js	2005-07-02 19:27:18 UTC (rev 207)
+++ trunk/source/SectionView.js	2005-07-02 19:54:15 UTC (rev 208)
@@ -38,7 +38,7 @@
 /*global window, document  */
 /*global Util  */
 /*global Item  */
-/*global RootView, PageView, TablePlugin, TextView  */
+/*global RootView, PageView, TablePlugin, EntryView  */
 // -------------------------------------------------------------------
 
 
@@ -54,7 +54,7 @@
 SectionView.CSS_CLASS_TEXT_FIELD_IN_TABLE_CELL = &quot;text_field_in_table_cell&quot;;
 SectionView.CSS_CLASS_SELECTED = &quot;selected&quot;;
 SectionView.CSS_CLASS_MORE_LINK = &quot;more&quot;;
-SectionView.CSS_CLASS_TEXT_VIEW = &quot;text_view&quot;;
+SectionView.CSS_CLASS_ENTRY_VIEW = &quot;entry_view&quot;;
 SectionView.CSS_CLASS_SECTION_HEADER = &quot;section_header&quot;;
 SectionView.CSS_CLASS_SUMMARY_TEXT = &quot;summary_text&quot;;
 
@@ -230,12 +230,12 @@
   var headerH2 = View.createAndAppendElement(outerDiv, &quot;h2&quot;);
   var attributeCalledName = this.getWorld().getAttributeCalledName();
   var attributeCalledSummary = this.getWorld().getAttributeCalledSummary();
-  this._headerView = new TextView(this, headerH2, this._section, attributeCalledName,
+  this._headerView = new EntryView(this, headerH2, this._section, attributeCalledName,
     this._section.getSingleEntryFromAttribute(attributeCalledName),
     SectionView.CSS_CLASS_SECTION_HEADER);
   var summaryDiv = View.createAndAppendElement(outerDiv, &quot;div&quot;);
-  this._sectionSummaryView = new TextView(this, summaryDiv, this._section, attributeCalledSummary,
-    this._section.getSingleEntryFromAttribute(attributeCalledSummary), SectionView.CSS_CLASS_TEXT_VIEW, true);
+  this._sectionSummaryView = new EntryView(this, summaryDiv, this._section, attributeCalledSummary,
+    this._section.getSingleEntryFromAttribute(attributeCalledSummary), SectionView.CSS_CLASS_ENTRY_VIEW, true);
   View.createAndAppendElement(outerDiv, &quot;p&quot;);
 
   // create the editing controls, if we're in edit mode
@@ -354,17 +354,17 @@
   var listOfPossibleEntries = this.getWorld().getSuggestedItemsForAttribute(matchingAttribute);
   var entrySpan = View.createAndAppendElement(this._queryEditSpan, &quot;span&quot;);
   
-  var entryTextView =  new TextView(this, entrySpan, myQuery, attributeCalledQueryMatchingValue, matchingEntry,
+  var entryView =  new EntryView(this, entrySpan, myQuery, attributeCalledQueryMatchingValue, matchingEntry,
     RootView.CSS_CLASS_EDIT_MODE);
-  entryTextView.setSuggestions(listOfPossibleEntries);
-  entryTextView.alwaysUseEditField();
-  entryTextView.setAutoWiden(true);
+  entryView.setSuggestions(listOfPossibleEntries);
+  entryView.alwaysUseEditField();
+  entryView.setAutoWiden(true);
   var attributeCalledExpectedType = this.getWorld().getAttributeCalledExpectedType();
   var listOfExpectedTypeEntries = matchingAttribute.getEntriesForAttribute(attributeCalledExpectedType);
-  entryTextView.setExpectedTypeEntries(listOfExpectedTypeEntries);
-  entryTextView.refresh();
+  entryView.setExpectedTypeEntries(listOfExpectedTypeEntries);
+  entryView.refresh();
   var listener = this;
-  entryTextView.setKeyPressFunction(function (evt, aTxtView) {return listener.keyPressOnMatchingValueField(evt, aTxtView);});
+  entryView.setKeyPressFunction(function (evt, entryView) {return listener.keyPressOnMatchingValueField(evt, entryView);});
   myQuery.addObserver(this);
 };
 
@@ -380,9 +380,9 @@
  * @scope    public instance method
  * @return   Returns true if the user pressed the return key, or false otherwise.
  */
-SectionView.prototype.keyPressOnMatchingValueField = function(event, aTextView) {
+SectionView.prototype.keyPressOnMatchingValueField = function(event, anEntryView) {
   if (event.keyCode == Util.ASCII_VALUE_FOR_RETURN) {
-    aTextView.stopEditing();
+    anEntryView.stopEditing();
     return true;
   }
   return false;

Modified: trunk/source/TablePlugin.js
===================================================================
--- trunk/source/TablePlugin.js	2005-07-02 19:27:18 UTC (rev 207)
+++ trunk/source/TablePlugin.js	2005-07-02 19:54:15 UTC (rev 208)
@@ -278,7 +278,7 @@
  * PENDING: 
  * This method observedItemHasChanged() was written back before we 
  * wrote the method above this one, _provisionalItemJustBecomeReal().
- * Now we've got things set up so that the TextView will call
+ * Now we've got things set up so that the EntryView will call
  * our _provisionalItemJustBecomeReal() method when the user first
  * makes a change that causes the provisional item to become real.
  * Now that we have _provisionalItemJustBecomeReal(), we might 
@@ -398,8 +398,8 @@
 
 /**
  * Inserts a table cell into table's row &amp; col, with data from a given item and
- * attribute. Each table cell is displayed with a TextView object.  The HTML 
- * table cell links to the TextView object with the attribute &quot;or_textView&quot;
+ * attribute. Each table cell is displayed with a EntryView object.  The HTML 
+ * table cell links to the EntryView object with the attribute &quot;or_entryView&quot;
  *
  * @scope    public instance method
  * @return   An HTML image element
@@ -413,8 +413,8 @@
   if (this.isInEditMode()) {
     multiEntriesView.setSuggestions(this._hashTableOfEntries[attribute.getUniqueKeyString()]);
     var listener = this;
-    multiEntriesView.setKeyPressFunction(function (evt, aTxtView) {return listener.keyPressOnEditField(evt, aTxtView);});
-    multiEntriesView.setClickFunction(function (evt, aTxtView) {return listener._handleClick(evt, aTxtView);});
+    multiEntriesView.setKeyPressFunction(function (evt, entryView) {return listener.keyPressOnEditField(evt, entryView);});
+    multiEntriesView.setClickFunction(function (evt, entryView) {return listener._handleClick(evt, entryView);});
   }
 };
 
@@ -533,8 +533,8 @@
   }
 };
 
-TablePlugin.prototype._handleClick = function (inEventObject, aTextView) {
-  var rowElement = aTextView.getSuperview().getHTMLElement().parentNode; // textView -&gt; multiEntriesView -&gt; cellElment -&gt; rowElement
+TablePlugin.prototype._handleClick = function (inEventObject, anEntryView) {
+  var rowElement = anEntryView.getSuperview().getHTMLElement().parentNode; // entryView -&gt; multiEntriesView -&gt; cellElment -&gt; rowElement
   return this.selectRow(rowElement);
 };
 
@@ -549,7 +549,7 @@
  * @scope    public class method
  * @return   Returns true if the keyPress is a letter, or false if the keyPress is an arrow key or a key that moves the cursor to another cell. 
  */
-TablePlugin.prototype.keyPressOnEditField = function (inEventObject, aTextView) {
+TablePlugin.prototype.keyPressOnEditField = function (inEventObject, anEntryView) {
   var eventObject = inEventObject;
   var asciiValueOfKey = eventObject.keyCode;
   var shiftKeyPressed = eventObject.shiftKey;
@@ -590,9 +590,9 @@
     
     // line below needs to be called here i.e. early because stopping an edit may change a provisional item
     // to become a &quot;real&quot; one thereby  creating new row for the next provisional item, e.g. this._listOfItems changes
-    aTextView.stopEditing();
+    anEntryView.stopEditing();
 
-    var cellElement = aTextView.getSuperview().getHTMLElement(); // textView's multiEntriesView's
+    var cellElement = anEntryView.getSuperview().getHTMLElement(); // entryView's multiEntriesView's
     var userHitReturnInLastRow = false;
     var shiftBy;
     var numCols = this._numberOfColumns;

Modified: trunk/source/TestSuite.html
===================================================================
--- trunk/source/TestSuite.html	2005-07-02 19:27:18 UTC (rev 207)
+++ trunk/source/TestSuite.html	2005-07-02 19:54:15 UTC (rev 208)
@@ -26,6 +26,7 @@
         testSuite.addTestPage(&quot;../../../source/LintTest.html&quot;);
         testSuite.addTestPage(&quot;../../../source/model/TestSuite.html&quot;);
         testSuite.addTestPage(&quot;../../../source/util/TestSuite.html&quot;);
+        testSuite.addTestPage(&quot;../../../source/view/LintTest.html&quot;);
         return testSuite;
       }
     &lt;/script&gt;

Deleted: trunk/source/TextView.js
===================================================================
--- trunk/source/TextView.js	2005-07-02 19:27:18 UTC (rev 207)
+++ trunk/source/TextView.js	2005-07-02 19:54:15 UTC (rev 208)
@@ -1,811 +0,0 @@
-/*****************************************************************************
- TextView.js
- 
-******************************************************************************
- Written in 2005 by 
-    Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
-    Chih-Chao Lam &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">chao at cs.stanford.edu</A>&gt;
-  
- Copyright rights relinquished under the Creative Commons  
- Public Domain Dedication:
-    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
-  
- You can copy freely from this file.  This work may be freely reproduced, 
- distributed, transmitted, used, modified, built upon, or otherwise exploited
- by anyone for any purpose.
-  
- This work is provided on an &quot;AS IS&quot; basis, without warranties or conditions 
- of any kind, either express or implied, including, without limitation, any 
- warranties or conditions of title, non-infringement, merchantability, or 
- fitness for a particular purpose. You are solely responsible for determining 
- the appropriateness of using or distributing the work and assume all risks 
- associated with use of this work, including but not limited to the risks and 
- costs of errors, compliance with applicable laws, damage to or loss of data 
- or equipment, and unavailability or interruption of operations.
-
- In no event shall the authors or contributors have any liability for any 
- direct, indirect, incidental, special, exemplary, or consequential damages,
- however caused and on any theory of liability, whether in contract, strict 
- liability, or tort (including negligence), arising in any way out of or in 
- connection with the use or distribution of the work.
-*****************************************************************************/
-
-
-// -------------------------------------------------------------------
-// Dependencies, expressed in the syntax that JSLint understands:
-// 
-/*global document  */
-/*global Util  */
-/*global Item, Entry  */
-/*global AttributeSuggestionBox  */
-// -------------------------------------------------------------------
-
-
-// -------------------------------------------------------------------
-// TextView public class constants
-// -------------------------------------------------------------------
-// TextView.ELEMENT_CLASS_TEXT_BLOCK = &quot;text_block&quot;; 
-TextView.CSS_CLASS_VALUE_IS_ITEM = &quot;textViewItem&quot;;
-TextView.PROVISIONAL_COLOR = '#999999';
-
-
-/**
- * An instance of TextView can be placed in any parent container View
- * to display and (if in edit mode) edit multi-lines of text
- *
- * @scope    public instance constructor
- * @extends  View
- * @param    theSuperview    The view that this view is nested in. 
- * @param    theItem         The Item to be displayed and edited by this view. 
- * @param    theAttribute    The attribute of the item to be displayed.
- * @param    theElement      The HTMLElement to display the HTML in. 
- * @param    theClassType    A string that gives a class name to assign to the HTML element. 
- * @param    isMultiLine     a boolean indicating if text view is single line or multi-line
- */
-TextView.prototype = new View();  // makes TextView be a subclass of View
-function TextView(theSuperview, inElement, inItem, inAttribute, inEntry, inClassName, isMultiLine) {
-  Util.assert((!inEntry) || inEntry instanceof Entry);
-  Util.assert(inItem instanceof Item);
-  Util.assert(inAttribute instanceof Item);
-  //Util.assert(theAttribute instanceof Attribute); PENDING need to check that attribute is an attribute
-  
-  this.setSuperview(theSuperview);
-  this.setHTMLElement(inElement);
-  inElement.style.width = &quot;100%&quot;;
-  inElement.style.height = &quot;100%&quot;; // make this element expand to fill parent element where possible
-  this._item = inItem;
-  this._attribute = inAttribute;
-  this._entry = inEntry;
-  this._editField = null;
-  this._className = inClassName;
-  this._isMultiLine = isMultiLine;
-  this._isEditing = false;
-  this._proxyOnKeyFunction = null;
-  this._alwaysUseEditField = null;
-  
-  this._isProvisional = inItem.isProvisional();
-  if (this._isProvisional) {
-    this._provisionalText = inAttribute.getDisplayString();
-  }
-  else if (inEntry &amp;&amp; inEntry.getValue(this._item) instanceof Item) {
-    this._valueIsItem = true;
-  }
-}
-
-
-/**
- *
- */
-TextView.prototype._setupSuggestionBox = function() {
-  if (this._suggestions) {
-    var suggestionBox = new AttributeSuggestionBox(this._editField, this._suggestions);
-    this._suggestionBox = suggestionBox;
-    if (this._editField &amp;&amp; this._autoWiden) {
-      var maxLength = 4;
-      for (var i=0; i &lt; this._suggestions.length;++i) {
-        var aSuggestion = this._suggestions[i];
-        if (aSuggestion.getDisplayString().length &gt; maxLength) {maxLength = aSuggestion.getDisplayString().length;}
-      }
-      this._editField.size = maxLength;
-    }
-  }
-};
-
-/**
- *
- */
-TextView.prototype.alwaysUseEditField = function() {
-  this._alwaysUseEditField = true;
-  if (this._myHasEverBeenDisplayedFlag) {
-    this.startEditing(true);
-  }
-};
-
-/**
- *
- */
-TextView.prototype.setAutoWiden = function(inAutoWiden) {
-  this._autoWiden = inAutoWiden;
-};
-
-/**
- *
- */
-TextView.prototype.setExpectedTypeEntries = function(expectedTypeEntries) {
-  Util.assert(Util.isArray(expectedTypeEntries));
-  for(var i=0;i &lt; expectedTypeEntries.length; ++i) {
-    Util.assert(expectedTypeEntries[i] instanceof Entry);
-  }
-  this._expectedTypeEntries = expectedTypeEntries;
-};
-
-
-/**
- *
- */
-TextView.prototype.setSuggestions = function(suggestionList) {
-  if (suggestionList) {Util.assert(Util.isArray(suggestionList));}
-  this._suggestions = suggestionList;
-};
-
-
-/**
- * Updates the HTML elements in this view to reflect any changes in 
- * the item's attribute values.
- *
- * @scope    public instance method
-*/
-TextView.prototype.refresh = function() {
-  if (!this._myHasEverBeenDisplayedFlag) {
-    this._buildView();
-  } else {
-  // if (weHaveBeenNotifiedOfChangesTo(this._item)) {
-  //   var newText = getNewValueFrom(this._item);
-  //   this._textNode.data = newText;
-  // }
-  }
-};
-
-
-/**
- *
- */
-TextView.prototype._isLozenge = function() {
-  return this._valueIsItem &amp;&amp; !this._alwaysUseEditField;
-};
-
-
-/**
- * Re-creates all the HTML for the TextView, and hands the HTML to the 
- * browser to be re-drawn.
- *
- * @scope    private instance method
- */
-TextView.prototype._buildView = function() {
-  var htmlElement = this.getHTMLElement();
-  View.removeChildrenOfElement(htmlElement);
-  
-  var textString = this._getText();
-  
-  if (this._isProvisional) {
-    this._oldColor = htmlElement.style.color;
-    htmlElement.style.color = TextView.PROVISIONAL_COLOR;
-  }
-  else if (this._isLozenge()) {
-    htmlElement.className += &quot; &quot; + TextView.CSS_CLASS_VALUE_IS_ITEM;
-  }
-  this._textNode = document.createTextNode(textString);
-  htmlElement.appendChild(this._textNode);
-  htmlElement.onclick =  this.onClick.bindAsEventListener(this);
-  if (this._alwaysUseEditField) {
-    this.startEditing(true);
-  }
-    
-  this._myHasEverBeenDisplayedFlag = true;
-};
-
-
-/**
- *
- */
-TextView.prototype._canStartEditing = function() {
-  return (!this._isEditing  &amp;&amp; !(this._valueIsItem &amp;&amp; !this._alwaysUseEditField));
-};
-
-
-/**
- * Switch to edit text field for editing.
- *
- * @scope    public instance method
- */
-TextView.prototype.startEditing = function(dontSelect) {
-  var canStartEditing = !(this._isEditing || this._isLozenge());
-  if (canStartEditing) {
-    var editField = this._editField;
-    if (!editField) {
-      if (this._isMultiLine) {
-        editField = this._editField = document.createElement(&quot;textarea&quot;);
-      }
-      else {
-        editField = this._editField= document.createElement(&quot;input&quot;);
-        editField.type = 'text';
-      }
-      editField.className = this._className;
-      var listener = this; 
-      editField.onblur = this.onBlur.bindAsEventListener(this);
-      editField.onkeypress = this.onKeyPress.bindAsEventListener(this);
-      editField.onkeyup = this.onKeyUp.bindAsEventListener(this);
-      editField.onfocus = this.onFocus.bindAsEventListener(this);
-      editField.defaultValue = this._isProvisional ? '' : this._textNode.data;
-      editField.size = 5; //editField.defaultValue.length+1;
-    }
-    
-    //editField.style.width = this.getHTMLElement().offsetWidth + &quot;px&quot;;  
-    if (this._isMultiLine) {editField.style.height = (this.getHTMLElement().offsetHeight) + &quot;px&quot;;}  
-    
-    this._setupSuggestionBox();
-    this.getHTMLElement().replaceChild(editField, this._textNode);
-    if (!dontSelect) {editField.select();}
-    this._isEditing = true;
-  }
-};
-
-
-/**
- * Called when it's time to stop editing and save the changes.
- *
- * @scope    public instance method
- */
-TextView.prototype.stopEditing = function() {
-  if (this._isEditing) {
-    var newValue;
-    if (this._suggestionBox) {
-      newValue = this._suggestionBox.getSelectedItem();
-    }
-    if (!newValue) {
-      newValue = this._editField.value;
-    }
-    var stillProvisional = this._isProvisional &amp;&amp; !newValue;
-    var htmlElement = this.getHTMLElement();
-
-
-    if (this._suggestionBox) {
-      this._suggestionBox._blurOnInputField();
-    }
-    if (!this._alwaysUseEditField) {
-      this._isEditing = false;
-      if (stillProvisional) {
-        newValue = this._provisionalText;
-      }
-      var newValueDisplayString = &quot;&quot;;
-      if (Util.isString(newValue)) {
-        newValueDisplayString = newValue;
-      }
-      else if (newValue instanceof Item) {
-        newValueDisplayString = newValue.getDisplayString();
-      }
-      this._textNode.data = newValueDisplayString;
-      this._suggestionBox = null;
-      this.getHTMLElement().replaceChild(this._textNode, this._editField);
-    }
-
-    // we need this _writeValue() to be after all display related code, because this may trigger an observer call
-    if (!stillProvisional) { this._writeValue(newValue); }
-  }
-};
-
-
-/**
- * Given a value, this function uses hints form this item's attribute to transform
- * the value to one more suitable for the model. 
- * 
- * For now, all this function does is check to see if expected type of attribute is a 
- * type of category, and if it does not expect a plain text value then transform plain
- * text to a new item belonging to expected category.
- *
- * @scope    private instance method
- * @param    value    The new value to be saved. 
- */
-TextView.prototype._transformToExpectedType = function(value) {
-if (value &amp;&amp; Util.isString(value)) {
-    var repository = this.getWorld();
-    var listOfExpectedTypeEntries;
-    if (this._expectedTypeEntries) {
-      listOfExpectedTypeEntries = this._expectedTypeEntries;
-    }
-    else {
-      var attributeCalledExpectedType = repository.getAttributeCalledExpectedType();
-      listOfExpectedTypeEntries = this._attribute.getEntriesForAttribute(attributeCalledExpectedType);
-    }
-    var categoryCalledCategory = repository.getCategoryCalledCategory();
-    var typeCalledText = repository.getTypeCalledText();
-    var typeCalledDate = repository.getTypeCalledDate();
-    var typeCalledNumber = repository.getTypeCalledNumber();
-    if (listOfExpectedTypeEntries) {
-      for (var i=0; i&lt;listOfExpectedTypeEntries.length; ++i) {
-        var aType = listOfExpectedTypeEntries[i].getValue();
-        switch (aType) {
-          case typeCalledText:
-            return value;
-          case typeCalledNumber:
-            var floatVal = parseFloat(value);
-            if (floatVal != NaN) {return floatVal;}
-            break;
-          case typeCalledDate:
-            var dateVal = Date.parse(value);
-            if (!isNaN(dateVal)) {return new Date(value);}
-            break;
-          default:
-            if (aType.isInCategory(categoryCalledCategory)) {
-              value = repository.newItem(value);
-              value.assignToCategory(aType);
-              if (this._suggestions) {
-                // add new item to suggestion list if list is present
-                // PENDING: should this be using an observer instead?
-                Util.addObjectToSet(value, this._suggestions);
-              }
-              return value;
-            }
-            break;
-        }
-      }
-    }
-  }
-  return value;
-};
-/**
- * Writes edited value back into item entry of repository.
- *
- * @scope    private instance method
- * @param    value    The new value to be saved. 
- */
-TextView.prototype._writeValue = function(value) {
-  if (value === 0 || value) {
-    this.getWorld().beginTransaction();
-    value = this._transformToExpectedType(value);
-
-    var oldValue = null;
-    if (this._entry) {oldValue = this._entry.getValue(this._item);}
-    if (oldValue != value) {
-      var attributeCalledInverseAttribute = this.getWorld().getAttributeCalledInverseAttribute();
-      var listOfInverseAttributeEntries = this._attribute.getEntriesForAttribute(attributeCalledInverseAttribute);
-      if (listOfInverseAttributeEntries.length &gt; 0) {
-        // alert(this._attribute.getDisplayString());
-        // alert(listOfInverseAttributeEntries[0].getDisplayString());
-        var inverseAttr = listOfInverseAttributeEntries[0].getValue(this._attribute);
-        this._entry = this._item.replaceEntryWithConnection(this._entry, this._attribute, value, inverseAttr);
-      }
-      else {
-        this._entry = this._item.replaceEntryWithEntryForAttribute(this._entry, this._attribute, value);
-      }
-      var superview = this.getSuperview();
-      if (superview._provisionalItemJustBecomeReal) {
-        superview._provisionalItemJustBecomeReal(this._item);
-      }
-      if (value instanceof Item) {
-        this._valueIsItem = true;
-        var htmlElement = this.getHTMLElement();
-        if (this._isLozenge() &amp;&amp; !htmlElement.className.match(TextView.CSS_CLASS_VALUE_IS_ITEM)) {
-          htmlElement.className += &quot; &quot; + TextView.CSS_CLASS_VALUE_IS_ITEM;
-        }
-      }
-    }    
-    this.getWorld().endTransaction();
-  }
-  this._restoreText(true); // call restore text in case item is transformed (e.g. Dates will be normalized)
-};
-
-
-/**
- * Returns text string for TextView to be displaying and editing
- *
- * @scope    private instance method
- */
-TextView.prototype._getText = function() {
-  if (this._isProvisional) {return this._provisionalText;}
-  if (this._entry) {return this._item.getDisplayStringForEntry(this._entry);}
-  return '';
-};
-
-
-/**
- * Restores the original text before this editing session
- *
- * @scope    private instance method
- */
-TextView.prototype._restoreText = function(dontSelect) {
-  var oldText = (this._entry) ?  this._getText() : '';
-  if (this._isEditing) {
-    this._editField.value = oldText;
-  }
-  else {
-    this._textNode.data = oldText;
-  }
-  if (!dontSelect) {this._editField.select();}
-};
-
-
-// -------------------------------------------------------------------
-// Event handler methods
-// -------------------------------------------------------------------
-
-/**
- * Sets a function to be used when onclick is called to the TextView
- *
- * @scope    public instance method
- * @param    inEventObject    An event object. 
- */
-TextView.prototype.setClickFunction = function(inClickFunction) {
-  Util.assert(inClickFunction instanceof Function);
-  this._clickFunction = inClickFunction;
-};
-
-
-/**
- * Called when the user clicks on the text.
- *
- * Handles the mouse click event on text view. Called by listener.
- *
- * @scope    public instance method
- * @param    inEventObject    An event object. 
- */
-TextView.prototype.onClick = function(inEventObject) {
-  if (this._clickFunction &amp;&amp; this._clickFunction(inEventObject, this)) {
-    return true;
-  }
-  if (this.isInEditMode()) {
-    this.startEditing();
-  }
-};
-
-
-/**
- *
- */
-TextView.prototype.onFocus = function(inEventObject) {
-  if (this._suggestionBox) {
-    this._suggestionBox._focusOnInputField(inEventObject);
-  }
-};
-
-
-/**
- * Called when focus leaves the text view.
- *
- * Handles loss of focus for text view. Called by listener. Switches back 
- * to static text from editable text.
- *
- * @scope    public instance method
- * @param    inEventObject    An event object. 
- */
-TextView.prototype.onBlur = function(inEventObject) {
-  this.stopEditing();
-};
-
-
-/**
- * Sets a function to be used when onkeypress is called to the TextView
- *
- * @scope    public instance method
- * @param    keyPressFunction    A function. 
- */
-TextView.prototype.setKeyPressFunction = function(keyPressFunction) {
-  this._keyPressFunction = keyPressFunction;
-};
-
-
-/**
- *
- */
-TextView.prototype.onKeyUp = function(inEventObject) {
-  if (this._suggestionBox) {
-    this._suggestionBox._keyUpOnInputField(inEventObject);
-  }
-};
-
-
-/**
- * Called when the user types in editField
- *
- * @scope    public instance method
- * @param    inEventObject    An event object. 
- */
-TextView.prototype.onKeyPress = function(inEventObject) {
-  if (inEventObject.keyCode == Util.ASCII_VALUE_FOR_ESCAPE) {
-    this._restoreText();
-    return true;
-  }
-  if (this._suggestionBox &amp;&amp; this._suggestionBox._keyPressOnInputField(inEventObject)) {
-    return true;
-  }
-  if (this._keyPressFunction &amp;&amp; this._keyPressFunction(inEventObject, this)) {
-    return true;
-  }
-  var editField = this._editField;
-
-  // PENDING: 
-  // Here are some failed attempts at trying to get the editField to 
-  // automatically grow taller as the user types more text into it.
-  // The idea was to avoid having the editField ever show its scroll 
-  // bar. The user shouldn't feel like they're filling in a form; 
-  // they should feel like they're typing a paragraph in a word
-  // processor, and the paragraph grows naturally as they type, 
-  // with all the paragraphs beneath it getting pushed down the page.
-  
-  // ATTEMPT #0: 
-  // Display diagnostic info...
-  // Initially editField.scrollHeight and editField.clientHeight are equal.  
-  // As you type scrollHeight grows. editField.rows is always -1.
-  /*
-  RootView.displayStatusBlurb(&quot;editField.scrollHeight: &quot; + editField.scrollHeight + &quot;, &quot; +
-    &quot;editField.clientHeight: &quot; + editField.clientHeight + &quot;, &quot; +
-    &quot;editField.rows: &quot; + editField.rows);
-  */
-
-  // ATTEMPT #1: 
-  // causes infinite loop -- adding rows doesn't change editField.clientHeight
-  /*
-  while (editField.scrollHeight &gt; editField.clientHeight) {
-    editField.rows += 1;
-  }
-  */
-
-  // ATTEMPT #2: 
-  // slightly clunky, but better than nothing!
-  if (this._isMultiLine &amp;&amp; (editField.scrollHeight &gt; editField.clientHeight)) {
-    editField.style.height = editField.scrollHeight + &quot;px&quot;;
-  }
-
-  // ATTEMPT #3: has no impact
-  /*
-  if (editField.scrollHeight &gt; editField.clientHeight) {
-    editField.clientHeight = editField.scrollHeight;
-  }
-  */
-};
-
-
-/**
- *
- */
-TextView.prototype.noLongerProvisional = function() {
-  if (this._isProvisional) {
-    this._isProvisional = false;
-    this.getHTMLElement().style.color = this._oldColor;
-    // need to set line below because _writeValue() hasn't returned an entry yet
-    this._entry = this._item.getSingleEntryFromAttribute(this._attribute); 
-    this._buildView();
-  }
-};
-
-
-// -------------------------------------------------------------------
-// Suggestion box methods
-// -------------------------------------------------------------------
-
-/**
- *
- */
-function AttributeSuggestionBox(inHTMLInputField, listOfItems) {
-  this._inputField = inHTMLInputField;
-  this._listOfSuggestedItems = listOfItems.sort(AttributeSuggestionBox._compareItemDisplayNames);
-  this._selectedItem = null;
-  this._shouldHide = inHTMLInputField.value.length === 0;
-  
-  this._attributeSuggestionBoxDivElement = document.createElement('div');
-  // this._attributeSuggestionBoxDivElement.style.visibility = &quot;hidden&quot;;
-  this._attributeSuggestionBoxDivElement.style.zIndex = 11;
-  this._attributeSuggestionBoxDivElement.style.display = &quot;none&quot;;
-  document.body.appendChild(this._attributeSuggestionBoxDivElement);
-
- /* this._inputField.onkeyup = this._keyPressOnInputField.bindAsEventListener(this);
-  this._inputField.onfocus = this._focusOnInputField.bindAsEventListener(this);
-  this._inputField.onblur = this._blurOnInputField.bindAsEventListener(this); */
-  //this._keyPressOnInputField();
-}
-
-
-/**
- *
- */
-AttributeSuggestionBox.prototype.getSelectedItem = function () {
-  if (!this._selectedItem) {
-    // check if typed item is identical to suggested item
-    var editValue = this._inputField.value;
-    for (var i = 0; i &lt; this._listOfSuggestedItems.length; ++i) {
-      var item = this._listOfSuggestedItems[i];
-      if (editValue.toLowerCase() == item.getDisplayName().toLowerCase()) {return item;}
-    }
-  }
-  return this._selectedItem;
-};
-
-
-/**
- *
- */
-AttributeSuggestionBox._compareItemDisplayNames = function (itemOne, itemTwo) {
-  var displayNameOne = itemOne.getDisplayString();
-  var displayNameTwo = itemTwo.getDisplayString();
-  if (displayNameOne == displayNameTwo) {
-    return 0;
-  } else {
-    return (displayNameOne &gt; displayNameTwo) ?  1 : -1;
-  }
-};
-
-
-/**
- *
- */
-AttributeSuggestionBox.prototype._focusOnInputField = function (inEventObject) {
-  this._redisplayAttributeSuggestionBox();
-};
-
-
-/**
- *
- */
-AttributeSuggestionBox.prototype._keyPressOnInputField = function (inEventObject) {
-  var numberOfMatchingItems = this._listOfMatchingItems.length;
-  if (numberOfMatchingItems === 0) {return false;}
-
-  var asciiValueOfKey = inEventObject.keyCode;
-  var index = -1;
-  var doSelectItem = false;
-  switch (asciiValueOfKey) {
-    case Util.ASCII_VALUE_FOR_DOWN_ARROW:
-      if (this._selectedItem) {
-        index = (Util.getArrayIndex(this._listOfMatchingItems, this._selectedItem)+1) % numberOfMatchingItems;
-      }
-      else {
-        index = 0;
-      }
-      break;
-    case Util.ASCII_VALUE_FOR_UP_ARROW:
-      if (this._selectedItem) {
-        index = Util.getArrayIndex(this._listOfMatchingItems, this._selectedItem)-1;
-        if (index &lt; 0) {index = numberOfMatchingItems-1;}
-      }
-      else {
-        index = numberOfMatchingItems-1;
-      }
-      break;
-      case Util.ASCII_VALUE_FOR_TAB:
-      if (this._inputField.value.length === 0) {return false;}
-      if (!this._selectedItem) {
-        this._selectedItem = this._listOfMatchingItems[0];
-        doSelectItem = true;
-      }
-      break;
-    case Util.ASCII_VALUE_FOR_RETURN:
-      if (this._selectedItem) {doSelectItem = true;}
-      break;
-    case Util.ASCII_VALUE_FOR_LEFT_ARROW:
-    case Util.ASCII_VALUE_FOR_RIGHT_ARROW:
-      // if left or right arrow keys, then hide suggestion box
-      this._setShouldHide(true);
-      return false;
-    default:
-      // show suggestion box if not already shown, then let editField process keystroke
-      this._setShouldHide(false);
-      return false;
-  }
-  if (index != -1) {
-    this._setShouldHide(false);
-    this._selectedItem = this._listOfMatchingItems[index];
-    this._redisplayAttributeSuggestionBox();
-    return true;
-  }
-  if (doSelectItem) {
-    this._inputField.value = this._selectedItem.getDisplayString();
-    this._setShouldHide(true);
-  }
-  return false;
-};
-
-
-/**
- *
- */
-AttributeSuggestionBox.prototype._keyUpOnInputField = function (inEventObject) {
-  this._redisplayAttributeSuggestionBox();
-};
-
-
-/**
- *
- */
-AttributeSuggestionBox.prototype._blurOnInputField = function () {
-  // make the suggestion box disappear
-  this._attributeSuggestionBoxDivElement.style.display = &quot;none&quot;;
-};
-
-
-/**
- *
- */
-AttributeSuggestionBox.prototype._clickOnSelection = function (inEventObject, item) {
-  this._selectedItem = item;
-};
-
-
-/**
- *
- */
-AttributeSuggestionBox.prototype._setShouldHide = function (shouldHide) {
-  // make the suggestion box disappear
-  this._shouldHide = shouldHide;
-  this._selectedItem = null;
-  if (shouldHide) {
-    this._attributeSuggestionBoxDivElement.style.display = &quot;none&quot;;
-  }
-  else {
-    this._redisplayAttributeSuggestionBox();
-  }
-};
-
-
-/**
- *
- */
-AttributeSuggestionBox.prototype._redisplayAttributeSuggestionBox = function () {
-  //if (this._shouldHide) {return;} // if SuggestionBox is in hide mode, don't show the box
-  
-  var partialInputString = this._inputField.value;
-  var listOfMatchingItems = [];
-  var key;
-  var item;
-
-  for (key in this._listOfSuggestedItems) {
-    item = this._listOfSuggestedItems[key];
-    var lowerCaseEntryString = item.getDisplayString().toLowerCase();
-    var lowerCaseInputString = partialInputString.toLowerCase();
-    var numberOfCharactersToCompare = lowerCaseInputString.length;
-    var shortEntryString = lowerCaseEntryString.substring(0, numberOfCharactersToCompare);
-    if (shortEntryString == lowerCaseInputString) {
-      // we have a match!
-      listOfMatchingItems.push(item);
-    }
-  }
-  this._listOfMatchingItems = listOfMatchingItems;
-
-  if (this._shouldHide || listOfMatchingItems.length === 0) {
-    // make the suggestion box disappear
-    this._attributeSuggestionBoxDivElement.style.display = &quot;none&quot;;
-  } else {
-    View.removeChildrenOfElement(this._attributeSuggestionBoxDivElement);
-    var table = document.createElement('table');
-    var rowNumber = 0;
-    var columnNumber = 0;
-    for (key in listOfMatchingItems) {
-      item = listOfMatchingItems[key];
-      var textNode = document.createTextNode(item.getDisplayString());
-      var row = table.insertRow(rowNumber);
-      var cell = row.insertCell(columnNumber);
-      row.className = (this._selectedItem == item) ? &quot;selected&quot;:&quot;&quot;;
-      //cell.style.background = (this._selectedItem == item) ? &quot;rgb(0%,70%,100%)&quot;:&quot;&quot;; //pending need to CSS-ify this
-      cell.appendChild(textNode);
-      cell.onmousedown = this._clickOnSelection.bindAsEventListener(this, item);
-      rowNumber += 1;
-    }
-    this._attributeSuggestionBoxDivElement.appendChild(table);
-
-    // set-up the suggestion box to open just below the input field it comes from
-    var AttributeSuggestionBoxTop = Util.getOffsetTopFromElement(this._inputField) + this._inputField.offsetHeight;
-    var AttributeSuggestionBoxLeft = Util.getOffsetLeftFromElement(this._inputField);
-    this._attributeSuggestionBoxDivElement.style.top = AttributeSuggestionBoxTop + &quot;px&quot;; 
-    this._attributeSuggestionBoxDivElement.style.left = AttributeSuggestionBoxLeft + &quot;px&quot;;
-    // alert(this._inputField.offsetWidth);
-    this._attributeSuggestionBoxDivElement.style.width = (this._inputField.offsetWidth - 2)+ &quot;px&quot;;
-
-    // this._attributeSuggestionBoxDivElement.style.zIndex = 11;
-    this._attributeSuggestionBoxDivElement.className = &quot;suggestion_box&quot;;
-    this._attributeSuggestionBoxDivElement.style.visibility = &quot;visible&quot;;
-    this._attributeSuggestionBoxDivElement.style.display = &quot;block&quot;;
-  }
-};
-
-// -------------------------------------------------------------------
-// End of file
-// -------------------------------------------------------------------
\ No newline at end of file

Modified: trunk/source/base_style.css
===================================================================
--- trunk/source/base_style.css	2005-07-02 19:27:18 UTC (rev 207)
+++ trunk/source/base_style.css	2005-07-02 19:54:15 UTC (rev 208)
@@ -612,7 +612,7 @@
 /****************************************/
 /* Text view styles                     */
 
-.text_view {
+.entry_view {
   /* height: 100%; */
   width: 100%;
   font-family: Arial, Verdana, sans-serif;
@@ -622,7 +622,7 @@
   /* overflow: visible; */
 }
 
-.textViewItem {
+.entryViewItem {
   background-color:#DEE7F8;
   padding: 1px;
   border: thin solid #A4BDEC;	

Copied: trunk/source/view/EntryView.js (from rev 203, trunk/source/TextView.js)
===================================================================
--- trunk/source/TextView.js	2005-07-01 02:21:33 UTC (rev 203)
+++ trunk/source/view/EntryView.js	2005-07-02 19:54:15 UTC (rev 208)
@@ -0,0 +1,584 @@
+/*****************************************************************************
+ EntryView.js
+ 
+******************************************************************************
+ Written in 2005 by 
+    Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
+    Chih-Chao Lam &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">chao at cs.stanford.edu</A>&gt;
+  
+ Copyright rights relinquished under the Creative Commons  
+ Public Domain Dedication:
+    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
+  
+ You can copy freely from this file.  This work may be freely reproduced, 
+ distributed, transmitted, used, modified, built upon, or otherwise exploited
+ by anyone for any purpose.
+  
+ This work is provided on an &quot;AS IS&quot; basis, without warranties or conditions 
+ of any kind, either express or implied, including, without limitation, any 
+ warranties or conditions of title, non-infringement, merchantability, or 
+ fitness for a particular purpose. You are solely responsible for determining 
+ the appropriateness of using or distributing the work and assume all risks 
+ associated with use of this work, including but not limited to the risks and 
+ costs of errors, compliance with applicable laws, damage to or loss of data 
+ or equipment, and unavailability or interruption of operations.
+
+ In no event shall the authors or contributors have any liability for any 
+ direct, indirect, incidental, special, exemplary, or consequential damages,
+ however caused and on any theory of liability, whether in contract, strict 
+ liability, or tort (including negligence), arising in any way out of or in 
+ connection with the use or distribution of the work.
+*****************************************************************************/
+
+
+// -------------------------------------------------------------------
+// Dependencies, expressed in the syntax that JSLint understands:
+// 
+/*global document  */
+/*global Util  */
+/*global Item, Entry  */
+/*global SuggestionBox  */
+// -------------------------------------------------------------------
+
+
+// -------------------------------------------------------------------
+// EntryView public class constants
+// -------------------------------------------------------------------
+// EntryView.ELEMENT_CLASS_TEXT_BLOCK = &quot;text_block&quot;; 
+EntryView.CSS_CLASS_VALUE_IS_ITEM = &quot;entryViewItem&quot;;
+EntryView.PROVISIONAL_COLOR = '#999999';
+
+
+/**
+ * An instance of EntryView can be placed in any parent container View
+ * to display and (if in edit mode) edit multi-lines of text
+ *
+ * @scope    public instance constructor
+ * @extends  View
+ * @param    theSuperview    The view that this view is nested in. 
+ * @param    theItem         The Item to be displayed and edited by this view. 
+ * @param    theAttribute    The attribute of the item to be displayed.
+ * @param    theElement      The HTMLElement to display the HTML in. 
+ * @param    theClassType    A string that gives a class name to assign to the HTML element. 
+ * @param    isMultiLine     a boolean indicating if text view is single line or multi-line
+ */
+EntryView.prototype = new View();  // makes EntryView be a subclass of View
+function EntryView(theSuperview, inElement, inItem, inAttribute, inEntry, inClassName, isMultiLine) {
+  Util.assert((!inEntry) || inEntry instanceof Entry);
+  Util.assert(inItem instanceof Item);
+  Util.assert(inAttribute instanceof Item);
+  //Util.assert(theAttribute instanceof Attribute); PENDING need to check that attribute is an attribute
+  
+  this.setSuperview(theSuperview);
+  this.setHTMLElement(inElement);
+  inElement.style.width = &quot;100%&quot;;
+  inElement.style.height = &quot;100%&quot;; // make this element expand to fill parent element where possible
+  this._item = inItem;
+  this._attribute = inAttribute;
+  this._entry = inEntry;
+  this._editField = null;
+  this._className = inClassName;
+  this._isMultiLine = isMultiLine;
+  this._isEditing = false;
+  this._proxyOnKeyFunction = null;
+  this._alwaysUseEditField = null;
+  
+  this._isProvisional = inItem.isProvisional();
+  if (this._isProvisional) {
+    this._provisionalText = inAttribute.getDisplayString();
+  }
+  else if (inEntry &amp;&amp; inEntry.getValue(this._item) instanceof Item) {
+    this._valueIsItem = true;
+  }
+}
+
+
+/**
+ *
+ */
+EntryView.prototype._setupSuggestionBox = function() {
+  if (this._suggestions) {
+    var suggestionBox = new SuggestionBox(this._editField, this._suggestions);
+    this._suggestionBox = suggestionBox;
+    if (this._editField &amp;&amp; this._autoWiden) {
+      var maxLength = 4;
+      for (var i=0; i &lt; this._suggestions.length;++i) {
+        var aSuggestion = this._suggestions[i];
+        if (aSuggestion.getDisplayString().length &gt; maxLength) {maxLength = aSuggestion.getDisplayString().length;}
+      }
+      this._editField.size = maxLength;
+    }
+  }
+};
+
+/**
+ *
+ */
+EntryView.prototype.alwaysUseEditField = function() {
+  this._alwaysUseEditField = true;
+  if (this._myHasEverBeenDisplayedFlag) {
+    this.startEditing(true);
+  }
+};
+
+/**
+ *
+ */
+EntryView.prototype.setAutoWiden = function(inAutoWiden) {
+  this._autoWiden = inAutoWiden;
+};
+
+/**
+ *
+ */
+EntryView.prototype.setExpectedTypeEntries = function(expectedTypeEntries) {
+  Util.assert(Util.isArray(expectedTypeEntries));
+  for(var i=0;i &lt; expectedTypeEntries.length; ++i) {
+    Util.assert(expectedTypeEntries[i] instanceof Entry);
+  }
+  this._expectedTypeEntries = expectedTypeEntries;
+};
+
+
+/**
+ *
+ */
+EntryView.prototype.setSuggestions = function(suggestionList) {
+  if (suggestionList) {Util.assert(Util.isArray(suggestionList));}
+  this._suggestions = suggestionList;
+};
+
+
+/**
+ * Updates the HTML elements in this view to reflect any changes in 
+ * the item's attribute values.
+ *
+ * @scope    public instance method
+*/
+EntryView.prototype.refresh = function() {
+  if (!this._myHasEverBeenDisplayedFlag) {
+    this._buildView();
+  } else {
+  // if (weHaveBeenNotifiedOfChangesTo(this._item)) {
+  //   var newText = getNewValueFrom(this._item);
+  //   this._textNode.data = newText;
+  // }
+  }
+};
+
+
+/**
+ *
+ */
+EntryView.prototype._isLozenge = function() {
+  return this._valueIsItem &amp;&amp; !this._alwaysUseEditField;
+};
+
+
+/**
+ * Re-creates all the HTML for the EntryView, and hands the HTML to the 
+ * browser to be re-drawn.
+ *
+ * @scope    private instance method
+ */
+EntryView.prototype._buildView = function() {
+  var htmlElement = this.getHTMLElement();
+  View.removeChildrenOfElement(htmlElement);
+  
+  var textString = this._getText();
+  
+  if (this._isProvisional) {
+    this._oldColor = htmlElement.style.color;
+    htmlElement.style.color = EntryView.PROVISIONAL_COLOR;
+  }
+  else if (this._isLozenge()) {
+    htmlElement.className += &quot; &quot; + EntryView.CSS_CLASS_VALUE_IS_ITEM;
+  }
+  this._textNode = document.createTextNode(textString);
+  htmlElement.appendChild(this._textNode);
+  htmlElement.onclick =  this.onClick.bindAsEventListener(this);
+  if (this._alwaysUseEditField) {
+    this.startEditing(true);
+  }
+    
+  this._myHasEverBeenDisplayedFlag = true;
+};
+
+
+/**
+ *
+ */
+EntryView.prototype._canStartEditing = function() {
+  return (!this._isEditing  &amp;&amp; !(this._valueIsItem &amp;&amp; !this._alwaysUseEditField));
+};
+
+
+/**
+ * Switch to edit text field for editing.
+ *
+ * @scope    public instance method
+ */
+EntryView.prototype.startEditing = function(dontSelect) {
+  var canStartEditing = !(this._isEditing || this._isLozenge());
+  if (canStartEditing) {
+    var editField = this._editField;
+    if (!editField) {
+      if (this._isMultiLine) {
+        editField = this._editField = document.createElement(&quot;textarea&quot;);
+      }
+      else {
+        editField = this._editField= document.createElement(&quot;input&quot;);
+        editField.type = 'text';
+      }
+      editField.className = this._className;
+      var listener = this; 
+      editField.onblur = this.onBlur.bindAsEventListener(this);
+      editField.onkeypress = this.onKeyPress.bindAsEventListener(this);
+      editField.onkeyup = this.onKeyUp.bindAsEventListener(this);
+      editField.onfocus = this.onFocus.bindAsEventListener(this);
+      editField.defaultValue = this._isProvisional ? '' : this._textNode.data;
+      editField.size = 5; //editField.defaultValue.length+1;
+    }
+    
+    //editField.style.width = this.getHTMLElement().offsetWidth + &quot;px&quot;;  
+    if (this._isMultiLine) {editField.style.height = (this.getHTMLElement().offsetHeight) + &quot;px&quot;;}  
+    
+    this._setupSuggestionBox();
+    this.getHTMLElement().replaceChild(editField, this._textNode);
+    if (!dontSelect) {editField.select();}
+    this._isEditing = true;
+  }
+};
+
+
+/**
+ * Called when it's time to stop editing and save the changes.
+ *
+ * @scope    public instance method
+ */
+EntryView.prototype.stopEditing = function() {
+  if (this._isEditing) {
+    var newValue;
+    if (this._suggestionBox) {
+      newValue = this._suggestionBox.getSelectedItem();
+    }
+    if (!newValue) {
+      newValue = this._editField.value;
+    }
+    var stillProvisional = this._isProvisional &amp;&amp; !newValue;
+    var htmlElement = this.getHTMLElement();
+
+
+    if (this._suggestionBox) {
+      this._suggestionBox._blurOnInputField();
+    }
+    if (!this._alwaysUseEditField) {
+      this._isEditing = false;
+      if (stillProvisional) {
+        newValue = this._provisionalText;
+      }
+      var newValueDisplayString = &quot;&quot;;
+      if (Util.isString(newValue)) {
+        newValueDisplayString = newValue;
+      }
+      else if (newValue instanceof Item) {
+        newValueDisplayString = newValue.getDisplayString();
+      }
+      this._textNode.data = newValueDisplayString;
+      this._suggestionBox = null;
+      this.getHTMLElement().replaceChild(this._textNode, this._editField);
+    }
+
+    // we need this _writeValue() to be after all display related code, because this may trigger an observer call
+    if (!stillProvisional) { this._writeValue(newValue); }
+  }
+};
+
+
+/**
+ * Given a value, this function uses hints form this item's attribute to transform
+ * the value to one more suitable for the model. 
+ * 
+ * For now, all this function does is check to see if expected type of attribute is a 
+ * type of category, and if it does not expect a plain text value then transform plain
+ * text to a new item belonging to expected category.
+ *
+ * @scope    private instance method
+ * @param    value    The new value to be saved. 
+ */
+EntryView.prototype._transformToExpectedType = function(value) {
+if (value &amp;&amp; Util.isString(value)) {
+    var repository = this.getWorld();
+    var listOfExpectedTypeEntries;
+    if (this._expectedTypeEntries) {
+      listOfExpectedTypeEntries = this._expectedTypeEntries;
+    }
+    else {
+      var attributeCalledExpectedType = repository.getAttributeCalledExpectedType();
+      listOfExpectedTypeEntries = this._attribute.getEntriesForAttribute(attributeCalledExpectedType);
+    }
+    var categoryCalledCategory = repository.getCategoryCalledCategory();
+    var typeCalledText = repository.getTypeCalledText();
+    var typeCalledDate = repository.getTypeCalledDate();
+    var typeCalledNumber = repository.getTypeCalledNumber();
+    if (listOfExpectedTypeEntries) {
+      for (var i=0; i&lt;listOfExpectedTypeEntries.length; ++i) {
+        var aType = listOfExpectedTypeEntries[i].getValue();
+        switch (aType) {
+          case typeCalledText:
+            return value;
+          case typeCalledNumber:
+            var floatVal = parseFloat(value);
+            if (floatVal != NaN) {return floatVal;}
+            break;
+          case typeCalledDate:
+            var dateVal = Date.parse(value);
+            if (!isNaN(dateVal)) {return new Date(value);}
+            break;
+          default:
+            if (aType.isInCategory(categoryCalledCategory)) {
+              value = repository.newItem(value);
+              value.assignToCategory(aType);
+              if (this._suggestions) {
+                // add new item to suggestion list if list is present
+                // PENDING: should this be using an observer instead?
+                Util.addObjectToSet(value, this._suggestions);
+              }
+              return value;
+            }
+            break;
+        }
+      }
+    }
+  }
+  return value;
+};
+/**
+ * Writes edited value back into item entry of repository.
+ *
+ * @scope    private instance method
+ * @param    value    The new value to be saved. 
+ */
+EntryView.prototype._writeValue = function(value) {
+  if (value === 0 || value) {
+    this.getWorld().beginTransaction();
+    value = this._transformToExpectedType(value);
+
+    var oldValue = null;
+    if (this._entry) {oldValue = this._entry.getValue(this._item);}
+    if (oldValue != value) {
+      var attributeCalledInverseAttribute = this.getWorld().getAttributeCalledInverseAttribute();
+      var listOfInverseAttributeEntries = this._attribute.getEntriesForAttribute(attributeCalledInverseAttribute);
+      if (listOfInverseAttributeEntries.length &gt; 0) {
+        // alert(this._attribute.getDisplayString());
+        // alert(listOfInverseAttributeEntries[0].getDisplayString());
+        var inverseAttr = listOfInverseAttributeEntries[0].getValue(this._attribute);
+        this._entry = this._item.replaceEntryWithConnection(this._entry, this._attribute, value, inverseAttr);
+      }
+      else {
+        this._entry = this._item.replaceEntryWithEntryForAttribute(this._entry, this._attribute, value);
+      }
+      var superview = this.getSuperview();
+      if (superview._provisionalItemJustBecomeReal) {
+        superview._provisionalItemJustBecomeReal(this._item);
+      }
+      if (value instanceof Item) {
+        this._valueIsItem = true;
+        var htmlElement = this.getHTMLElement();
+        if (this._isLozenge() &amp;&amp; !htmlElement.className.match(EntryView.CSS_CLASS_VALUE_IS_ITEM)) {
+          htmlElement.className += &quot; &quot; + EntryView.CSS_CLASS_VALUE_IS_ITEM;
+        }
+      }
+    }    
+    this.getWorld().endTransaction();
+  }
+  this._restoreText(true); // call restore text in case item is transformed (e.g. Dates will be normalized)
+};
+
+
+/**
+ * Returns text string for EntryView to be displaying and editing
+ *
+ * @scope    private instance method
+ */
+EntryView.prototype._getText = function() {
+  if (this._isProvisional) {return this._provisionalText;}
+  if (this._entry) {return this._item.getDisplayStringForEntry(this._entry);}
+  return '';
+};
+
+
+/**
+ * Restores the original text before this editing session
+ *
+ * @scope    private instance method
+ */
+EntryView.prototype._restoreText = function(dontSelect) {
+  var oldText = (this._entry) ?  this._getText() : '';
+  if (this._isEditing) {
+    this._editField.value = oldText;
+  }
+  else {
+    this._textNode.data = oldText;
+  }
+  if (!dontSelect) {this._editField.select();}
+};
+
+
+// -------------------------------------------------------------------
+// Event handler methods
+// -------------------------------------------------------------------
+
+/**
+ * Sets a function to be used when onclick is called to the EntryView
+ *
+ * @scope    public instance method
+ * @param    inEventObject    An event object. 
+ */
+EntryView.prototype.setClickFunction = function(inClickFunction) {
+  Util.assert(inClickFunction instanceof Function);
+  this._clickFunction = inClickFunction;
+};
+
+
+/**
+ * Called when the user clicks on the text.
+ *
+ * Handles the mouse click event on text view. Called by listener.
+ *
+ * @scope    public instance method
+ * @param    inEventObject    An event object. 
+ */
+EntryView.prototype.onClick = function(inEventObject) {
+  if (this._clickFunction &amp;&amp; this._clickFunction(inEventObject, this)) {
+    return true;
+  }
+  if (this.isInEditMode()) {
+    this.startEditing();
+  }
+};
+
+
+/**
+ *
+ */
+EntryView.prototype.onFocus = function(inEventObject) {
+  if (this._suggestionBox) {
+    this._suggestionBox._focusOnInputField(inEventObject);
+  }
+};
+
+
+/**
+ * Called when focus leaves the text view.
+ *
+ * Handles loss of focus for text view. Called by listener. Switches back 
+ * to static text from editable text.
+ *
+ * @scope    public instance method
+ * @param    inEventObject    An event object. 
+ */
+EntryView.prototype.onBlur = function(inEventObject) {
+  this.stopEditing();
+};
+
+
+/**
+ * Sets a function to be used when onkeypress is called to the EntryView
+ *
+ * @scope    public instance method
+ * @param    keyPressFunction    A function. 
+ */
+EntryView.prototype.setKeyPressFunction = function(keyPressFunction) {
+  this._keyPressFunction = keyPressFunction;
+};
+
+
+/**
+ *
+ */
+EntryView.prototype.onKeyUp = function(inEventObject) {
+  if (this._suggestionBox) {
+    this._suggestionBox._keyUpOnInputField(inEventObject);
+  }
+};
+
+
+/**
+ * Called when the user types in editField
+ *
+ * @scope    public instance method
+ * @param    inEventObject    An event object. 
+ */
+EntryView.prototype.onKeyPress = function(inEventObject) {
+  if (inEventObject.keyCode == Util.ASCII_VALUE_FOR_ESCAPE) {
+    this._restoreText();
+    return true;
+  }
+  if (this._suggestionBox &amp;&amp; this._suggestionBox._keyPressOnInputField(inEventObject)) {
+    return true;
+  }
+  if (this._keyPressFunction &amp;&amp; this._keyPressFunction(inEventObject, this)) {
+    return true;
+  }
+  var editField = this._editField;
+
+  // PENDING: 
+  // Here are some failed attempts at trying to get the editField to 
+  // automatically grow taller as the user types more text into it.
+  // The idea was to avoid having the editField ever show its scroll 
+  // bar. The user shouldn't feel like they're filling in a form; 
+  // they should feel like they're typing a paragraph in a word
+  // processor, and the paragraph grows naturally as they type, 
+  // with all the paragraphs beneath it getting pushed down the page.
+  
+  // ATTEMPT #0: 
+  // Display diagnostic info...
+  // Initially editField.scrollHeight and editField.clientHeight are equal.  
+  // As you type scrollHeight grows. editField.rows is always -1.
+  /*
+  RootView.displayStatusBlurb(&quot;editField.scrollHeight: &quot; + editField.scrollHeight + &quot;, &quot; +
+    &quot;editField.clientHeight: &quot; + editField.clientHeight + &quot;, &quot; +
+    &quot;editField.rows: &quot; + editField.rows);
+  */
+
+  // ATTEMPT #1: 
+  // causes infinite loop -- adding rows doesn't change editField.clientHeight
+  /*
+  while (editField.scrollHeight &gt; editField.clientHeight) {
+    editField.rows += 1;
+  }
+  */
+
+  // ATTEMPT #2: 
+  // slightly clunky, but better than nothing!
+  if (this._isMultiLine &amp;&amp; (editField.scrollHeight &gt; editField.clientHeight)) {
+    editField.style.height = editField.scrollHeight + &quot;px&quot;;
+  }
+
+  // ATTEMPT #3: has no impact
+  /*
+  if (editField.scrollHeight &gt; editField.clientHeight) {
+    editField.clientHeight = editField.scrollHeight;
+  }
+  */
+};
+
+
+/**
+ *
+ */
+EntryView.prototype.noLongerProvisional = function() {
+  if (this._isProvisional) {
+    this._isProvisional = false;
+    this.getHTMLElement().style.color = this._oldColor;
+    // need to set line below because _writeValue() hasn't returned an entry yet
+    this._entry = this._item.getSingleEntryFromAttribute(this._attribute); 
+    this._buildView();
+  }
+};
+
+
+// -------------------------------------------------------------------
+// End of file
+// -------------------------------------------------------------------
\ No newline at end of file

Added: trunk/source/view/LintTest.html
===================================================================
--- trunk/source/view/LintTest.html	2005-07-02 19:27:18 UTC (rev 207)
+++ trunk/source/view/LintTest.html	2005-07-02 19:54:15 UTC (rev 208)
@@ -0,0 +1,86 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
+&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.1//EN&quot; &quot;<A HREF="http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd</A>&quot;&gt;
+&lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot; xml:lang=&quot;en&quot; &gt;
+
+&lt;!-- 
+ Written in 2005 by Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
+  
+ Copyright rights relinquished under the Creative Commons  
+ Public Domain Dedication:
+    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
+--&gt;
+
+  &lt;head&gt;
+    &lt;title&gt;Unit tests using jslint&lt;/title&gt;
+
+    &lt;script type=&quot;text/javascript&quot; src=&quot;../../third_party/jsunit/jsunit2_1/app/jsUnitCore.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;../../third_party/jslint/fulljslint.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;../util/Util.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;../util/LintTool.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;LintTest.js&quot;&gt;&lt;/script&gt;
+  &lt;/head&gt;
+  
+  &lt;body&gt;
+    &lt;h1&gt;Unit tests using jslint&lt;/h1&gt;
+
+    &lt;p&gt;This page is used to run unit tests for the JavaScript code in the 
+    OpenRecord project.&lt;/p&gt;
+    
+    &lt;p&gt;&nbsp;&lt;/p&gt;
+    &lt;hr/&gt;
+    &lt;p&gt;To see the tests, open this .html file in a text editor. Or, within a  
+    web browser, you should be able see the source for this file by using 
+    some menu like &lt;b&gt;View&lt;/b&gt; followed by &lt;b&gt;Page Source&lt;/b&gt;. The tests 
+    may be in this file, or they may be in a separate file that has the
+    same name as this one, except with a .js extension instead of a .html
+    extension.&lt;/p&gt;
+ 
+    &lt;p&gt;The unit tests are set up to run in the
+    &lt;a href=&quot;<A HREF="http://www.edwardh.com/jsunit/">http://www.edwardh.com/jsunit/</A>&quot; rel=&quot;external&quot;&gt;JsUnit framework&lt;/a&gt;
+    written by 
+    &lt;a href=&quot;<A HREF="http://www.edwardh.com/">http://www.edwardh.com/</A>&quot; rel=&quot;external&quot;&gt;Edward Hieatt&lt;/a&gt;. &lt;/p&gt;
+
+    &lt;p&gt;If you're looking at this page across an &quot;<A HREF="http://">http://</A>&quot; connection, rather
+    than having loaded it as a &quot;<A HREF="file:///">file:///</A>&quot;, then you may be able to run the
+    unit tests. The web server that served you this page may also have a
+    JsUnit testRunner available. If so, you should be able to run these unit
+    tests by going to
+    &lt;a href=&quot;../../third_party/jsunit/jsunit2_1/testRunner.html?testpage=&quot; 
+    onclick=&quot;href+=window.location.href;&quot; rel=&quot;external&quot;&gt;the local testRunner 
+    page&lt;/a&gt;, and hitting the &lt;b&gt;Run&lt;/b&gt; button.&lt;/p&gt;
+
+    &lt;p&gt;You can also run these unit tests on your local computer. To do that you 
+    first need to download &lt;a href=&quot;<A HREF="http://www.edwardh.com/jsunit/">http://www.edwardh.com/jsunit/</A>&quot; 
+    rel=&quot;external&quot;&gt;JsUnit&lt;/a&gt;.&lt;/p&gt;
+    
+    &lt;p&gt;&nbsp;&lt;/p&gt;
+    &lt;hr/&gt;
+    &lt;p class=&quot;copyright&quot;&gt;You can copy freely from this work &mdash; copyright 
+    rights relinquished under the Creative Commons  
+    &lt;a rel=&quot;license external&quot; 
+    href=&quot;<A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>&quot;&gt;Public Domain 
+    Dedication&lt;/a&gt;.&lt;/p&gt;
+
+&lt;!-- Creative Commons metadata for Public Domain License 
+
+&lt;rdf:RDF xmlns=&quot;<A HREF="http://web.resource.org/cc/">http://web.resource.org/cc/</A>&quot;
+    xmlns:dc=&quot;<A HREF="http://purl.org/dc/elements/1.1/">http://purl.org/dc/elements/1.1/</A>&quot;
+    xmlns:rdf=&quot;<A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#">http://www.w3.org/1999/02/22-rdf-syntax-ns#</A>&quot;&gt;
+&lt;Work rdf:about=&quot;&quot;&gt;
+   &lt;dc:title&gt;openrecord.org&lt;/dc:title&gt;
+   &lt;dc:type rdf:resource=&quot;<A HREF="http://purl.org/dc/dcmitype/Text">http://purl.org/dc/dcmitype/Text</A>&quot; /&gt;
+   &lt;license rdf:resource=&quot;<A HREF="http://web.resource.org/cc/PublicDomain">http://web.resource.org/cc/PublicDomain</A>&quot; /&gt;
+&lt;/Work&gt;
+
+&lt;License rdf:about=&quot;<A HREF="http://web.resource.org/cc/PublicDomain">http://web.resource.org/cc/PublicDomain</A>&quot;&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Reproduction">http://web.resource.org/cc/Reproduction</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Distribution">http://web.resource.org/cc/Distribution</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/DerivativeWorks">http://web.resource.org/cc/DerivativeWorks</A>&quot; /&gt;
+&lt;/License&gt;
+
+&lt;/rdf:RDF&gt;
+
+--&gt;
+  &lt;/body&gt;
+&lt;/html&gt;
+

Added: trunk/source/view/LintTest.js
===================================================================
--- trunk/source/view/LintTest.js	2005-07-02 19:27:18 UTC (rev 207)
+++ trunk/source/view/LintTest.js	2005-07-02 19:54:15 UTC (rev 208)
@@ -0,0 +1,56 @@
+/*****************************************************************************
+ LintTest.js
+ 
+******************************************************************************
+ Written in 2005 by Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
+  
+ Copyright rights relinquished under the Creative Commons  
+ Public Domain Dedication:
+    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
+  
+ You can copy freely from this file.  This work may be freely reproduced, 
+ distributed, transmitted, used, modified, built upon, or otherwise exploited
+ by anyone for any purpose.
+  
+ This work is provided on an &quot;AS IS&quot; basis, without warranties or conditions 
+ of any kind, either express or implied, including, without limitation, any 
+ warranties or conditions of title, non-infringement, merchantability, or 
+ fitness for a particular purpose. You are solely responsible for determining 
+ the appropriateness of using or distributing the work and assume all risks 
+ associated with use of this work, including but not limited to the risks and 
+ costs of errors, compliance with applicable laws, damage to or loss of data 
+ or equipment, and unavailability or interruption of operations.
+
+ In no event shall the authors or contributors have any liability for any 
+ direct, indirect, incidental, special, exemplary, or consequential damages,
+ however caused and on any theory of liability, whether in contract, strict 
+ liability, or tort (including negligence), arising in any way out of or in 
+ connection with the use or distribution of the work.
+*****************************************************************************/
+ 
+// -------------------------------------------------------------------
+// Dependencies, expressed in the syntax that JSLint understands:
+// 
+/*global LintTool, assertTrue, setUp, tearDown */
+// -------------------------------------------------------------------
+
+function setUp() {
+}
+
+function testJsLintOnOpenRecordCode() {
+  var listOfSourceCodeFiles = [
+    &quot;EntryView.js&quot;,
+    &quot;SuggestionBox.js&quot;];
+  var prefix = &quot;../../../source/view/&quot;;
+  var errorReport = LintTool.getErrorReportFromListOfFilesnames(listOfSourceCodeFiles, prefix);
+  var message = &quot;Lint check \n&quot; + errorReport;
+  assertTrue(message, !errorReport);
+}
+
+function tearDown() {
+}
+
+
+// -------------------------------------------------------------------
+// End of file
+// -------------------------------------------------------------------

Added: trunk/source/view/SuggestionBox.js
===================================================================
--- trunk/source/view/SuggestionBox.js	2005-07-02 19:27:18 UTC (rev 207)
+++ trunk/source/view/SuggestionBox.js	2005-07-02 19:54:15 UTC (rev 208)
@@ -0,0 +1,268 @@
+/*****************************************************************************
+ SuggestionBox.js
+ 
+******************************************************************************
+ Written in 2005 by 
+    Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
+    Chih-Chao Lam &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">chao at cs.stanford.edu</A>&gt;
+  
+ Copyright rights relinquished under the Creative Commons  
+ Public Domain Dedication:
+    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
+  
+ You can copy freely from this file.  This work may be freely reproduced, 
+ distributed, transmitted, used, modified, built upon, or otherwise exploited
+ by anyone for any purpose.
+  
+ This work is provided on an &quot;AS IS&quot; basis, without warranties or conditions 
+ of any kind, either express or implied, including, without limitation, any 
+ warranties or conditions of title, non-infringement, merchantability, or 
+ fitness for a particular purpose. You are solely responsible for determining 
+ the appropriateness of using or distributing the work and assume all risks 
+ associated with use of this work, including but not limited to the risks and 
+ costs of errors, compliance with applicable laws, damage to or loss of data 
+ or equipment, and unavailability or interruption of operations.
+
+ In no event shall the authors or contributors have any liability for any 
+ direct, indirect, incidental, special, exemplary, or consequential damages,
+ however caused and on any theory of liability, whether in contract, strict 
+ liability, or tort (including negligence), arising in any way out of or in 
+ connection with the use or distribution of the work.
+*****************************************************************************/
+
+
+// -------------------------------------------------------------------
+// Dependencies, expressed in the syntax that JSLint understands:
+// 
+/*global document  */
+/*global Util  */
+/*global View  */
+// -------------------------------------------------------------------
+
+
+/**
+ *
+ */
+function SuggestionBox(inHTMLInputField, listOfItems) {
+  this._inputField = inHTMLInputField;
+  this._listOfSuggestedItems = listOfItems.sort(SuggestionBox._compareItemDisplayNames);
+  this._selectedItem = null;
+  this._shouldHide = inHTMLInputField.value.length === 0;
+  
+  this._attributeSuggestionBoxDivElement = document.createElement('div');
+  // this._attributeSuggestionBoxDivElement.style.visibility = &quot;hidden&quot;;
+  this._attributeSuggestionBoxDivElement.style.zIndex = 11;
+  this._attributeSuggestionBoxDivElement.style.display = &quot;none&quot;;
+  document.body.appendChild(this._attributeSuggestionBoxDivElement);
+
+ /* this._inputField.onkeyup = this._keyPressOnInputField.bindAsEventListener(this);
+  this._inputField.onfocus = this._focusOnInputField.bindAsEventListener(this);
+  this._inputField.onblur = this._blurOnInputField.bindAsEventListener(this); */
+  //this._keyPressOnInputField();
+}
+
+
+/**
+ *
+ */
+SuggestionBox.prototype.getSelectedItem = function () {
+  if (!this._selectedItem) {
+    // check if typed item is identical to suggested item
+    var editValue = this._inputField.value;
+    for (var i = 0; i &lt; this._listOfSuggestedItems.length; ++i) {
+      var item = this._listOfSuggestedItems[i];
+      if (editValue.toLowerCase() == item.getDisplayName().toLowerCase()) {return item;}
+    }
+  }
+  return this._selectedItem;
+};
+
+
+/**
+ *
+ */
+SuggestionBox._compareItemDisplayNames = function (itemOne, itemTwo) {
+  var displayNameOne = itemOne.getDisplayString();
+  var displayNameTwo = itemTwo.getDisplayString();
+  if (displayNameOne == displayNameTwo) {
+    return 0;
+  } else {
+    return (displayNameOne &gt; displayNameTwo) ?  1 : -1;
+  }
+};
+
+
+/**
+ *
+ */
+SuggestionBox.prototype._focusOnInputField = function (inEventObject) {
+  this._redisplaySuggestionBox();
+};
+
+
+/**
+ *
+ */
+SuggestionBox.prototype._keyPressOnInputField = function (inEventObject) {
+  var numberOfMatchingItems = this._listOfMatchingItems.length;
+  if (numberOfMatchingItems === 0) {return false;}
+
+  var asciiValueOfKey = inEventObject.keyCode;
+  var index = -1;
+  var doSelectItem = false;
+  switch (asciiValueOfKey) {
+    case Util.ASCII_VALUE_FOR_DOWN_ARROW:
+      if (this._selectedItem) {
+        index = (Util.getArrayIndex(this._listOfMatchingItems, this._selectedItem)+1) % numberOfMatchingItems;
+      }
+      else {
+        index = 0;
+      }
+      break;
+    case Util.ASCII_VALUE_FOR_UP_ARROW:
+      if (this._selectedItem) {
+        index = Util.getArrayIndex(this._listOfMatchingItems, this._selectedItem)-1;
+        if (index &lt; 0) {index = numberOfMatchingItems-1;}
+      }
+      else {
+        index = numberOfMatchingItems-1;
+      }
+      break;
+      case Util.ASCII_VALUE_FOR_TAB:
+      if (this._inputField.value.length === 0) {return false;}
+      if (!this._selectedItem) {
+        this._selectedItem = this._listOfMatchingItems[0];
+        doSelectItem = true;
+      }
+      break;
+    case Util.ASCII_VALUE_FOR_RETURN:
+      if (this._selectedItem) {doSelectItem = true;}
+      break;
+    case Util.ASCII_VALUE_FOR_LEFT_ARROW:
+    case Util.ASCII_VALUE_FOR_RIGHT_ARROW:
+      // if left or right arrow keys, then hide suggestion box
+      this._setShouldHide(true);
+      return false;
+    default:
+      // show suggestion box if not already shown, then let editField process keystroke
+      this._setShouldHide(false);
+      return false;
+  }
+  if (index != -1) {
+    this._setShouldHide(false);
+    this._selectedItem = this._listOfMatchingItems[index];
+    this._redisplaySuggestionBox();
+    return true;
+  }
+  if (doSelectItem) {
+    this._inputField.value = this._selectedItem.getDisplayString();
+    this._setShouldHide(true);
+  }
+  return false;
+};
+
+
+/**
+ *
+ */
+SuggestionBox.prototype._keyUpOnInputField = function (inEventObject) {
+  this._redisplaySuggestionBox();
+};
+
+
+/**
+ *
+ */
+SuggestionBox.prototype._blurOnInputField = function () {
+  // make the suggestion box disappear
+  this._attributeSuggestionBoxDivElement.style.display = &quot;none&quot;;
+};
+
+
+/**
+ *
+ */
+SuggestionBox.prototype._clickOnSelection = function (inEventObject, item) {
+  this._selectedItem = item;
+};
+
+
+/**
+ *
+ */
+SuggestionBox.prototype._setShouldHide = function (shouldHide) {
+  // make the suggestion box disappear
+  this._shouldHide = shouldHide;
+  this._selectedItem = null;
+  if (shouldHide) {
+    this._attributeSuggestionBoxDivElement.style.display = &quot;none&quot;;
+  }
+  else {
+    this._redisplaySuggestionBox();
+  }
+};
+
+
+/**
+ *
+ */
+SuggestionBox.prototype._redisplaySuggestionBox = function () {
+  //if (this._shouldHide) {return;} // if SuggestionBox is in hide mode, don't show the box
+  
+  var partialInputString = this._inputField.value;
+  var listOfMatchingItems = [];
+  var key;
+  var item;
+
+  for (key in this._listOfSuggestedItems) {
+    item = this._listOfSuggestedItems[key];
+    var lowerCaseEntryString = item.getDisplayString().toLowerCase();
+    var lowerCaseInputString = partialInputString.toLowerCase();
+    var numberOfCharactersToCompare = lowerCaseInputString.length;
+    var shortEntryString = lowerCaseEntryString.substring(0, numberOfCharactersToCompare);
+    if (shortEntryString == lowerCaseInputString) {
+      // we have a match!
+      listOfMatchingItems.push(item);
+    }
+  }
+  this._listOfMatchingItems = listOfMatchingItems;
+
+  if (this._shouldHide || listOfMatchingItems.length === 0) {
+    // make the suggestion box disappear
+    this._attributeSuggestionBoxDivElement.style.display = &quot;none&quot;;
+  } else {
+    View.removeChildrenOfElement(this._attributeSuggestionBoxDivElement);
+    var table = document.createElement('table');
+    var rowNumber = 0;
+    var columnNumber = 0;
+    for (key in listOfMatchingItems) {
+      item = listOfMatchingItems[key];
+      var textNode = document.createTextNode(item.getDisplayString());
+      var row = table.insertRow(rowNumber);
+      var cell = row.insertCell(columnNumber);
+      row.className = (this._selectedItem == item) ? &quot;selected&quot;:&quot;&quot;;
+      //cell.style.background = (this._selectedItem == item) ? &quot;rgb(0%,70%,100%)&quot;:&quot;&quot;; //pending need to CSS-ify this
+      cell.appendChild(textNode);
+      cell.onmousedown = this._clickOnSelection.bindAsEventListener(this, item);
+      rowNumber += 1;
+    }
+    this._attributeSuggestionBoxDivElement.appendChild(table);
+
+    // set-up the suggestion box to open just below the input field it comes from
+    var suggestionBoxTop = Util.getOffsetTopFromElement(this._inputField) + this._inputField.offsetHeight;
+    var suggestionBoxLeft = Util.getOffsetLeftFromElement(this._inputField);
+    this._attributeSuggestionBoxDivElement.style.top = suggestionBoxTop + &quot;px&quot;; 
+    this._attributeSuggestionBoxDivElement.style.left = suggestionBoxLeft + &quot;px&quot;;
+    // alert(this._inputField.offsetWidth);
+    this._attributeSuggestionBoxDivElement.style.width = (this._inputField.offsetWidth - 2)+ &quot;px&quot;;
+
+    // this._attributeSuggestionBoxDivElement.style.zIndex = 11;
+    this._attributeSuggestionBoxDivElement.className = &quot;suggestion_box&quot;;
+    this._attributeSuggestionBoxDivElement.style.visibility = &quot;visible&quot;;
+    this._attributeSuggestionBoxDivElement.style.display = &quot;block&quot;;
+  }
+};
+
+// -------------------------------------------------------------------
+// End of file
+// -------------------------------------------------------------------


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000193.html">[openrecord-svn] r207 - trunk/source
</A></li>
	<LI>Next message: <A HREF="000195.html">[openrecord-svn] r209 - in trunk: documentation source
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#194">[ date ]</a>
              <a href="thread.html#194">[ thread ]</a>
              <a href="subject.html#194">[ subject ]</a>
              <a href="author.html#194">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openrecord-svn">More information about the openrecord-svn
mailing list</a><br>
</body></html>
