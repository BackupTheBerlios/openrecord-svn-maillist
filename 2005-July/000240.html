<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openrecord-svn] r255 - in trunk: . documentation repositories source/model source/util source/view
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openrecord-svn/2005-July/index.html" >
   <LINK REL="made" HREF="mailto:openrecord-svn%40lists.berlios.de?Subject=Re%3A%20%5Bopenrecord-svn%5D%20r255%20-%20in%20trunk%3A%20.%20documentation%20repositories%20source/model%20source/util%20source/view&In-Reply-To=%3C200507202014.j6KKEDIf029933%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000239.html">
   <LINK REL="Next"  HREF="000241.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openrecord-svn] r255 - in trunk: . documentation repositories source/model source/util source/view</H1>
    <B>Brian Douglas Skinner at BerliOS</B> 
    <A HREF="mailto:openrecord-svn%40lists.berlios.de?Subject=Re%3A%20%5Bopenrecord-svn%5D%20r255%20-%20in%20trunk%3A%20.%20documentation%20repositories%20source/model%20source/util%20source/view&In-Reply-To=%3C200507202014.j6KKEDIf029933%40sheep.berlios.de%3E"
       TITLE="[openrecord-svn] r255 - in trunk: . documentation repositories source/model source/util source/view">skinner at berlios.de
       </A><BR>
    <I>Wed Jul 20 22:14:13 CEST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000239.html">[openrecord-svn] r254 - trunk/documentation
</A></li>
        <LI>Next message: <A HREF="000241.html">[openrecord-svn] r256 - in trunk: . documentation source source/util
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#240">[ date ]</a>
              <a href="thread.html#240">[ thread ]</a>
              <a href="subject.html#240">[ subject ]</a>
              <a href="author.html#240">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: skinner
Date: 2005-07-20 22:14:10 +0200 (Wed, 20 Jul 2005)
New Revision: 255

Added:
   trunk/source/util/DateValue.js
   trunk/source/util/DateValueTest.html
   trunk/source/util/DateValueTest.js
Modified:
   trunk/dashboard.html
   trunk/demo_page.html
   trunk/documentation/release_planning.txt
   trunk/dogfood.html
   trunk/repositories/dogfood.json
   trunk/source/model/DeltaVirtualServer.js
   trunk/source/model/Entry.js
   trunk/source/model/ModelTest.html
   trunk/source/model/ModelTest.js
   trunk/source/model/StubVirtualServer.js
   trunk/source/util/LintTest.js
   trunk/source/util/TestSuite.html
   trunk/source/util/Util.js
   trunk/source/view/EntryView.js
Log:
Created a new DateValue class, that extends Date to support values like &quot;1944&quot;.

Modified: trunk/dashboard.html
===================================================================
--- trunk/dashboard.html	2005-07-20 17:46:40 UTC (rev 254)
+++ trunk/dashboard.html	2005-07-20 20:14:10 UTC (rev 255)
@@ -21,6 +21,7 @@
     &lt;script type=&quot;text/javascript&quot; src=&quot;source/util/Uuid.js&quot;&gt;&lt;/script&gt;
     &lt;script type=&quot;text/javascript&quot; src=&quot;source/util/Util.js&quot;&gt;&lt;/script&gt;
     &lt;script type=&quot;text/javascript&quot; src=&quot;source/util/Cookie.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;source/util/DateValue.js&quot;&gt;&lt;/script&gt;
 
     &lt;script type=&quot;text/javascript&quot; src=&quot;source/view/View.js&quot;&gt;&lt;/script&gt;
     &lt;script type=&quot;text/javascript&quot; src=&quot;source/view/RootView.js&quot;&gt;&lt;/script&gt;

Modified: trunk/demo_page.html
===================================================================
--- trunk/demo_page.html	2005-07-20 17:46:40 UTC (rev 254)
+++ trunk/demo_page.html	2005-07-20 20:14:10 UTC (rev 255)
@@ -21,6 +21,7 @@
     &lt;script type=&quot;text/javascript&quot; src=&quot;source/util/Uuid.js&quot;&gt;&lt;/script&gt;
     &lt;script type=&quot;text/javascript&quot; src=&quot;source/util/Util.js&quot;&gt;&lt;/script&gt;
     &lt;script type=&quot;text/javascript&quot; src=&quot;source/util/Cookie.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;source/util/DateValue.js&quot;&gt;&lt;/script&gt;
 
     &lt;script type=&quot;text/javascript&quot; src=&quot;source/view/View.js&quot;&gt;&lt;/script&gt;
     &lt;script type=&quot;text/javascript&quot; src=&quot;source/view/RootView.js&quot;&gt;&lt;/script&gt;

Modified: trunk/documentation/release_planning.txt
===================================================================
--- trunk/documentation/release_planning.txt	2005-07-20 17:46:40 UTC (rev 254)
+++ trunk/documentation/release_planning.txt	2005-07-20 20:14:10 UTC (rev 255)
@@ -273,7 +273,7 @@
        |          |       &gt;&gt;|     Be able to easily create new documents that are empty
        |          |       &gt;&gt;|     Create a dozen demo documents (quotes, dictionary, movies, books, oil-change, etc.)
        |          |       &gt;&gt;|     Have different documents use different style-sheets
-brian  | 1    IED |       &gt;&gt;|     Add a DateValue class that supports dates like &quot;2005&quot;
+brian  | 1    IED | 0.75    |     Add a DateValue class that supports dates like &quot;2005&quot;
        |          |         |     Data model: boolean, URL, entries that apply to timespan (e.g. annual population)
        |          |         |     improve UI for initial &quot;out of the box&quot; experience
        |          |         |     UI and data model design to support collaboration

Modified: trunk/dogfood.html
===================================================================
--- trunk/dogfood.html	2005-07-20 17:46:40 UTC (rev 254)
+++ trunk/dogfood.html	2005-07-20 20:14:10 UTC (rev 255)
@@ -21,6 +21,7 @@
     &lt;script type=&quot;text/javascript&quot; src=&quot;source/util/Uuid.js&quot;&gt;&lt;/script&gt;
     &lt;script type=&quot;text/javascript&quot; src=&quot;source/util/Util.js&quot;&gt;&lt;/script&gt;
     &lt;script type=&quot;text/javascript&quot; src=&quot;source/util/Cookie.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;source/util/DateValue.js&quot;&gt;&lt;/script&gt;
 
     &lt;script type=&quot;text/javascript&quot; src=&quot;source/view/View.js&quot;&gt;&lt;/script&gt;
     &lt;script type=&quot;text/javascript&quot; src=&quot;source/view/RootView.js&quot;&gt;&lt;/script&gt;

Modified: trunk/repositories/dogfood.json
===================================================================
--- trunk/repositories/dogfood.json	2005-07-20 17:46:40 UTC (rev 254)
+++ trunk/repositories/dogfood.json	2005-07-20 20:14:10 UTC (rev 255)
@@ -1809,17 +1809,17 @@
           &quot;value&quot;: &quot;3af52130-e77a-11d9-93ea-000c414ce854&quot;  }
   },
   // -----------------------------------------------------------------------
-  // (Iteration: Iteration 1).(Completion Date) = &quot;Mon May 30 2005 00:00:00 GMT-0700 (Pacific Standard Time)&quot;
+  // (Iteration: Iteration 1).(Completion Date) = &quot;Mon May 30 2005&quot;
   //           by (Brian) on (Jun 27, 2005)
   { &quot;Entry&quot;: {
            &quot;uuid&quot;: &quot;6892d560-e77a-11d9-8196-000c414ce854&quot;,
            &quot;type&quot;: &quot;00001022-ce7f-11d9-8cd5-0011113ae5d6&quot;,
       &quot;attribute&quot;: &quot;3af52130-e77a-11d9-93ea-000c414ce854&quot;,
            &quot;item&quot;: &quot;ceb795d0-e778-11d9-a7da-000c414ce854&quot;,
-          &quot;value&quot;: &quot;Mon May 30 2005 00:00:00 GMT-0700 (Pacific Standard Time)&quot;  }
+          &quot;value&quot;: &quot;Mon May 30 2005&quot;  }
   },
   // -----------------------------------------------------------------------
-  // (Iteration: Iteration 1).(Completion Date) = &quot;Mon Jun 06 2005 00:00:00 GMT-0700 (Pacific Standard Time)&quot;
+  // (Iteration: Iteration 1).(Completion Date) = &quot;Mon Jun 06 2005&quot;
   //           by (Brian) on (Jun 27, 2005)
   { &quot;Entry&quot;: {
            &quot;uuid&quot;: &quot;7c85cc30-e77a-11d9-8196-000c414ce854&quot;,
@@ -1827,17 +1827,17 @@
            &quot;type&quot;: &quot;00001022-ce7f-11d9-8cd5-0011113ae5d6&quot;,
       &quot;attribute&quot;: &quot;3af52130-e77a-11d9-93ea-000c414ce854&quot;,
            &quot;item&quot;: &quot;ceb795d0-e778-11d9-a7da-000c414ce854&quot;,
-          &quot;value&quot;: &quot;Mon Jun 06 2005 00:00:00 GMT-0700 (Pacific Standard Time)&quot;  }
+          &quot;value&quot;: &quot;Mon Jun 06 2005&quot;  }
   },
   // -----------------------------------------------------------------------
-  // (Iteration: Iteration 2).(Completion Date) = &quot;Tue Jul 05 2005 00:00:00 GMT-0700 (Pacific Standard Time)&quot;
+  // (Iteration: Iteration 2).(Completion Date) = &quot;Tue Jul 05 2005&quot;
   //           by (Brian) on (Jun 27, 2005)
   { &quot;Entry&quot;: {
            &quot;uuid&quot;: &quot;84c88360-e77a-11d9-8196-000c414ce854&quot;,
            &quot;type&quot;: &quot;00001022-ce7f-11d9-8cd5-0011113ae5d6&quot;,
       &quot;attribute&quot;: &quot;3af52130-e77a-11d9-93ea-000c414ce854&quot;,
            &quot;item&quot;: &quot;e0dc0e30-e778-11d9-a7da-000c414ce854&quot;,
-          &quot;value&quot;: &quot;Tue Jul 05 2005 00:00:00 GMT-0700 (Pacific Standard Time)&quot;  }
+          &quot;value&quot;: &quot;Tue Jul 05 2005&quot;  }
   },
   // =======================================================================
   { &quot;Transaction&quot;: [

Modified: trunk/source/model/DeltaVirtualServer.js
===================================================================
--- trunk/source/model/DeltaVirtualServer.js	2005-07-20 17:46:40 UTC (rev 254)
+++ trunk/source/model/DeltaVirtualServer.js	2005-07-20 20:14:10 UTC (rev 255)
@@ -34,7 +34,7 @@
 // 
 /*global window */
 /*global XMLHttpRequest, ActiveXObject  */
-/*global Util  */
+/*global Util, DateValue  */
 /*global World, Item, Entry, Ordinal, Vote  */
 // -------------------------------------------------------------------
 
@@ -217,7 +217,7 @@
       var item = record;
       listOfStrings.push(indent + '// ' + this._getTypedDisplayStringForItem(item) + '\n');
       listOfStrings.push(indent + '//           by (' + item.getUserstamp().getDisplayString() + ')');
-      listOfStrings.push(' on (' + Util.getStringMonthDayYear(item.getCreationDate()) + ')\n');
+      listOfStrings.push(' on (' + DateValue.getStringMonthDayYear(item.getCreationDate()) + ')\n');
       listOfStrings.push(indent + '{ &quot;' + StubVirtualServer.JSON_MEMBER_ITEM_CLASS + '&quot;: ');
       listOfStrings.push('{ &quot;' + StubVirtualServer.JSON_MEMBER_UUID + '&quot;: &quot;' + item._getUuid() + '&quot; }');
       listOfStrings.push(' }');
@@ -328,7 +328,7 @@
         commentString += &quot; = &quot; + valueComment + &quot;\n&quot;;
       }
       commentString += indent + '//           by (' + entry.getUserstamp().getDisplayString() + ')';
-      commentString += ' on (' + Util.getStringMonthDayYear(entry.getCreationDate()) + ')\n';
+      commentString += ' on (' + DateValue.getStringMonthDayYear(entry.getCreationDate()) + ')\n';
       listOfStrings.push(commentString);
       listOfStrings.push(entryString);
       listOfStrings.push('  }\n');

Modified: trunk/source/model/Entry.js
===================================================================
--- trunk/source/model/Entry.js	2005-07-20 17:46:40 UTC (rev 254)
+++ trunk/source/model/Entry.js	2005-07-20 20:14:10 UTC (rev 255)
@@ -336,7 +336,8 @@
       break;
     case this.getWorld().getTypeCalledDate():
       var aDate = this._value;
-      returnString = Util.getStringMonthDayYear(aDate);
+      // returnString = Util.getStringMonthDayYear(aDate);
+      returnString = aDate.toShortLocaleDateString();
       break;
     case this.getWorld().getTypeCalledItem():
       returnString = this._value.getDisplayString();

Modified: trunk/source/model/ModelTest.html
===================================================================
--- trunk/source/model/ModelTest.html	2005-07-20 17:46:40 UTC (rev 254)
+++ trunk/source/model/ModelTest.html	2005-07-20 20:14:10 UTC (rev 255)
@@ -17,6 +17,7 @@
     &lt;script type=&quot;text/javascript&quot; src=&quot;../../third_party/md5/md5.js&quot;&gt;&lt;/script&gt;
     &lt;script type=&quot;text/javascript&quot; src=&quot;../util/Util.js&quot;&gt;&lt;/script&gt;
     &lt;script type=&quot;text/javascript&quot; src=&quot;../util/Uuid.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;../util/DateValue.js&quot;&gt;&lt;/script&gt;
     &lt;script type=&quot;text/javascript&quot; src=&quot;Record.js&quot;&gt;&lt;/script&gt;
     &lt;script type=&quot;text/javascript&quot; src=&quot;Ordinal.js&quot;&gt;&lt;/script&gt;
     &lt;script type=&quot;text/javascript&quot; src=&quot;Vote.js&quot;&gt;&lt;/script&gt;

Modified: trunk/source/model/ModelTest.js
===================================================================
--- trunk/source/model/ModelTest.js	2005-07-20 17:46:40 UTC (rev 254)
+++ trunk/source/model/ModelTest.js	2005-07-20 20:14:10 UTC (rev 255)
@@ -627,7 +627,7 @@
   var aPerson = world.newItem(&quot;John Doe&quot;);
   var subjectEntry = anEmail.addEntryForAttribute(subjectAttribute, &quot;Money saved for you at Nigerian Bank&quot;);
   var fromEntry = anEmail.addEntryForAttribute(fromAttribute, aPerson);
-  var receivedEntry = anEmail.addEntryForAttribute(dateReceivedAttribute, new Date(&quot;6/8/05&quot;));
+  var receivedEntry = anEmail.addEntryForAttribute(dateReceivedAttribute, new DateValue(&quot;6/8/05&quot;));
   var numAttachmentsEntry = anEmail.addEntryForAttribute(noOfAttachments, 4);
 }
 

Modified: trunk/source/model/StubVirtualServer.js
===================================================================
--- trunk/source/model/StubVirtualServer.js	2005-07-20 17:46:40 UTC (rev 254)
+++ trunk/source/model/StubVirtualServer.js	2005-07-20 20:14:10 UTC (rev 255)
@@ -936,10 +936,11 @@
               finalData = rawData;
               break;
             case World.UUID_FOR_TYPE_NUMBER:
-              finalData = rawData;
+              finalData = parseFloat(rawData);
               break;
             case World.UUID_FOR_TYPE_DATE:
-              finalData = new Date(rawData);
+              finalData = new DateValue(rawData);
+              Util.assert(finalData.isValid());
               break;
             default:
               Util.assert(false, 'Unknown data type while _rehydrating()');

Added: trunk/source/util/DateValue.js
===================================================================
--- trunk/source/util/DateValue.js	2005-07-20 17:46:40 UTC (rev 254)
+++ trunk/source/util/DateValue.js	2005-07-20 20:14:10 UTC (rev 255)
@@ -0,0 +1,210 @@
+/*****************************************************************************
+ DateValue.js
+
+******************************************************************************
+ Written in 2005 by Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
+  
+ Copyright rights relinquished under the Creative Commons  
+ Public Domain Dedication:
+    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
+  
+ You can copy freely from this file.  This work may be freely reproduced, 
+ distributed, transmitted, used, modified, built upon, or otherwise exploited
+ by anyone for any purpose.
+  
+ This work is provided on an &quot;AS IS&quot; basis, without warranties or conditions 
+ of any kind, either express or implied, including, without limitation, any 
+ warranties or conditions of title, non-infringement, merchantability, or 
+ fitness for a particular purpose. You are solely responsible for determining 
+ the appropriateness of using or distributing the work and assume all risks 
+ associated with use of this work, including but not limited to the risks and 
+ costs of errors, compliance with applicable laws, damage to or loss of data 
+ or equipment, and unavailability or interruption of operations.
+
+ In no event shall the authors or contributors have any liability for any 
+ direct, indirect, incidental, special, exemplary, or consequential damages,
+ however caused and on any theory of liability, whether in contract, strict 
+ liability, or tort (including negligence), arising in any way out of or in 
+ connection with the use or distribution of the work.
+*****************************************************************************/
+
+
+// -------------------------------------------------------------------
+// Util public class constants
+// -------------------------------------------------------------------
+DateValue.MONTH_JAN = 0;
+DateValue.MONTH_FEB = 1;
+DateValue.MONTH_MAR = 2;
+DateValue.MONTH_APR = 3;
+DateValue.MONTH_MAY = 4;
+DateValue.MONTH_JUN = 5;
+DateValue.MONTH_JUL = 6;
+DateValue.MONTH_AUG = 7;
+DateValue.MONTH_SEP = 8;
+DateValue.MONTH_OCT = 9;
+DateValue.MONTH_NOV = 10;
+DateValue.MONTH_DEC = 11;
+
+DateValue.ARRAY_OF_MONTH_SHORT_NAMES = new Array(&quot;Jan&quot;, &quot;Feb&quot;, &quot;Mar&quot;, &quot;Apr&quot;, &quot;May&quot;, &quot;Jun&quot;, &quot;Jul&quot;, &quot;Aug&quot;, &quot;Sep&quot;, &quot;Oct&quot;, &quot;Nov&quot;, &quot;Dec&quot;);
+DateValue.ARRAY_OF_MONTH_NAMES = new Array(&quot;January&quot;, &quot;February&quot;, &quot;March&quot;, &quot;April&quot;, &quot;May&quot;, &quot;June&quot;, &quot;July&quot;, &quot;August&quot;, &quot;September&quot;, &quot;October&quot;, &quot;November&quot;, &quot;December&quot;);
+
+
+/**
+ * The DateValue class is similar to the JavaScript built-in Date class. 
+ * DateValue objects can be used to represent &quot;fuzzy&quot; dates, such as &quot;1999&quot;
+ * and &quot;July 1965&quot;, as well as complete dates like &quot;May 14, 1982&quot;.
+ *
+ * @scope    public instance constructor
+ * @param    foo    A parameter. 
+ */
+function DateValue(year, month, day, hours, minutes, seconds, ms) {
+  var date;
+
+  // Step 1: 
+  // Figure out what sort of arguments we've been given.
+  //
+  // If one string argument is passed, we parse the string.
+  // If one numeric argument is passed, it represents milliseconds since 1970.
+  // If two or more arguments are passed, they are year, month, day, hours, etc.
+  var STRING          = &quot;STRING&quot;;
+  var MILLISECONDS    = &quot;MILLISECONDS&quot;;
+  var SEPARATE_FIELDS = &quot;SEPARATE_FIELDS&quot;;
+  var argumentType = null;
+  
+  if ((typeof year) == &quot;string&quot;) {
+    argumentType = STRING;
+  }
+  if ((typeof year) == &quot;number&quot;) {
+    if ((typeof month) == &quot;number&quot;) {
+      argumentType = SEPARATE_FIELDS;
+    } else {
+      argumentType = MILLISECONDS;
+    }
+  }
+  
+  // Step 2: 
+  // Create a conventional JavaScript Date object.
+  switch (argumentType) {
+    case STRING:
+      date = new Date(year);
+      break;
+    case MILLISECONDS:
+      date = new Date(year);
+      break;
+    case SEPARATE_FIELDS:
+      if (!day) {
+        date = new Date(year, month);
+      } else {
+        hours = hours ? hours : null;
+        minutes = minutes ? minutes : null;
+        seconds = seconds ? seconds : null;
+        ms = ms ? ms : null;
+        date = new Date(year, month, day, hours, minutes, seconds, ms);
+      }
+      break;
+  }
+  
+  // Step 3: 
+  // Take note of whether this is just a year, a full timestamp, or something
+  // in between.
+  switch (argumentType) {
+    case MILLISECONDS:
+      date._hasTime = true;
+      break;
+    case SEPARATE_FIELDS:
+      if (hours || minutes || seconds || ms) {
+        date._hasTime = true;
+        // date._hasDay = true;
+        // date._hasMonth = true;
+      } else {
+        date._hasTime = false;
+        date._hasDay = day ? true : false;
+        date._hasMonth = true;
+      }
+      break;
+    case STRING:
+      date._hasTime = (year.indexOf(':') != -1) ? true : false;
+      // if (date._hasTime) {
+      //   date._hasDay = true;
+      //   date._hasMonth = true;
+      // }
+      if (!date._hasTime) {
+        if (!isNaN(date.valueOf())) {
+          date._hasDay = true;
+          date._hasMonth = true;
+       } else {
+          // If we get here, it means we may have been passed a string like 
+          // &quot;1944&quot; or &quot;July 1944&quot;, which the Date class was not able to parse.
+          // We should try to parse the string ourselves and create a valid
+          // Date object.
+          //
+          // PENDING: 
+          // Right now we only have code to parse strings like &quot;1944&quot;.
+          // We should expand this to deal with strings like &quot;Feb 1944&quot;,
+          // &quot;February 1944&quot;, &quot;1944/02&quot;, etc.
+          var yearAsInt = parseInt(year);
+          if ((year.length == 4) &amp;&amp; !isNaN(yearAsInt)) {
+            date = new Date(yearAsInt, DateValue.MONTH_JAN);
+            date._hasTime = false;
+            date._hasDay = false;
+            date._hasMonth = false;
+          }
+       }
+      }
+      break;
+  }
+  
+  // Step 4: 
+  // Add our own new DateValue methods to the conventional JavaScript Date object.
+  date.isValid = function() {
+    var valid = !isNaN(this.valueOf());
+    return valid;
+  };
+  if (!date._hasTime) {
+    date.toString = function() {
+      if (this._hasDay &amp;&amp; this._hasMonth) {
+        return this.toLocaleDateString();
+      } else {
+        if (this._hasMonth) {
+          return DateValue.ARRAY_OF_MONTH_SHORT_NAMES[this.getUTCMonth()] + ' ' + this.getUTCFullYear();
+        } else {
+          return this.getUTCFullYear();
+        }
+      }
+    };
+  }
+  date.toShortLocaleDateString = function() {
+    if (this._hasTime || (this._hasDay &amp;&amp; this._hasMonth)) {
+      return DateValue.ARRAY_OF_MONTH_SHORT_NAMES[date.getMonth()] + ' ' + date.getDate() + ', ' + date.getFullYear();
+    } else {
+      if (this._hasMonth) {
+        return DateValue.ARRAY_OF_MONTH_SHORT_NAMES[this.getUTCMonth()] + ' ' + this.getUTCFullYear();
+      } else {
+        return this.getUTCFullYear().toString();
+      }
+    }
+  };
+
+  return date;
+}
+
+
+// -------------------------------------------------------------------
+// Public class methods
+// -------------------------------------------------------------------
+
+/**
+ * Given a Date, returns a string like &quot;Feb 14, 1944&quot;.
+ *
+ * @scope    public class method
+ * @param    date    Either a Date or DateValue object. 
+ * @return   A string like &quot;Feb 14, 1944&quot;. 
+ */
+DateValue.getStringMonthDayYear = function(date) {
+  return DateValue.ARRAY_OF_MONTH_SHORT_NAMES[date.getMonth()] + ' ' + date.getDate() + ', ' + date.getFullYear();
+};
+
+
+// -------------------------------------------------------------------
+// End of file
+// -------------------------------------------------------------------

Added: trunk/source/util/DateValueTest.html
===================================================================
--- trunk/source/util/DateValueTest.html	2005-07-20 17:46:40 UTC (rev 254)
+++ trunk/source/util/DateValueTest.html	2005-07-20 20:14:10 UTC (rev 255)
@@ -0,0 +1,85 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
+&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.1//EN&quot; &quot;<A HREF="http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd</A>&quot;&gt;
+&lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot; xml:lang=&quot;en&quot; &gt;
+
+&lt;!-- 
+ Written in 2005 by Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
+  
+ Copyright rights relinquished under the Creative Commons  
+ Public Domain Dedication:
+    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
+--&gt;
+
+  &lt;head&gt;
+    &lt;title&gt;Unit tests for DateValue.js&lt;/title&gt;
+
+    &lt;script type=&quot;text/javascript&quot; src=&quot;../../third_party/jsunit/jsunit2_1/app/jsUnitCore.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;Util.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;DateValue.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;DateValueTest.js&quot;&gt;&lt;/script&gt;
+  &lt;/head&gt;
+  
+  &lt;body&gt;
+    &lt;h1&gt;Unit tests for DateValue.js&lt;/h1&gt;
+
+    &lt;p&gt;This page is used to run unit tests for the JavaScript code in the 
+    OpenRecord project.&lt;/p&gt;
+    
+    &lt;p&gt;&nbsp;&lt;/p&gt;
+    &lt;hr/&gt;
+    &lt;p&gt;To see the tests, open this .html file in a text editor. Or, within a  
+    web browser, you should be able see the source for this file by using 
+    some menu like &lt;b&gt;View&lt;/b&gt; followed by &lt;b&gt;Page Source&lt;/b&gt;. The tests 
+    may be in this file, or they may be in a separate file that has the
+    same name as this one, except with a .js extension instead of a .html
+    extension.&lt;/p&gt;
+ 
+    &lt;p&gt;The unit tests are set up to run in the
+    &lt;a href=&quot;<A HREF="http://www.edwardh.com/jsunit/">http://www.edwardh.com/jsunit/</A>&quot; rel=&quot;external&quot;&gt;JsUnit framework&lt;/a&gt;
+    written by 
+    &lt;a href=&quot;<A HREF="http://www.edwardh.com/">http://www.edwardh.com/</A>&quot; rel=&quot;external&quot;&gt;Edward Hieatt&lt;/a&gt;. &lt;/p&gt;
+
+    &lt;p&gt;If you're looking at this page across an &quot;<A HREF="http://">http://</A>&quot; connection, rather
+    than having loaded it as a &quot;<A HREF="file:///">file:///</A>&quot;, then you may be able to run the
+    unit tests. The web server that served you this page may also have a
+    JsUnit testRunner available. If so, you should be able to run these unit
+    tests by going to
+    &lt;a href=&quot;../../third_party/jsunit/jsunit2_1/testRunner.html?testpage=&quot; 
+    onclick=&quot;href+=window.location.href;&quot; rel=&quot;external&quot;&gt;the local testRunner 
+    page&lt;/a&gt;, and hitting the &lt;b&gt;Run&lt;/b&gt; button.&lt;/p&gt;
+
+    &lt;p&gt;You can also run these unit tests on your local computer. To do that you 
+    first need to download &lt;a href=&quot;<A HREF="http://www.edwardh.com/jsunit/">http://www.edwardh.com/jsunit/</A>&quot; 
+    rel=&quot;external&quot;&gt;JsUnit&lt;/a&gt;.&lt;/p&gt;
+    
+    &lt;p&gt;&nbsp;&lt;/p&gt;
+    &lt;hr/&gt;
+    &lt;p class=&quot;copyright&quot;&gt;You can copy freely from this work &mdash; copyright 
+    rights relinquished under the Creative Commons  
+    &lt;a rel=&quot;license external&quot; 
+    href=&quot;<A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>&quot;&gt;Public Domain 
+    Dedication&lt;/a&gt;.&lt;/p&gt;
+
+&lt;!-- Creative Commons metadata for Public Domain License 
+
+&lt;rdf:RDF xmlns=&quot;<A HREF="http://web.resource.org/cc/">http://web.resource.org/cc/</A>&quot;
+    xmlns:dc=&quot;<A HREF="http://purl.org/dc/elements/1.1/">http://purl.org/dc/elements/1.1/</A>&quot;
+    xmlns:rdf=&quot;<A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#">http://www.w3.org/1999/02/22-rdf-syntax-ns#</A>&quot;&gt;
+&lt;Work rdf:about=&quot;&quot;&gt;
+   &lt;dc:title&gt;openrecord.org&lt;/dc:title&gt;
+   &lt;dc:type rdf:resource=&quot;<A HREF="http://purl.org/dc/dcmitype/Text">http://purl.org/dc/dcmitype/Text</A>&quot; /&gt;
+   &lt;license rdf:resource=&quot;<A HREF="http://web.resource.org/cc/PublicDomain">http://web.resource.org/cc/PublicDomain</A>&quot; /&gt;
+&lt;/Work&gt;
+
+&lt;License rdf:about=&quot;<A HREF="http://web.resource.org/cc/PublicDomain">http://web.resource.org/cc/PublicDomain</A>&quot;&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Reproduction">http://web.resource.org/cc/Reproduction</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Distribution">http://web.resource.org/cc/Distribution</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/DerivativeWorks">http://web.resource.org/cc/DerivativeWorks</A>&quot; /&gt;
+&lt;/License&gt;
+
+&lt;/rdf:RDF&gt;
+
+--&gt;
+  &lt;/body&gt;
+&lt;/html&gt;
+

Added: trunk/source/util/DateValueTest.js
===================================================================
--- trunk/source/util/DateValueTest.js	2005-07-20 17:46:40 UTC (rev 254)
+++ trunk/source/util/DateValueTest.js	2005-07-20 20:14:10 UTC (rev 255)
@@ -0,0 +1,73 @@
+/*****************************************************************************
+ DateValueTest.js
+ 
+******************************************************************************
+ Written in 2005 by Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
+  
+ Copyright rights relinquished under the Creative Commons  
+ Public Domain Dedication:
+    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
+  
+ You can copy freely from this file.  This work may be freely reproduced, 
+ distributed, transmitted, used, modified, built upon, or otherwise exploited
+ by anyone for any purpose.
+  
+ This work is provided on an &quot;AS IS&quot; basis, without warranties or conditions 
+ of any kind, either express or implied, including, without limitation, any 
+ warranties or conditions of title, non-infringement, merchantability, or 
+ fitness for a particular purpose. You are solely responsible for determining 
+ the appropriateness of using or distributing the work and assume all risks 
+ associated with use of this work, including but not limited to the risks and 
+ costs of errors, compliance with applicable laws, damage to or loss of data 
+ or equipment, and unavailability or interruption of operations.
+
+ In no event shall the authors or contributors have any liability for any 
+ direct, indirect, incidental, special, exemplary, or consequential damages,
+ however caused and on any theory of liability, whether in contract, strict 
+ liability, or tort (including negligence), arising in any way out of or in 
+ connection with the use or distribution of the work.
+*****************************************************************************/
+ 
+var TestVars = null;
+
+function setUp() {
+  // TestVars = {};
+  // TestVars.theHobbit = &quot;The Hobbit&quot;;
+}
+
+function testDateValueConstructor() {
+  var year = 1944;
+  var month = DateValue.MONTH_FEB;
+  var day = 14;
+  var hours = 9;
+  var minutes = 30;
+  var seconds = 15;
+  var ms = 444;
+  var dates = new Array();
+  dates[0] = new DateValue(&quot;1944&quot;);
+  dates[1] = new DateValue(&quot;2/14/1944&quot;);
+  dates[2] = new DateValue(&quot;Feb 14 1944&quot;);
+  dates[3] = new DateValue(-816710400000);
+  dates[4] = new DateValue(year, month);
+  dates[5] = new DateValue(year, month, day);
+  dates[6] = new DateValue(year, month, day, hours);
+  dates[7] = new DateValue(year, month, day, hours, minutes);
+  dates[8] = new DateValue(year, month, day, hours, minutes, seconds);
+  dates[9] = new DateValue(year, month, day, hours, minutes, seconds, ms);
+  for (var i in dates) {
+    var dateValue = dates[i];
+    assertTrue('DateValue is valid', dateValue.isValid());
+    assertTrue('Util.isDate() returns true', Util.isDate(dateValue));
+  }
+  // var alertString = dates.join('\n');
+  // alert(alertString);
+}
+
+
+function tearDown() {
+  // TestVars = null;
+}
+
+// -------------------------------------------------------------------
+// End of file
+// -------------------------------------------------------------------

Modified: trunk/source/util/LintTest.js
===================================================================
--- trunk/source/util/LintTest.js	2005-07-20 17:46:40 UTC (rev 254)
+++ trunk/source/util/LintTest.js	2005-07-20 20:14:10 UTC (rev 255)
@@ -41,6 +41,8 @@
   var listOfSourceCodeFiles = [
     &quot;Util.js&quot;,
     &quot;UtilTest.js&quot;,
+    &quot;DateValue.js&quot;,
+    &quot;DateValueTest.js&quot;,
     &quot;Uuid.js&quot;,
     &quot;LintTool.js&quot;];
   var prefix = &quot;../../../source/util/&quot;;

Modified: trunk/source/util/TestSuite.html
===================================================================
--- trunk/source/util/TestSuite.html	2005-07-20 17:46:40 UTC (rev 254)
+++ trunk/source/util/TestSuite.html	2005-07-20 20:14:10 UTC (rev 255)
@@ -24,6 +24,7 @@
       function utilTestSuite() {
         var testSuite = new window.top.jsUnitTestSuite();
         testSuite.addTestPage(&quot;../../../source/util/UtilTest.html&quot;);
+        testSuite.addTestPage(&quot;../../../source/util/DateValueTest.html&quot;);
         testSuite.addTestPage(&quot;../../../source/util/LintTest.html&quot;);
         return testSuite;
       }

Modified: trunk/source/util/Util.js
===================================================================
--- trunk/source/util/Util.js	2005-07-20 17:46:40 UTC (rev 254)
+++ trunk/source/util/Util.js	2005-07-20 20:14:10 UTC (rev 255)
@@ -75,7 +75,7 @@
 Util.KEYCODE_FOR_DELETE = 46;
 
 
-Util.ABBREV_MONTHS_ARRAY = new Array(&quot;Jan&quot;,&quot;Feb&quot;,&quot;Mar&quot;,&quot;Apr&quot;,&quot;May&quot;,&quot;Jun&quot;,&quot;Jul&quot;,&quot;Aug&quot;,&quot;Sep&quot;,&quot;Oct&quot;,&quot;Nov&quot;,&quot;Dec&quot;);
+// Util.ABBREV_MONTHS_ARRAY = new Array(&quot;Jan&quot;,&quot;Feb&quot;,&quot;Mar&quot;,&quot;Apr&quot;,&quot;May&quot;,&quot;Jun&quot;,&quot;Jul&quot;,&quot;Aug&quot;,&quot;Sep&quot;,&quot;Oct&quot;,&quot;Nov&quot;,&quot;Dec&quot;);
 
 
 // -------------------------------------------------------------------
@@ -520,10 +520,10 @@
 // Methods that operate on Dates
 // -------------------------------------------------------------------
 
-Util.getStringMonthDayYear = function(date) {
-  var returnString = Util.ABBREV_MONTHS_ARRAY[date.getMonth()] + ' ' + date.getDate() + ', ' + (date.getYear()+1900);
-  return returnString;
-};
+// Util.getStringMonthDayYear = function(date) {
+//   var returnString = Util.ABBREV_MONTHS_ARRAY[date.getMonth()] + ' ' + date.getDate() + ', ' + date.getFullYear();
+//   return returnString;
+// };
 
 
 // -------------------------------------------------------------------

Modified: trunk/source/view/EntryView.js
===================================================================
--- trunk/source/view/EntryView.js	2005-07-20 17:46:40 UTC (rev 254)
+++ trunk/source/view/EntryView.js	2005-07-20 20:14:10 UTC (rev 255)
@@ -434,8 +434,10 @@
             if (!isNaN(floatVal)) {return floatVal;}
             break;
           case typeCalledDate:
-            var dateVal = Date.parse(value);
-            if (!isNaN(dateVal)) {return new Date(value);}
+            // var dateVal = Date.parse(value);
+            // if (!isNaN(dateVal)) {return new Date(value);}
+            var dateValue = new DateValue(value);
+            if (dateValue.isValid()) {return dateValue;}
             break;
           default:
             if (aType.isInCategory(categoryCalledCategory)) {


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000239.html">[openrecord-svn] r254 - trunk/documentation
</A></li>
	<LI>Next message: <A HREF="000241.html">[openrecord-svn] r256 - in trunk: . documentation source source/util
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#240">[ date ]</a>
              <a href="thread.html#240">[ thread ]</a>
              <a href="subject.html#240">[ subject ]</a>
              <a href="author.html#240">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openrecord-svn">More information about the openrecord-svn
mailing list</a><br>
</body></html>
