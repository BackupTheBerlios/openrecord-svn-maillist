<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openrecord-svn] r261 - in trunk: . documentation repositories source/view
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openrecord-svn/2005-July/index.html" >
   <LINK REL="made" HREF="mailto:openrecord-svn%40lists.berlios.de?Subject=Re%3A%20%5Bopenrecord-svn%5D%20r261%20-%20in%20trunk%3A%20.%20documentation%20repositories%20source/view&In-Reply-To=%3C200507260011.j6Q0BqlH019675%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000245.html">
   <LINK REL="Next"  HREF="000247.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openrecord-svn] r261 - in trunk: . documentation repositories source/view</H1>
    <B>Brian Douglas Skinner at BerliOS</B> 
    <A HREF="mailto:openrecord-svn%40lists.berlios.de?Subject=Re%3A%20%5Bopenrecord-svn%5D%20r261%20-%20in%20trunk%3A%20.%20documentation%20repositories%20source/view&In-Reply-To=%3C200507260011.j6Q0BqlH019675%40sheep.berlios.de%3E"
       TITLE="[openrecord-svn] r261 - in trunk: . documentation repositories source/view">skinner at berlios.de
       </A><BR>
    <I>Tue Jul 26 02:11:52 CEST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000245.html">[openrecord-svn] r260 - trunk/source/util
</A></li>
        <LI>Next message: <A HREF="000247.html">[openrecord-svn] r262 - in trunk/source: model util
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#246">[ date ]</a>
              <a href="thread.html#246">[ thread ]</a>
              <a href="subject.html#246">[ subject ]</a>
              <a href="author.html#246">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: skinner
Date: 2005-07-26 02:11:47 +0200 (Tue, 26 Jul 2005)
New Revision: 261

Added:
   trunk/repositories/sandbox.json
   trunk/sandbox.html
Modified:
   trunk/documentation/release_planning.txt
   trunk/source/view/RootView.js
Log:
Made a few minor changes so that we can more easily create lots of new empty demo documents.

Modified: trunk/documentation/release_planning.txt
===================================================================
--- trunk/documentation/release_planning.txt	2005-07-25 23:42:46 UTC (rev 260)
+++ trunk/documentation/release_planning.txt	2005-07-26 00:11:47 UTC (rev 261)
@@ -270,7 +270,7 @@
        |          |         | 24. Deal with \n in page name or summary fields
 brian  |          | 0.25    | 25. BUG: need to encode reserved characters(&lt;&amp;&gt;\n&quot;') back at client-server layer
 brian  |          | 0.25    |     Be able to make html files with just one &lt;script&gt; element, not dozens 
-brian  |          |       &gt;&gt;|     Be able to easily create new documents that are empty
+brian  |          | 0.25    |     Be able to easily create new documents that are empty
        |          |       &gt;&gt;|     Create a dozen demo documents (quotes, dictionary, movies, books, oil-change, etc.)
        |          |       &gt;&gt;|     Have different documents use different style-sheets
 brian  | 1    IED | 0.75    |     Add a DateValue class that supports dates like &quot;2005&quot;

Added: trunk/repositories/sandbox.json
===================================================================
--- trunk/repositories/sandbox.json	2005-07-25 23:42:46 UTC (rev 260)
+++ trunk/repositories/sandbox.json	2005-07-26 00:11:47 UTC (rev 261)
@@ -0,0 +1,40 @@
+// Repository records, in JSON format
+{ &quot;format&quot;: &quot;2005_JUNE_CHRONOLOGICAL_LIST&quot;, 
+  &quot;records&quot;: [ {},
+  // =======================================================================
+  { &quot;Transaction&quot;: [
+    // -----------------------------------------------------------------------
+    // (Page: Welcome)
+    //           by (Brian) on (Jul 25, 2005)
+    { &quot;Item&quot;: { &quot;uuid&quot;: &quot;82c7f970-fd68-11d9-be6a-000c414ce854&quot; } },
+    // -----------------------------------------------------------------------
+    // (Page: Welcome).(Name) = &quot;Welcome&quot;
+    //           by (Brian) on (Jul 25, 2005)
+    { &quot;Entry&quot;: {
+             &quot;uuid&quot;: &quot;82c7f971-fd68-11d9-be6a-000c414ce854&quot;,
+             &quot;type&quot;: &quot;00001020-ce7f-11d9-8cd5-0011113ae5d6&quot;,
+        &quot;attribute&quot;: &quot;00001001-ce7f-11d9-8cd5-0011113ae5d6&quot;,
+             &quot;item&quot;: &quot;82c7f970-fd68-11d9-be6a-000c414ce854&quot;,
+            &quot;value&quot;: &quot;Welcome&quot;  }
+    },
+    // -----------------------------------------------------------------------
+    // (Page: Welcome).(Category) = (Category: Page)
+    // (Category: Page).(Items in Category) = (Page: Welcome)
+    //           by (Brian) on (Jul 25, 2005)
+    { &quot;Entry&quot;: {
+             &quot;uuid&quot;: &quot;82c7f972-fd68-11d9-be6a-000c414ce854&quot;,
+             &quot;type&quot;: &quot;00001050-ce7f-11d9-8cd5-0011113ae5d6&quot;,
+             &quot;item&quot;: [&quot;82c7f970-fd68-11d9-be6a-000c414ce854&quot;, &quot;00020000-ce7f-11d9-8cd5-0011113ae5d6&quot;],
+        &quot;attribute&quot;: [&quot;00001005-ce7f-11d9-8cd5-0011113ae5d6&quot;, &quot;0000100c-ce7f-11d9-8cd5-0011113ae5d6&quot;]  }
+    },
+    // -----------------------------------------------------------------------
+    // (Page: Welcome).(Summary) = &quot;Welcome to the Sandbox repository...&quot;
+    //           by (Brian) on (Jul 25, 2005)
+    { &quot;Entry&quot;: {
+             &quot;uuid&quot;: &quot;82c7f973-fd68-11d9-be6a-000c414ce854&quot;,
+             &quot;type&quot;: &quot;00001020-ce7f-11d9-8cd5-0011113ae5d6&quot;,
+        &quot;attribute&quot;: &quot;00001003-ce7f-11d9-8cd5-0011113ae5d6&quot;,
+             &quot;item&quot;: &quot;82c7f970-fd68-11d9-be6a-000c414ce854&quot;,
+            &quot;value&quot;: &quot;Welcome to the Sandbox repository. Feel free to use this as a place to play around with OpenRecord. You can experiment with creating pages, setting up tables, and editing items.&quot;  }
+    }  ]
+  }
\ No newline at end of file

Added: trunk/sandbox.html
===================================================================
--- trunk/sandbox.html	2005-07-25 23:42:46 UTC (rev 260)
+++ trunk/sandbox.html	2005-07-26 00:11:47 UTC (rev 261)
@@ -0,0 +1,50 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
+&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.1//EN&quot; &quot;<A HREF="http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd</A>&quot;&gt;
+&lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot; xml:lang=&quot;en&quot; &gt;
+
+&lt;!-- 
+ Written in 2005 by Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
+  
+ Copyright rights relinquished under the Creative Commons  
+ Public Domain Dedication:
+    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
+--&gt;
+
+  &lt;head&gt;
+    &lt;title&gt;openrecord.org - Sandbox Page&lt;/title&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;source/OpenRecordLoader.js&quot;&gt;&lt;/script&gt;
+  &lt;/head&gt;
+  
+  &lt;body&gt;
+    &lt;div id=&quot;OpenRecord&quot;&gt;
+      &lt;p&gt;Sorry, for some reason OpenRecord was not able to launch.  
+      OpenRecord only runs in Firefox browsers, and JavaScript must be enabled. 
+      If you are seeing this message in Firefox, then you may have found a
+      bug in OpenRecord.&lt;/p&gt;
+    &lt;/div&gt;
+    
+&lt;!-- Creative Commons metadata for Public Domain License 
+
+&lt;rdf:RDF xmlns=&quot;<A HREF="http://web.resource.org/cc/">http://web.resource.org/cc/</A>&quot;
+    xmlns:dc=&quot;<A HREF="http://purl.org/dc/elements/1.1/">http://purl.org/dc/elements/1.1/</A>&quot;
+    xmlns:rdf=&quot;<A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#">http://www.w3.org/1999/02/22-rdf-syntax-ns#</A>&quot;&gt;
+&lt;Work rdf:about=&quot;&quot;&gt;
+   &lt;dc:title&gt;openrecord.org&lt;/dc:title&gt;
+   &lt;dc:type rdf:resource=&quot;<A HREF="http://purl.org/dc/dcmitype/Text">http://purl.org/dc/dcmitype/Text</A>&quot; /&gt;
+   &lt;license rdf:resource=&quot;<A HREF="http://web.resource.org/cc/PublicDomain">http://web.resource.org/cc/PublicDomain</A>&quot; /&gt;
+&lt;/Work&gt;
+
+&lt;License rdf:about=&quot;<A HREF="http://web.resource.org/cc/PublicDomain">http://web.resource.org/cc/PublicDomain</A>&quot;&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Reproduction">http://web.resource.org/cc/Reproduction</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Distribution">http://web.resource.org/cc/Distribution</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/DerivativeWorks">http://web.resource.org/cc/DerivativeWorks</A>&quot; /&gt;
+&lt;/License&gt;
+
+&lt;/rdf:RDF&gt;
+
+--&gt;
+
+  &lt;/body&gt;
+  
+&lt;/html&gt;
+

Modified: trunk/source/view/RootView.js
===================================================================
--- trunk/source/view/RootView.js	2005-07-25 23:42:46 UTC (rev 260)
+++ trunk/source/view/RootView.js	2005-07-26 00:11:47 UTC (rev 261)
@@ -181,7 +181,7 @@
     if (listOfPages &amp;&amp; listOfPages.length &gt; 0) {
       this._homePage = listOfPages[0];
     } else {
-      Util.assert(false);
+      // We may get here if the document does not yet have any pages.
     }
   }
   return this._homePage;
@@ -331,12 +331,14 @@
   
   if (!contentViewToSwitchTo) {
     var page = this.getHomePage();
-    contentViewToSwitchTo = this._hashTableOfPageViewsKeyedByUuid[page._getUuid()];
-    if (!contentViewToSwitchTo) {
-      divElement = window.document.createElement(&quot;div&quot;); 
-      this._contentViewDivElement.appendChild(divElement);
-      contentViewToSwitchTo = new PageView(this, divElement, page);
-      this._hashTableOfPageViewsKeyedByUuid[page._getUuid()] = contentViewToSwitchTo;
+    if (page) {
+      contentViewToSwitchTo = this._hashTableOfPageViewsKeyedByUuid[page._getUuid()];
+      if (!contentViewToSwitchTo) {
+        divElement = window.document.createElement(&quot;div&quot;); 
+        this._contentViewDivElement.appendChild(divElement);
+        contentViewToSwitchTo = new PageView(this, divElement, page);
+        this._hashTableOfPageViewsKeyedByUuid[page._getUuid()] = contentViewToSwitchTo;
+      }
     }
   }
   if (this._currentContentView) {
@@ -354,14 +356,15 @@
  * @scope    public instance method
  */
 RootView.prototype.display = function() {
-  Util.assert(this._currentContentView instanceof Object);
-
-  document.title = this._currentContentView.getPageTitle() + &quot; - openrecord.org&quot;;
   this._rootDiv.className = (this.isInShowToolsMode()) ? RootView.CSS_CLASS_EDIT_MODE : RootView.CSS_CLASS_VIEW_MODE;
   this._displayLoginSpan();
   this._displayNavbar();
   this._displayDebugArea();
-  this._currentContentView.includeOnScreen(true);
+  if (this._currentContentView) {
+    Util.assert(this._currentContentView instanceof Object);
+    document.title = this._currentContentView.getPageTitle() + &quot; - openrecord.org&quot;;
+    this._currentContentView.includeOnScreen(true);
+  }
   window.focus();
 };
 
@@ -375,6 +378,7 @@
  * @return   The newly created page item.
  */
 RootView.prototype.newPage = function() {
+  var hasAtLeastOnePage = this.getHomePage() ? true : false;
   var repository = this.getWorld();
   repository.beginTransaction();
   var newPage = repository.newItem(&quot;New Page&quot;);
@@ -383,7 +387,13 @@
   newPage.assignToCategory(categoryCalledPage);
   newPage.addEntryForAttribute(attributeCalledSummary, &quot;This is a new page.&quot;);
 
-  PageView.newSection(repository, newPage);
+  if (hasAtLeastOnePage) {
+    PageView.newSection(repository, newPage);
+  } else {
+    // If we get here it means we're creating the very first page in 
+    // this repository, so make it a &quot;Welcome page&quot; that just has a title
+    // and a summary, without any new sections.
+  }
 
   repository.endTransaction();
   


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000245.html">[openrecord-svn] r260 - trunk/source/util
</A></li>
	<LI>Next message: <A HREF="000247.html">[openrecord-svn] r262 - in trunk/source: model util
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#246">[ date ]</a>
              <a href="thread.html#246">[ thread ]</a>
              <a href="subject.html#246">[ subject ]</a>
              <a href="author.html#246">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openrecord-svn">More information about the openrecord-svn
mailing list</a><br>
</body></html>
