<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openrecord-svn] r68 - trunk/source
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openrecord-svn/2005-May/index.html" >
   <LINK REL="made" HREF="mailto:openrecord-svn%40lists.berlios.de?Subject=Re%3A%20%5Bopenrecord-svn%5D%20r68%20-%20trunk/source&In-Reply-To=%3C200505192242.j4JMgwPW028574%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000057.html">
   <LINK REL="Next"  HREF="000059.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openrecord-svn] r68 - trunk/source</H1>
    <B>Brian Douglas Skinner at BerliOS</B> 
    <A HREF="mailto:openrecord-svn%40lists.berlios.de?Subject=Re%3A%20%5Bopenrecord-svn%5D%20r68%20-%20trunk/source&In-Reply-To=%3C200505192242.j4JMgwPW028574%40sheep.berlios.de%3E"
       TITLE="[openrecord-svn] r68 - trunk/source">skinner at sheep.berlios.de
       </A><BR>
    <I>Fri May 20 00:42:58 CEST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000057.html">[openrecord-svn] r67 - trunk/documentation
</A></li>
        <LI>Next message: <A HREF="000059.html">[openrecord-svn] r70 - in trunk/source: . model
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58">[ date ]</a>
              <a href="thread.html#58">[ thread ]</a>
              <a href="subject.html#58">[ subject ]</a>
              <a href="author.html#58">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: skinner
Date: 2005-05-20 00:42:55 +0200 (Fri, 20 May 2005)
New Revision: 68

Removed:
   trunk/source/Item.js
   trunk/source/Stevedore.js
Log:
Deleted source/Stevedore.js and source/Item.js, both of which have been replaced by the new data model code in the model/ directory.

Deleted: trunk/source/Item.js
===================================================================
--- trunk/source/Item.js	2005-05-19 22:41:02 UTC (rev 67)
+++ trunk/source/Item.js	2005-05-19 22:42:55 UTC (rev 68)
@@ -1,380 +0,0 @@
-/*****************************************************************************
- Item.js
- 
-******************************************************************************
- Written in 2005 by Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
-  
- Copyright rights relinquished under the Creative Commons  
- Public Domain Dedication:
-    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
-  
- You can copy freely from this file.  This work may be freely reproduced, 
- distributed, transmitted, used, modified, built upon, or otherwise exploited
- by anyone for any purpose.
-  
- This work is provided on an &quot;AS IS&quot; basis, without warranties or conditions 
- of any kind, either express or implied, including, without limitation, any 
- warranties or conditions of title, non-infringement, merchantability, or 
- fitness for a particular purpose. You are solely responsible for determining 
- the appropriateness of using or distributing the work and assume all risks 
- associated with use of this work, including but not limited to the risks and 
- costs of errors, compliance with applicable laws, damage to or loss of data 
- or equipment, and unavailability or interruption of operations.
-
- In no event shall the authors or contributors have any liability for any 
- direct, indirect, incidental, special, exemplary, or consequential damages,
- however caused and on any theory of liability, whether in contract, strict 
- liability, or tort (including negligence), arising in any way out of or in 
- connection with the use or distribution of the work.
-*****************************************************************************/
-
- 
-// -------------------------------------------------------------------
-// Dependencies:
-//   Util.js
-//   Stevedore.js
-// -------------------------------------------------------------------
-
-
-/**
- * Instances of the Item class know how to store and retrieve their
- * attribute values.
- *
- * @scope    public instance constructor
- */
-function Item(inStevedore, inUuid) {
-  Util.assert(!inUuid || Util.isNumeric(inUuid));
-  
-  this._myStevedore = inStevedore;
-  this._myUuid = inUuid;
-  this._myListOfObservers = [];
-  this._myHashTableOfAssignmentsKeyedByAttributeUuid = {};
-}
-
-
-/**
- * Returns the display name of the item.
- *
- * @scope    public instance method
- * @return   A string with a display name for the item.
- */
-Item.prototype.toString = function () {
-  var returnString = &quot;[Item #&quot; + this.getUuid() + &quot; &quot;;
-  var listOfCategories = this.getValueListFromAttribute(Stevedore.UUID_FOR_ATTRIBUTE_CATEGORY);
-  for (var key in listOfCategories) {
-    var category = listOfCategories[key];
-    Util.assert(category instanceof Item);
-    returnString += &quot;(&quot; + category.getDisplayName() + &quot;)&quot;;
-  }
-  returnString += &quot; \&quot;&quot; + this.getDisplayName() + &quot;\&quot;&quot; + &quot;]&quot;;
-  return returnString; 
-};
-
-
-// -------------------------------------------------------------------
-// Attribute Accessor Methods
-// -------------------------------------------------------------------
-
-/**
- * Returns the display name of the item.
- *
- * @scope    public instance method
- * @return   A string with a display name for the item.
- */
-Item.prototype.getDisplayName = function (inDefaultString) {
-  return this._getStringUsingNameAttributes(Stevedore.UUID_FOR_ATTRIBUTE_NAME, null, inDefaultString);
-};
-  
-  
-/**
- * Returns a short display name for the item.
- *
- * @scope    public instance method
- * @return   A string with a short display name for the item.
- */
-Item.prototype.getShortName = function (inDefaultString) {
-  return this._getStringUsingNameAttributes(Stevedore.UUID_FOR_ATTRIBUTE_SHORT_NAME, Stevedore.UUID_FOR_ATTRIBUTE_NAME, inDefaultString);
-};
-
-
-/**
- * Given an attribute, this method returns the list of values that 
- * have been assigned to that attribute for this item.
- *
- * For example, to find out what color Kermit is: 
- * &lt;pre&gt;
- *    var valueList = kermit.getValueListFromAttribute(color);
- *    for (var i = 0; i &lt; valueList.length; ++i) {
- *      alert(&quot;Kermit is &quot; + valueList[i]);
- *    }
- * &lt;/pre&gt;
- *
- * @scope    public instance method
- * @param    inAttribute    The object to be removed from the set of observers. 
- */
-Item.prototype.getValueListFromAttribute = function (inAttribute) {
-  Util.assert(Util.isHashTable(this._myHashTableOfAssignmentsKeyedByAttributeUuid));
-  
-  var attributeUuid = this._myStevedore.getAttributeUuidFromAttributeOrUuid(inAttribute);
-  // PENDING: 
-  //   If this item isn't yet fully loaded into the cache, then we might need 
-  //   to ask our stevedore to get the attribute values for us.
-  var valueList = this._myHashTableOfAssignmentsKeyedByAttributeUuid[attributeUuid];
-  return (valueList || null);
-};
-
-/**
- * Utility function to return just the first value of an item's attribute
- */
-Item.prototype.getSingleValueFromAttribute = function(inAttribute) {
-  var valueList = this.getValueListFromAttribute(inAttribute);
-  var singleValue = &quot;&quot;;
-  if (valueList) {
-    singleValue = SectionView.getStringForValue(valueList[0]);
-  }
-  return singleValue;
-};
-
-/**
- * Assigns a value to an attribute in this item.
- *
- * Given an attribute and a value, assigns that value to the
- * attribute of the item. For example, to make a Kermit green:
- * &lt;pre&gt;
- *    kermit.assign(color, &quot;green&quot;);
- * &lt;/pre&gt;
- * Attributes can always have more than one assigned value, so
- * you can make Kermit be both blue and green by doing:
- * &lt;pre&gt;
- *    kermit.assign(color, &quot;green&quot;);
- *    kermit.assign(color, &quot;blue&quot;);
- * &lt;/pre&gt;
- *
- * @scope    public instance method
- * @param    inAttribute    The attribute to assign the value to, or the UUID of the attribute. 
- * @param    inValue    The value to be assigned. 
- */
-Item.prototype.assign = function (inAttribute, inValue) {
-  var cleanValue = inValue;
-  // alert(&quot;assign(&quot; + inAttribute + &quot;, &quot; + inValue + &quot;)&quot;);
-  if (Util.isString(inValue)) {
-    cleanValue = Util.getCleanString(inValue);
-  }
-  var valueWasSet = this._initializeAttributeValue(inAttribute, cleanValue);
-  if (valueWasSet) {
-    this._myStevedore.markDirty(this);
-  }
-  // PENDING: 
-  //   We also need to create a change object, and we need to tell 
-  //   this._myStevedore about the change.
-  this._notifyObservers();
-};
-
-
-/**
- * Given an attribute, removes that attribute from the item's list
- * of attributes that have values assigned.
- *
- * @scope    public instance method
- * @param    inAttribute    The attribute to clear, or the UUID of the attribute. 
- * @return   Returns true if there was an existing attribute value to clear.
- */
-Item.prototype.clear = function (inAttribute) {
-  Util.assert(Util.isHashTable(this._myHashTableOfAssignmentsKeyedByAttributeUuid));
-
-  var valueWasDeleted = false;
-  var attributeUuid = this._myStevedore.getAttributeUuidFromAttributeOrUuid(inAttribute);
-  var currentValueList = this._myHashTableOfAssignmentsKeyedByAttributeUuid[attributeUuid];
-  if (currentValueList &amp;&amp; (currentValueList.length &gt; 0)) {
-    this._myHashTableOfAssignmentsKeyedByAttributeUuid[attributeUuid] = null;
-    valueWasDeleted = true;
-    this._myStevedore.markDirty(this);
-  }
-  
-  // PENDING: 
-  //   We also need to create a change object, and we need to tell 
-  //   this._myStevedore about the change.
-  this._notifyObservers();
-  
-  return valueWasDeleted;
-};
-
-
-// -------------------------------------------------------------------
-// Non-Attribute Accessor Methods
-// -------------------------------------------------------------------
-
-/**
- * Returns the UUID of the item.
- *
- * @scope    public instance method
- * @return   The UUID of the item.
- */
-Item.prototype.getUuid = function () {
-  return this._myUuid;
-};
-
-
-/**
- * Returns a list of the UUIDs for all the attributes that this item
- * has values assigned to.
- *
- * @scope    public instance method
- * @return   A list of UUIDs of attribute items.
- */
-Item.prototype.getListOfAttributeUuids = function () {
-  var listOfAttributeUuids = [];
-  for (var attributeUuid in this._myHashTableOfAssignmentsKeyedByAttributeUuid) {
-    listOfAttributeUuids.push(attributeUuid);
-  }
-  return listOfAttributeUuids;
-};
-
-
-/**
- * Given a category, returns &quot;true&quot; if the item has been assigned to 
- * that category.
- *
- * Also returns true if the item has been assigned to some category which is in
- * turn assigned to the given category, and so on, up the chain of category 
- * assignments.
- *
- * @scope    public instance method
- * @return   A boolean.  True if the item has been assigned to the category.
- */
-Item.prototype.isInCategory = function (inCategory) {
-  Util.assert(inCategory instanceof Item);
-
-  var valueList = this.getValueListFromAttribute(Stevedore.UUID_FOR_ATTRIBUTE_CATEGORY);
-  var key;
-  var value;
-  
-  // look at all the categories this item is assigned to, and see if one of them is &quot;inCategory&quot;
-  for (key in valueList) {
-    value = valueList[key];
-    if (value == inCategory) {
-      return true;
-    }
-  }
-  
-  // look at all the categories this item is assigned to, and see if one of them
-  // is in turn in the categoery &quot;inCategory&quot;
-  for (key in valueList) {
-    value = valueList[key];
-    // PENDING: 
-    //   This will go into an infinite loop if there is ever a cycle in the category 
-    //   assignments, like: A is in category B, and B is in C, and C is in A.
-    //   We need to use a non-recursive search of the graph.
-    // PENDING:
-    //   Do we also need to register as an observer of something, so that if we later
-    //   become a member of that category in question, then we can notify whoever
-    //   is observing us?
-    if ((value != this) &amp;&amp; (value.isInCategory(inCategory))) {
-      return true;
-    }
-  }
-  return false;
-};
- 
-
-// -------------------------------------------------------------------
-// Observer/Observable Methods
-// -------------------------------------------------------------------
-
-/**
- * Given an object, registers the object as an observer of this item, so that
- * the object will be notified when the item changes.
- *
- * @scope    public instance method
- * @param    inObserver    An object to be registered as an observer of the item. 
- */
-Item.prototype.addObserver = function (inObserver) {
-  Util.addObjectToSet(inObserver, this._myListOfObservers);
-};
-
-
-/**
- * Given an object, removes that object from the set of observers of this item, so 
- * that the object will no longer be notified when the item changes.
- *
- * @scope    public instance method
- * @param    inObserver    The object to be removed from the set of observers. 
- */
-Item.prototype.removeObserver = function (inObserver) {
-  Util.removeObjectFromSet(inObserver, this._myListOfObservers);
-};
-
-
-// -------------------------------------------------------------------
-// Private Methods
-// -------------------------------------------------------------------
-
-/**
- * Set the value of an attribute when the item is first being loaded
- * by the Stevedore.
- *
- * @scope    private instance method
- * @param    inAttribute    The attribute to assign the value to, or the UUID of the attribute. 
- * @param    inValue    The value to be assigned. 
- * @return   Returns true if the value was assigned.
- */
-Item.prototype._initializeAttributeValue = function (inAttribute, inValue) {
-  Util.assert(Util.isHashTable(this._myHashTableOfAssignmentsKeyedByAttributeUuid));
-
-  var attributeUuid = this._myStevedore.getAttributeUuidFromAttributeOrUuid(inAttribute);
-  if (!this._myHashTableOfAssignmentsKeyedByAttributeUuid[attributeUuid]) {
-    this._myHashTableOfAssignmentsKeyedByAttributeUuid[attributeUuid] = [];
-  }
-  // var 
-  var valueList = this._myHashTableOfAssignmentsKeyedByAttributeUuid[attributeUuid];
-  var valueWasAddedFlag = Util.addObjectToSet(inValue, valueList);
-  return valueWasAddedFlag;
-};
-
-
-/**
- * Returns some display name for the item, drawing on both the &quot;name&quot; and
- * &quot;short name&quot; attributes.
- *
- * @scope    private instance method
- * @return   A string with a display name for the item.
- */
-Item.prototype._getStringUsingNameAttributes = function (inPrimaryAttributeUuid, inSecondaryAttributeUuid, inDefaultString) {
-  var returnString = null;
-  var nameList = this.getValueListFromAttribute(inPrimaryAttributeUuid);
-  if (nameList) {
-    returnString = nameList[0];
-  }
-  if (!returnString &amp;&amp; inSecondaryAttributeUuid) {
-    nameList = this.getValueListFromAttribute(inSecondaryAttributeUuid);
-    if (nameList) {
-      returnString = nameList[0];
-    }
-  }
-  if (!returnString) {
-    returnString = inDefaultString;
-  }
-  if (!returnString) {
-    returnString = &quot;&quot;;
-  }
-  return returnString;
-};
-  
-
-/**
- * Sends messages to all the registered observers to let them know that
- * this item has changed.
- *
- * @scope    private instance method
- */
-Item.prototype._notifyObservers = function () {
-  for (var key in this._myListOfObservers) {
-    var observer = this._myListOfObservers[key];
-    observer.observedItemHasChanged(this);
-  }
-};
-
-
-// -------------------------------------------------------------------
-// End of file
-// -------------------------------------------------------------------

Deleted: trunk/source/Stevedore.js
===================================================================
--- trunk/source/Stevedore.js	2005-05-19 22:41:02 UTC (rev 67)
+++ trunk/source/Stevedore.js	2005-05-19 22:42:55 UTC (rev 68)
@@ -1,640 +0,0 @@
-/*****************************************************************************
- Stevedore.js
- 
-******************************************************************************
- Written in 2005 by Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
-  
- Copyright rights relinquished under the Creative Commons  
- Public Domain Dedication:
-    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
-  
- You can copy freely from this file.  This work may be freely reproduced, 
- distributed, transmitted, used, modified, built upon, or otherwise exploited
- by anyone for any purpose.
-  
- This work is provided on an &quot;AS IS&quot; basis, without warranties or conditions 
- of any kind, either express or implied, including, without limitation, any 
- warranties or conditions of title, non-infringement, merchantability, or 
- fitness for a particular purpose. You are solely responsible for determining 
- the appropriateness of using or distributing the work and assume all risks 
- associated with use of this work, including but not limited to the risks and 
- costs of errors, compliance with applicable laws, damage to or loss of data 
- or equipment, and unavailability or interruption of operations.
-
- In no event shall the authors or contributors have any liability for any 
- direct, indirect, incidental, special, exemplary, or consequential damages,
- however caused and on any theory of liability, whether in contract, strict 
- liability, or tort (including negligence), arising in any way out of or in 
- connection with the use or distribution of the work.
-*****************************************************************************/
-
- 
-// -------------------------------------------------------------------
-// Dependencies:
-//   Util.js
-//   Item.js
-// -------------------------------------------------------------------
-
-
-// -------------------------------------------------------------------
-// Stevedore public class constants
-// -------------------------------------------------------------------
-Stevedore.UUID_FOR_ATTRIBUTE_UUID = 100;
-Stevedore.UUID_FOR_ATTRIBUTE_SHORT_NAME = 101;
-Stevedore.UUID_FOR_ATTRIBUTE_NAME = 102;
-Stevedore.UUID_FOR_ATTRIBUTE_SUMMARY = 103;
-Stevedore.UUID_FOR_ATTRIBUTE_BODY = 104;
-Stevedore.UUID_FOR_ATTRIBUTE_CATEGORY = 105;
-Stevedore.UUID_FOR_ATTRIBUTE_USERSTAMP = 106;
-Stevedore.UUID_FOR_ATTRIBUTE_TIMESTAMP = 107;
-Stevedore.UUID_FOR_ATTRIBUTE_SECTION = 108;
-Stevedore.UUID_FOR_ATTRIBUTE_QUERY = 109;
-Stevedore.UUID_FOR_ATTRIBUTE_QUERY_MATCHING_CATEGORY = 110;
-Stevedore.UUID_FOR_ATTRIBUTE_QUERY_MATCHING_ITEM = 111;
-Stevedore.UUID_FOR_ATTRIBUTE_PLUGIN_NAME = 112;
-
-Stevedore.UUID_FOR_CATEGORY_BOOK = 141;      // here as an example only
-Stevedore.UUID_FOR_CATEGORY_MOVIE = 142;     // here as an example only
-Stevedore.UUID_FOR_CATEGORY_ATTRIBUTE = 143;
-Stevedore.UUID_FOR_CATEGORY_CATEGORY = 144;
-Stevedore.UUID_FOR_CATEGORY_PAGE = 145;
-Stevedore.UUID_FOR_CATEGORY_SECTION = 146;
-Stevedore.UUID_FOR_CATEGORY_QUERY = 147;
-
-Stevedore.JSON_MEMBER_FORMAT = &quot;format&quot;;
-Stevedore.JSON_MEMBER_TIMESTAMP = &quot;timestamp&quot;;
-Stevedore.JSON_MEMBER_DATA = &quot;data&quot;;
-Stevedore.JSON_FORMAT_2005_MARCH = &quot;2005_MARCH_ITEM_CENTRIC_LIST&quot;;
-
-Stevedore.JSON_MEMBER_TYPE = &quot;type&quot;;
-Stevedore.JSON_MEMBER_VALUE = &quot;value&quot;;
-Stevedore.JSON_TYPE_STRING_VALUE = &quot;StringValue&quot;;
-Stevedore.JSON_TYPE_UUID = &quot;Uuid&quot;;
-Stevedore.JSON_TYPE_FOREIGN_UUID = &quot;ForeignUuid&quot;;
-Stevedore.JSON_TYPE_NUMBER_VALUE = &quot;NumberValue&quot;;
-
-
-/**
- * Instances of the Stevedore class know how to store and retrieve items to 
- * and from a data source.
- *
- * @scope    public instance constructor
- */
-function Stevedore() {
-  this._myNextAvailableUuid = 1;
-  this._myHashTableOfItemsKeyedByUuid = {};
-  this._myCountOfNestedTransactions = 0;
-  this._myHomePageItem = null;
-  this._myXMLHttpRequestObject = this._newXMLHttpRequestObject();
-  this._myListOfDirtyItems = [];
-  // this._myDirtyFlag = false;
-  
-  this._loadBootstrapItems();
-}
-
-
-/**
- * Returns a newly created item.
- *
- * @scope    public instance method
- * @param    inObserver    Optional. An object to be registered as an observer of the returned item. 
- * @return   A newly created item.
- */
-Stevedore.prototype.newItem = function (inObserver) {
-  var uuid = this._myNextAvailableUuid;
-  this._myNextAvailableUuid += 1;
-  var item = new Item(this, uuid);
-  this._myHashTableOfItemsKeyedByUuid[uuid] = item;
-  item.addObserver(inObserver);
-  this.markDirty(item);
-  return item;
-};
-
-
-// -------------------------------------------------------------------
-// Accessor Methods
-// -------------------------------------------------------------------
-
-/**
- * Given a UUID, returns the item identified by that UUID.
- *
- * @scope    public instance method
- * @param    inUuid    The UUID of the item to be returned. 
- * @param    inObserver    Optional. An object to be registered as an observer of the returned item. 
- * @return   The item identified by the given UUID.
- */
-Stevedore.prototype.getItemFromUuid = function (inUuid, inObserver) {
-  Util.assert(Util.isNumeric(inUuid));
-  
-  var item = this._myHashTableOfItemsKeyedByUuid[inUuid];
-  if (item &amp;&amp; inObserver) {
-    item.addObserver(inObserver);
-  }
-  return item;
-};
-
-
-/**
- * Given an attribute or an attribute's UUID, return the attribute's UUID.
- *
- * @scope    public instance method
- * @param    inAttributeOrUuid    An attribute, or an attribute's UUID. 
- * @return   The UUID of the attribute.
- */
-Stevedore.prototype.getAttributeUuidFromAttributeOrUuid = function (inAttributeOrUuid) {
-  Util.assert((inAttributeOrUuid instanceof Item) || Util.isNumeric(inAttributeOrUuid));
-
-  var uuid = null;
-  if (Util.isNumeric(inAttributeOrUuid)) {
-    uuid = inAttributeOrUuid;
-  }
-  if (inAttributeOrUuid instanceof Item) {
-    uuid = inAttributeOrUuid.getUuid();
-  }
-  return uuid;
-};
-
-
-/**
- * Returns the page item to be used as the home page.
- *
- * @scope    public instance method
- * @return   A page item.
- */
-Stevedore.prototype.getHomePage = function () {
-  return this._myHomePageItem; 
-};
-
-
-/**
- * Given a query item, this method returns a list of all the items that 
- * match the query criteria.
- *
- * @scope    public instance method
- * @param    inQuery    A query item. 
- * @return   A list of items.
- */
-Stevedore.prototype.getListOfResultItemsForQuery = function (inQuery) {
-  Util.assert(inQuery instanceof Item);
-
-  var uuid = null;
-  var item = null;
-  var listOfQueryResultItems = null;
-  var listOfMatchingCategories = inQuery.getValueListFromAttribute(Stevedore.UUID_FOR_ATTRIBUTE_QUERY_MATCHING_CATEGORY);
-  var listOfMatchingItems = inQuery.getValueListFromAttribute(Stevedore.UUID_FOR_ATTRIBUTE_QUERY_MATCHING_ITEM);
-  var isCategoryMatchingQuery = (listOfMatchingCategories &amp;&amp; (listOfMatchingCategories.length &gt; 0));
-  var isItemMatchingQuery = (listOfMatchingItems &amp;&amp; (listOfMatchingItems.length &gt; 0));
-
-  Util.assert(!(isCategoryMatchingQuery &amp;&amp; isItemMatchingQuery));
-
-  if (isItemMatchingQuery) {
-    listOfQueryResultItems = listOfMatchingItems;
-  }
-  
-  if (isCategoryMatchingQuery) {
-    listOfQueryResultItems = [];
-    // This is a wildly inefficient search.  But maybe it doesn't matter,
-    // because this code should all be replaced someday by server code.
-    for (uuid in this._myHashTableOfItemsKeyedByUuid) {
-      item = this._myHashTableOfItemsKeyedByUuid[uuid];
-      var includeItem = true;
-      for (var key in listOfMatchingCategories) {
-        var category = listOfMatchingCategories[key];
-        if (includeItem &amp;&amp; !(item.isInCategory(category))) {
-          includeItem = false;
-        }
-      }
-      if (includeItem) {
-        listOfQueryResultItems.push(item);
-      }
-    }
-  }
-  
-  if (!isItemMatchingQuery &amp;&amp; !isCategoryMatchingQuery) {
-    listOfQueryResultItems = [];
-    for (uuid in this._myHashTableOfItemsKeyedByUuid) {
-      item = this._myHashTableOfItemsKeyedByUuid[uuid];
-      listOfQueryResultItems.push(item);
-    }
-  }
-  
-  return listOfQueryResultItems; 
-};
-
-
-
-/**
- * Given an item and a query item, this method modifies the attributes 
- * of the item so that when the query is next evaluated the item will be 
- * included in query result list.
- *
- * @scope    public instance method
- * @param    inItem    An item, which will be modified so that it matches the query. 
- * @param    inQuery    A query item. 
- */
-Stevedore.prototype.setItemToBeIncludedInQueryResultList = function (inItem, inQuery) {
-  Util.assert(inItem instanceof Item);
-  Util.assert(inQuery instanceof Item);
-
-  var listOfMatchingCategories = inQuery.getValueListFromAttribute(Stevedore.UUID_FOR_ATTRIBUTE_QUERY_MATCHING_CATEGORY);
-  var listOfMatchingItems = inQuery.getValueListFromAttribute(Stevedore.UUID_FOR_ATTRIBUTE_QUERY_MATCHING_ITEM);
-  var isCategoryMatchingQuery = (listOfMatchingCategories &amp;&amp; (listOfMatchingCategories.length &gt; 0));
-  var isItemMatchingQuery = (listOfMatchingItems &amp;&amp; (listOfMatchingItems.length &gt; 0));
-
-  Util.assert(!(isCategoryMatchingQuery &amp;&amp; isItemMatchingQuery));
-
-  if (isItemMatchingQuery) {
-    inQuery.assign(Stevedore.UUID_FOR_ATTRIBUTE_QUERY_MATCHING_ITEM, inItem);
-  }
-  
-  if (isCategoryMatchingQuery) {
-    for (var key in listOfMatchingCategories) {
-      var category = listOfMatchingCategories[key];
-      if (!(inItem.isInCategory(category))) {
-        inItem.assign(Stevedore.UUID_FOR_ATTRIBUTE_CATEGORY, category);
-      }
-    }
-  }
-};
-
-
-/**
- * Given a category, this method returns a list of all the items that have been 
- * assigned to that category.
- *
- * @scope    public instance method
- * @param    inCategory    A category item. 
- * @return   A list of items.
- */
-Stevedore.prototype.getListOfItemsInCategory = function (inCategory) {
-  Util.assert(inCategory instanceof Item);
-
-  var listOfItems = [];
-  for (var uuid in this._myHashTableOfItemsKeyedByUuid) {
-    var item = this._myHashTableOfItemsKeyedByUuid[uuid];
-    if (item.isInCategory(inCategory)) {
-      listOfItems.push(item);
-    }
-    // var kindList = item.getValueListFromAttribute(Repository.ATTRIBUTE_CALLED_KIND);
-    // if (kindList) {
-    //   if (kindList[0] == inKind) {
-    //     listOfItems.push(item);
-    //   }
-    // }
-  }
-  return listOfItems; 
-};
-
-// -------------------------------------------------------------------
-// Transaction Methods
-// -------------------------------------------------------------------
-
-/**
- * Marks the beginning of a transaction.
- *
- * Each time you call beginTransaction() you open a new transaction, 
- * which you need to close later using endTransaction().  Transactions
- * may be nested, but the beginTransaction and endTransaction calls
- * always need to come in pairs. 
- *
- * @scope    public instance method
- */
-Stevedore.prototype.beginTransaction = function () {
-  this._myCountOfNestedTransactions += 1;
-  // PENDING:
-  //   This is just a stub method for now.  Once we start implementing
-  //   support for transactions we'll have to put some real code here.
-};
- 
-
-/**
- * Marks the end of a transaction.
- *
- * @scope    public instance method
- */
-Stevedore.prototype.endTransaction = function () {
-  this._myCountOfNestedTransactions -= 1;
-  Util.assert(this._myCountOfNestedTransactions &gt;= 0);
-  // PENDING:
-  //   This is just a stub method for now.  Once we start implementing
-  //   support for transactions we'll have to put some real code here.
-  if (this._myCountOfNestedTransactions === 0) {
-    RootView.displayStatusBlurb(this._myListOfDirtyItems.length + &quot; changes made&quot;);
-    if (this._myListOfDirtyItems &amp;&amp; (this._myListOfDirtyItems.length &gt; 0)) {
-      this._saveChangesToServer();
-      this._myListOfDirtyItems = [];
-    }
-  }
-};
-
-
-/**
- * Marks an item as having been edited during the transaction.
- *
- * @scope    public instance method
- */
-Stevedore.prototype.markDirty = function (anItem) {
-  Util.assert(Util.isArray(this._myListOfDirtyItems));
-  this._myListOfDirtyItems.push(anItem);
-};
-
-
-// -------------------------------------------------------------------
-// Private Methods
-// -------------------------------------------------------------------
-
-/**
- * Given a UUID, either (a) returns the existing item identified by that UUID, 
- * or (b) creates an new item object, set its UUID, and returns that object.
- *
- * @scope    public instance method
- * @param    inUuid    The UUID of the item to be returned. 
- * @param    inObserver    Optional. An object to be registered as an observer of the returned item. 
- * @return   The item identified by the given UUID.
- */
-Stevedore.prototype._getItemFromUuidOrBootstrapItem = function (inUuid, inObserver) {
-  var item = this.getItemFromUuid(inUuid, inObserver);
-  if (!item) {
-    item = new Item(this, inUuid);
-    this._myHashTableOfItemsKeyedByUuid[inUuid] = item;
-    this._myNextAvailableUuid = Math.max(this._myNextAvailableUuid, (inUuid + 1));   
-    item.addObserver(inObserver);
-  }
-  return item;
-};
-
-
-/**
- * Loads the basic items needed in order to do anything else, like
- * the items for &quot;name&quot;, &quot;attribute&quot;, and &quot;category&quot;.
- *
- * @scope    private instance method
- */
-Stevedore.prototype._loadBootstrapItems = function () {
-  var uuid;
-  var name;
-  var item;
-  
-  // associate display names with the UUIDs of all the attributes
-  var hashTableOfAttributeNamesKeyedByUuid = {};
-  hashTableOfAttributeNamesKeyedByUuid[Stevedore.UUID_FOR_ATTRIBUTE_SHORT_NAME] = &quot;Short Name&quot;;
-  hashTableOfAttributeNamesKeyedByUuid[Stevedore.UUID_FOR_ATTRIBUTE_NAME] = &quot;Name&quot;;
-  hashTableOfAttributeNamesKeyedByUuid[Stevedore.UUID_FOR_ATTRIBUTE_SUMMARY] = &quot;Summary&quot;;
-  hashTableOfAttributeNamesKeyedByUuid[Stevedore.UUID_FOR_ATTRIBUTE_BODY] = &quot;Body&quot;;
-  hashTableOfAttributeNamesKeyedByUuid[Stevedore.UUID_FOR_ATTRIBUTE_CATEGORY] = &quot;Category&quot;;
-  hashTableOfAttributeNamesKeyedByUuid[Stevedore.UUID_FOR_ATTRIBUTE_USERSTAMP] = &quot;Userstamp&quot;;
-  hashTableOfAttributeNamesKeyedByUuid[Stevedore.UUID_FOR_ATTRIBUTE_TIMESTAMP] = &quot;Timestamp&quot;;
-  hashTableOfAttributeNamesKeyedByUuid[Stevedore.UUID_FOR_ATTRIBUTE_SECTION] = &quot;Section&quot;;
-  hashTableOfAttributeNamesKeyedByUuid[Stevedore.UUID_FOR_ATTRIBUTE_QUERY] = &quot;Query&quot;;
-  hashTableOfAttributeNamesKeyedByUuid[Stevedore.UUID_FOR_ATTRIBUTE_QUERY_MATCHING_CATEGORY] = &quot;Matching Category&quot;;
-  hashTableOfAttributeNamesKeyedByUuid[Stevedore.UUID_FOR_ATTRIBUTE_QUERY_MATCHING_ITEM] = &quot;Matching Item&quot;;
-  hashTableOfAttributeNamesKeyedByUuid[Stevedore.UUID_FOR_ATTRIBUTE_PLUGIN_NAME] = &quot;Plugin Name&quot;;
-
-  // create all the Item objects for the attributes
-  for (uuid in hashTableOfAttributeNamesKeyedByUuid) {
-    this._getItemFromUuidOrBootstrapItem(uuid);
-  }
-  
-  // associate display names with the UUIDs of all the categories
-  var hashTableOfCategoryNamesKeyedByUuid = {};
-  hashTableOfCategoryNamesKeyedByUuid[Stevedore.UUID_FOR_CATEGORY_ATTRIBUTE] = &quot;Attribute&quot;;
-  hashTableOfCategoryNamesKeyedByUuid[Stevedore.UUID_FOR_CATEGORY_CATEGORY] = &quot;Category&quot;;
-  hashTableOfCategoryNamesKeyedByUuid[Stevedore.UUID_FOR_CATEGORY_PAGE] = &quot;Page&quot;;
-  hashTableOfCategoryNamesKeyedByUuid[Stevedore.UUID_FOR_CATEGORY_SECTION] = &quot;Section&quot;;
-  hashTableOfCategoryNamesKeyedByUuid[Stevedore.UUID_FOR_CATEGORY_QUERY] = &quot;Query&quot;;
-
-  // create all the Item objects for the categories
-  for (uuid in hashTableOfCategoryNamesKeyedByUuid) {
-    this._getItemFromUuidOrBootstrapItem(uuid);
-  }
- 
-  // set the display names of all the attributes, and put them in the category called &quot;Attribute&quot;
-  var categoryAttribute = this._getItemFromUuidOrBootstrapItem(Stevedore.UUID_FOR_CATEGORY_ATTRIBUTE);
-  for (uuid in hashTableOfAttributeNamesKeyedByUuid) {
-    item = this.getItemFromUuid(uuid);
-    name = hashTableOfAttributeNamesKeyedByUuid[uuid];
-    item._initializeAttributeValue(Stevedore.UUID_FOR_ATTRIBUTE_NAME, name);
-    item._initializeAttributeValue(Stevedore.UUID_FOR_ATTRIBUTE_CATEGORY, categoryAttribute);
-  }
-  
-  // set the display names of all the categories, and put them in the category called &quot;Category&quot;
-  var categoryCategory = this._getItemFromUuidOrBootstrapItem(Stevedore.UUID_FOR_CATEGORY_CATEGORY);
-  for (uuid in hashTableOfCategoryNamesKeyedByUuid) {
-    item = this.getItemFromUuid(uuid);
-    name = hashTableOfCategoryNamesKeyedByUuid[uuid];
-    item._initializeAttributeValue(Stevedore.UUID_FOR_ATTRIBUTE_NAME, name);
-    item._initializeAttributeValue(Stevedore.UUID_FOR_ATTRIBUTE_CATEGORY, categoryCategory);
-  }
-  
-};
-
-
-/**
- * Loads sample data.
- *
- * Given a set of sample data in JSON format, bootstraps 
- * new instances of items corresponding to the sample data.
- * 
- * @scope    private instance method
- * @param    inDataSet    A list of items to be loaded, in JSON format. 
- */
-Stevedore.prototype._loadItemsFromList = function (inDataSet) {
-  Util.assert(Util.isArray(inDataSet) || Util.isObject(inDataSet));
-  
-  var uuidValue;
-  var uuid;
-  var item;
-  var listOfItems;
-  
-  if (Util.isArray(inDataSet)) {
-    // this is an old, pre-March-15-2005, file format
-    listOfItems = inDataSet;
-  } else {
-    // this is newer file format, circa March-16-2005
-    var fileFormat = inDataSet[Stevedore.JSON_MEMBER_FORMAT];
-    Util.assert(fileFormat == Stevedore.JSON_FORMAT_2005_MARCH);
-    listOfItems = inDataSet[Stevedore.JSON_MEMBER_DATA];
-    Util.assert(Util.isArray(listOfItems));
-  }
-  
-  for (var entryKey in listOfItems) {
-    var entry = listOfItems[entryKey];
-    uuidValue = entry[Stevedore.UUID_FOR_ATTRIBUTE_UUID];
-    uuid = uuidValue[Stevedore.JSON_MEMBER_VALUE];
-    item = this._getItemFromUuidOrBootstrapItem(uuid);
-    for (var propertyKey in entry) {
-      if (propertyKey != Stevedore.UUID_FOR_ATTRIBUTE_UUID) { 
-        var propertyValue = entry[propertyKey];
-        var attributeUuid = propertyKey;
-        Util.assert(Util.isArray(propertyValue));
-        for (var valueKey in propertyValue) {
-          var valueObject = propertyValue[valueKey];
-          var valueType = valueObject[Stevedore.JSON_MEMBER_TYPE];
-          var valueValue = valueObject[Stevedore.JSON_MEMBER_VALUE];
-          var finalValue = null;
-          switch (valueType) {
-            case Stevedore.JSON_TYPE_FOREIGN_UUID:
-              finalValue = this._getItemFromUuidOrBootstrapItem(valueValue);
-              break;
-            case Stevedore.JSON_TYPE_STRING_VALUE:
-              finalValue = valueValue;
-              break;
-            case Stevedore.JSON_TYPE_NUMBER_VALUE:
-              finalValue = valueValue;
-              break;
-          }
-          item._initializeAttributeValue(attributeUuid, finalValue);
-        }
-      }
-    }
-  }
-  
-  // PENDING:
-  // If we don't have a designated &quot;home page&quot; for this data set, then just
-  // look through all the items and set the home page to be the first page 
-  // item we come across.  This, of course, is a hack.
-  if (!this._myHomePageItem) {
-    var categoryPage = this.getItemFromUuid(Stevedore.UUID_FOR_CATEGORY_PAGE);
-    for (uuid in this._myHashTableOfItemsKeyedByUuid) {
-      item = this.getItemFromUuid(uuid);
-      if (item.isInCategory(categoryPage)) {
-        this._myHomePageItem = this._myHomePageItem || item;
-      }
-    }
-  }
-};
-
-
-/**
- * Returns a huge string, containing a JavaScript &quot;object literal&quot;
- * representation of the entire cache.
- *
- * @scope    private instance method
- * @return   A string in JavaScript &quot;object literal&quot; format, representing all the items in the cache. 
- */
-Stevedore.prototype._getJsonStringRepresentingAllItems = function () {
-  var timestamp = new Date();
-  var timestampString = timestamp.toString();
-  var listOfStrings = [];
-  
-  listOfStrings.push('// Repository dump, in JSON format' + '\n');
-  listOfStrings.push('Stevedore._ourRepositoryInJsonFormat = {' + '\n');
-  listOfStrings.push('  &quot;' + Stevedore.JSON_MEMBER_FORMAT + '&quot;: &quot;' + Stevedore.JSON_FORMAT_2005_MARCH + '&quot;, ' + '\n');
-  listOfStrings.push('  &quot;' + Stevedore.JSON_MEMBER_TIMESTAMP + '&quot;: &quot;' + timestampString + '&quot;, ' + '\n');
-  listOfStrings.push('  &quot;' + Stevedore.JSON_MEMBER_DATA + '&quot;: ' + '[' + '\n');
-  for (var uuid in this._myHashTableOfItemsKeyedByUuid) {
-    var uuidInJsonForm = '{ &quot;' + Stevedore.JSON_MEMBER_TYPE + '&quot;: &quot;' + Stevedore.JSON_TYPE_UUID + '&quot;, &quot;' + Stevedore.JSON_MEMBER_VALUE + '&quot;: ' + uuid + ' }';
-    listOfStrings.push('  { &quot;' + Stevedore.UUID_FOR_ATTRIBUTE_UUID + '&quot;: ' + uuidInJsonForm + ',' + '\n');
-    var item = this.getItemFromUuid(uuid);
-    var listOfAttributeUuids = item.getListOfAttributeUuids();
-    for (var attributeKey in listOfAttributeUuids) {
-      var attributeUuid = listOfAttributeUuids[attributeKey];
-      var attribute = this.getItemFromUuid(attributeUuid);
-      Util.assert(attribute instanceof Item);
-      var attributeName = attribute.getDisplayName();
-      var attributeNameSubstring = (attributeName + '          ').substring(0, 10);
-      listOfStrings.push('    /* ' + attributeNameSubstring + ' */   ');
-      listOfStrings.push('&quot;' + attributeUuid + '&quot;: [');
-      var listOfAttributeValues = item.getValueListFromAttribute(attribute);
-      for (var valueKey in listOfAttributeValues) {
-        var value = listOfAttributeValues[valueKey];
-        var pickleString = &quot;&quot;;
-        var typeString = null;
-        var valueString = null;
-        if (Util.isNumber(value)) {
-          typeString = Stevedore.JSON_TYPE_NUMBER_VALUE;
-          valueString = value;
-        }
-        if (Util.isString(value)) {
-          typeString = Stevedore.JSON_TYPE_STRING_VALUE;
-          valueString = '&quot;' + value + '&quot;';
-        }
-        if (value instanceof Item) {
-          typeString = Stevedore.JSON_TYPE_FOREIGN_UUID;
-          valueString = value.getUuid();
-        }
-        pickleString = '{ &quot;' + Stevedore.JSON_MEMBER_TYPE + '&quot;: &quot;' + typeString + '&quot;, &quot;' + Stevedore.JSON_MEMBER_VALUE + '&quot;: ' + valueString + ' }';
-        listOfStrings.push(pickleString + ', ');
-      }
-      listOfStrings.push('],\n');
-    }
-    listOfStrings.push(&quot;  },&quot; + &quot;\n&quot;);
-  }
-  listOfStrings.push(&quot;]};&quot; + &quot;\n&quot;);
-  var finalString = listOfStrings.join(&quot;&quot;);
-  return finalString;
-};
-
-
-/**
- * Returns a newly created XMLHttpRequest object.
- *
- * @scope    private instance method
- * @return   A newly created XMLHttpRequest object. 
- */
-Stevedore.prototype._newXMLHttpRequestObject = function () {
-  var newXMLHttpRequestObject = null;
-  if (window.XMLHttpRequest) {
-    newXMLHttpRequestObject = new XMLHttpRequest();
-  } else {
-    if (window.ActiveXObject) {
-      newXMLHttpRequestObject = new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;);
-    }
-  }
-  if (newXMLHttpRequestObject) {
-    newXMLHttpRequestObject.onreadystatechange = function() {
-      alert(&quot;onreadystatechange:\n&quot; +
-        &quot;readyState: &quot; + this._myXMLHttpRequestObject.readyState + &quot;\n&quot; +
-        &quot;status: &quot; + this._myXMLHttpRequestObject.status + &quot;\n&quot; +
-        &quot;statusText: &quot; + this._myXMLHttpRequestObject.statusText + &quot;\n&quot; +
-        &quot;responseText: &quot; + this._myXMLHttpRequestObject.responseText + &quot;\n&quot;);
-    };
-  }
-  return newXMLHttpRequestObject;
-};
-
-
-/**
- * Sends all the changed items to the server, so that the server can save the
- * changes.
- *
- * @scope    private instance method
- */
-Stevedore.prototype._saveChangesToServer = function () {
-  var saveChanges = false;
-  if (window.location) {
-    if (window.location.protocol == &quot;http:&quot;) {
-      saveChanges = true;
-    }
-    if (window.location.protocol == &quot;file:&quot;) {
-      alert(&quot;I can't save changes to server, because this page was loaded from a \&quot;<A HREF="file:///\">file:///\</A>&quot; location, not a real \&quot;<A HREF="http://\">http://\</A>&quot; location.  Sorry.&quot;); 
-    }
-  }
-  
-  if (saveChanges) {
-    var url = &quot;save_changes.php&quot;;
-    this._myXMLHttpRequestObject.open(&quot;POST&quot;, url, true);
-    this._myXMLHttpRequestObject.setRequestHeader(&quot;Content-Type&quot;, &quot;text/xml&quot;);
-    this._myXMLHttpRequestObject.send(this._getJsonStringRepresentingAllItems());
-  }
-  
-};
-
-
-/**
- * This is the event handler method that we register with the XMLHttpRequest
- * object's onreadystatechange property.
- *
- * @scope    private class method
- */
-Stevedore._handleStateChangeForXMLHttpRequestObject = function () {
-  alert(&quot;_handleStateChangeForXMLHttpRequestObject()\n&quot;); // +
-  //  &quot;readyState: &quot; + this._myXMLHttpRequestObject.readyState + &quot;\n&quot; +
-  //  &quot;status: &quot; + this._myXMLHttpRequestObject.status + &quot;\n&quot; +
-  //  &quot;statusText: &quot; + this._myXMLHttpRequestObject.statusText + &quot;\n&quot; +
-  //  &quot;responseText: &quot; + this._myXMLHttpRequestObject.responseText + &quot;\n&quot;);
-};
-
-// -------------------------------------------------------------------
-// End of file
-// -------------------------------------------------------------------


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000057.html">[openrecord-svn] r67 - trunk/documentation
</A></li>
	<LI>Next message: <A HREF="000059.html">[openrecord-svn] r70 - in trunk/source: . model
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58">[ date ]</a>
              <a href="thread.html#58">[ thread ]</a>
              <a href="subject.html#58">[ subject ]</a>
              <a href="author.html#58">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openrecord-svn">More information about the openrecord-svn
mailing list</a><br>
</body></html>
