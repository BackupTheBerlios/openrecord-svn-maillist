<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openrecord-svn] r371 - in trunk: source source/archive source/model source/storage source/util source/view tests tests/archive tests/dom tests/lang tests/model tests/storage tests/util tests/uuid
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openrecord-svn/2005-November/index.html" >
   <LINK REL="made" HREF="mailto:openrecord-svn%40lists.berlios.de?Subject=Re%3A%20%5Bopenrecord-svn%5D%20r371%20-%20in%20trunk%3A%20source%20source/archive%20source/model%20source/storage%20source/util%20source/view%20tests%20tests/archive%20tests/dom%20tests/lang%20tests/model%20tests/storage%20tests/util%20tests/uuid&In-Reply-To=%3C200511010523.jA15NOD7026348%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000352.html">
   <LINK REL="Next"  HREF="000354.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openrecord-svn] r371 - in trunk: source source/archive source/model source/storage source/util source/view tests tests/archive tests/dom tests/lang tests/model tests/storage tests/util tests/uuid</H1>
    <B>Brian Douglas Skinner at BerliOS</B> 
    <A HREF="mailto:openrecord-svn%40lists.berlios.de?Subject=Re%3A%20%5Bopenrecord-svn%5D%20r371%20-%20in%20trunk%3A%20source%20source/archive%20source/model%20source/storage%20source/util%20source/view%20tests%20tests/archive%20tests/dom%20tests/lang%20tests/model%20tests/storage%20tests/util%20tests/uuid&In-Reply-To=%3C200511010523.jA15NOD7026348%40sheep.berlios.de%3E"
       TITLE="[openrecord-svn] r371 - in trunk: source source/archive source/model source/storage source/util source/view tests tests/archive tests/dom tests/lang tests/model tests/storage tests/util tests/uuid">skinner at berlios.de
       </A><BR>
    <I>Tue Nov  1 06:23:24 CET 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000352.html">[openrecord-svn] r370 - trunk/source/storage
</A></li>
        <LI>Next message: <A HREF="000354.html">[openrecord-svn] r372 - trunk/repositories
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#353">[ date ]</a>
              <a href="thread.html#353">[ thread ]</a>
              <a href="subject.html#353">[ subject ]</a>
              <a href="author.html#353">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: skinner
Date: 2005-11-01 06:23:19 +0100 (Tue, 01 Nov 2005)
New Revision: 371

Added:
   trunk/source/storage/FileProtocolStorage.js
   trunk/source/storage/HttpProtocolStorage.js
   trunk/source/storage/directoryList.js
   trunk/source/storage/httpProtocolUtil.js
   trunk/tests/archive/TestSuite.html
   trunk/tests/archive/test_dependencies.html
   trunk/tests/archive/test_dependencies.js
   trunk/tests/dom/test_dom.html
   trunk/tests/dom/test_dom.js
   trunk/tests/model/test_AfterLogin.html
   trunk/tests/model/test_AfterLogin.js
   trunk/tests/model/test_BeforeLogin.html
   trunk/tests/model/test_BeforeLogin.js
   trunk/tests/model/test_SequentialUsers.html
   trunk/tests/model/test_SequentialUsers.js
   trunk/tests/model/test_dependencies.html
   trunk/tests/model/test_dependencies.js
   trunk/tests/storage/test_dependencies.html
   trunk/tests/storage/test_dependencies.js
   trunk/tests/util/test_dependencies.html
   trunk/tests/util/test_dependencies.js
Removed:
   trunk/source/storage/FileStorage.js
   trunk/source/storage/FileSystem.js
   trunk/source/storage/HttpStorage.js
   trunk/tests/dom/domTest.html
   trunk/tests/dom/domTest.js
Modified:
   trunk/source/BarChartPlugin.js
   trunk/source/TablePlugin.js
   trunk/source/archive/DeltaArchive.js
   trunk/source/model/Item.js
   trunk/source/model/World.js
   trunk/source/storage/FakeStorage.js
   trunk/source/storage/Storage.js
   trunk/source/util/Util.js
   trunk/source/util/XmlConverter.js
   trunk/source/view/NavbarView.js
   trunk/source/view/SectionView.js
   trunk/tests/TestSuite.html
   trunk/tests/lang/LangTest.js
   trunk/tests/model/ModelTest.js
   trunk/tests/model/TestSuite.html
   trunk/tests/storage/DirectoryReadingTest.js
   trunk/tests/storage/LintTest.js
   trunk/tests/storage/StorageTest.js
   trunk/tests/storage/TestSuite.html
   trunk/tests/util/TestSuite.html
   trunk/tests/util/UtilTest.js
   trunk/tests/uuid/UuidTest.js
Log:
Finished conversion to new data model API.  Refactored data model unit tests.  Added unit tests to check for errant dependencies between packages.  Refactored code in the storage directory (and fixed a bug in directoryList.js).

Modified: trunk/source/BarChartPlugin.js
===================================================================
--- trunk/source/BarChartPlugin.js	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/source/BarChartPlugin.js	2005-11-01 05:23:19 UTC (rev 371)
@@ -117,8 +117,8 @@
 
   var contentItem = null;
   var attribute = null;
-  var listOfEntries;
-  var firstEntry;
+  var listOfValues;
+  var firstValue;
   var attributeUuid;
   var hashTableOfNumericValueIncidenceKeyedByUuid = {};
   var hashTableOfAttributesKeyedByUuid = {};
@@ -132,19 +132,16 @@
       attribute = listOfAttributesForItem[i];
       attributeUuid = attribute.getUuid();
       hashTableOfAttributesKeyedByUuid[attributeUuid] = attribute;
-      listOfEntries = contentItem.getEntriesForAttribute(attribute);
-      if (listOfEntries) {
-        firstEntry = listOfEntries[0];
-        if (firstEntry) {
-          var value = firstEntry.getValue(contentItem);
-          if (dojo.lang.isNumber(value)) {
-            var count = hashTableOfNumericValueIncidenceKeyedByUuid[attributeUuid];
-            if (!count) {
-              count = 0;
-            }
-            count += 1;
-            hashTableOfNumericValueIncidenceKeyedByUuid[attributeUuid] = count;
+      listOfValues = contentItem.getValuesForAttribute(attribute);
+      if (listOfValues.length &gt; 0) {
+        firstValue = listOfValues[0];
+        if (dojo.lang.isNumber(firstValue)) {
+          var count = hashTableOfNumericValueIncidenceKeyedByUuid[attributeUuid];
+          if (!count) {
+            count = 0;
           }
+          count += 1;
+          hashTableOfNumericValueIncidenceKeyedByUuid[attributeUuid] = count;
         }
       }
     }
@@ -166,13 +163,12 @@
     var maxValue = 0;
     for (var jkey in listOfContentItems) {
       contentItem = listOfContentItems[jkey];
-      listOfEntries = contentItem.getEntriesForAttribute(selectedAttribute);
-      if (listOfEntries &amp;&amp; listOfEntries[0]) {
-        var nextEntry = listOfEntries[0];
-        var nextValue = nextEntry.getValue();
+      listOfValues = contentItem.getValuesForAttribute(selectedAttribute);
+      if (listOfValues.length &gt; 0) {
+        var nextValue = listOfValues[0];
         if (dojo.lang.isNumber(nextValue)) {
           maxValue = Math.max(maxValue, nextValue);
-        }     
+        }
       }
     }
   }
@@ -196,10 +192,9 @@
     listOfStrings.push(&quot;&lt;td class=\&quot;&quot; + orp.view.SectionView.cssClass.PLAIN + &quot;\&quot;&gt;&quot; + contentItem.getDisplayName(&quot;{no name}&quot;) + &quot;&lt;/td&gt;&quot;);
     var numericValue = 0;
     if (selectedAttribute) {
-      listOfEntries = contentItem.getEntriesForAttribute(selectedAttribute);
-      if (listOfEntries &amp;&amp; listOfEntries[0]) {
-        firstEntry = listOfEntries[0];
-        var firstValue = firstEntry.getValue();
+      listOfValues = contentItem.getValuesForAttribute(selectedAttribute);
+      if (listOfValues.length &gt; 0) {
+        firstValue = listOfValues[0];
         if (dojo.lang.isNumber(firstValue)) {
           numericValue = firstValue;
         }

Modified: trunk/source/TablePlugin.js
===================================================================
--- trunk/source/TablePlugin.js	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/source/TablePlugin.js	2005-11-01 05:23:19 UTC (rev 371)
@@ -409,7 +409,6 @@
     // alertString = &quot;&quot;;
     for (var i in this._displayAttributes) {
       var attribute = this._displayAttributes[i];
-      // this._layout.addEntryForAttribute(attributeTableColumns, attribute);
       this._layout.addEntry({attribute:attributeTableColumns, value:attribute});
       // alertString += attribute.getDisplayString() + '\n';
     }
@@ -670,16 +669,21 @@
       var value = listOfFields[j];
       if (value !== &quot;&quot;) {
         listOfTypes = hashTableOfTypesKeyedByAttributeUuid[attribute.getUuid()];
-        // value = orp.view.EntryView._transformValueToExpectedType(world, value, listOfTypes);
         value = world.transformValueToExpectedType(value, listOfTypes);
+        var inverseAttribute = attribute.getSingleValueFromAttribute(attributeCalledInverseAttribute);
+        newItem.addEntry({
+          attribute:attribute, 
+          value:value, 
+          inverseAttribute:inverseAttribute });
+/*
         var inverseAttributeEntry = attribute.getSingleEntryFromAttribute(attributeCalledInverseAttribute);
         if (inverseAttributeEntry) {
           var inverseAttribute = inverseAttributeEntry.getValue(attribute);
           newItem.addConnectionEntry(attribute, value, inverseAttribute);
         } else {
-          // newItem.addEntryForAttribute(attribute, value);
           newItem.addEntry({attribute:attribute, value:value});
         }
+*/
       }
     }
   }
@@ -732,12 +736,10 @@
     if (noStoredColumns) {
       for (i in this._displayAttributes) {
         var anAttribute = this._displayAttributes[i];
-        // this._layout.addEntryForAttribute(attributeTableColumns,anAttribute,typeCalledItem);
         this._layout.addEntry({attribute:attributeTableColumns, value:anAttribute, type:typeCalledItem});
       }
     } else {
       if (!removeAttribute) {
-        // this._layout.addEntryForAttribute(attributeTableColumns,changedAttribute,typeCalledItem);
         this._layout.addEntry({attribute:attributeTableColumns, value:changedAttribute, type:typeCalledItem});
       }
     }

Modified: trunk/source/archive/DeltaArchive.js
===================================================================
--- trunk/source/archive/DeltaArchive.js	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/source/archive/DeltaArchive.js	2005-11-01 05:23:19 UTC (rev 371)
@@ -36,8 +36,8 @@
 dojo.require(&quot;orp.archive.StubArchive&quot;);
 dojo.require(&quot;orp.model.World&quot;);
 dojo.require(&quot;orp.model.Vote&quot;);
-dojo.require(&quot;orp.storage.FileStorage&quot;);
-dojo.require(&quot;orp.storage.HttpStorage&quot;);
+dojo.require(&quot;orp.storage.FileProtocolStorage&quot;);
+dojo.require(&quot;orp.storage.HttpProtocolStorage&quot;);
 dojo.require(&quot;orp.lang.Lang&quot;);
 dojo.require(&quot;orp.archive.JsonSerializer&quot;);
 dojo.require(&quot;orp.archive.JsonDeserializer&quot;);
@@ -153,12 +153,12 @@
   }
   if (window.location) {
     if (window.location.protocol == &quot;http:&quot;) {
-      this._saverObject = new orp.storage.HttpStorage(this._repositoryName,
+      this._saverObject = new orp.storage.HttpProtocolStorage(this._repositoryName,
                                                       orp.archive.DeltaArchive.PATH_TO_REPOSITORY_DIRECTORY,
                                                       this._pathToTrunkDirectory);
     }
     if (window.location.protocol == &quot;file:&quot;) {
-      this._saverObject = new orp.storage.FileStorage(this._repositoryName,
+      this._saverObject = new orp.storage.FileProtocolStorage(this._repositoryName,
                                                       orp.archive.DeltaArchive.PATH_TO_REPOSITORY_DIRECTORY,
                                                       this._pathToTrunkDirectory);
     }
@@ -194,12 +194,12 @@
   if (!this._saverObject) {
     if (window.location) {
       if (window.location.protocol == &quot;http:&quot;) {
-        this._saverObject = new orp.storage.HttpStorage(this._repositoryName,
+        this._saverObject = new orp.storage.HttpProtocolStorage(this._repositoryName,
                                                         orp.archive.DeltaArchive.PATH_TO_REPOSITORY_DIRECTORY,
                                                         this._pathToTrunkDirectory);
       }
       if (window.location.protocol == &quot;file:&quot;) {
-        this._saverObject = new orp.storage.FileStorage(this._repositoryName,
+        this._saverObject = new orp.storage.FileProtocolStorage(this._repositoryName,
                                                         orp.archive.DeltaArchive.PATH_TO_REPOSITORY_DIRECTORY,
                                                         this._pathToTrunkDirectory);
       }

Modified: trunk/source/model/Item.js
===================================================================
--- trunk/source/model/Item.js	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/source/model/Item.js	2005-11-01 05:23:19 UTC (rev 371)
@@ -81,15 +81,12 @@
 // Public class constants
 // -------------------------------------------------------------------
 orp.model.Item.NamedParameters = {
-  attribute:      &quot;attribute&quot;,
-  value:          &quot;value&quot;,
-  type:           &quot;type&quot;,
-  previousEntry:  &quot;previousEntry&quot;,
-  myAttribute:    &quot;myAttribute&quot;,
-  otherItem:      &quot;otherItem&quot;,
-  otherAttribute: &quot;otherAttribute&quot;};
+  attribute:        &quot;attribute&quot;,
+  value:            &quot;value&quot;,
+  type:             &quot;type&quot;,
+  previousEntry:    &quot;previousEntry&quot;,
+  inverseAttribute: &quot;inverseAttribute&quot;};
 
-
 // -------------------------------------------------------------------
 // Private methods
 // -------------------------------------------------------------------
@@ -121,22 +118,6 @@
 // Entry adding methods
 // -------------------------------------------------------------------
 
-/* PENDING: refactor these methods as per Sept 12 plan:
-// OLD
-item.addConnectionEntry(myAttribute, otherItem, otherAttribute)
-Item.replaceEntryWithConnection(previousEntry, myAttribute, otherItem, otherAttribute)
-
-// NEW
-item.addConnectionEntry({myAttribute:
-                        otherItem:
-                        otherAttribute: })
-
-item.replaceEntryWithConnection({previousEntry: 
-                        myAttribute:
-                        otherItem:
-                        otherAttribute: })
-*/
-
 /**
  * Creates a new entry object and adds the new entry to the item's 
  * list of entries.
@@ -156,26 +137,40 @@
  * &lt;/pre&gt;
  * 
  * @scope    public instance method
- * @namedParam    value    The value to initialize the entry to. 
+ * @namedParam    value    The value to initialize the entry to. (Optional if previousEntry is provided.)
  * @namedParam    type    Optional. An item representing a data type.
- * @namedParam    attribute    Optional.  The attribute to assign the entry to. 
+ * @namedParam    attribute    Optional. The attribute to assign the entry to. 
+ * @namedParam    previousEntry    Optional. The old entry to be replaced.
+ * @namedParam    inverseAttribute    Optional. The attribute to use as the inverseAttribute of 'attribute'.
  * @return   An entry object.
  * @throws   Throws an Error if no user is logged in.
  */
 orp.model.Item.prototype.addEntry = function(namedParameters) {
   orp.lang.assert(dojo.lang.isObject(namedParameters));
-  var arg = orp.model.Item.NamedParameters;
-  var value = namedParameters[arg.value];
-  var attribute = namedParameters[arg.attribute];
-  var type = namedParameters[arg.type];
+  var parameters = orp.model.Item.NamedParameters;
+  var value = namedParameters[parameters.value];
+  var attribute = namedParameters[parameters.attribute];
+  var type = namedParameters[parameters.type];
+  var previousEntry = namedParameters[parameters.previousEntry];
+  var inverseAttribute = namedParameters[parameters.inverseAttribute];
   
   // Check for typos in parameter names
-  orp.lang.assert(orp.util.hasNoUnexpectedProperties(namedParameters, [arg.value, arg.attribute, arg.type]));
+  orp.lang.assert(orp.util.hasNoUnexpectedProperties(namedParameters, parameters));
   
-  if (!attribute) {
-    attribute = this.getWorld().getAttributeCalledUnfiled();
+  if (previousEntry) {
+    if (!attribute) {
+      attribute = previousEntry.getAttribute();
+    }
+    if (dojo.lang.isUndefined(value)) {
+      value = previousEntry.getValue();
+    }
+  } else {
+    if (!attribute) {
+      attribute = this.getWorld().getAttributeCalledUnfiled();
+    }
   }
-  return this._createNewEntry(null, attribute, value, type);
+
+  return this._createNewEntry(previousEntry, attribute, value, type, inverseAttribute);
 };
  
 
@@ -185,15 +180,15 @@
  * Examples:
  * &lt;pre&gt;
  *    var entry = item.addEntry({value: &quot;green&quot;});
- *    entry = item.replaceEntry({previousEntry: entry, value: &quot;green&quot;});
- *    entry = item.replaceEntry({previousEntry: entry, attribute: color, value: &quot;green&quot;});
+ *    entry = item.replaceEntry({previousEntry: entry, value: &quot;blue&quot;});
+ *    entry = item.replaceEntry({previousEntry: entry, attribute: color, value: &quot;blue&quot;});
  *    var textType = world.getTypeCalledText();
- *    entry = item.replaceEntry({previousEntry: entry, attribute: color, value: &quot;green&quot;, type: textType});
+ *    entry = item.replaceEntry({previousEntry: entry, attribute: color, value: &quot;blue&quot;, type: textType});
  * &lt;/pre&gt;
  * 
  * @scope    public instance method
  * @namedParam    previousEntry    The old entry to be replaced.
- * @namedParam    value    The value to initialize the entry to. 
+ * @namedParam    value    Optional. The value to initialize the entry to. 
  * @namedParam    type    Optional. An item representing a data type.
  * @namedParam    attribute    Optional.  The attribute to assign the entry to. 
  * @return   The new replacement entry object.
@@ -201,25 +196,10 @@
  */
 orp.model.Item.prototype.replaceEntry = function(namedParameters) {
   orp.lang.assert(dojo.lang.isObject(namedParameters));
-  var arg = orp.model.Item.NamedParameters;
-  var value = namedParameters[arg.value];
-  var attribute = namedParameters[arg.attribute];
-  var type = namedParameters[arg.type];
-  var previousEntry = namedParameters[arg.previousEntry];
+  var previousEntry = namedParameters[orp.model.Item.NamedParameters.previousEntry];
 
-  // Check for typos in parameter names
-  orp.lang.assert(orp.util.hasNoUnexpectedProperties(namedParameters, [arg.value, arg.attribute, arg.type, arg.previousEntry]));
-  
   orp.lang.assert(dojo.lang.isObject(previousEntry));
-  if (!attribute) {
-    var FIXME_OCT_7_2005_EXPERIMENT = true;
-    if (FIXME_OCT_7_2005_EXPERIMENT) {
-      attribute = previousEntry.getAttribute();
-    } else {
-      attribute = previousEntry.getAttributeForItem(this);
-    }
-  }
-  return this._createNewEntry(previousEntry, attribute, value, type);
+  return this.addEntry(namedParameters);
 };
 
 
@@ -231,18 +211,46 @@
  * @param    attribute    The attribute to assign the entry to. 
  * @param    value    The value to initialize the new entry to.
  * @param    type    Optional. An item representing a data type.
+ * @param    inverseAttribute    Optional. The attribute to use as the inverseAttribute of 'attribute'.
  * @scope    private instance method
  */
-orp.model.Item.prototype._createNewEntry = function(previousEntry, attribute, value, type) {
-
-  // If we've just been asked to replace the string &quot;Foo&quot; with the string &quot;Foo&quot;,
-  // then don't even bother creating a new entry. 
-  if (previousEntry) {
-    var oldValue = previousEntry.getValue();
-    var oldAttribute = previousEntry.getAttribute();
-    if ((oldValue == value) &amp;&amp; (oldAttribute == attribute)) {
-      return null;
+orp.model.Item.prototype._createNewEntry = function(previousEntry, attribute, value, type, inverseAttribute) {
+  var newEntry;
+  
+  if (inverseAttribute) {
+    var otherItem = value;
+    var myAttribute = attribute;
+    var otherAttribute = inverseAttribute;
+    
+    orp.lang.assert(otherItem instanceof orp.model.Item);
+    orp.lang.assert(myAttribute instanceof orp.model.Item);
+  
+    // If we've just been asked to replace the string &quot;Foo&quot; with the string &quot;Foo&quot;,
+    // then don't even bother creating a new entry. 
+    if (previousEntry) {
+      if (previousEntry.getType() == this.getWorld().getTypeCalledConnection()) {
+        var oldItem = previousEntry.getItem();
+        var oldAttribute = previousEntry.getAttribute();
+        var oldValue = previousEntry.getValue();
+        var oldInverseAttribute = previousEntry.getInverseAttribute();
+        if (((oldAttribute == myAttribute) &amp;&amp;  (oldInverseAttribute == otherAttribute) &amp;&amp;
+          oldItem == this &amp;&amp; oldValue == otherItem) ||
+          ((oldInverseAttribute == myAttribute) &amp;&amp;  (oldAttribute == otherAttribute) &amp;&amp;
+          oldValue == this &amp;&amp; oldItem == otherItem)) {
+          return null;
+        }
+      }
     }
+  } else {
+    // If we've just been asked to replace the string &quot;Foo&quot; with the string &quot;Foo&quot;,
+    // then don't even bother creating a new entry. 
+    if (previousEntry) {
+      oldValue = previousEntry.getValue();
+      oldAttribute = previousEntry.getAttribute();
+      if ((oldValue == value) &amp;&amp; (oldAttribute == attribute)) {
+        return null;
+      }
+    }
   }
   
   this.getWorld().beginTransaction();
@@ -250,11 +258,31 @@
     this._provisionalFlag = false;
     this.getWorld()._provisionalItemJustBecameReal(this);
   }
-  
-  var entry = this.getWorld()._newEntry(this, previousEntry, attribute, value, type);
+  if (inverseAttribute) {
+    if (otherItem._provisionalFlag) {
+      otherItem._provisionalFlag = false;
+      this.getWorld()._provisionalItemJustBecameReal(otherItem);
+    }
+    if (!otherAttribute) {
+      otherAttribute = this.getWorld().getAttributeCalledUnfiled();
+    }
+    newEntry = this.getWorld()._newConnectionEntry(previousEntry, this, myAttribute, otherItem, otherAttribute);
+  } else {
+    newEntry = this.getWorld()._newEntry(this, previousEntry, attribute, value, type);
+  }
   this.getWorld().endTransaction();
   this._noteChanges(null);
-  return entry;
+  if (inverseAttribute) {
+    otherItem._noteChanges(null);
+    if (previousEntry) {
+      previousEntry.getItem()._noteChanges(null);
+      if (previousEntry.getType() == this.getWorld().getTypeCalledConnection()) {
+        previousEntry.getValue()._noteChanges(null);
+      }
+    }
+  }
+  
+  return newEntry;
 };
 
 
@@ -278,7 +306,8 @@
  * @throws   Throws an Error if no user is logged in.
  */
 orp.model.Item.prototype.addConnectionEntry = function(myAttribute, otherItem, otherAttribute) {
-  return this.replaceEntryWithConnection(null, myAttribute, otherItem, otherAttribute);
+  var typeCalledConnection = this.getWorld().getTypeCalledConnection();
+  return this._createNewEntry(null, myAttribute, otherItem, typeCalledConnection, otherAttribute);
 };
 
 
@@ -286,79 +315,8 @@
  *
  */
 orp.model.Item.prototype.replaceEntryWithConnection = function(previousEntry, myAttribute, otherItem, otherAttribute) {
-  orp.lang.assert(otherItem instanceof orp.model.Item);
-  orp.lang.assert(myAttribute instanceof orp.model.Item);
-
-  // If we've just been asked to replace the string &quot;Foo&quot; with the string &quot;Foo&quot;,
-  // then don't even bother creating a new entry. 
-  if (previousEntry) {
-    var FIXME_OCT_7_2005_EXPERIMENT = true;
-    if (FIXME_OCT_7_2005_EXPERIMENT) {
-      if (previousEntry.getType() == this.getWorld().getTypeCalledConnection()) {
-        var oldItem = previousEntry.getItem();
-        var oldAttribute = previousEntry.getAttribute();
-        var oldValue = previousEntry.getValue();
-        var oldInverseAttribute = previousEntry.getInverseAttribute();
-        if (((oldAttribute == myAttribute) &amp;&amp;  (oldInverseAttribute == otherAttribute) &amp;&amp;
-          oldItem == this &amp;&amp; oldValue == otherItem) ||
-          ((oldInverseAttribute == myAttribute) &amp;&amp;  (oldAttribute == otherAttribute) &amp;&amp;
-          oldValue == this &amp;&amp; oldItem == otherItem)) {
-          return null;
-        }
-      }
-    } else {
-      // var oldValue = previousEntry.getValue(this);
-      var oldPairOfAttributes = previousEntry.getAttribute();
-      var oldPairOfItems = previousEntry.getItem();
-      if (dojo.lang.isArray(oldPairOfAttributes)) {
-        orp.lang.assert(oldPairOfAttributes.length == 2);
-        orp.lang.assert(oldPairOfItems.length == 2);
-        if (((oldPairOfAttributes[0] == myAttribute) &amp;&amp;  (oldPairOfAttributes[1] == otherAttribute) &amp;&amp;
-          oldPairOfItems[0] == this &amp;&amp; oldPairOfItems[1] == otherItem) ||
-          ((oldPairOfAttributes[1] == myAttribute) &amp;&amp;  (oldPairOfAttributes[0] == otherAttribute) &amp;&amp;
-          oldPairOfItems[1] == this &amp;&amp; oldPairOfItems[0] == otherItem)) {
-          return null;
-        }
-      }
-    }
-  }
-
-  this.getWorld().beginTransaction();
-  if (this._provisionalFlag) {
-    this._provisionalFlag = false;
-    this.getWorld()._provisionalItemJustBecameReal(this);
-  }
-  if (otherItem._provisionalFlag) {
-    otherItem._provisionalFlag = false;
-    this.getWorld()._provisionalItemJustBecameReal(otherItem);
-  }
-  if (!otherAttribute) {
-    otherAttribute = this.getWorld().getAttributeCalledUnfiled();
-  }
-
-  var entry = this.getWorld()._newConnectionEntry(previousEntry, this, myAttribute, otherItem, otherAttribute);
-  this.getWorld().endTransaction();
-  this._noteChanges(null);
-  otherItem._noteChanges(null);
-  if (previousEntry) {
-    FIXME_OCT_7_2005_EXPERIMENT = true;
-    if (FIXME_OCT_7_2005_EXPERIMENT) {
-      previousEntry.getItem()._noteChanges(null);
-      if (previousEntry.getType() == this.getWorld().getTypeCalledConnection()) {
-        previousEntry.getValue()._noteChanges(null);
-      }
-    } else {
-      var oldItemOrPairOfItems = previousEntry.getItem();
-      if (oldItemOrPairOfItems instanceof orp.model.Item) {
-        oldItemOrPairOfItems._noteChanges(null);
-      }
-      if (dojo.lang.isArray(oldItemOrPairOfItems)) {
-        oldItemOrPairOfItems[0]._noteChanges(null);
-        oldItemOrPairOfItems[1]._noteChanges(null);
-      }
-    }
-  }
-  return entry;  
+  var typeCalledConnection = this.getWorld().getTypeCalledConnection();
+  return this._createNewEntry(previousEntry, myAttribute, otherItem, typeCalledConnection, otherAttribute);
 };
 
 
@@ -378,24 +336,44 @@
 // -------------------------------------------------------------------
 // Accessor methods where the answer depends on the retrieval filter
 // -------------------------------------------------------------------
-/* PENDING: add this API
 
-var entries = item.getValuesForAttribute(height);
-for (var i in values) {
-  var value = value[i];
-  // display value on screen
-}
+/**
+ * Given an attribute, this method returns the list of all the values that 
+ * have been assigned to that attribute for this item.
+ *
+ * For example, to find out what color Kermit is: 
+ * &lt;pre&gt;
+ * var listOfValues = kermit.getValuesForAttribute(color);
+ * for (var i in listOfValues) {
+ *   var value = listOfValues[i];
+ *   alert(&quot;Kermit is &quot; + value);
+ * }
+ * &lt;/pre&gt;
+ *
+ * @scope    public instance method
+ * @param    attribute    An attribute that we want to know the value of. 
+ * @return   A list of value objects (may include strings, numbers, Items, Dates, etc.)
 */
+orp.model.Item.prototype.getValuesForAttribute = function(attribute) {
+  var listOfEntries = this.getEntriesForAttribute(attribute);
+  var listOfValues = [];
+  for (var i in listOfEntries) {
+    var entry = listOfEntries[i];
+    listOfValues.push(entry.getValue());
+  }
+  return listOfValues;
+};
 
+
 /**
  * Given an attribute, this method returns the list of all the entries that 
  * have been assigned to that attribute for this item.
  *
  * For example, to find out what color Kermit is: 
  * &lt;pre&gt;
- *    var entryList = kermit.getEntriesForAttribute(color);
- *    for (var i = 0; i &lt; entryList.length; ++i) {
- *      alert(&quot;Kermit is &quot; + entryList[i].getDisplayString());
+ *    var listOfEntries = kermit.getEntriesForAttribute(color);
+ *    for (var i in listOfEntries) {
+ *      alert(&quot;Kermit is &quot; + listOfEntries[i].getDisplayString());
  *    }
  * &lt;/pre&gt;
  *
@@ -500,20 +478,12 @@
 /**
  *
  */
-orp.model.Item.prototype.getFirstCategory = function() {
-  if (this._cachedFirstCategory !== null) {
-    return this._cachedFirstCategory;
-  } else {
+orp.model.Item.prototype.getFirstCategory = function() { 
+  if (!this._cachedFirstCategory) {
     var attributeCalledCategory = this.getWorld().getAttributeCalledCategory();
-    var listOfCategoryEntries = this.getEntriesForAttribute(attributeCalledCategory);
-    var returnEntry = null;
-    if (listOfCategoryEntries &amp;&amp; listOfCategoryEntries.length &gt; 0) {
-      var firstEntry = listOfCategoryEntries[0];
-      var returnCategory = firstEntry.getValue(this);
-    }
-    this._cachedFirstCategory = returnCategory;
-    return returnCategory;
+    this._cachedFirstCategory = this.getSingleValueFromAttribute(attributeCalledCategory);
   }
+  return this._cachedFirstCategory;
 };
 
 // -------------------------------------------------------------------
@@ -626,6 +596,22 @@
 
 
 /**
+ * Returns just the first entry of an item's attribute.
+ *
+ * @scope    public instance method
+ * @param    attribute    An item representing an attribute. 
+ * @return   A string with a description of the item.
+ */
+orp.model.Item.prototype.getSingleValueFromAttribute = function(attribute) {
+  var listOfEntries = this.getEntriesForAttribute(attribute);
+  if (listOfEntries[0]) {
+    return listOfEntries[0].getValue();
+  }
+  return null;
+};
+
+
+/**
  * Returns just the first entry's display string of an item's attribute.
  *
  * @scope    public instance method
@@ -648,9 +634,9 @@
 orp.model.Item.prototype.toString = function() {
   var returnString = &quot;[Item #&quot; + this.getUuid() + &quot; &quot;;
   var attributeCategory = this.getWorld().getAttributeCalledCategory();
-  var listOfCategories = this.getEntriesForAttribute(attributeCategory);
-  for (var key in listOfCategories) {
-    var category = listOfCategories[key];
+  var listOfCategories = this.getValuesForAttribute(attributeCategory);
+  for (var i in listOfCategories) {
+    var category = listOfCategories[i];
     if (category instanceof orp.model.Item) {
       returnString += &quot;(&quot; + category.getDisplayString() + &quot;)&quot;;
     }
@@ -668,18 +654,14 @@
  * Does this item have an attribute with a particular entry?
  * Used in getting query results
  *
- * @scope public instance method
- * @return Boolean. True if this item has an attribute with the entry
+ * @scope   public instance method
+ * @return   Boolean. True if this item has an attribute with the entry
  */
 orp.model.Item.prototype.hasAttributeValue = function(attribute, value) {
   orp.lang.assert(attribute instanceof orp.model.Item);
-  var entryList = this.getEntriesForAttribute(attribute);
-
-  // look at all the entries this item's attribute is assigned to, 
-  // and see if one of them is &quot;inEntry&quot;
-  for (var i in entryList) {
-    var entry = entryList[i];
-    if (entry.getValue(this) == value) {
+  var listOfValues = this.getValuesForAttribute(attribute);
+  for (var i in listOfValues) {
+    if (listOfValues[i] == value) {
       return true;
     }
   }

Modified: trunk/source/model/World.js
===================================================================
--- trunk/source/model/World.js	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/source/model/World.js	2005-11-01 05:23:19 UTC (rev 371)
@@ -760,8 +760,7 @@
         matchingEntry = matchingEntryOrListOfEntries[key];
         item.addEntry({attribute:attributeCalledQueryMatchingValue, value:matchingEntry});
       }
-    }
-    else {
+    } else {
       matchingEntry = matchingEntryOrListOfEntries;
       item.addEntry({attribute:attributeCalledQueryMatchingValue, value:matchingEntry});
     }
@@ -1002,7 +1001,6 @@
   var listOfSuggestedItems = [];
   var key;
   var categoryCalledCategory = this.getCategoryCalledCategory();
-  // var attributeCalledCategory = this.getAttributeCalledCategory();
   var attributeCalledExpectedType = this.getAttributeCalledExpectedType();
   var listOfExpectedTypeEntries = attribute.getEntriesForAttribute(attributeCalledExpectedType);
   var listOfCategories = [];

Modified: trunk/source/storage/FakeStorage.js
===================================================================
--- trunk/source/storage/FakeStorage.js	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/source/storage/FakeStorage.js	2005-11-01 05:23:19 UTC (rev 371)
@@ -41,7 +41,7 @@
 // -------------------------------------------------------------------
 /**
  * The Storage class is the abstract superclass for the other storage 
- * classes, including FileStorage and HttpStorage.
+ * classes, including FileProtocolStorage and HttpProtocolStorage.
  *
  * @param    repositoryName                         // e.g. demo_page
  * @param    pathToTrunkDirectoryFromWindowLocation // Not needed if window location is at the root of the trunk directory.

Copied: trunk/source/storage/FileProtocolStorage.js (from rev 367, trunk/source/storage/FileStorage.js)
===================================================================
--- trunk/source/storage/FileStorage.js	2005-10-25 03:17:18 UTC (rev 367)
+++ trunk/source/storage/FileProtocolStorage.js	2005-11-01 05:23:19 UTC (rev 371)
@@ -0,0 +1,219 @@
+/*****************************************************************************
+ FileProtocolStorage.js
+ 
+******************************************************************************
+ The code in this file is a heavily modified version of code that was copied
+ from the TiddlyWiki and GTDTiddlyWiki code base.
+ 
+ The original code is Copyright (c) Osmosoft Limited.  The original copyright 
+ notice is included below, along with the license conditions and disclaimer.  
+ 
+ OpenRecord modifications by Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
+
+ For the OpenRecord modifications, the Copyright rights are relinquished under  
+ the Creative Commons Public Domain Dedication:
+    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
+
+******************************************************************************
+TiddlyWiki 1.2.6 by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)
+Incorporating improvements by Isao Sonobe, <A HREF="http://www-gauge.scphys.kyoto-u.ac.jp/~sonobe/OgreKit/OgreKitWiki.html">http://www-gauge.scphys.kyoto-u.ac.jp/~sonobe/OgreKit/OgreKitWiki.html</A>
+GTDTiddlyWiki modification by Nathan Bowers, (wiki [at] snapgrid [dot] com)
+Safari Compatability by Jonathan Paisley at <A HREF="http://www.dcs.gla.ac.uk/~jp/">http://www.dcs.gla.ac.uk/~jp/</A>
+
+Copyright (c) Osmosoft Limited, 14 April 2005
+
+All rights reserved.
+
+Redistribution and use in source and binary forms, with or without modification,
+are permitted provided that the following conditions are met:
+
+Redistributions of source code must retain the above copyright notice, this
+list of conditions and the following disclaimer.
+
+Redistributions in binary form must reproduce the above copyright notice, this
+list of conditions and the following disclaimer in the documentation and/or other
+materials provided with the distribution.
+
+Neither the name of the Osmosoft Limited nor the names of its contributors may be
+used to endorse or promote products derived from this software without specific
+prior written permission.
+
+THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY
+EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
+SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
+INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
+TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
+CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
+ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
+DAMAGE.
+*****************************************************************************/
+
+
+// -------------------------------------------------------------------
+// Provides and Requires
+// -------------------------------------------------------------------
+dojo.provide(&quot;orp.storage.FileProtocolStorage&quot;);
+dojo.require(&quot;orp.storage.Storage&quot;);
+dojo.require(&quot;orp.storage.fileProtocolUtil&quot;);
+dojo.require(&quot;orp.lang.Lang&quot;);
+
+
+// -------------------------------------------------------------------
+// Constructor
+// -------------------------------------------------------------------
+/**
+ * The FileProtocolStorage class knows how to save text to a local file.
+ *
+ * @param    repositoryName                 // e.g. demo_page
+ * @param    pathToTrunkDirectory           // Not needed if window.location.pathname is in the trunk directory.
+ * @scope    public instance constructor
+ */
+orp.storage.FileProtocolStorage = function(repositoryName, repositoryDirectoryName, pathToTrunkDirectory) {
+  orp.storage.Storage.call(this, repositoryName, repositoryDirectoryName, pathToTrunkDirectory);
+  
+  // Step 1: Build the fileUrl
+  // 
+  // Our saveTextToFile() method needs a fileUrl that looks like this:
+  //   fileUrl = &quot;K:\\www\\htdocs\\openrecord\\demo\\current\\trunk\\repositories\\demo_page.json&quot;;
+  // 
+  // We start with a value in this.getRepositoryName() that looks like this:
+  //   this.getRepositoryName() == &quot;demo_page&quot;
+
+  // URLs like these don't work:
+  //   fileUrl = &quot;repositories/demo_page.json&quot;;
+  //   fileUrl = &quot;repositories\\demo_page.json&quot;;
+  //   fileUrl = &quot;\\repositories\\demo_page.json&quot;;
+  //   fileUrl = &quot;K:/www/htdocs/openrecord/demo/current/trunk/repositories/demo_page.json&quot;;
+
+  var listOfAdditions = [];
+  if (pathToTrunkDirectory &amp;&amp; pathToTrunkDirectory !== &quot;&quot;) {
+    listOfAdditions.push(pathToTrunkDirectory);
+  }
+  listOfAdditions.push(this._repositoryDirectoryName);
+  listOfAdditions.push(this.getRepositoryName() + &quot;.json&quot;);
+  this._fileUrl = orp.storage.getLocalPathFromWindowLocation(listOfAdditions);
+};
+
+dojo.inherits(orp.storage.FileProtocolStorage, orp.storage.Storage);  // makes FileProtocolStorage be a subclass of Storage
+
+
+// -------------------------------------------------------------------
+// Public methods
+// -------------------------------------------------------------------
+
+/**
+ * Appends text to a file.
+ *
+ * @scope    public instance method
+ */
+orp.storage.FileProtocolStorage.prototype.appendText = function(textToAppend) {
+  var append = true;
+  this._saveTextToFile(textToAppend, this._fileUrl, append);
+};
+
+
+/**
+ * Writes text to a file, completely replacing the contents of the file.
+ *
+ * @scope    public instance method
+ */
+orp.storage.FileProtocolStorage.prototype.writeText = function(textToWrite, overwriteIfExists) {
+  var append = false;
+  this._saveTextToFile(textToWrite, this._fileUrl, append);
+};
+
+
+// -------------------------------------------------------------------
+// Private methods
+// -------------------------------------------------------------------
+
+/**
+ * Save the text to the file at the given URL.
+ *
+ * @scope    private instance method
+ * @return   Returns true if the text was saved.
+ */
+orp.storage.FileProtocolStorage.prototype._saveTextToFile = function(text, fileUrl, append) {
+  // Make sure we were loaded from a &quot;file:&quot; URL
+  if (window.location.protocol != &quot;file:&quot;) {
+    orp.lang.assert(false, 'FileProtocolStorage.js can only be used for pages loaded from a &quot;<A HREF="file:///">file:///</A>&quot; location');
+  }
+
+  var success = this._mozillaSaveToFile(text, fileUrl, append);
+  if (!success) {
+    success = this._ieSaveToFile(text, fileUrl, append);
+  }
+  return(success);
+};
+
+
+/**
+ * Save the text to the file at the given filePath.
+ *
+ * @scope    private instance method
+ * @return   Returns true if the text was saved, false if there was an error, or null if we couldn't even try.
+ */
+orp.storage.FileProtocolStorage.prototype._mozillaSaveToFile = function(text, filePath, append) {
+  if (window.Components) {
+    try {
+      netscape.security.PrivilegeManager.enablePrivilege(&quot;UniversalXPConnect&quot;);
+      var file = Components.classes[&quot;@mozilla.org/file/local;1&quot;].createInstance(Components.interfaces.nsILocalFile);
+      file.initWithPath(filePath);
+      if (!file.exists()) {
+        // Not all JavaScript implementations  support octal literals,
+        // so it's not safe to use '0664' here:
+        //   file.create(0, 0664);
+        //   file.permissions = 0664; // Because create ignores the permissions argument, at least on Mignon's Mac.
+        file.create(0, 0x1B4);
+        file.permissions = 0x1B4; // Because create ignores the permissions argument, at least on Mignon's Mac.
+      }
+      var outputStream = Components.classes[&quot;@mozilla.org/network/file-output-stream;1&quot;].createInstance(Components.interfaces.nsIFileOutputStream);
+      if (append) {
+        outputStream.init(file, 0x10 | 0x02, 0x0004, null);
+      } else {
+        outputStream.init(file, 0x20 | 0x02, 0x0004, null);
+      }
+      outputStream.write(text, text.length);
+      outputStream.flush();
+      outputStream.close();
+      return true;
+    } catch(exception) {
+      alert(&quot;Exception while attempting to save\n\n&quot; + exception);
+      return false;
+    }
+  } else {
+    alert(&quot;window.Components == null&quot;);
+  }
+  return null;
+};
+
+
+/**
+ * Save the text to the file at the given filePath.
+ *
+ * @scope    private instance method
+ * @return   Returns true if the text was saved, or false if there was an error.
+ */
+orp.storage.FileProtocolStorage.prototype._ieSaveToFile = function(text, filePath, append) {
+  try {
+    var fileSystemObject = new ActiveXObject(&quot;Scripting.FileSystemObject&quot;);
+  } catch(exception) {
+    alert(&quot;Exception while attempting to save\n\n&quot; + exception.toString());
+    return false;
+  }
+  if (append) {
+    orp.lang.assert(false, &quot;FIXME: still need to write code for this&quot;);
+  } else {
+    var file = fileSystemObject.OpenTextFile(filePath, 2, -1, 0);
+  }
+  file.Write(text);
+  file.Close();
+  return true;
+};
+
+
+// -------------------------------------------------------------------
+// End of file
+// -------------------------------------------------------------------

Deleted: trunk/source/storage/FileStorage.js
===================================================================
--- trunk/source/storage/FileStorage.js	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/source/storage/FileStorage.js	2005-11-01 05:23:19 UTC (rev 371)
@@ -1,310 +0,0 @@
-/*****************************************************************************
- FileStorage.js
- 
-******************************************************************************
- The code in this file is a heavily modified version of code that was copied
- from the TiddlyWiki and GTDTiddlyWiki code base.
- 
- The original code is Copyright (c) Osmosoft Limited.  The original copyright 
- notice is included below, along with the license conditions and disclaimer.  
- 
- OpenRecord modifications by Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
-
- For the OpenRecord modifications, the Copyright rights are relinquished under  
- the Creative Commons Public Domain Dedication:
-    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
-
-******************************************************************************
-TiddlyWiki 1.2.6 by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)
-Incorporating improvements by Isao Sonobe, <A HREF="http://www-gauge.scphys.kyoto-u.ac.jp/~sonobe/OgreKit/OgreKitWiki.html">http://www-gauge.scphys.kyoto-u.ac.jp/~sonobe/OgreKit/OgreKitWiki.html</A>
-GTDTiddlyWiki modification by Nathan Bowers, (wiki [at] snapgrid [dot] com)
-Safari Compatability by Jonathan Paisley at <A HREF="http://www.dcs.gla.ac.uk/~jp/">http://www.dcs.gla.ac.uk/~jp/</A>
-
-Copyright (c) Osmosoft Limited, 14 April 2005
-
-All rights reserved.
-
-Redistribution and use in source and binary forms, with or without modification,
-are permitted provided that the following conditions are met:
-
-Redistributions of source code must retain the above copyright notice, this
-list of conditions and the following disclaimer.
-
-Redistributions in binary form must reproduce the above copyright notice, this
-list of conditions and the following disclaimer in the documentation and/or other
-materials provided with the distribution.
-
-Neither the name of the Osmosoft Limited nor the names of its contributors may be
-used to endorse or promote products derived from this software without specific
-prior written permission.
-
-THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY
-EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
-OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
-SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
-INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
-TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
-BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
-CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
-ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
-DAMAGE.
-*****************************************************************************/
-
-
-// -------------------------------------------------------------------
-// Provides and Requires
-// -------------------------------------------------------------------
-dojo.provide(&quot;orp.storage.FileStorage&quot;);
-dojo.require(&quot;orp.storage.Storage&quot;);
-dojo.require(&quot;orp.lang.Lang&quot;);
-
-
-// -------------------------------------------------------------------
-// Constructor
-// -------------------------------------------------------------------
-/**
- * The FileStorage class knows how to save text to a local file.
- *
- * @param    repositoryName                 // e.g. demo_page
- * @param    pathToTrunkDirectory           // Not needed if window.location.pathname is in the trunk directory.
- * @scope    public instance constructor
- */
-orp.storage.FileStorage = function(repositoryName, repositoryDirectoryName, pathToTrunkDirectory) {
-  orp.storage.Storage.call(this, repositoryName, repositoryDirectoryName, pathToTrunkDirectory);
-  
-  // Step 1: Build the fileUrl
-  // 
-  // Our saveTextToFile() method needs a fileUrl that looks like this:
-  //   fileUrl = &quot;K:\\www\\htdocs\\openrecord\\demo\\current\\trunk\\repositories\\demo_page.json&quot;;
-  // 
-  // We start with a value in this.getRepositoryName() that looks like this:
-  //   this.getRepositoryName() == &quot;demo_page&quot;
-
-  // URLs like these don't work:
-  //   fileUrl = &quot;repositories/demo_page.json&quot;;
-  //   fileUrl = &quot;repositories\\demo_page.json&quot;;
-  //   fileUrl = &quot;\\repositories\\demo_page.json&quot;;
-  //   fileUrl = &quot;K:/www/htdocs/openrecord/demo/current/trunk/repositories/demo_page.json&quot;;
-
-  var listOfAdditions = [];
-  if (pathToTrunkDirectory &amp;&amp; pathToTrunkDirectory !== &quot;&quot;) {
-    listOfAdditions.push(pathToTrunkDirectory);
-  }
-  listOfAdditions.push(this._repositoryDirectoryName);
-  listOfAdditions.push(this.getRepositoryName() + &quot;.json&quot;);
-  this._fileUrl = this._getLocalPathFromWindowLocation(listOfAdditions);
-};
-
-dojo.inherits(orp.storage.FileStorage, orp.storage.Storage);  // makes FileStorage be a subclass of Storage
-
-
-// -------------------------------------------------------------------
-// Public methods
-// -------------------------------------------------------------------
-
-/**
- * Appends text to a file.
- *
- * @scope    public instance method
- */
-orp.storage.FileStorage.prototype.appendText = function(textToAppend) {
-  var append = true;
-  this._saveTextToFile(textToAppend, this._fileUrl, append);
-};
-
-
-/**
- * Writes text to a file, completely replacing the contents of the file.
- *
- * @scope    public instance method
- */
-orp.storage.FileStorage.prototype.writeText = function(textToWrite, overwriteIfExists) {
-  var append = false;
-  this._saveTextToFile(textToWrite, this._fileUrl, append);
-};
-
-
-// -------------------------------------------------------------------
-// Private methods
-// -------------------------------------------------------------------
-
-/**
- * Save the text to the file at the given URL.
- *
- * @scope    private instance method
- * @return   Returns true if the text was saved.
- */
-orp.storage.FileStorage.prototype._saveTextToFile = function(text, fileUrl, append) {
-  // Make sure we were loaded from a &quot;file:&quot; URL
-  if (window.location.protocol != &quot;file:&quot;) {
-    orp.lang.assert(false, 'FileStorage.js can only be used for pages loaded from a &quot;<A HREF="file:///">file:///</A>&quot; location');
-  }
-
-  var success = this._mozillaSaveToFile(text, fileUrl, append);
-  if (!success) {
-    success = this._ieSaveToFile(text, fileUrl, append);
-  }
-  return(success);
-};
-
-
-/**
- * Save the text to the file at the given filePath.
- *
- * @scope    private instance method
- * @return   Returns true if the text was saved, false if there was an error, or null if we couldn't even try.
- */
-orp.storage.FileStorage.prototype._mozillaSaveToFile = function(text, filePath, append) {
-  if (window.Components) {
-    try {
-      netscape.security.PrivilegeManager.enablePrivilege(&quot;UniversalXPConnect&quot;);
-      var file = Components.classes[&quot;@mozilla.org/file/local;1&quot;].createInstance(Components.interfaces.nsILocalFile);
-      file.initWithPath(filePath);
-      if (!file.exists()) {
-        // Not all JavaScript implementations  support octal literals,
-        // so it's not safe to use '0664' here:
-        //   file.create(0, 0664);
-        //   file.permissions = 0664; // Because create ignores the permissions argument, at least on Mignon's Mac.
-        file.create(0, 0x1B4);
-        file.permissions = 0x1B4; // Because create ignores the permissions argument, at least on Mignon's Mac.
-      }
-      var outputStream = Components.classes[&quot;@mozilla.org/network/file-output-stream;1&quot;].createInstance(Components.interfaces.nsIFileOutputStream);
-      if (append) {
-        outputStream.init(file, 0x10 | 0x02, 0x0004, null);
-      } else {
-        outputStream.init(file, 0x20 | 0x02, 0x0004, null);
-      }
-      outputStream.write(text, text.length);
-      outputStream.flush();
-      outputStream.close();
-      return true;
-    }
-    catch(exception) {
-      alert(&quot;Exception while attempting to save\n\n&quot; + exception);
-      return false;
-    }
-  } else {
-    alert(&quot;window.Components == null&quot;);
-  }
-  return null;
-};
-
-
-/**
- * Save the text to the file at the given filePath.
- *
- * @scope    private instance method
- * @return   Returns true if the text was saved, or false if there was an error.
- */
-orp.storage.FileStorage.prototype._ieSaveToFile = function(text, filePath, append) {
-  try {
-    var fileSystemObject = new ActiveXObject(&quot;Scripting.FileSystemObject&quot;);
-  }
-  catch(exception) {
-    alert(&quot;Exception while attempting to save\n\n&quot; + exception.toString());
-    return false;
-  }
-  if (append) {
-    orp.lang.assert(false, &quot;PENDING: still need to write code for this&quot;);
-  } else {
-    var file = fileSystemObject.OpenTextFile(filePath, 2, -1, 0);
-  }
-  file.Write(text);
-  file.Close();
-  return true;
-};
-
-
-/**
- * This method looks at the URL value in the window.location property,
- * strips the filename off the end, appends any given path elements,
- * converts the whole thing to a format that is compatible with the 
- * local file system, and returns the new local path.
- *
- * @scope    private instance method
- * @return   Returns a full local pathname.
- */
-orp.storage.FileStorage.prototype._getLocalPathFromWindowLocation = function(listOfAdditions) {
-  // Example location:
-  //   location.href     == <A HREF="file:///D:/amy/openrecord/foo.html#bar">file:///D:/amy/openrecord/foo.html#bar</A>
-  //   location.protocol == file:
-  //   location.pathname ==        /D:/amy/openrecord/foo.html
-  //   location.hash     ==                                   #bar
-
-  // Get the URL of the document
-  var pathname = window.location.pathname;
-  
-  
-  // Step 1: Make the requested additions to the pathname
-  var arrayOfParts = pathname.split('/');
-  arrayOfParts.pop();  // get rid of the final &quot;/foo.html&quot; part
-  for (var i in listOfAdditions) {
-    var additionalPart = listOfAdditions[i];
-    arrayOfParts.push(additionalPart);
-  }
-  pathname = arrayOfParts.join('/');
-
-  
-  // Step 2: Figure out what type of URL we're working with
-  // Constants
-  var PathType = {
-    LOCAL_PC:        &quot;LOCAL_PC&quot;,          // &quot;<A HREF="file:///x:/path/path...">file:///x:/path/path...</A>&quot; 
-    LOCAL_UNIX_MAC:  &quot;LOCAL_UNIX_MAC&quot;,    // &quot;<A HREF="file:///path/path...">file:///path/path...</A>&quot;
-    NETWORK_PC:      &quot;NETWORK_PC&quot;,        // &quot;<A HREF="file://server/share/path/path...">file://server/share/path/path...</A>&quot;
-    NETWORK_FIREFOX: &quot;NETWORK_FIREFOX&quot; }; // &quot;<A HREF="file://///server/share/path/path...">file://///server/share/path/path...</A>&quot;
-  // &quot;<A HREF="file:///x:/path/path...">file:///x:/path/path...</A>&quot;             == PathType.LOCAL_PC        --&gt; &quot;x:\path\path...&quot;
-  // &quot;<A HREF="file:///path/path...">file:///path/path...</A>&quot;                == PathType.LOCAL_UNIX_MAC  --&gt; &quot;/path/path...&quot;
-  // &quot;<A HREF="file://server/share/path/path...">file://server/share/path/path...</A>&quot;    == PathType.NETWORK_PC      --&gt; &quot;\\server\share\path\path...&quot;
-  // &quot;<A HREF="file://///server/share/path/path...">file://///server/share/path/path...</A>&quot; == PathType.NETWORK_FIREFOX --&gt; &quot;\\server\share\path\path...&quot;
-
-  var pathType = null;
-  if (pathname.charAt(2) == &quot;:&quot;) {
-    pathType = PathType.LOCAL_PC;
-  } else if (pathname.indexOf(&quot;///&quot;) === 0) {
-    pathType = PathType.NETWORK_FIREFOX;
-  } else if (pathname.indexOf(&quot;/&quot;) === 0) {
-    pathType = PathType.LOCAL_UNIX_MAC;
-  } else {
-    pathType = PathType.NETWORK_PC;
-  }
-
-
-  // Step 3: Convert the URL to a file path
-  var localPath = pathname;
-  switch (pathType) {
-    case PathType.LOCAL_PC:
-      // example: &quot;/x:/path/path...&quot;
-      localPath = localPath.substring(1);  // get rid of initial '/'
-      localPath = unescape(localPath);
-      localPath = localPath.replace(new RegExp(&quot;/&quot;,&quot;g&quot;),&quot;\\&quot;);
-      // result: &quot;x:\path\path...&quot;
-      break;
-    case PathType.LOCAL_UNIX_MAC:         
-    // example: &quot;/path/path...&quot;
-      localPath = unescape(localPath);
-      // result: &quot;/path/path...&quot;
-      break;
-    case PathType.NETWORK_FIREFOX:
-      // example: &quot;///server/share/path/path...&quot;
-      localPath = localPath.substring(3);  // get rid of initial '///'
-      localPath = unescape(localPath);
-      localPath = localPath.replace(new RegExp(&quot;/&quot;,&quot;g&quot;),&quot;\\&quot;);
-      localPath = &quot;\\\\&quot; + localPath;      
-      // result: &quot;\\server\share\path\path...&quot;
-      break;
-    case PathType.NETWORK_PC:
-      // example: &quot;server/share/path/path...&quot;
-      localPath = unescape(localPath);
-      localPath = localPath.replace(new RegExp(&quot;/&quot;,&quot;g&quot;),&quot;\\&quot;);
-      localPath = &quot;\\\\&quot; + localPath;      
-      // result: &quot;\\server\share\path\path...&quot;
-      break;
-  }
-
-  return localPath;
-};
-
-
-// -------------------------------------------------------------------
-// End of file
-// -------------------------------------------------------------------

Deleted: trunk/source/storage/FileSystem.js
===================================================================
--- trunk/source/storage/FileSystem.js	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/source/storage/FileSystem.js	2005-11-01 05:23:19 UTC (rev 371)
@@ -1,131 +0,0 @@
-/*****************************************************************************
- FileSystem.js
- 
-******************************************************************************
- Written in 2005 by Mignon Belongie
-  
- Copyright rights relinquished under the Creative Commons  
- Public Domain Dedication:
-    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
-  
- You can copy freely from this file.  This work may be freely reproduced, 
- distributed, transmitted, used, modified, built upon, or otherwise exploited
- by anyone for any purpose.
-  
- This work is provided on an &quot;AS IS&quot; basis, without warranties or conditions 
- of any kind, either express or implied, including, without limitation, any 
- warranties or conditions of title, non-infringement, merchantability, or 
- fitness for a particular purpose. You are solely responsible for determining 
- the appropriateness of using or distributing the work and assume all risks 
- associated with use of this work, including but not limited to the risks and 
- costs of errors, compliance with applicable laws, damage to or loss of data 
- or equipment, and unavailability or interruption of operations.
-
- In no event shall the authors or contributors have any liability for any 
- direct, indirect, incidental, special, exemplary, or consequential damages,
- however caused and on any theory of liability, whether in contract, strict 
- liability, or tort (including negligence), arising in any way out of or in 
- connection with the use or distribution of the work.
-*****************************************************************************/
-
-dojo.provide(&quot;orp.storage.FileSystem&quot;);
-dojo.require(&quot;orp.storage.Storage&quot;);
-
-// -------------------------------------------------------------------
-// Dependencies, expressed in the syntax that JSLint understands:
-/*global window, document  */
-// -------------------------------------------------------------------
-
-/**
- * @scope    public function
- * @param    dirNameRelativeToWindowLocation
- * @param    suffix                                   // if null or undefined, all files will be listed
- * @return   an array of the files in the directory
- * @throws   Throws an Error if directory doesn't exist, isn't a directory, or can't be read.
- */
-orp.storage.getDirList = function(dirNameRelativeToWindowLocation, suffix) {
-  var dirList = [];
-  var thisUrl = window.location.pathname; // e.g .../someDirectory/currentWindow.html
-  var arrayOfPathComponents = thisUrl.split('/');
-  arrayOfPathComponents.pop();
-  var thisDirectory = arrayOfPathComponents.join('/'); // e.g .../someDirectory
-  if (window.location.protocol == &quot;http:&quot;) {
-    var response = this._getDirListFromPhp(thisDirectory, dirNameRelativeToWindowLocation, suffix);
-    if (response[0] != '[') { // i.e. get_list_of_files_in_dir.php returned a message instead of an array
-      throw new Error(response);
-    }
-    eval(&quot;dirList = &quot; + response);
-  }
-  else {
-    if (window.Components) {
-      dirList = this._getDirListFromMozillaComponent(thisDirectory, dirNameRelativeToWindowLocation, suffix);
-    }
-    else {
-      throw new Error(&quot;window.Components == null&quot;);
-    }
-  }
-  return dirList;
-};
-
-// FIXME: This hack should be replaced by something better, perhaps using dojo.hostenv.getBaseScriptUri().
-orp.storage.PATH_TO_TRUNK_DIRECTORY_FROM_WINDOW_LOCATION = null;
-orp.storage.PATH_TO_WINDOW_LOCATION_FROM_TRUNK_DIRECTORY = null;
-
-orp.storage._getDirListFromPhp = function(thisDirectory, dirNameRelativeToWindowLocation, suffix) {
-  var newXMLHttpRequestObject = new XMLHttpRequest();
-  var pathToTrunkFromPhpFile = &quot;../..&quot;;
-  
-  var dirNameRelativeToPhpFile = pathToTrunkFromPhpFile + '/';
-  if (orp.storage.PATH_TO_WINDOW_LOCATION_FROM_TRUNK_DIRECTORY) {
-    dirNameRelativeToPhpFile += orp.storage.PATH_TO_WINDOW_LOCATION_FROM_TRUNK_DIRECTORY + '/';
-  }
-  dirNameRelativeToPhpFile += dirNameRelativeToWindowLocation;
-  
-  var pathToPhpDirectoryFromWindowLocation = &quot;&quot;;
-  if (orp.storage.PATH_TO_TRUNK_DIRECTORY_FROM_WINDOW_LOCATION) {
-    pathToPhpDirectoryFromWindowLocation += orp.storage.PATH_TO_TRUNK_DIRECTORY_FROM_WINDOW_LOCATION + '/';
-  }
-  pathToPhpDirectoryFromWindowLocation += orp.storage.PATH_TO_PHP_FILES_FROM_TRUNK + '/';
-
-  var pathToPhpFileFromWindowLocation = pathToPhpDirectoryFromWindowLocation + &quot;get_list_of_files_in_dir.php&quot;;
-  var url = thisDirectory + '/' + pathToPhpFileFromWindowLocation + 
-            &quot;?dir=&quot; + dirNameRelativeToPhpFile;
-  if (suffix) {
-    url += &quot;&amp;suffix=&quot; + suffix;
-  }
-  newXMLHttpRequestObject.open(&quot;GET&quot;, url, false);
-  newXMLHttpRequestObject.send(null);
-  return newXMLHttpRequestObject.responseText;
-};
-
-orp.storage._getDirListFromMozillaComponent = function(thisDirectory, dirNameRelativeToWindowLocation, suffix) {
-  var dirList = [];
-  netscape.security.PrivilegeManager.enablePrivilege(&quot;UniversalXPConnect&quot;);
-  var file = Components.classes[&quot;@mozilla.org/file/local;1&quot;].createInstance(Components.interfaces.nsILocalFile);
-  var dirPath = thisDirectory + &quot;/&quot; + dirNameRelativeToWindowLocation;
-  file.initWithPath(dirPath);
-  if (!file.exists()) {
-    throw new Error(dirPath + &quot; not found.&quot;);
-  }
-  if (!file.isDirectory()) {
-    throw new Error(dirPath + &quot; is not a directory.&quot;);
-  }
-  // file is the given directory (nsIFile)
-  var entries = file.directoryEntries;
-  while(entries.hasMoreElements()) {
-    var entry = entries.getNext();
-    entry.QueryInterface(Components.interfaces.nsIFile);
-    if (suffix) {
-      var parts = entry.leafName.split('.');
-      if (parts.length != 2 || parts[1] != suffix) {
-        continue;
-      }
-    }
-    dirList.push(entry.leafName); // could be entry.path instead, if needed...
-  }
-  return dirList;
-};
-
-// -------------------------------------------------------------------
-// End of file
-// -------------------------------------------------------------------

Copied: trunk/source/storage/HttpProtocolStorage.js (from rev 367, trunk/source/storage/HttpStorage.js)
===================================================================
--- trunk/source/storage/HttpStorage.js	2005-10-25 03:17:18 UTC (rev 367)
+++ trunk/source/storage/HttpProtocolStorage.js	2005-11-01 05:23:19 UTC (rev 371)
@@ -0,0 +1,155 @@
+/*****************************************************************************
+ HttpProtocolStorage.js
+  
+******************************************************************************
+ Written in 2005 by Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
+  
+ Copyright rights relinquished under the Creative Commons  
+ Public Domain Dedication:
+    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
+  
+ You can copy freely from this file.  This work may be freely reproduced, 
+ distributed, transmitted, used, modified, built upon, or otherwise exploited
+ by anyone for any purpose.
+  
+ This work is provided on an &quot;AS IS&quot; basis, without warranties or conditions 
+ of any kind, either express or implied, including, without limitation, any 
+ warranties or conditions of title, non-infringement, merchantability, or 
+ fitness for a particular purpose. You are solely responsible for determining 
+ the appropriateness of using or distributing the work and assume all risks 
+ associated with use of this work, including but not limited to the risks and 
+ costs of errors, compliance with applicable laws, damage to or loss of data 
+ or equipment, and unavailability or interruption of operations.
+
+ In no event shall the authors or contributors have any liability for any 
+ direct, indirect, incidental, special, exemplary, or consequential damages,
+ however caused and on any theory of liability, whether in contract, strict 
+ liability, or tort (including negligence), arising in any way out of or in 
+ connection with the use or distribution of the work.
+*****************************************************************************/
+
+
+// -------------------------------------------------------------------
+// Provides and Requires
+// -------------------------------------------------------------------
+dojo.provide(&quot;orp.storage.HttpProtocolStorage&quot;);
+dojo.require(&quot;orp.storage.Storage&quot;);
+dojo.require(&quot;orp.storage.httpProtocolUtil&quot;);
+
+
+// -------------------------------------------------------------------
+// Constructor
+// -------------------------------------------------------------------
+/**
+ * The HttpProtocolStorage class knows how to save content to a server by using
+ * XMLHttpRequest to call a PHP script.
+ *
+ * @param    repositoryName                         // e.g. demo_page
+ * @param    pathToTrunkDirectoryFromWindowLocation // Not needed if window location is at the root of the trunk directory.
+ * @scope    public instance constructor
+ */
+orp.storage.HttpProtocolStorage = function(repositoryName, repositoryDirectoryName, pathToTrunkDirectoryFromWindowLocation) {
+  orp.storage.Storage.call(this, repositoryName, repositoryDirectoryName, pathToTrunkDirectoryFromWindowLocation);
+
+  var thisUrl = window.location.pathname; //e.g. /openrecord/trunk/demo_page.html or /openrecord/trunk/source/model/TestRepositoryWriting.html.
+  var arrayOfPathComponents = thisUrl.split('/');
+  arrayOfPathComponents.pop();
+  var thisDirectory = arrayOfPathComponents.join('/'); //e.g. /openrecord/trunk or /openrecord/trunk/source/model
+  if (pathToTrunkDirectoryFromWindowLocation) {
+    this._completePathToTrunkDirectory = thisDirectory + '/' + pathToTrunkDirectoryFromWindowLocation;
+  } else {
+    this._completePathToTrunkDirectory = thisDirectory;
+  }
+};
+
+dojo.inherits(orp.storage.HttpProtocolStorage, orp.storage.Storage);  // makes HttpProtocolStorage be a subclass of Storage
+
+
+// -------------------------------------------------------------------
+// Public methods
+// -------------------------------------------------------------------
+
+/**
+ * Appends text to a file.
+ *
+ * @scope    public instance method
+ */
+orp.storage.HttpProtocolStorage.prototype.appendText = function(textToAppend) {
+  var url = this._completePathToTrunkDirectory;
+  url += '/' + orp.storage.httpProtocolUtil.PATH_TO_PHP_FILES_FROM_TRUNK;
+  // FIXME: Should also pass in this._repositoryDirectoryName, rather than having &quot;repositories&quot; hardcoded in append_to_repository_file.php.
+  url += &quot;/append_to_repository_file.php?file=&quot; + this.getRepositoryName();
+  
+  // PENDING: 
+  // It might be more efficient to re-use the XMLHttpRequestObject,
+  // rather than creating a new one for new request.  But re-using 
+  // them is complicated, because the requests are asynchronous, so
+  // we need to check to see if the last request is done before we 
+  // can start a new request.
+  var newXMLHttpRequestObject = this._newXMLHttpRequestObject();
+  var asynchronous = true;
+  newXMLHttpRequestObject.open(&quot;POST&quot;, url, asynchronous);
+  newXMLHttpRequestObject.setRequestHeader(&quot;Content-Type&quot;, &quot;text/plain&quot;);
+  newXMLHttpRequestObject.send(textToAppend);
+};
+
+
+/**
+ * Writes text to a file, completely replacing the contents of the file.
+ *
+ * @scope    public instance method
+ */
+orp.storage.HttpProtocolStorage.prototype.writeText = function(textToWrite, overwriteIfExists) {
+  var url = this._completePathToTrunkDirectory;
+  url += '/' + orp.storage.httpProtocolUtil.PATH_TO_PHP_FILES_FROM_TRUNK;
+  // FIXME: Should also pass in this._repositoryDirectoryName, rather than having &quot;repositories&quot; hardcoded in write_to_repository_file.php.
+  url += &quot;/write_to_repository_file.php?file=&quot; + this.getRepositoryName();
+  if (overwriteIfExists) {
+    url += &quot;&amp;overwrite=T&quot;;
+  }
+  var newXMLHttpRequestObject = this._newXMLHttpRequestObject();
+  var asynchronous = true;
+  newXMLHttpRequestObject.open(&quot;POST&quot;, url, asynchronous);
+  newXMLHttpRequestObject.setRequestHeader(&quot;Content-Type&quot;, &quot;text/plain&quot;);
+  newXMLHttpRequestObject.send(textToWrite);
+};
+
+
+// -------------------------------------------------------------------
+// Private methods
+// -------------------------------------------------------------------
+
+/**
+ * Returns a newly created XMLHttpRequest object.
+ *
+ * @scope    private instance method
+ * @return   A newly created XMLHttpRequest object. 
+ */
+orp.storage.HttpProtocolStorage.prototype._newXMLHttpRequestObject = function() {
+  var newXMLHttpRequestObject = null;
+  if (window.XMLHttpRequest) {
+    newXMLHttpRequestObject = new XMLHttpRequest();
+  } else {
+    if (window.ActiveXObject) {
+      newXMLHttpRequestObject = new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;);
+    }
+  }
+  if (newXMLHttpRequestObject) {
+    newXMLHttpRequestObject.onreadystatechange = function() {
+      var statusText = newXMLHttpRequestObject.statusText;
+      if (statusText != &quot;OK&quot;) {
+        window.alert(&quot;onreadystatechange:\n&quot; +
+          &quot;readyState: &quot; + newXMLHttpRequestObject.readyState + &quot;\n&quot; +
+          &quot;status: &quot; + newXMLHttpRequestObject.status + &quot;\n&quot; +
+          &quot;statusText: &quot; + newXMLHttpRequestObject.statusText + &quot;\n&quot; +
+          &quot;responseText: &quot; + newXMLHttpRequestObject.responseText + &quot;\n&quot;);
+      }
+    };
+  }
+  return newXMLHttpRequestObject;
+};
+
+
+// -------------------------------------------------------------------
+// End of file
+// -------------------------------------------------------------------

Deleted: trunk/source/storage/HttpStorage.js
===================================================================
--- trunk/source/storage/HttpStorage.js	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/source/storage/HttpStorage.js	2005-11-01 05:23:19 UTC (rev 371)
@@ -1,154 +0,0 @@
-/*****************************************************************************
- HttpStorage.js
-  
-******************************************************************************
- Written in 2005 by Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
-  
- Copyright rights relinquished under the Creative Commons  
- Public Domain Dedication:
-    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
-  
- You can copy freely from this file.  This work may be freely reproduced, 
- distributed, transmitted, used, modified, built upon, or otherwise exploited
- by anyone for any purpose.
-  
- This work is provided on an &quot;AS IS&quot; basis, without warranties or conditions 
- of any kind, either express or implied, including, without limitation, any 
- warranties or conditions of title, non-infringement, merchantability, or 
- fitness for a particular purpose. You are solely responsible for determining 
- the appropriateness of using or distributing the work and assume all risks 
- associated with use of this work, including but not limited to the risks and 
- costs of errors, compliance with applicable laws, damage to or loss of data 
- or equipment, and unavailability or interruption of operations.
-
- In no event shall the authors or contributors have any liability for any 
- direct, indirect, incidental, special, exemplary, or consequential damages,
- however caused and on any theory of liability, whether in contract, strict 
- liability, or tort (including negligence), arising in any way out of or in 
- connection with the use or distribution of the work.
-*****************************************************************************/
-
-
-// -------------------------------------------------------------------
-// Provides and Requires
-// -------------------------------------------------------------------
-dojo.provide(&quot;orp.storage.HttpStorage&quot;);
-dojo.require(&quot;orp.storage.Storage&quot;);
-
-
-// -------------------------------------------------------------------
-// Constructor
-// -------------------------------------------------------------------
-/**
- * The HttpStorage class knows how to save content to a server by using
- * XMLHttpRequest to call a PHP script.
- *
- * @param    repositoryName                         // e.g. demo_page
- * @param    pathToTrunkDirectoryFromWindowLocation // Not needed if window location is at the root of the trunk directory.
- * @scope    public instance constructor
- */
-orp.storage.HttpStorage = function(repositoryName, repositoryDirectoryName, pathToTrunkDirectoryFromWindowLocation) {
-  orp.storage.Storage.call(this, repositoryName, repositoryDirectoryName, pathToTrunkDirectoryFromWindowLocation);
-
-  var thisUrl = window.location.pathname; //e.g. /openrecord/trunk/demo_page.html or /openrecord/trunk/source/model/TestRepositoryWriting.html.
-  var arrayOfPathComponents = thisUrl.split('/');
-  arrayOfPathComponents.pop();
-  var thisDirectory = arrayOfPathComponents.join('/'); //e.g. /openrecord/trunk or /openrecord/trunk/source/model
-  if (pathToTrunkDirectoryFromWindowLocation) {
-    this._completePathToTrunkDirectory = thisDirectory + '/' + pathToTrunkDirectoryFromWindowLocation;
-  } else {
-    this._completePathToTrunkDirectory = thisDirectory;
-  }
-};
-
-dojo.inherits(orp.storage.HttpStorage, orp.storage.Storage);  // makes HttpStorage be a subclass of Storage
-
-
-// -------------------------------------------------------------------
-// Public methods
-// -------------------------------------------------------------------
-
-/**
- * Appends text to a file.
- *
- * @scope    public instance method
- */
-orp.storage.HttpStorage.prototype.appendText = function(textToAppend) {
-  var url = this._completePathToTrunkDirectory;
-  url += '/' + orp.storage.PATH_TO_PHP_FILES_FROM_TRUNK;
-  // FIXME: Should also pass in this._repositoryDirectoryName, rather than having &quot;repositories&quot; hardcoded in append_to_repository_file.php.
-  url += &quot;/append_to_repository_file.php?file=&quot; + this.getRepositoryName();
-  
-  // PENDING: 
-  // It might be more efficient to re-use the XMLHttpRequestObject,
-  // rather than creating a new one for new request.  But re-using 
-  // them is complicated, because the requests are asynchronous, so
-  // we need to check to see if the last request is done before we 
-  // can start a new request.
-  var newXMLHttpRequestObject = this._newXMLHttpRequestObject();
-  var asynchronous = true;
-  newXMLHttpRequestObject.open(&quot;POST&quot;, url, asynchronous);
-  newXMLHttpRequestObject.setRequestHeader(&quot;Content-Type&quot;, &quot;text/plain&quot;);
-  newXMLHttpRequestObject.send(textToAppend);
-};
-
-
-/**
- * Writes text to a file, completely replacing the contents of the file.
- *
- * @scope    public instance method
- */
-orp.storage.HttpStorage.prototype.writeText = function(textToWrite, overwriteIfExists) {
-  var url = this._completePathToTrunkDirectory;
-  url += '/' + orp.storage.PATH_TO_PHP_FILES_FROM_TRUNK;
-  // FIXME: Should also pass in this._repositoryDirectoryName, rather than having &quot;repositories&quot; hardcoded in write_to_repository_file.php.
-  url += &quot;/write_to_repository_file.php?file=&quot; + this.getRepositoryName();
-  if (overwriteIfExists) {
-    url += &quot;&amp;overwrite=T&quot;;
-  }
-  var newXMLHttpRequestObject = this._newXMLHttpRequestObject();
-  var asynchronous = true;
-  newXMLHttpRequestObject.open(&quot;POST&quot;, url, asynchronous);
-  newXMLHttpRequestObject.setRequestHeader(&quot;Content-Type&quot;, &quot;text/plain&quot;);
-  newXMLHttpRequestObject.send(textToWrite);
-};
-
-
-// -------------------------------------------------------------------
-// Private methods
-// -------------------------------------------------------------------
-
-/**
- * Returns a newly created XMLHttpRequest object.
- *
- * @scope    private instance method
- * @return   A newly created XMLHttpRequest object. 
- */
-orp.storage.HttpStorage.prototype._newXMLHttpRequestObject = function() {
-  var newXMLHttpRequestObject = null;
-  if (window.XMLHttpRequest) {
-    newXMLHttpRequestObject = new XMLHttpRequest();
-  } else {
-    if (window.ActiveXObject) {
-      newXMLHttpRequestObject = new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;);
-    }
-  }
-  if (newXMLHttpRequestObject) {
-    newXMLHttpRequestObject.onreadystatechange = function() {
-      var statusText = newXMLHttpRequestObject.statusText;
-      if (statusText != &quot;OK&quot;) {
-        window.alert(&quot;onreadystatechange:\n&quot; +
-          &quot;readyState: &quot; + newXMLHttpRequestObject.readyState + &quot;\n&quot; +
-          &quot;status: &quot; + newXMLHttpRequestObject.status + &quot;\n&quot; +
-          &quot;statusText: &quot; + newXMLHttpRequestObject.statusText + &quot;\n&quot; +
-          &quot;responseText: &quot; + newXMLHttpRequestObject.responseText + &quot;\n&quot;);
-      }
-    };
-  }
-  return newXMLHttpRequestObject;
-};
-
-
-// -------------------------------------------------------------------
-// End of file
-// -------------------------------------------------------------------

Modified: trunk/source/storage/Storage.js
===================================================================
--- trunk/source/storage/Storage.js	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/source/storage/Storage.js	2005-11-01 05:23:19 UTC (rev 371)
@@ -40,7 +40,7 @@
 // -------------------------------------------------------------------
 /**
  * The Storage class is the abstract superclass for the other storage 
- * classes, including FileStorage and HttpStorage.
+ * classes, including FileProtocolStorage and HttpProtocolStorage.
  *
  * @param    repositoryName                         // e.g. demo_page
  * @param    pathToTrunkDirectoryFromWindowLocation // Not needed if window location is at the root of the trunk directory.
@@ -52,10 +52,6 @@
   this._pathToTrunkDirectory = pathToTrunkDirectoryFromWindowLocation;
 };
 
-// -------------------------------------------------------------------
-// Public constants
-// -------------------------------------------------------------------
-orp.storage.PATH_TO_PHP_FILES_FROM_TRUNK = &quot;source/storage&quot;;
 
 // -------------------------------------------------------------------
 // Public methods

Copied: trunk/source/storage/directoryList.js (from rev 367, trunk/source/storage/FileSystem.js)
===================================================================
--- trunk/source/storage/FileSystem.js	2005-10-25 03:17:18 UTC (rev 367)
+++ trunk/source/storage/directoryList.js	2005-11-01 05:23:19 UTC (rev 371)
@@ -0,0 +1,134 @@
+/*****************************************************************************
+ directoryList.js
+ 
+******************************************************************************
+ Written in 2005 by Mignon Belongie
+  
+ Copyright rights relinquished under the Creative Commons  
+ Public Domain Dedication:
+    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
+  
+ You can copy freely from this file.  This work may be freely reproduced, 
+ distributed, transmitted, used, modified, built upon, or otherwise exploited
+ by anyone for any purpose.
+  
+ This work is provided on an &quot;AS IS&quot; basis, without warranties or conditions 
+ of any kind, either express or implied, including, without limitation, any 
+ warranties or conditions of title, non-infringement, merchantability, or 
+ fitness for a particular purpose. You are solely responsible for determining 
+ the appropriateness of using or distributing the work and assume all risks 
+ associated with use of this work, including but not limited to the risks and 
+ costs of errors, compliance with applicable laws, damage to or loss of data 
+ or equipment, and unavailability or interruption of operations.
+
+ In no event shall the authors or contributors have any liability for any 
+ direct, indirect, incidental, special, exemplary, or consequential damages,
+ however caused and on any theory of liability, whether in contract, strict 
+ liability, or tort (including negligence), arising in any way out of or in 
+ connection with the use or distribution of the work.
+*****************************************************************************/
+
+dojo.provide(&quot;orp.storage.directoryList&quot;);
+dojo.require(&quot;orp.storage.fileProtocolUtil&quot;);
+dojo.require(&quot;orp.storage.httpProtocolUtil&quot;);
+
+// -------------------------------------------------------------------
+// Dependencies, expressed in the syntax that JSLint understands:
+/*global window, document  */
+// -------------------------------------------------------------------
+
+/**
+ * @scope    public function
+ * @param    dirNameRelativeToWindowLocation
+ * @param    suffix                                   // if null or undefined, all files will be listed
+ * @return   an array of the files in the directory
+ * @throws   Throws an Error if directory doesn't exist, isn't a directory, or can't be read.
+ */
+orp.storage.getDirList = function(dirNameRelativeToWindowLocation, suffix) {
+  var dirList = [];
+  var thisUrl = window.location.pathname; // e.g .../someDirectory/currentWindow.html
+  var arrayOfPathComponents = thisUrl.split('/');
+  arrayOfPathComponents.pop();
+  var thisDirectory = arrayOfPathComponents.join('/'); // e.g .../someDirectory
+  if (window.location.protocol == &quot;http:&quot;) {
+    var response = this._getDirListFromPhp(thisDirectory, dirNameRelativeToWindowLocation, suffix);
+    if (response[0] != '[') { // i.e. get_list_of_files_in_dir.php returned a message instead of an array
+      throw new Error(response);
+    }
+    eval(&quot;dirList = &quot; + response);
+  }
+  if (window.location.protocol == &quot;file:&quot;) {
+    if (window.Components) {
+      var arrayOfAdditions = dirNameRelativeToWindowLocation.split('/');
+      var pathToDirectory = orp.storage.getLocalPathFromWindowLocation(arrayOfAdditions);
+      dirList = this._getDirListFromMozillaComponent(pathToDirectory, suffix);
+    } else {
+      throw new Error(&quot;window.Components == null&quot;);
+    }
+  }
+  return dirList;
+};
+
+// FIXME: This hack should be replaced by something better, perhaps using dojo.hostenv.getBaseScriptUri().
+orp.storage.PATH_TO_TRUNK_DIRECTORY_FROM_WINDOW_LOCATION = null;
+orp.storage.PATH_TO_WINDOW_LOCATION_FROM_TRUNK_DIRECTORY = null;
+
+orp.storage._getDirListFromPhp = function(thisDirectory, dirNameRelativeToWindowLocation, suffix) {
+  var newXMLHttpRequestObject = new XMLHttpRequest();
+  var pathToTrunkFromPhpFile = &quot;../..&quot;;
+  
+  var dirNameRelativeToPhpFile = pathToTrunkFromPhpFile + '/';
+  if (orp.storage.PATH_TO_WINDOW_LOCATION_FROM_TRUNK_DIRECTORY) {
+    dirNameRelativeToPhpFile += orp.storage.PATH_TO_WINDOW_LOCATION_FROM_TRUNK_DIRECTORY + '/';
+  }
+  dirNameRelativeToPhpFile += dirNameRelativeToWindowLocation;
+  
+  var pathToPhpDirectoryFromWindowLocation = &quot;&quot;;
+  if (orp.storage.PATH_TO_TRUNK_DIRECTORY_FROM_WINDOW_LOCATION) {
+    pathToPhpDirectoryFromWindowLocation += orp.storage.PATH_TO_TRUNK_DIRECTORY_FROM_WINDOW_LOCATION + '/';
+  }
+  pathToPhpDirectoryFromWindowLocation += orp.storage.httpProtocolUtil.PATH_TO_PHP_FILES_FROM_TRUNK + '/';
+
+  var pathToPhpFileFromWindowLocation = pathToPhpDirectoryFromWindowLocation + &quot;get_list_of_files_in_dir.php&quot;;
+  var url = &quot;&quot;;
+  url += thisDirectory + '/' + pathToPhpFileFromWindowLocation + 
+            &quot;?dir=&quot; + dirNameRelativeToPhpFile;
+  if (suffix) {
+    url += &quot;&amp;suffix=&quot; + suffix;
+  }
+  newXMLHttpRequestObject.open(&quot;GET&quot;, url, false);
+  newXMLHttpRequestObject.send(null);
+  return newXMLHttpRequestObject.responseText;
+};
+
+orp.storage._getDirListFromMozillaComponent = function(pathToDirectory, suffix) {
+  var dirList = [];
+  var dirPath = pathToDirectory;
+  netscape.security.PrivilegeManager.enablePrivilege(&quot;UniversalXPConnect&quot;);
+  var file = Components.classes[&quot;@mozilla.org/file/local;1&quot;].createInstance(Components.interfaces.nsILocalFile);
+  file.initWithPath(dirPath);
+  if (!file.exists()) {
+    throw new Error(dirPath + &quot; not found.&quot;);
+  }
+  if (!file.isDirectory()) {
+    throw new Error(dirPath + &quot; is not a directory.&quot;);
+  }
+  // file is the given directory (nsIFile)
+  var entries = file.directoryEntries;
+  while(entries.hasMoreElements()) {
+    var entry = entries.getNext();
+    entry.QueryInterface(Components.interfaces.nsIFile);
+    if (suffix) {
+      var parts = entry.leafName.split('.');
+      if (parts.length != 2 || parts[1] != suffix) {
+        continue;
+      }
+    }
+    dirList.push(entry.leafName); // could be entry.path instead, if needed...
+  }
+  return dirList;
+};
+
+// -------------------------------------------------------------------
+// End of file
+// -------------------------------------------------------------------

Added: trunk/source/storage/httpProtocolUtil.js
===================================================================
--- trunk/source/storage/httpProtocolUtil.js	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/source/storage/httpProtocolUtil.js	2005-11-01 05:23:19 UTC (rev 371)
@@ -0,0 +1,47 @@
+/*****************************************************************************
+ httpProtocolUtil.js
+ 
+******************************************************************************
+ Written in 2005 by 
+    Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
+  
+ Copyright rights relinquished under the Creative Commons  
+ Public Domain Dedication:
+    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
+  
+ You can copy freely from this file.  This work may be freely reproduced, 
+ distributed, transmitted, used, modified, built upon, or otherwise exploited
+ by anyone for any purpose.
+  
+ This work is provided on an &quot;AS IS&quot; basis, without warranties or conditions 
+ of any kind, either express or implied, including, without limitation, any 
+ warranties or conditions of title, non-infringement, merchantability, or 
+ fitness for a particular purpose. You are solely responsible for determining 
+ the appropriateness of using or distributing the work and assume all risks 
+ associated with use of this work, including but not limited to the risks and 
+ costs of errors, compliance with applicable laws, damage to or loss of data 
+ or equipment, and unavailability or interruption of operations.
+
+ In no event shall the authors or contributors have any liability for any 
+ direct, indirect, incidental, special, exemplary, or consequential damages,
+ however caused and on any theory of liability, whether in contract, strict 
+ liability, or tort (including negligence), arising in any way out of or in 
+ connection with the use or distribution of the work.
+*****************************************************************************/
+
+
+// -------------------------------------------------------------------
+// Provides and Requires
+// -------------------------------------------------------------------
+dojo.provide(&quot;orp.storage.httpProtocolUtil&quot;);
+
+
+// -------------------------------------------------------------------
+// Public constants
+// -------------------------------------------------------------------
+orp.storage.httpProtocolUtil.PATH_TO_PHP_FILES_FROM_TRUNK = &quot;source/storage&quot;;
+
+
+// -------------------------------------------------------------------
+// End of file
+// -------------------------------------------------------------------

Modified: trunk/source/util/Util.js
===================================================================
--- trunk/source/util/Util.js	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/source/util/Util.js	2005-11-01 05:23:19 UTC (rev 371)
@@ -212,8 +212,15 @@
 };
 
 orp.util.hasNoUnexpectedProperties = function(object, expectedProperties) {
-  for (var key in object) {
-    if (!orp.util.isObjectInSet(key, expectedProperties)) { return false; }
+  var key;
+  if (dojo.lang.isArray(expectedProperties)) {
+    for (key in object) {
+      if (!orp.util.isObjectInSet(key, expectedProperties)) { return false; }
+    }
+  } else {
+    for (key in object) {
+      if (!orp.util.hasProperty(expectedProperties, key)) { return false; }
+    }
   }
   return true;
 };

Modified: trunk/source/util/XmlConverter.js
===================================================================
--- trunk/source/util/XmlConverter.js	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/source/util/XmlConverter.js	2005-11-01 05:23:19 UTC (rev 371)
@@ -315,11 +315,17 @@
   if (level == maxLevel) {
     if (node.childNodes &amp;&amp; node.childNodes.length &gt; 0 &amp;&amp; node.childNodes[0].nodeType == Node.TEXT_NODE) {
       value = this._world.transformValueToExpectedType(node.childNodes[0].nodeValue, xmlToAttributeSpecifier._listOfTypes);
+      newItem.addEntry({
+        attribute: xmlToAttributeSpecifier._attribute, 
+        value: value,
+        inverseAttribute: xmlToAttributeSpecifier._inverseAttribute });
+/*
       if (xmlToAttributeSpecifier._inverseAttribute) {
         newItem.addConnectionEntry(xmlToAttributeSpecifier._attribute, value, xmlToAttributeSpecifier._inverseAttribute);
       } else {
         newItem.addEntry({attribute:xmlToAttributeSpecifier._attribute, value:value});
       }
+*/
     }
     return;
   }

Modified: trunk/source/view/NavbarView.js
===================================================================
--- trunk/source/view/NavbarView.js	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/source/view/NavbarView.js	2005-11-01 05:23:19 UTC (rev 371)
@@ -238,6 +238,14 @@
   newPageButton.value = &quot;New Page&quot;;
   dojo.event.connect(newPageButton, &quot;onclick&quot;, this, &quot;_clickOnNewPageButton&quot;);
 
+  var FIXME_OCT_19_2005_EXPERIMENT = false;
+  if (FIXME_OCT_19_2005_EXPERIMENT) {
+    var getTrunkButton = orp.view.View.appendNewElement(divElement, &quot;input&quot;);
+    getTrunkButton.type = &quot;button&quot;;
+    getTrunkButton.value = &quot;getBaseScriptUri()&quot;;
+    dojo.event.connect(getTrunkButton, &quot;onclick&quot;, this, &quot;getBaseScriptUri&quot;);
+  }
+
   var FIXME_OCT_14_2005_EXPERIMENT = false;
   if (FIXME_OCT_14_2005_EXPERIMENT) {
     var stage = this;
@@ -272,24 +280,31 @@
 
 };
 
+var FIXME_OCT_19_2005_EXPERIMENT = false;
+if (FIXME_OCT_19_2005_EXPERIMENT) {
+  orp.view.NavbarView.prototype.getBaseScriptUri = function(event) {
+    alert(window.location.pathname + &quot;\n&quot; + dojo.hostenv.getBaseScriptUri());
+  };
+}
+
 var FIXME_OCT_14_2005_EXPERIMENT = false;
 if (FIXME_OCT_14_2005_EXPERIMENT) {
-orp.view.NavbarView.prototype.plusMuppet = function(event) {
-  alert(event.target.muppetName);
-  delete event.target.muppetName;
-  dojo.event.disconnect(window.kermitButton, &quot;onclick&quot;, this, &quot;plusMuppet&quot;);
-};
-
-orp.view.NavbarView.prototype.addMuppet = function(muppetName) {
-  muppetName = muppetName || &quot;nobody :-(&quot;;
-  alert(muppetName);
-};
-
-orp.view.NavbarView.prototype.addMuppetEvent = function(event, muppetName) {
+  orp.view.NavbarView.prototype.plusMuppet = function(event) {
+    alert(event.target.muppetName);
+    delete event.target.muppetName;
+    dojo.event.disconnect(window.kermitButton, &quot;onclick&quot;, this, &quot;plusMuppet&quot;);
+  };
   
-  muppetName = muppetName || &quot;nobody :-(&quot;;
-  alert(event.target.orp_name);
-};
+  orp.view.NavbarView.prototype.addMuppet = function(muppetName) {
+    muppetName = muppetName || &quot;nobody :-(&quot;;
+    alert(muppetName);
+  };
+  
+  orp.view.NavbarView.prototype.addMuppetEvent = function(event, muppetName) {
+    
+    muppetName = muppetName || &quot;nobody :-(&quot;;
+    alert(event.target.orp_name);
+  };
 }
 
 // -------------------------------------------------------------------

Modified: trunk/source/view/SectionView.js
===================================================================
--- trunk/source/view/SectionView.js	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/source/view/SectionView.js	2005-11-01 05:23:19 UTC (rev 371)
@@ -454,11 +454,16 @@
     this._pluginView = this.getPluginInstanceFromPluginItem(newPluginViewItem, this._pluginDiv);
 
     var oldEntry = this._section.getSingleEntryFromAttribute(attributeCalledPluginView);
-    if (oldEntry) {
+    this._section.addEntry({
+      previousEntry:oldEntry, 
+      attribute:attributeCalledPluginView, 
+      value:newPluginViewItem});
+/*  if (oldEntry) {
       this._section.replaceEntry({previousEntry:oldEntry, value:newPluginViewItem});
     } else {
       this._section.addEntry({attribute:attributeCalledPluginView, value:newPluginViewItem});
     }
+*/
     this.refresh();
   }
 };
@@ -486,20 +491,26 @@
   var attributeCalledQueryMatchingAttribute = this.getWorld().getAttributeCalledQueryMatchingAttribute();
   var listOfMatchingAttrs = myQuery.getEntriesForAttribute(attributeCalledQueryMatchingAttribute);
   var matchingAttribute;
+  var entryToBeReplaced = null;
   if (listOfMatchingAttrs.length === 0) {
     // by default matching attribute is category
     matchingAttribute = this.getWorld().getAttributeCalledCategory();
-  }
-  else {
+  } else {
     orp.lang.assert(listOfMatchingAttrs.length == 1, 'more than one matching attributes');
+    entryToBeReplaced = listOfMatchingAttrs[0];
     matchingAttribute = listOfMatchingAttrs[0].getValue();
   }
   if (matchingAttribute.getDisplayString() != newChoiceName) {
-    if (listOfMatchingAttrs.length === 0) {
+      myQuery.addEntry({
+        previousEntry:entryToBeReplaced, 
+        attribute:attributeCalledQueryMatchingAttribute, 
+        value:newQueryMatchingAttribute});
+/*  if (listOfMatchingAttrs.length === 0) {
       myQuery.addEntry({attribute:attributeCalledQueryMatchingAttribute, value:newQueryMatchingAttribute});
     } else {
-      myQuery.replaceEntry({previousEntry:listOfMatchingAttrs[0], value:newQueryMatchingAttribute});
+      myQuery.replaceEntry({previousEntry:entryToBeReplaced, value:newQueryMatchingAttribute});
     }
+*/
 
     /* PENDING, PROBLEM to check Can't delete entries already created by previous matching attribute */
     var attributeCalledQueryMatchingValue = this.getWorld().getAttributeCalledQueryMatchingValue();

Modified: trunk/tests/TestSuite.html
===================================================================
--- trunk/tests/TestSuite.html	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/tests/TestSuite.html	2005-11-01 05:23:19 UTC (rev 371)
@@ -25,12 +25,12 @@
         var testSuite = new window.top.jsUnitTestSuite();
         testSuite.addTestPage(&quot;../../../tests/SimpleTest.html&quot;);
         testSuite.addTestPage(&quot;../../../tests/dojo/SimpleDojoTest.html&quot;);
-        testSuite.addTestPage(&quot;../../../tests/dom/domTest.html&quot;);
+        testSuite.addTestPage(&quot;../../../tests/dom/test_dom.html&quot;);
         testSuite.addTestPage(&quot;../../../tests/lang/LangTest.html&quot;);
         testSuite.addTestPage(&quot;../../../tests/util/TestSuite.html&quot;);
         testSuite.addTestPage(&quot;../../../tests/uuid/TestSuite.html&quot;);
         testSuite.addTestPage(&quot;../../../tests/model/TestSuite.html&quot;);
-        testSuite.addTestPage(&quot;../../../tests/archive/LintTest.html&quot;);
+        testSuite.addTestPage(&quot;../../../tests/archive/TestSuite.html&quot;);
         testSuite.addTestPage(&quot;../../../tests/storage/TestSuite.html&quot;);
         testSuite.addTestPage(&quot;../../../tests/view/LintTest.html&quot;);
         testSuite.addTestPage(&quot;../../../tests/LintTest.html&quot;);

Added: trunk/tests/archive/TestSuite.html
===================================================================
--- trunk/tests/archive/TestSuite.html	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/tests/archive/TestSuite.html	2005-11-01 05:23:19 UTC (rev 371)
@@ -0,0 +1,88 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
+&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.1//EN&quot; &quot;<A HREF="http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd</A>&quot;&gt;
+&lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot; xml:lang=&quot;en&quot; &gt;
+
+&lt;!-- 
+ Written in 2005 by Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
+  
+ Copyright rights relinquished under the Creative Commons  
+ Public Domain Dedication:
+    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
+--&gt;
+
+  &lt;head&gt;
+    &lt;title&gt;orp.archive Test Suite&lt;/title&gt;
+
+    &lt;script type=&quot;text/javascript&quot; src=&quot;../../third_party/jsunit/jsunit2_1/app/jsUnitCore.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot;&gt;
+      function suite() {
+        var testSuite = new window.top.jsUnitTestSuite();
+        testSuite.addTestSuite(utilTestSuite());
+        return testSuite;
+      }
+      
+      function utilTestSuite() {
+        var testSuite = new window.top.jsUnitTestSuite();
+        testSuite.addTestPage(&quot;../../../tests/archive/LintTest.html&quot;);
+        testSuite.addTestPage(&quot;../../../tests/archive/test_dependencies.html&quot;);
+        return testSuite;
+      }
+    &lt;/script&gt;
+  &lt;/head&gt;
+  
+  &lt;body&gt;
+    &lt;h1&gt;UUID Test Suite&lt;/h1&gt;
+
+    &lt;p&gt;This page is used to run unit tests for the JavaScript code in the 
+    OpenRecord project.&lt;/p&gt;
+    
+    &lt;p&gt;&nbsp;&lt;/p&gt;
+    &lt;hr/&gt;
+    &lt;p&gt;You should be able to run these unit tests by going to
+    &lt;a href=&quot;../../third_party/jsunit/jsunit2_1/testRunner.html?testpage=&quot; 
+    onclick=&quot;href+=window.location.href;&quot; rel=&quot;external&quot;&gt;the local testRunner 
+    page&lt;/a&gt;, and hitting the &lt;b&gt;Run&lt;/b&gt; button.&lt;/p&gt;
+
+    &lt;p&gt;To see the tests, open this .html file in a text editor. Or, within a  
+    web browser, you should be able see the source for this file by using 
+    some menu like &lt;b&gt;View&lt;/b&gt; followed by &lt;b&gt;Page Source&lt;/b&gt;. The tests 
+    may be in this file, or they may be in a separate file that has the
+    same name as this one, except with a .js extension instead of a .html
+    extension.&lt;/p&gt;
+ 
+    &lt;p&gt;The unit tests are set up to run in the
+    &lt;a href=&quot;<A HREF="http://www.edwardh.com/jsunit/">http://www.edwardh.com/jsunit/</A>&quot; rel=&quot;external&quot;&gt;JsUnit framework&lt;/a&gt;
+    written by 
+    &lt;a href=&quot;<A HREF="http://www.edwardh.com/">http://www.edwardh.com/</A>&quot; rel=&quot;external&quot;&gt;Edward Hieatt&lt;/a&gt;. &lt;/p&gt;
+
+    &lt;p&gt;&nbsp;&lt;/p&gt;
+    &lt;hr/&gt;
+    &lt;p class=&quot;copyright&quot;&gt;You can copy freely from this work &mdash; copyright 
+    rights relinquished under the Creative Commons  
+    &lt;a rel=&quot;license external&quot; 
+    href=&quot;<A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>&quot;&gt;Public Domain 
+    Dedication&lt;/a&gt;.&lt;/p&gt;
+
+&lt;!-- Creative Commons metadata for Public Domain License 
+
+&lt;rdf:RDF xmlns=&quot;<A HREF="http://web.resource.org/cc/">http://web.resource.org/cc/</A>&quot;
+    xmlns:dc=&quot;<A HREF="http://purl.org/dc/elements/1.1/">http://purl.org/dc/elements/1.1/</A>&quot;
+    xmlns:rdf=&quot;<A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#">http://www.w3.org/1999/02/22-rdf-syntax-ns#</A>&quot;&gt;
+&lt;Work rdf:about=&quot;&quot;&gt;
+   &lt;dc:title&gt;openrecord.org&lt;/dc:title&gt;
+   &lt;dc:type rdf:resource=&quot;<A HREF="http://purl.org/dc/dcmitype/Text">http://purl.org/dc/dcmitype/Text</A>&quot; /&gt;
+   &lt;license rdf:resource=&quot;<A HREF="http://web.resource.org/cc/PublicDomain">http://web.resource.org/cc/PublicDomain</A>&quot; /&gt;
+&lt;/Work&gt;
+
+&lt;License rdf:about=&quot;<A HREF="http://web.resource.org/cc/PublicDomain">http://web.resource.org/cc/PublicDomain</A>&quot;&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Reproduction">http://web.resource.org/cc/Reproduction</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Distribution">http://web.resource.org/cc/Distribution</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/DerivativeWorks">http://web.resource.org/cc/DerivativeWorks</A>&quot; /&gt;
+&lt;/License&gt;
+
+&lt;/rdf:RDF&gt;
+
+--&gt;
+  &lt;/body&gt;
+&lt;/html&gt;
+

Added: trunk/tests/archive/test_dependencies.html
===================================================================
--- trunk/tests/archive/test_dependencies.html	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/tests/archive/test_dependencies.html	2005-11-01 05:23:19 UTC (rev 371)
@@ -0,0 +1,76 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
+&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.1//EN&quot; &quot;<A HREF="http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd</A>&quot;&gt;
+&lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot; xml:lang=&quot;en&quot; &gt;
+
+&lt;!-- 
+ Written in 2005 by Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
+  
+ Copyright rights relinquished under the Creative Commons  
+ Public Domain Dedication:
+    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
+--&gt;
+
+  &lt;head&gt;
+    &lt;title&gt;Dependency tests for the orp.archive package&lt;/title&gt;
+
+    &lt;script type=&quot;text/javascript&quot; src=&quot;../../third_party/jsunit/jsunit2_1/app/jsUnitCore.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;../../third_party/dojo/dojo-rev1759/dojo.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;test_dependencies.js&quot;&gt;&lt;/script&gt;
+  &lt;/head&gt;
+  
+  &lt;body&gt;
+    &lt;h1&gt;Dependency tests for the orp.archive package&lt;/h1&gt;
+
+    &lt;p&gt;This page is used to run unit tests for the JavaScript code in the 
+    OpenRecord project.&lt;/p&gt;
+    
+    &lt;p&gt;&nbsp;&lt;/p&gt;
+    &lt;hr/&gt;
+    &lt;p&gt;You should be able to run these unit tests by going to
+    &lt;a href=&quot;../../third_party/jsunit/jsunit2_1/testRunner.html?testpage=&quot; 
+    onclick=&quot;href+=window.location.href;&quot; rel=&quot;external&quot;&gt;the local testRunner 
+    page&lt;/a&gt;, and hitting the &lt;b&gt;Run&lt;/b&gt; button. &lt;/p&gt;
+
+    &lt;p&gt;To see the tests, open this .html file in a text editor. Or, within a  
+    web browser, you should be able see the source for this file by using 
+    some menu like &lt;b&gt;View&lt;/b&gt; followed by &lt;b&gt;Page Source&lt;/b&gt;. The tests 
+    may be in this file, or they may be in a separate file that has the
+    same name as this one, except with a .js extension instead of a .html
+    extension.&lt;/p&gt;
+ 
+    &lt;p&gt;The unit tests are set up to run in the
+    &lt;a href=&quot;<A HREF="http://www.edwardh.com/jsunit/">http://www.edwardh.com/jsunit/</A>&quot; rel=&quot;external&quot;&gt;JsUnit framework&lt;/a&gt;
+    written by 
+    &lt;a href=&quot;<A HREF="http://www.edwardh.com/">http://www.edwardh.com/</A>&quot; rel=&quot;external&quot;&gt;Edward Hieatt&lt;/a&gt;. &lt;/p&gt;
+
+    &lt;p&gt;&nbsp;&lt;/p&gt;
+    &lt;hr/&gt;
+    &lt;p class=&quot;copyright&quot;&gt;You can copy freely from this work &mdash; copyright 
+    rights relinquished under the Creative Commons  
+    &lt;a rel=&quot;license external&quot; 
+    href=&quot;<A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>&quot;&gt;Public Domain 
+    Dedication&lt;/a&gt;.&lt;/p&gt;
+
+&lt;!-- Creative Commons metadata for Public Domain License 
+
+&lt;rdf:RDF xmlns=&quot;<A HREF="http://web.resource.org/cc/">http://web.resource.org/cc/</A>&quot;
+    xmlns:dc=&quot;<A HREF="http://purl.org/dc/elements/1.1/">http://purl.org/dc/elements/1.1/</A>&quot;
+    xmlns:rdf=&quot;<A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#">http://www.w3.org/1999/02/22-rdf-syntax-ns#</A>&quot;&gt;
+&lt;Work rdf:about=&quot;&quot;&gt;
+   &lt;dc:title&gt;openrecord.org&lt;/dc:title&gt;
+   &lt;dc:type rdf:resource=&quot;<A HREF="http://purl.org/dc/dcmitype/Text">http://purl.org/dc/dcmitype/Text</A>&quot; /&gt;
+   &lt;license rdf:resource=&quot;<A HREF="http://web.resource.org/cc/PublicDomain">http://web.resource.org/cc/PublicDomain</A>&quot; /&gt;
+&lt;/Work&gt;
+
+&lt;License rdf:about=&quot;<A HREF="http://web.resource.org/cc/PublicDomain">http://web.resource.org/cc/PublicDomain</A>&quot;&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Reproduction">http://web.resource.org/cc/Reproduction</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Distribution">http://web.resource.org/cc/Distribution</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/DerivativeWorks">http://web.resource.org/cc/DerivativeWorks</A>&quot; /&gt;
+&lt;/License&gt;
+
+&lt;/rdf:RDF&gt;
+
+--&gt;
+  &lt;/body&gt;
+&lt;/html&gt;
+

Added: trunk/tests/archive/test_dependencies.js
===================================================================
--- trunk/tests/archive/test_dependencies.js	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/tests/archive/test_dependencies.js	2005-11-01 05:23:19 UTC (rev 371)
@@ -0,0 +1,62 @@
+/*****************************************************************************
+ test_dependencies.js
+ 
+******************************************************************************
+ Written in 2005 by 
+    Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
+  
+ Copyright rights relinquished under the Creative Commons  
+ Public Domain Dedication:
+    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
+  
+ You can copy freely from this file.  This work may be freely reproduced, 
+ distributed, transmitted, used, modified, built upon, or otherwise exploited
+ by anyone for any purpose.
+  
+ This work is provided on an &quot;AS IS&quot; basis, without warranties or conditions 
+ of any kind, either express or implied, including, without limitation, any 
+ warranties or conditions of title, non-infringement, merchantability, or 
+ fitness for a particular purpose. You are solely responsible for determining 
+ the appropriateness of using or distributing the work and assume all risks 
+ associated with use of this work, including but not limited to the risks and 
+ costs of errors, compliance with applicable laws, damage to or loss of data 
+ or equipment, and unavailability or interruption of operations.
+
+ In no event shall the authors or contributors have any liability for any 
+ direct, indirect, incidental, special, exemplary, or consequential damages,
+ however caused and on any theory of liability, whether in contract, strict 
+ liability, or tort (including negligence), arising in any way out of or in 
+ connection with the use or distribution of the work.
+*****************************************************************************/
+ 
+
+// -------------------------------------------------------------------
+// setUp and tearDown
+// -------------------------------------------------------------------
+
+function setUp() {
+  dojo.hostenv.setModulePrefix(&quot;dojo&quot;, &quot;../../../dojo/dojo-rev1759/src&quot;);
+  dojo.hostenv.setModulePrefix(&quot;orp&quot;, &quot;../../../../source&quot;);
+  dojo.require(&quot;orp.archive.JsonFormat&quot;);
+  dojo.require(&quot;orp.archive.JsonSerializer&quot;);
+  dojo.require(&quot;orp.archive.JsonDeserializer&quot;);
+  dojo.require(&quot;orp.archive.StubArchive&quot;);
+  dojo.require(&quot;orp.archive.DeltaArchive&quot;);
+  dojo.require(&quot;orp.archive.TextEncoding&quot;);
+}
+
+function tearDown() {
+}
+
+
+// -------------------------------------------------------------------
+// Test functions
+// -------------------------------------------------------------------
+
+function testDependencies() {
+  assertTrue(&quot;orp.archive depends only on lang, util, uuid, model, and storage&quot;, orp.util.hasExactlyTheseProperties(orp, [&quot;archive&quot;, &quot;lang&quot;, &quot;util&quot;, &quot;uuid&quot;, &quot;model&quot;, &quot;storage&quot;]));
+}
+
+// -------------------------------------------------------------------
+// End of file
+// -------------------------------------------------------------------

Deleted: trunk/tests/dom/domTest.html
===================================================================
--- trunk/tests/dom/domTest.html	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/tests/dom/domTest.html	2005-11-01 05:23:19 UTC (rev 371)
@@ -1,76 +0,0 @@
-&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
-&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.1//EN&quot; &quot;<A HREF="http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd</A>&quot;&gt;
-&lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot; xml:lang=&quot;en&quot; &gt;
-
-&lt;!-- 
- Written in 2005 by Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
-  
- Copyright rights relinquished under the Creative Commons  
- Public Domain Dedication:
-    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
---&gt;
-
-  &lt;head&gt;
-    &lt;title&gt;Unit tests for orp.dom&lt;/title&gt;
-
-    &lt;script type=&quot;text/javascript&quot; src=&quot;../../third_party/jsunit/jsunit2_1/app/jsUnitCore.js&quot;&gt;&lt;/script&gt;
-    &lt;script type=&quot;text/javascript&quot; src=&quot;../../third_party/dojo/dojo-rev1759/dojo.js&quot;&gt;&lt;/script&gt;
-    &lt;script type=&quot;text/javascript&quot; src=&quot;domTest.js&quot;&gt;&lt;/script&gt;
-  &lt;/head&gt;
-  
-  &lt;body&gt;
-    &lt;h1&gt;Unit tests for orp.dom&lt;/h1&gt;
-
-    &lt;p&gt;This page is used to run unit tests for the JavaScript code in the 
-    OpenRecord project.&lt;/p&gt;
-    
-    &lt;p&gt;&nbsp;&lt;/p&gt;
-    &lt;hr/&gt;
-    &lt;p&gt;You should be able to run these unit tests by going to
-    &lt;a href=&quot;../../third_party/jsunit/jsunit2_1/testRunner.html?testpage=&quot; 
-    onclick=&quot;href+=window.location.href;&quot; rel=&quot;external&quot;&gt;the local testRunner 
-    page&lt;/a&gt;, and hitting the &lt;b&gt;Run&lt;/b&gt; button. &lt;/p&gt;
-
-    &lt;p&gt;To see the tests, open this .html file in a text editor. Or, within a  
-    web browser, you should be able see the source for this file by using 
-    some menu like &lt;b&gt;View&lt;/b&gt; followed by &lt;b&gt;Page Source&lt;/b&gt;. The tests 
-    may be in this file, or they may be in a separate file that has the
-    same name as this one, except with a .js extension instead of a .html
-    extension.&lt;/p&gt;
- 
-    &lt;p&gt;The unit tests are set up to run in the
-    &lt;a href=&quot;<A HREF="http://www.edwardh.com/jsunit/">http://www.edwardh.com/jsunit/</A>&quot; rel=&quot;external&quot;&gt;JsUnit framework&lt;/a&gt;
-    written by 
-    &lt;a href=&quot;<A HREF="http://www.edwardh.com/">http://www.edwardh.com/</A>&quot; rel=&quot;external&quot;&gt;Edward Hieatt&lt;/a&gt;. &lt;/p&gt;
-
-    &lt;p&gt;&nbsp;&lt;/p&gt;
-    &lt;hr/&gt;
-    &lt;p class=&quot;copyright&quot;&gt;You can copy freely from this work &mdash; copyright 
-    rights relinquished under the Creative Commons  
-    &lt;a rel=&quot;license external&quot; 
-    href=&quot;<A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>&quot;&gt;Public Domain 
-    Dedication&lt;/a&gt;.&lt;/p&gt;
-
-&lt;!-- Creative Commons metadata for Public Domain License 
-
-&lt;rdf:RDF xmlns=&quot;<A HREF="http://web.resource.org/cc/">http://web.resource.org/cc/</A>&quot;
-    xmlns:dc=&quot;<A HREF="http://purl.org/dc/elements/1.1/">http://purl.org/dc/elements/1.1/</A>&quot;
-    xmlns:rdf=&quot;<A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#">http://www.w3.org/1999/02/22-rdf-syntax-ns#</A>&quot;&gt;
-&lt;Work rdf:about=&quot;&quot;&gt;
-   &lt;dc:title&gt;openrecord.org&lt;/dc:title&gt;
-   &lt;dc:type rdf:resource=&quot;<A HREF="http://purl.org/dc/dcmitype/Text">http://purl.org/dc/dcmitype/Text</A>&quot; /&gt;
-   &lt;license rdf:resource=&quot;<A HREF="http://web.resource.org/cc/PublicDomain">http://web.resource.org/cc/PublicDomain</A>&quot; /&gt;
-&lt;/Work&gt;
-
-&lt;License rdf:about=&quot;<A HREF="http://web.resource.org/cc/PublicDomain">http://web.resource.org/cc/PublicDomain</A>&quot;&gt;
-   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Reproduction">http://web.resource.org/cc/Reproduction</A>&quot; /&gt;
-   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Distribution">http://web.resource.org/cc/Distribution</A>&quot; /&gt;
-   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/DerivativeWorks">http://web.resource.org/cc/DerivativeWorks</A>&quot; /&gt;
-&lt;/License&gt;
-
-&lt;/rdf:RDF&gt;
-
---&gt;
-  &lt;/body&gt;
-&lt;/html&gt;
-

Deleted: trunk/tests/dom/domTest.js
===================================================================
--- trunk/tests/dom/domTest.js	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/tests/dom/domTest.js	2005-11-01 05:23:19 UTC (rev 371)
@@ -1,79 +0,0 @@
-/*****************************************************************************
- domTest.js
- 
-******************************************************************************
- Written in 2005 by Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
-  
- Copyright rights relinquished under the Creative Commons  
- Public Domain Dedication:
-    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
-  
- You can copy freely from this file.  This work may be freely reproduced, 
- distributed, transmitted, used, modified, built upon, or otherwise exploited
- by anyone for any purpose.
-  
- This work is provided on an &quot;AS IS&quot; basis, without warranties or conditions 
- of any kind, either express or implied, including, without limitation, any 
- warranties or conditions of title, non-infringement, merchantability, or 
- fitness for a particular purpose. You are solely responsible for determining 
- the appropriateness of using or distributing the work and assume all risks 
- associated with use of this work, including but not limited to the risks and 
- costs of errors, compliance with applicable laws, damage to or loss of data 
- or equipment, and unavailability or interruption of operations.
-
- In no event shall the authors or contributors have any liability for any 
- direct, indirect, incidental, special, exemplary, or consequential damages,
- however caused and on any theory of liability, whether in contract, strict 
- liability, or tort (including negligence), arising in any way out of or in 
- connection with the use or distribution of the work.
-*****************************************************************************/
- 
-
-// -------------------------------------------------------------------
-// setUp and tearDown
-// -------------------------------------------------------------------
-
-function setUp() {
-  dojo.hostenv.setModulePrefix(&quot;dojo&quot;, &quot;../../../dojo/dojo-rev1759/src&quot;);
-  dojo.hostenv.setModulePrefix(&quot;orp&quot;, &quot;../../../../source&quot;);
-  dojo.require(&quot;orp.dom&quot;);
-}
-
-function tearDown() {
-}
-
-
-// -------------------------------------------------------------------
-// Test functions
-// -------------------------------------------------------------------
-
-function testSimpleErrorCatching() {
-  divElementOne = window.document.createElement('div');
-  divElementTwo = window.document.createElement('div');
-  
-  document.body.appendChild(divElementOne);
-  document.body.appendChild(divElementTwo);
-  
-  orp.dom.setKeywordValueForElement(divElementOne, &quot;foo&quot;, 34);
-  var fooValueOne = orp.dom.getKeywordValueForElement(divElementOne, &quot;foo&quot;);
-  var fooValueTwo = orp.dom.getKeywordValueForElement(divElementTwo, &quot;foo&quot;);
- 
-  assertTrue('divElementOne has a &quot;foo&quot; value of 34', (fooValueOne === 34));
-  assertTrue('divElementTwo does not have a &quot;foo&quot; value', (fooValueTwo === null));
-
-  var barValueOne = {a: 1, b: 2};
-  var barValueTwo = &quot;Kermit the Frog&quot;;
-  orp.dom.setKeywordValueForElement(divElementOne, &quot;bar&quot;, barValueOne);
-  orp.dom.setKeywordValueForElement(divElementTwo, &quot;bar&quot;, barValueTwo);
-  
-  var barOneToo = orp.dom.getKeywordValueForElement(divElementOne, &quot;bar&quot;);
-  var barTwoToo = orp.dom.getKeywordValueForElement(divElementTwo, &quot;bar&quot;);
-  
-  assertTrue('divElementOne has a &quot;foo&quot; value of 34', (barValueOne === barOneToo));
-  assertTrue('divElementTwo does not have a &quot;foo&quot; value', (barValueTwo === barTwoToo));
-
-}
-
-// -------------------------------------------------------------------
-// End of file
-// -------------------------------------------------------------------

Copied: trunk/tests/dom/test_dom.html (from rev 364, trunk/tests/dom/domTest.html)
===================================================================
--- trunk/tests/dom/domTest.html	2005-10-18 02:15:08 UTC (rev 364)
+++ trunk/tests/dom/test_dom.html	2005-11-01 05:23:19 UTC (rev 371)
@@ -0,0 +1,76 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
+&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.1//EN&quot; &quot;<A HREF="http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd</A>&quot;&gt;
+&lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot; xml:lang=&quot;en&quot; &gt;
+
+&lt;!-- 
+ Written in 2005 by Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
+  
+ Copyright rights relinquished under the Creative Commons  
+ Public Domain Dedication:
+    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
+--&gt;
+
+  &lt;head&gt;
+    &lt;title&gt;Unit tests for orp.dom&lt;/title&gt;
+
+    &lt;script type=&quot;text/javascript&quot; src=&quot;../../third_party/jsunit/jsunit2_1/app/jsUnitCore.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;../../third_party/dojo/dojo-rev1759/dojo.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;test_dom.js&quot;&gt;&lt;/script&gt;
+  &lt;/head&gt;
+  
+  &lt;body&gt;
+    &lt;h1&gt;Unit tests for orp.dom&lt;/h1&gt;
+
+    &lt;p&gt;This page is used to run unit tests for the JavaScript code in the 
+    OpenRecord project.&lt;/p&gt;
+    
+    &lt;p&gt;&nbsp;&lt;/p&gt;
+    &lt;hr/&gt;
+    &lt;p&gt;You should be able to run these unit tests by going to
+    &lt;a href=&quot;../../third_party/jsunit/jsunit2_1/testRunner.html?testpage=&quot; 
+    onclick=&quot;href+=window.location.href;&quot; rel=&quot;external&quot;&gt;the local testRunner 
+    page&lt;/a&gt;, and hitting the &lt;b&gt;Run&lt;/b&gt; button. &lt;/p&gt;
+
+    &lt;p&gt;To see the tests, open this .html file in a text editor. Or, within a  
+    web browser, you should be able see the source for this file by using 
+    some menu like &lt;b&gt;View&lt;/b&gt; followed by &lt;b&gt;Page Source&lt;/b&gt;. The tests 
+    may be in this file, or they may be in a separate file that has the
+    same name as this one, except with a .js extension instead of a .html
+    extension.&lt;/p&gt;
+ 
+    &lt;p&gt;The unit tests are set up to run in the
+    &lt;a href=&quot;<A HREF="http://www.edwardh.com/jsunit/">http://www.edwardh.com/jsunit/</A>&quot; rel=&quot;external&quot;&gt;JsUnit framework&lt;/a&gt;
+    written by 
+    &lt;a href=&quot;<A HREF="http://www.edwardh.com/">http://www.edwardh.com/</A>&quot; rel=&quot;external&quot;&gt;Edward Hieatt&lt;/a&gt;. &lt;/p&gt;
+
+    &lt;p&gt;&nbsp;&lt;/p&gt;
+    &lt;hr/&gt;
+    &lt;p class=&quot;copyright&quot;&gt;You can copy freely from this work &mdash; copyright 
+    rights relinquished under the Creative Commons  
+    &lt;a rel=&quot;license external&quot; 
+    href=&quot;<A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>&quot;&gt;Public Domain 
+    Dedication&lt;/a&gt;.&lt;/p&gt;
+
+&lt;!-- Creative Commons metadata for Public Domain License 
+
+&lt;rdf:RDF xmlns=&quot;<A HREF="http://web.resource.org/cc/">http://web.resource.org/cc/</A>&quot;
+    xmlns:dc=&quot;<A HREF="http://purl.org/dc/elements/1.1/">http://purl.org/dc/elements/1.1/</A>&quot;
+    xmlns:rdf=&quot;<A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#">http://www.w3.org/1999/02/22-rdf-syntax-ns#</A>&quot;&gt;
+&lt;Work rdf:about=&quot;&quot;&gt;
+   &lt;dc:title&gt;openrecord.org&lt;/dc:title&gt;
+   &lt;dc:type rdf:resource=&quot;<A HREF="http://purl.org/dc/dcmitype/Text">http://purl.org/dc/dcmitype/Text</A>&quot; /&gt;
+   &lt;license rdf:resource=&quot;<A HREF="http://web.resource.org/cc/PublicDomain">http://web.resource.org/cc/PublicDomain</A>&quot; /&gt;
+&lt;/Work&gt;
+
+&lt;License rdf:about=&quot;<A HREF="http://web.resource.org/cc/PublicDomain">http://web.resource.org/cc/PublicDomain</A>&quot;&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Reproduction">http://web.resource.org/cc/Reproduction</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Distribution">http://web.resource.org/cc/Distribution</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/DerivativeWorks">http://web.resource.org/cc/DerivativeWorks</A>&quot; /&gt;
+&lt;/License&gt;
+
+&lt;/rdf:RDF&gt;
+
+--&gt;
+  &lt;/body&gt;
+&lt;/html&gt;
+

Copied: trunk/tests/dom/test_dom.js (from rev 364, trunk/tests/dom/domTest.js)
===================================================================
--- trunk/tests/dom/domTest.js	2005-10-18 02:15:08 UTC (rev 364)
+++ trunk/tests/dom/test_dom.js	2005-11-01 05:23:19 UTC (rev 371)
@@ -0,0 +1,89 @@
+/*****************************************************************************
+ test_dom.js
+ 
+******************************************************************************
+ Written in 2005 by Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
+  
+ Copyright rights relinquished under the Creative Commons  
+ Public Domain Dedication:
+    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
+  
+ You can copy freely from this file.  This work may be freely reproduced, 
+ distributed, transmitted, used, modified, built upon, or otherwise exploited
+ by anyone for any purpose.
+  
+ This work is provided on an &quot;AS IS&quot; basis, without warranties or conditions 
+ of any kind, either express or implied, including, without limitation, any 
+ warranties or conditions of title, non-infringement, merchantability, or 
+ fitness for a particular purpose. You are solely responsible for determining 
+ the appropriateness of using or distributing the work and assume all risks 
+ associated with use of this work, including but not limited to the risks and 
+ costs of errors, compliance with applicable laws, damage to or loss of data 
+ or equipment, and unavailability or interruption of operations.
+
+ In no event shall the authors or contributors have any liability for any 
+ direct, indirect, incidental, special, exemplary, or consequential damages,
+ however caused and on any theory of liability, whether in contract, strict 
+ liability, or tort (including negligence), arising in any way out of or in 
+ connection with the use or distribution of the work.
+*****************************************************************************/
+ 
+
+// -------------------------------------------------------------------
+// setUp and tearDown
+// -------------------------------------------------------------------
+
+function setUp() {
+  dojo.hostenv.setModulePrefix(&quot;dojo&quot;, &quot;../../../dojo/dojo-rev1759/src&quot;);
+  dojo.hostenv.setModulePrefix(&quot;orp&quot;, &quot;../../../../source&quot;);
+  dojo.require(&quot;orp.dom&quot;);
+}
+
+function tearDown() {
+}
+
+
+// -------------------------------------------------------------------
+// Test functions
+// -------------------------------------------------------------------
+
+function testDependencies() {
+  assertTrue(&quot;orp.lang is defined&quot;, ((typeof orp.lang) === 'object'));
+  assertTrue(&quot;orp.dom is defined&quot;, ((typeof orp.dom) === 'object'));
+  var i = 0;  
+  for (var key in orp) {
+    ++i;
+  }
+  assertTrue(&quot;Only orp.lang and orp.dom are defined&quot;, (i === 2));
+}
+
+function testKeywordValueAccessors() {
+  divElementOne = window.document.createElement('div');
+  divElementTwo = window.document.createElement('div');
+  
+  document.body.appendChild(divElementOne);
+  document.body.appendChild(divElementTwo);
+  
+  orp.dom.setKeywordValueForElement(divElementOne, &quot;foo&quot;, 34);
+  var fooValueOne = orp.dom.getKeywordValueForElement(divElementOne, &quot;foo&quot;);
+  var fooValueTwo = orp.dom.getKeywordValueForElement(divElementTwo, &quot;foo&quot;);
+ 
+  assertTrue('divElementOne has a &quot;foo&quot; value of 34', (fooValueOne === 34));
+  assertTrue('divElementTwo does not have a &quot;foo&quot; value', (fooValueTwo === null));
+
+  var barValueOne = {a: 1, b: 2};
+  var barValueTwo = &quot;Kermit the Frog&quot;;
+  orp.dom.setKeywordValueForElement(divElementOne, &quot;bar&quot;, barValueOne);
+  orp.dom.setKeywordValueForElement(divElementTwo, &quot;bar&quot;, barValueTwo);
+  
+  var barOneToo = orp.dom.getKeywordValueForElement(divElementOne, &quot;bar&quot;);
+  var barTwoToo = orp.dom.getKeywordValueForElement(divElementTwo, &quot;bar&quot;);
+  
+  assertTrue('divElementOne has a &quot;foo&quot; value of 34', (barValueOne === barOneToo));
+  assertTrue('divElementTwo does not have a &quot;foo&quot; value', (barValueTwo === barTwoToo));
+
+}
+
+// -------------------------------------------------------------------
+// End of file
+// -------------------------------------------------------------------

Modified: trunk/tests/lang/LangTest.js
===================================================================
--- trunk/tests/lang/LangTest.js	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/tests/lang/LangTest.js	2005-11-01 05:23:19 UTC (rev 371)
@@ -47,6 +47,16 @@
 // Test functions
 // -------------------------------------------------------------------
 
+
+function testDependencies() {
+  assertTrue(&quot;orp.lang is defined&quot;, ((typeof orp.lang) === 'object'));
+  var i = 0;  
+  for (var key in orp) {
+    ++i;
+  }
+  assertTrue(&quot;Only orp.lang is defined&quot;, (i === 1));
+}
+
 function testSimpleErrorCatching() {
   var caughtError = false;
   try {
@@ -222,6 +232,7 @@
   assertTrue(&quot;Bind works with 1 argument.&quot;, (box.getVolume() == (1)) );  
 }
 
+
 // -------------------------------------------------------------------
 // Helper functions
 // -------------------------------------------------------------------

Modified: trunk/tests/model/ModelTest.js
===================================================================
--- trunk/tests/model/ModelTest.js	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/tests/model/ModelTest.js	2005-11-01 05:23:19 UTC (rev 371)
@@ -1,5 +1,5 @@
 /*****************************************************************************
- ModelTest.js
+ test_BeforeLogin.js
  
 ******************************************************************************
  Written in 2005 by Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
@@ -38,7 +38,6 @@
 // -------------------------------------------------------------------
 
 
-var ModelTestVars = null;
 var world;
 
 // -------------------------------------------------------------------
@@ -52,141 +51,20 @@
   dojo.require(&quot;orp.archive.StubArchive&quot;);
   dojo.require(&quot;orp.util.DateValue&quot;);
 
-  ModelTestVars = {};
-
   var pathToTrunkDirectory = &quot;../..&quot;;
   var stubArchive = new orp.archive.StubArchive(pathToTrunkDirectory);
   world = new orp.model.World(stubArchive);
 }
 
 function tearDown() {
-  ModelTestVars = null;
 }
 
 
 // -------------------------------------------------------------------
 // Test functions
 // -------------------------------------------------------------------
-
-function testUuids() {
-  var janesPassword = &quot;jane's password&quot;;
-  var userJane = world.newUser(&quot;Jane Doe&quot;, janesPassword);  
-
-  world.login(userJane, janesPassword);
-  var apple = world.newItem(&quot;Apple&quot;);
-  var brownie = world.newItem(&quot;Brownie&quot;);
-  var cupcake = world.newItem(&quot;Cupcake&quot;);
   
-  var appleUuidString = apple.getUuidString();
-  var appleToo = world.getItemFromUuid(appleUuidString);
-  assertTrue('We can retrieve &quot;apple&quot; from its UUID string', (apple == appleToo)); 
-  
-  var appleUuid = apple.getUuid();
-  var appleAgain = world.getItemFromUuid(appleUuid);
-  assertTrue('We can retrieve &quot;apple&quot; from its UUID', (apple == appleAgain)); 
-}
 
-function testGetUserstamp() {
-  var listOfUsers = world.getUsers();  
-
-  var janesPassword = &quot;jane's password&quot;;
-  var userJane = world.newUser(&quot;Jane Doe&quot;, janesPassword);
-  var passwordForChris = &quot;Kringlishous!&quot;;
-  var userChris = world.newUser(&quot;Chris Kringle&quot;, passwordForChris);
-
-  world.login(userJane, janesPassword);
-
-  assertTrue('The user Jane created the user Jane', (userJane.getUserstamp() == userJane));
-  
-  var starWars = world.newItem(&quot;Star Wars&quot;);
-  var recoveredUser = starWars.getUserstamp();
-  assertTrue(&quot;The user that created 'starWars' should be Jane&quot;, recoveredUser == userJane);
-  
-  world.logout();
-  world.login(userChris, passwordForChris);
-  var elephant = world.newItem(&quot;Elephant&quot;);
-  recoveredUser = elephant.getUserstamp();
-  assertTrue(&quot;The user that created 'elephant' should be Chris&quot;, recoveredUser == userChris);
-  recoveredUser = starWars.getUserstamp();
-  assertTrue(&quot;The user that created 'starWars' should be Jane&quot;, recoveredUser == userJane);  
-}
-
-function testGetTimestamp() {
-  var tZero = new Date();
-  var janesPassword = &quot;jane's password&quot;;
-  waitForNextMillisecond();
-  var userJane = world.newUser(&quot;Jane Doe&quot;, janesPassword);
-  world.login(userJane, janesPassword);
-  waitForNextMillisecond();
-  var starWars = world.newItem(&quot;Star Wars&quot;);
-  var starWarsTimestamp = starWars.getTimestamp();
-  waitForNextMillisecond();
-  var now = new Date();
-  assertTrue('&quot;Star Wars&quot; has a timestamp in the past', now.valueOf() &gt; starWarsTimestamp);
-  assertTrue('&quot;Star Wars&quot; was created after tZero', starWarsTimestamp &gt; tZero.valueOf());
-  waitForNextMillisecond();
-  var starTrek = world.newItem(&quot;Star Trek&quot;);
-  var starTrekTimestamp = starTrek.getTimestamp();
-  assertTrue('&quot;Star Wars&quot; was created before &quot;Star Trek&quot;', starWarsTimestamp &lt; starTrekTimestamp);
-  var janesTimestamp = userJane.getTimestamp();
-  assertTrue('&quot;Star Wars&quot; was created after user Jane', starWarsTimestamp &gt; janesTimestamp);
-}
-
-function testLoginLogout() {
-  var listOfUsers;
-  var loginSuccess;
-  
-  listOfUsers = world.getUsers();
-  var originalLength = listOfUsers.length;
-  // assertTrue(&quot;Initially, there's only an axiomatic user&quot;, listOfUsers.length == 1);
-  // assertTrue('Nobody is logged in', world.getCurrentUser() === null);
-
-  var janesPassword = &quot;jane's password&quot;;
-  var userJane = world.newUser(&quot;Jane Doe&quot;, janesPassword);  
-  listOfUsers = world.getUsers();
-  assertTrue(&quot;Now there is another user&quot;, listOfUsers.length == (originalLength + 1));
-  assertTrue('Nobody is logged in', world.getCurrentUser() === null);
-
-  loginSuccess = world.login(userJane, &quot;wrong password&quot;);
-  assertFalse('Can not log in with wrong password', loginSuccess);
-  assertTrue('Jane is not logged in', world.getCurrentUser() === null);
-
-  loginSuccess = world.login(userJane, janesPassword);
-  assertTrue('Can log in with right password', loginSuccess);
-  assertTrue('Jane is logged in', world.getCurrentUser() == userJane);
-  
-  world.logout();
-  assertTrue('Nobody is logged in', world.getCurrentUser() === null);
-  
-  var passwordForChris = &quot;Kringlishous!&quot;;
-  var userChris = world.newUser(&quot;Chris Kringle&quot;, passwordForChris);
-  world.login(userChris, passwordForChris);
-  assertTrue('Chris is logged in', world.getCurrentUser() == userChris);
-  world.logout();
-  
-  world.login(userJane, janesPassword);
-  assertTrue('Jane is logged in', world.getCurrentUser() == userJane);
-  assertFalse('Chris is not logged in', world.getCurrentUser() == userChris);
-  var caughtError = false;
-  var oprahsPassword = &quot;Oprah's password&quot;;
-  try {
-    var userOprah = world.newUser(&quot;Oprah&quot;, oprahsPassword);
-  } catch (error) {
-    caughtError = true;
-  }
-  assertTrue(&quot;We can't create a new user while Jane is logged in&quot;, caughtError);
-  world.logout();
-  
-  caughtError = false;
-  try {
-    var newItem = world.newItem(&quot;The Great Wall of China&quot;);
-  } catch (error) {
-    caughtError = true;
-  }
-  assertTrue(&quot;We can't create a new item without being logged in&quot;, caughtError);
-}
-  
-
 function testAccessorsForAxiomaticItems() {
   var key;
   var item;
@@ -225,452 +103,8 @@
   }
 }
 
-  
-function noyet_testAdditionsAndRetrievals() {
-  var nameAttribute = world.getAttributeCalledName();
-  
-  var janesPassword = &quot;jane's password&quot;;
-  var listOfCharacters = null;
-  var listOfEntries = null;
-  var listOfAttributes = null;
-  var worldRetrievalFilter = null;
-  var hasAll;
-  
-  var tZero = new Date();
-  
-  // operations done by Jane
-  var userJane = world.newUser(&quot;Jane Doe&quot;, janesPassword);
-  assertTrue('The user Jane created the user Jane', (userJane.getUserstamp() == userJane));
-   
-  world.login(userJane, janesPassword);
 
-  var characterAttribute = world.newAttribute(&quot;Characters&quot;);
-  var starWars = world.newItem(&quot;Star Wars&quot;);
-  assertTrue('getDisplayName() works for &quot;Star Wars&quot;', (starWars.getDisplayName() == &quot;Star Wars&quot;));
 
-  var luck = starWars.addEntry({attribute:characterAttribute, value:&quot;Luck Skywalker&quot;});
-  var c3po = starWars.addEntry({attribute:characterAttribute, value:&quot;C3PO&quot;});
-  var r2d2 = starWars.addEntry({value:&quot;R2D2&quot;});
-  assertTrue('&quot;Star Wars&quot; has not been deleted', !starWars.hasBeenDeleted());
-  assertTrue('&quot;R2D2&quot; has not been deleted', !r2d2.hasBeenDeleted());
-  assertTrue('&quot;R2D2&quot; has not been replaced', !r2d2.hasBeenReplaced());
-
-  listOfCharacters = starWars.getEntriesForAttribute(characterAttribute);
-  hasAll = orp.util.areObjectsInSet([luck, c3po], listOfCharacters);
-  assertTrue('&quot;Star Wars&quot; has characters: luck, c3po', hasAll);
-  assertTrue('Exactly 2 characters in Star Wars', listOfCharacters.length == 2);
-
-  listOfEntries = starWars.getEntries();
-  hasAll = orp.util.areObjectsInSet([luck, c3po, r2d2], listOfEntries);
-  assertTrue('&quot;Star Wars&quot; has entries: luck, c3po, r2d2', hasAll);  
-  
-  var ordinalA = starWars.getOrdinalNumberAtCreation();
-  var ordinalB = starWars.getOrdinalNumber();
-  assertTrue('&quot;Star Wars&quot; ordinal values match', ordinalA == ordinalB);  
-  
-  var starWarsTimestamp = starWars.getTimestamp();
-  var now = new Date();
-  // alert(&quot;now: &quot; + now + &quot;\nstar wars: &quot; + starWarsTimestamp);
-  assertTrue('&quot;Star Wars&quot; has a timestamp in the past', now &gt;= starWarsTimestamp);  
-  assertTrue('&quot;Star Wars&quot; was created after tZero', starWarsTimestamp &gt;= tZero);  
-
-  var starWarsUserstamp = starWars.getUserstamp();
-  assertTrue('&quot;Star Wars&quot; was made by Jane', starWarsUserstamp == userJane);    
-
-  listOfAttributes = starWars.getAttributes();
-  hasAll = orp.util.areObjectsInSet([nameAttribute, characterAttribute], listOfAttributes);
-  assertTrue('&quot;Star Wars&quot; has both expected attributes', hasAll);
-  
-  worldRetrievalFilter = world.getRetrievalFilter();
-  assertTrue('Default retrieval filter is &quot;last edit wins&quot;', worldRetrievalFilter == orp.model.World.RetrievalFilter.LAST_EDIT_WINS);
-  
-  var luke = starWars.replaceEntry({previousEntry:luck, value:&quot;Luke Skywalker&quot;});
-  var previousEntry = luke.getPreviousEntry();
-  assertTrue('&quot;Luke&quot; has the previous version &quot;Luck&quot;', previousEntry !== null);
-  assertTrue('&quot;Luck&quot; has been replaced', luck.hasBeenReplaced());
-  assertTrue('&quot;Luck&quot; is a entry in &quot;Star Wars&quot;', luck.getItem() == starWars);
-
-  listOfEntries = starWars.getEntries();
-  hasAll = orp.util.areObjectsInSet([luke, c3po, r2d2], listOfEntries);
-  assertTrue('&quot;Star Wars&quot; has entries: luke, c3po, r2d2', hasAll);  
-
-  listOfCharacters = starWars.getEntriesForAttribute(characterAttribute);
-  hasAll = orp.util.areObjectsInSet([luke, c3po], listOfCharacters);
-  assertTrue('&quot;Star Wars&quot; has characters: luke, c3po', hasAll);
-  assertTrue('Exactly 2 characters in the star wars', listOfCharacters.length == 2);
-
-  world.logout();
-  
-  // operations done by Chris
-  var passwordForChris = &quot;Kringlishous!&quot;;
-  var userChris = world.newUser(&quot;Chris Kringle&quot;, passwordForChris);
-  world.login(userChris, passwordForChris);
-
-  // r2d2 = starWars.replaceEntryWithEntryForAttribute(r2d2, characterAttribute, &quot;R2D2&quot;);
-  r2d2 = starWars.replaceEntry({previousEntry:r2d2, attribute:characterAttribute, value:&quot;R2D2&quot;});
-  assertTrue('&quot;R2D2&quot; is now character', r2d2.getAttribute() == characterAttribute);
-
-  var failure = starWars.replaceEntry({previousEntry:r2d2, value:&quot;R2D2&quot;});
-  assertTrue(&quot;Can't replace a value with an identical value&quot;, failure === null);
-
-  listOfCharacters = starWars.getEntriesForAttribute(characterAttribute);
-  var hasR2d2 = orp.util.isObjectInSet(r2d2, listOfCharacters);
-  hasAll = orp.util.areObjectsInSet([luke, c3po, r2d2], listOfCharacters);
-  assertTrue('Chris sees R2D2 as a character', hasR2d2);
-  assertTrue('Chris sees characters: luke, c3po, r2d2', hasAll);
-  assertTrue('Chris sees 3 characters in &quot;Star Wars&quot;', listOfCharacters.length == 3);
-  
-  var attributeCalledName = world.getAttributeCalledName();
-  var theHobbit = world.newItem(&quot;The Hobbit&quot;);
-  theHobbit.addEntry({attribute:attributeCalledName, value:&quot;There and Back Again&quot;});
-  listOfEntries = theHobbit.getEntriesForAttribute(attributeCalledName);
-  assertTrue('&quot;The Hobbit&quot; has two names', listOfEntries.length == 2);
-  assertTrue('getDisplayName() returns the first name', (starWars.getDisplayName() == &quot;Star Wars&quot;));
-  var listOfNames = theHobbit.getNameEntries();
-  assertTrue('getContentData() returns a string', listOfNames[0].getValue() == &quot;The Hobbit&quot;);
-  hasAll = orp.util.areObjectsInSet(listOfNames, listOfEntries);
-  hasAll = hasAll &amp;&amp; orp.util.areObjectsInSet(listOfEntries, listOfNames);
-  assertTrue('getName() matches getEntriesForAttribute(attributeCalledName)', hasAll);
-  
-  world.logout();
-}
-
-
-function testCategories() {
-  var janesPassword = &quot;jane's password&quot;;
-  var userJane = world.newUser(&quot;Jane Doe&quot;, janesPassword);
-  world.login(userJane, janesPassword);
-
-  var attributeCalledCategory = world.getAttributeCalledCategory();
-  var attributeCalledName = world.getAttributeCalledName();
-  var categoryCalledAttribute = world.getCategoryCalledAttribute();
-
-  var isInCategory;
-  isInCategory = attributeCalledName.isInCategory(categoryCalledAttribute);
-  assertTrue('The attribute &quot;Name&quot; is in the category &quot;Attribute&quot;', isInCategory);
-  isInCategory = categoryCalledAttribute.isInCategory(categoryCalledAttribute);
-  assertTrue('The category &quot;Attribute&quot; is NOT in the category &quot;Attribute&quot;', !isInCategory);
-  
-  var theHobbit = world.newItem(&quot;The Hobbit&quot;);
-  var theWisdomOfCrowds = world.newItem(&quot;The Wisdom of Crowds&quot;);
-  var theTransparentSociety = world.newItem(&quot;The Transparent Society&quot;);
-  isInCategory = theHobbit.isInCategory(categoryCalledAttribute);
-  assertTrue('&quot;The Hobbit&quot; is NOT in the category &quot;Attribute&quot;', !isInCategory);
-  
-  var categoryCalledBook = world.newCategory(&quot;Book&quot;);
-  isInCategory = theHobbit.isInCategory(categoryCalledBook);
-  assertTrue('&quot;The Hobbit&quot; is NOT in the category &quot;Book&quot;', !isInCategory);
-  
-  theHobbit.assignToCategory(categoryCalledBook);
-  theWisdomOfCrowds.assignToCategory(categoryCalledBook);
-  theTransparentSociety.assignToCategory(categoryCalledBook);
-  isInCategory = theHobbit.isInCategory(categoryCalledBook);
-  assertTrue('&quot;The Hobbit&quot; is in the category &quot;Book&quot;', isInCategory);
- 
-  var allBooks = world.getItemsInCategory(categoryCalledBook);
-  var hasAll = orp.util.areObjectsInSet([theHobbit, theWisdomOfCrowds, theTransparentSociety], allBooks);
-  assertTrue('All three books are in the category &quot;Book&quot;', hasAll);
-  
-  world.logout();
-}
-
-function testOrdinals() {
-  var janesPassword = &quot;jane's password&quot;;
-  var userJane = world.newUser(&quot;Jane Doe&quot;, janesPassword);
-  world.login(userJane, janesPassword);
-  
-  var attributeCalledCategory = world.getAttributeCalledCategory();
-  
-  var apple = world.newItem(&quot;Apple&quot;);
-  var cupcake = world.newItem(&quot;Cupcake&quot;);
-  var brownie = world.newItem(&quot;Brownie&quot;);  
-
-  var categoryCalledFood = world.newCategory(&quot;Food&quot;);
-  apple.assignToCategory(categoryCalledFood);
-  cupcake.assignToCategory(categoryCalledFood);
-  brownie.assignToCategory(categoryCalledFood);
-
-  var foodItems = world.getItemsInCategory(categoryCalledFood);
-  assertTrue('Apple starts out first in the list&quot;', foodItems[0] == apple);
-  assertTrue('Cupcake starts out second in the list&quot;', foodItems[1] == cupcake);
-  assertTrue('Brownie starts out second in the list&quot;', foodItems[2] == brownie);
-
-  brownie.reorderBetween(apple, cupcake);
-  foodItems = world.getItemsInCategory(categoryCalledFood);
-  assertTrue('Apple is now first in the list&quot;', foodItems[0] == apple);
-  assertTrue('Brownie is now second in the list&quot;', foodItems[1] == brownie);
-  assertTrue('Cupcake is now third in the list&quot;', foodItems[2] == cupcake);
-
-  cupcake.reorderBetween(null, apple);
-  foodItems = world.getItemsInCategory(categoryCalledFood);
-  assertTrue('Cupcake is now first in the list&quot;', foodItems[0] == cupcake);
-  assertTrue('Apple is now second in the list&quot;', foodItems[1] == apple);
-  assertTrue('Brownie is now third in the list&quot;', foodItems[2] == brownie);
-
-  cupcake.reorderBetween(brownie, null);
-  foodItems = world.getItemsInCategory(categoryCalledFood);
-  assertTrue('Apple is now first in the list&quot;', foodItems[0] == apple);
-  assertTrue('Brownie is now second in the list&quot;', foodItems[1] == brownie);
-  assertTrue('Cupcake is now third in the list&quot;', foodItems[2] == cupcake);
-  
-  world.logout();
-}
-  
-function testDeletion() {
-  var janesPassword = &quot;jane's password&quot;;
-  var userJane = world.newUser(&quot;Jane Doe&quot;, janesPassword);
-  world.login(userJane, janesPassword);
-  
-  var hydrogen = world.newItem(&quot;Hydrogen&quot;);
-  var oxygen = world.newItem(&quot;Oxygen&quot;);
-  
-  assertTrue('Hydrogen starts out not having been deleted&quot;', !hydrogen.hasBeenDeleted());
-
-  hydrogen.voteToDelete();
-  assertTrue('After a voteToDelete(), hydrogen hasBeenDeleted()&quot;', hydrogen.hasBeenDeleted());
-  
-  hydrogen.voteToRetain();
-  assertTrue('After a voteToRetain(), hydrogen no longer hasBeenDeleted()', !hydrogen.hasBeenDeleted());
-
-  world.logout();
-}
-
-
-function testItemObservation() {
-  var janesPassword = &quot;jane's password&quot;;
-  var userJane = world.newUser(&quot;Jane Doe&quot;, janesPassword);
-  world.login(userJane, janesPassword);
-  
-  var tokyo = world.newItem(&quot;Tokyo&quot;);
-  var seattle = world.newItem(&quot;Seattle&quot;);
-  
-  var changesObservedByObject = null;
-  var tokyoObserverObject = {};
-  tokyoObserverObject.observedItemHasChanged = function (inItem, inListOfRecords) {
-    changesObservedByObject = inListOfRecords;
-  };
-  tokyo.addObserver(tokyoObserverObject);
-
-  var changesObservedByFunction = null;
-  var tokyoObserverFunction = function (inItem, inListOfRecords) {
-    changesObservedByFunction = inListOfRecords;
-  };
-  tokyo.addObserver(tokyoObserverFunction);
-  
-  seattle.voteToDelete();
-  assertTrue('tokyoObserverObject does not observe Seattle', (changesObservedByObject === null));
-  assertTrue('tokyoObserverFunction does not observe Seattle', (changesObservedByFunction === null));
-
-  tokyo.voteToDelete();
-  assertTrue('tokyoObserverObject does observe Tokyo', (changesObservedByObject !== null));
-  assertTrue('tokyoObserverObject sees exactly one change', (changesObservedByObject.length == 1));
-  assertTrue('tokyoObserverFunction does observe Tokyo', (changesObservedByFunction !== null));
-  assertTrue('tokyoObserverFunction sees exactly one change', (changesObservedByFunction.length == 1));
-
-  changesObservedByObject = null;
-  changesObservedByFunction = null;
-  world.beginTransaction();
-  tokyo.voteToRetain();
-  tokyo.addEntry({value:&quot;Japan&quot;});
-  assertTrue('tokyoObserverObject does not yet see changes', (changesObservedByObject === null));
-  assertTrue('tokyoObserverFunction does not yet see changes', (changesObservedByFunction === null));
-  world.endTransaction();
-  assertTrue('tokyoObserverObject now sees changes', (changesObservedByObject !== null));
-  assertTrue('tokyoObserverObject now sees two changes', (changesObservedByObject.length == 2));
-  assertTrue('tokyoObserverFunction now sees changes', (changesObservedByFunction !== null));
-  assertTrue('tokyoObserverFunction now sees two changes', (changesObservedByFunction.length == 2));
-
-  changesObservedByObject = null;
-  changesObservedByFunction = null;
-  tokyo.removeObserver(tokyoObserverObject);
-  tokyo.removeObserver(tokyoObserverFunction);
-  tokyo.voteToDelete();
-  assertTrue('tokyoObserverObject no longer observes Tokyo', (changesObservedByObject === null));
-  assertTrue('tokyoObserverFunction no longer observes Tokyo', (changesObservedByFunction === null));
-  
-  world.logout();
-}
-
-
-function testListObservation() {
-  var janesPassword = &quot;jane's password&quot;;
-  var userJane = world.newUser(&quot;Jane Doe&quot;, janesPassword);
-  world.login(userJane, janesPassword);
-
-  var attributeCalledCategory = world.getAttributeCalledCategory();
-  
-  var apple = world.newItem(&quot;Apple&quot;);
-  var brownie = world.newItem(&quot;Brownie&quot;);  
-  var cupcake = world.newItem(&quot;Cupcake&quot;);
-
-  var categoryCalledFood = world.newCategory(&quot;Food&quot;);
-  apple.assignToCategory(categoryCalledFood);
-  brownie.assignToCategory(categoryCalledFood);
-  cupcake.assignToCategory(categoryCalledFood);
-
-  var tokyo = world.newItem(&quot;Tokyo&quot;);
-  var seattle = world.newItem(&quot;Seattle&quot;);
-
-  var changesObservedByObject = null;
-  var foodObserverObject = {};
-  foodObserverObject.observedListHasChanged = function (inList, inListOfChangeReports) {
-    changesObservedByObject = inListOfChangeReports;
-  };
-  var foodItems = world.getItemsInCategory(categoryCalledFood, foodObserverObject);
-
-  var changesObservedByFunction = null;
-  var foodObserverFunction = function (inList, inListOfChangeReports) {
-    changesObservedByFunction = inListOfChangeReports;
-  };
-  var alsoFoodItems = world.getItemsInCategory(categoryCalledFood, foodObserverFunction);
-  
-  apple.addEntry({value:&quot;Red&quot;});
-  assertTrue('foodObserverObject sees a change to apple', (changesObservedByObject !== null));
-  assertTrue('foodObserverFunction sees a change to apple', (changesObservedByFunction !== null));
-
-  changesObservedByObject = null;
-  changesObservedByFunction = null;
-  tokyo.addEntry({value:&quot;Japan&quot;});
-  assertTrue('foodObserverObject does not see a change to tokyo', (changesObservedByObject === null));
-  assertTrue('foodObserverFunction does not see a change to tokyo', (changesObservedByFunction === null));
-
-  world.removeListObserver(foodItems, foodObserverObject);
-  world.removeListObserver(alsoFoodItems, foodObserverFunction);
-  brownie.addEntry({value:&quot;Brown&quot;});
-  assertTrue('foodObserverObject no longer sees changes to food items', (changesObservedByObject === null));
-  assertTrue('foodObserverFunction no longer sees changes to food items', (changesObservedByFunction === null));
-  
-  world.logout();
-}
-
-
-function testQueries() {
-  var janesPassword = &quot;jane's password&quot;;
-  var userJane = world.newUser(&quot;Jane Doe&quot;, janesPassword);
-  world.login(userJane, janesPassword);
-  
-  var attributeCalledCategory = world.getAttributeCalledCategory();
-  
-  var apple = world.newItem(&quot;Apple&quot;);
-  var brownie = world.newItem(&quot;Brownie&quot;);  
-  var cupcake = world.newItem(&quot;Cupcake&quot;);
-
-  var categoryCalledFood = world.newCategory(&quot;Food&quot;);
-  assertTrue('The category &quot;Food&quot; is an item', (categoryCalledFood instanceof orp.model.Item));
-  apple.assignToCategory(categoryCalledFood);
-  brownie.assignToCategory(categoryCalledFood);
-  cupcake.assignToCategory(categoryCalledFood);
-
-  var tokyo = world.newItem(&quot;Tokyo&quot;);
-  var seattle = world.newItem(&quot;Seattle&quot;);
-
-  var hasAll;
-  var queryForFoods = world.newQueryForItemsByCategory(categoryCalledFood);
-  var queryRunnerForFoods = world.newQueryRunner(queryForFoods);
-  var listOfFoods = queryRunnerForFoods.getResultItems();
-  
-  hasAll = orp.util.areObjectsInSet([apple, brownie, cupcake], listOfFoods);
-  assertTrue('Food query returns 3 foods', listOfFoods.length == 3);
-  assertTrue('Food query returns all 3 foods', hasAll);
-
-  world.setItemToBeIncludedInQueryResultList(tokyo, queryForFoods);
-  assertTrue('Tokyo is now a food', tokyo.isInCategory(categoryCalledFood));
-
-  listOfFoods = queryRunnerForFoods.getResultItems();
-  hasAll = orp.util.areObjectsInSet([apple, brownie, cupcake, tokyo], listOfFoods);
-  assertTrue('Food query returns 4 foods', listOfFoods.length == 4);
-  assertTrue('Food query returns all 4 foods', hasAll);
-
-  // test for queries using non-category attribute e.g. continent
-  var attributeCalledContinent = world.newItem(&quot;Continent&quot;);
-  tokyo.addEntry({attribute:attributeCalledContinent, value:&quot;Asia&quot;});
-  var beijing = world.newItem(&quot;Beijing&quot;);
-  beijing.addEntry({attribute:attributeCalledContinent, value:&quot;Asia&quot;});
-  var seattleEntry = seattle.addEntry({attribute:attributeCalledContinent, value:&quot;North America&quot;});
-  var queryRunnerForAsia = world.newQueryRunner({attribute: attributeCalledContinent, values:[&quot;Asia&quot;]});
-  var listOfCountries = queryRunnerForAsia.getResultItems();
-  
-  assertTrue('Asia query returns 2 countries', listOfCountries.length == 2);
-  hasAll = orp.util.areObjectsInSet([tokyo,beijing], listOfCountries);
-  assertTrue('Asia query returns all 2 countries', hasAll);
-  
-  var northAmericaQuery = world.newQuery(attributeCalledContinent, &quot;North America&quot;);
-  var queryRunnerForNorthAmerica = world.newQueryRunner(northAmericaQuery);
-  listOfCountries = queryRunnerForNorthAmerica.getResultItems();
-  assertTrue('North America query returned only Seattle',
-  listOfCountries.length == 1 &amp;&amp; orp.util.isObjectInSet(seattle, listOfCountries));
-    
-  seattle.addEntry({attribute:attributeCalledContinent, value:&quot;Asia&quot;});
-  listOfCountries = queryRunnerForAsia.getResultItems();
-  assertTrue('Asia query returns 3 countries', listOfCountries.length == 3);
-  hasAll = orp.util.areObjectsInSet([tokyo,beijing,seattle], listOfCountries);
-  assertTrue('Asia query returns all 3 countries', hasAll);
-  
-  world.setItemToBeIncludedInQueryResultList(beijing, northAmericaQuery);
-  listOfCountries = queryRunnerForNorthAmerica.getResultItems();
-  assertTrue('Beijing is now in North America',orp.util.isObjectInSet(beijing, listOfCountries));
-  assertTrue('North America query returns 2 countries', listOfCountries.length == 2);
-  world.setItemToBeIncludedInQueryResultList(seattle, northAmericaQuery);
-  listOfCountries = queryRunnerForNorthAmerica.getResultItems();
-  assertTrue('North America still returns only 2 countries', listOfCountries.length == 2);
-  
-  world.logout();
-}
-
-
-
-// Tests World._getFilteredList, via World.getUsers and World.getCategories.
-
-function testFilteredLists() {
-  var janesPassword = &quot;jane's password&quot;;
-  var userJane = world.newUser(&quot;Jane Doe&quot;, janesPassword);  
-  var listOfUsers = world.getUsers();
-
-  var listOfCategories = world.getCategories();
-  var origNumberOfCategories = listOfCategories.length;
-  assertTrue(&quot;Should be at least 3 categories&quot;, origNumberOfCategories &gt;= 3);
-  
-  // Need to login before adding a category.
-  var loginSuccess = world.login(userJane, janesPassword);
-  assertTrue('login succeeded', loginSuccess);
-  assertTrue('Jane is logged in', world.getCurrentUser() == userJane);  
-
-  var categoryCalledBlueThings = world.newCategory(&quot;BlueThings&quot;);
-  listOfCategories = world.getCategories();
-  assertTrue(&quot;Should be exactly one more category than before.&quot;, listOfCategories.length == origNumberOfCategories + 1);
-}
-
-function testItemTypes() {
-  var janesPassword = &quot;jane's password&quot;;
-  var userJane = world.newUser(&quot;Jane Doe&quot;, janesPassword);
-  world.login(userJane, janesPassword);
-  
-  var anEmail = world.newItem(&quot;Money saved for you at Nigerian Bank&quot;);
-  var fromAttribute = world.newAttribute(&quot;From&quot;);
-  var dateReceivedAttribute = world.newAttribute(&quot;Received&quot;);
-  var noOfAttachments = world.newAttribute(&quot;Number of attachments&quot;);
-  var subjectAttribute = world.newAttribute(&quot;Subject&quot;);
-  var aPerson = world.newItem(&quot;John Doe&quot;);
-  var subjectEntry = anEmail.addEntry({attribute:subjectAttribute, value:&quot;Money saved for you at Nigerian Bank&quot;});
-  var fromEntry = anEmail.addEntry({attribute:fromAttribute, value:aPerson});
-  var receivedEntry = anEmail.addEntry({attribute:dateReceivedAttribute, value:(new orp.util.DateValue(&quot;6/8/05&quot;))});
-  var numAttachmentsEntry = anEmail.addEntry({attribute:noOfAttachments, value:4});
-}
-
-
 // -------------------------------------------------------------------
-// Helper functions
-// -------------------------------------------------------------------
-
-function waitForNextMillisecond() {
-  var now = new Date();
-  var then = now;
-  while (now.valueOf() == then.valueOf()) {
-    now = new Date();
-  }
-}
-
-
-// -------------------------------------------------------------------
 // End of file
 // -------------------------------------------------------------------

Modified: trunk/tests/model/TestSuite.html
===================================================================
--- trunk/tests/model/TestSuite.html	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/tests/model/TestSuite.html	2005-11-01 05:23:19 UTC (rev 371)
@@ -24,10 +24,13 @@
       function dataModelTestSuite() {
         var testSuite = new window.top.jsUnitTestSuite();
         testSuite.addTestPage(&quot;../../../tests/model/LintTest.html&quot;);
-        testSuite.addTestPage(&quot;../../../tests/model/ModelTest.html&quot;);
+        testSuite.addTestPage(&quot;../../../tests/model/test_BeforeLogin.html&quot;);
+        testSuite.addTestPage(&quot;../../../tests/model/test_AfterLogin.html&quot;);
+        testSuite.addTestPage(&quot;../../../tests/model/test_SequentialUsers.html&quot;);
         testSuite.addTestPage(&quot;../../../tests/model/RepositoryWritingTest.html&quot;);
         testSuite.addTestPage(&quot;../../../tests/model/TestReorderingForTypicalOrdinals.html&quot;);
         testSuite.addTestPage(&quot;../../../tests/model/TestReorderingForSpecialCases.html&quot;);
+        testSuite.addTestPage(&quot;../../../tests/model/test_dependencies.html&quot;);
         return testSuite;
       }
     &lt;/script&gt;

Added: trunk/tests/model/test_AfterLogin.html
===================================================================
--- trunk/tests/model/test_AfterLogin.html	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/tests/model/test_AfterLogin.html	2005-11-01 05:23:19 UTC (rev 371)
@@ -0,0 +1,77 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
+&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.1//EN&quot; &quot;<A HREF="http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd</A>&quot;&gt;
+&lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot; xml:lang=&quot;en&quot; &gt;
+
+&lt;!-- 
+ Written in 2005 by Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
+  
+ Copyright rights relinquished under the Creative Commons  
+ Public Domain Dedication:
+    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
+--&gt;
+
+  &lt;head&gt;
+    &lt;title&gt;Unit tests for the data model&lt;/title&gt;
+
+    &lt;script type=&quot;text/javascript&quot; src=&quot;../../third_party/jsunit/jsunit2_1/app/jsUnitCore.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;../../third_party/dojo/dojo-rev1759/dojo.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;../../third_party/md5/md5.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;test_AfterLogin.js&quot;&gt;&lt;/script&gt;
+  &lt;/head&gt;
+  
+  &lt;body&gt;
+    &lt;h1&gt;Unit tests for the data model&lt;/h1&gt;
+
+    &lt;p&gt;This page is used to run unit tests for the JavaScript code in the 
+    OpenRecord project.&lt;/p&gt;
+    
+    &lt;p&gt;&nbsp;&lt;/p&gt;
+    &lt;hr/&gt;
+    &lt;p&gt;You should be able to run these unit tests by going to
+    &lt;a href=&quot;../../third_party/jsunit/jsunit2_1/testRunner.html?testpage=&quot; 
+    onclick=&quot;href+=window.location.href;&quot; rel=&quot;external&quot;&gt;the local testRunner 
+    page&lt;/a&gt;, and hitting the &lt;b&gt;Run&lt;/b&gt; button.&lt;/p&gt;
+
+    &lt;p&gt;To see the tests, open this .html file in a text editor. Or, within a  
+    web browser, you should be able see the source for this file by using 
+    some menu like &lt;b&gt;View&lt;/b&gt; followed by &lt;b&gt;Page Source&lt;/b&gt;. The tests 
+    may be in this file, or they may be in a separate file that has the
+    same name as this one, except with a .js extension instead of a .html
+    extension.&lt;/p&gt;
+ 
+    &lt;p&gt;The unit tests are set up to run in the
+    &lt;a href=&quot;<A HREF="http://www.edwardh.com/jsunit/">http://www.edwardh.com/jsunit/</A>&quot; rel=&quot;external&quot;&gt;JsUnit framework&lt;/a&gt;
+    written by 
+    &lt;a href=&quot;<A HREF="http://www.edwardh.com/">http://www.edwardh.com/</A>&quot; rel=&quot;external&quot;&gt;Edward Hieatt&lt;/a&gt;. &lt;/p&gt;
+
+    &lt;p&gt;&nbsp;&lt;/p&gt;
+    &lt;hr/&gt;
+    &lt;p class=&quot;copyright&quot;&gt;You can copy freely from this work &mdash; copyright 
+    rights relinquished under the Creative Commons  
+    &lt;a rel=&quot;license external&quot; 
+    href=&quot;<A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>&quot;&gt;Public Domain 
+    Dedication&lt;/a&gt;.&lt;/p&gt;
+
+&lt;!-- Creative Commons metadata for Public Domain License 
+
+&lt;rdf:RDF xmlns=&quot;<A HREF="http://web.resource.org/cc/">http://web.resource.org/cc/</A>&quot;
+    xmlns:dc=&quot;<A HREF="http://purl.org/dc/elements/1.1/">http://purl.org/dc/elements/1.1/</A>&quot;
+    xmlns:rdf=&quot;<A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#">http://www.w3.org/1999/02/22-rdf-syntax-ns#</A>&quot;&gt;
+&lt;Work rdf:about=&quot;&quot;&gt;
+   &lt;dc:title&gt;openrecord.org&lt;/dc:title&gt;
+   &lt;dc:type rdf:resource=&quot;<A HREF="http://purl.org/dc/dcmitype/Text">http://purl.org/dc/dcmitype/Text</A>&quot; /&gt;
+   &lt;license rdf:resource=&quot;<A HREF="http://web.resource.org/cc/PublicDomain">http://web.resource.org/cc/PublicDomain</A>&quot; /&gt;
+&lt;/Work&gt;
+
+&lt;License rdf:about=&quot;<A HREF="http://web.resource.org/cc/PublicDomain">http://web.resource.org/cc/PublicDomain</A>&quot;&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Reproduction">http://web.resource.org/cc/Reproduction</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Distribution">http://web.resource.org/cc/Distribution</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/DerivativeWorks">http://web.resource.org/cc/DerivativeWorks</A>&quot; /&gt;
+&lt;/License&gt;
+
+&lt;/rdf:RDF&gt;
+
+--&gt;
+  &lt;/body&gt;
+&lt;/html&gt;
+

Added: trunk/tests/model/test_AfterLogin.js
===================================================================
--- trunk/tests/model/test_AfterLogin.js	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/tests/model/test_AfterLogin.js	2005-11-01 05:23:19 UTC (rev 371)
@@ -0,0 +1,415 @@
+/*****************************************************************************
+ test_AfterLogin.js
+ 
+******************************************************************************
+ Written in 2005 by Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
+  
+ Copyright rights relinquished under the Creative Commons  
+ Public Domain Dedication:
+    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
+  
+ You can copy freely from this file.  This work may be freely reproduced, 
+ distributed, transmitted, used, modified, built upon, or otherwise exploited
+ by anyone for any purpose.
+  
+ This work is provided on an &quot;AS IS&quot; basis, without warranties or conditions 
+ of any kind, either express or implied, including, without limitation, any 
+ warranties or conditions of title, non-infringement, merchantability, or 
+ fitness for a particular purpose. You are solely responsible for determining 
+ the appropriateness of using or distributing the work and assume all risks 
+ associated with use of this work, including but not limited to the risks and 
+ costs of errors, compliance with applicable laws, damage to or loss of data 
+ or equipment, and unavailability or interruption of operations.
+
+ In no event shall the authors or contributors have any liability for any 
+ direct, indirect, incidental, special, exemplary, or consequential damages,
+ however caused and on any theory of liability, whether in contract, strict 
+ liability, or tort (including negligence), arising in any way out of or in 
+ connection with the use or distribution of the work.
+*****************************************************************************/
+ 
+// -------------------------------------------------------------------
+// Dependencies, expressed in the syntax that JSLint understands:
+// 
+/*global Util */
+/*global World, Item, Entry */
+/*global StubArchive */
+/*global assertTrue, assertFalse, setUp, tearDown */
+// -------------------------------------------------------------------
+
+
+var world;
+var userJane;
+
+// -------------------------------------------------------------------
+// setUp and tearDown
+// -------------------------------------------------------------------
+
+function setUp() {
+  dojo.hostenv.setModulePrefix(&quot;dojo&quot;, &quot;../../../dojo/dojo-rev1759/src&quot;);
+  dojo.hostenv.setModulePrefix(&quot;orp&quot;, &quot;../../../../source&quot;);
+  dojo.require(&quot;orp.model.World&quot;);
+  dojo.require(&quot;orp.archive.StubArchive&quot;);
+  dojo.require(&quot;orp.util.DateValue&quot;);
+
+  var pathToTrunkDirectory = &quot;../..&quot;;
+  var stubArchive = new orp.archive.StubArchive(pathToTrunkDirectory);
+  world = new orp.model.World(stubArchive);
+
+  var janesPassword = &quot;jane's password&quot;;
+  userJane = world.newUser(&quot;Jane Doe&quot;, janesPassword);  
+  world.login(userJane, janesPassword);
+}
+
+function tearDown() {
+  world.logout();
+}
+
+
+// -------------------------------------------------------------------
+// Test functions
+// -------------------------------------------------------------------
+
+function testUuids() {
+  var apple = world.newItem(&quot;Apple&quot;);
+  var brownie = world.newItem(&quot;Brownie&quot;);
+  var cupcake = world.newItem(&quot;Cupcake&quot;);
+  
+  var appleUuidString = apple.getUuidString();
+  var appleToo = world.getItemFromUuid(appleUuidString);
+  assertTrue('We can retrieve &quot;apple&quot; from its UUID string', (apple == appleToo)); 
+  
+  var appleUuid = apple.getUuid();
+  var appleAgain = world.getItemFromUuid(appleUuid);
+  assertTrue('We can retrieve &quot;apple&quot; from its UUID', (apple == appleAgain)); 
+}
+
+function testGetTimestamp() {
+  var tZero = new Date();
+  waitForNextMillisecond();
+  var starWars = world.newItem(&quot;Star Wars&quot;);
+  var starWarsTimestamp = starWars.getTimestamp();
+  waitForNextMillisecond();
+  var now = new Date();
+  assertTrue('&quot;Star Wars&quot; has a timestamp in the past', now.valueOf() &gt; starWarsTimestamp);
+  assertTrue('&quot;Star Wars&quot; was created after tZero', starWarsTimestamp &gt; tZero.valueOf());
+  waitForNextMillisecond();
+  var starTrek = world.newItem(&quot;Star Trek&quot;);
+  var starTrekTimestamp = starTrek.getTimestamp();
+  assertTrue('&quot;Star Wars&quot; was created before &quot;Star Trek&quot;', starWarsTimestamp &lt; starTrekTimestamp);
+  var janesTimestamp = userJane.getTimestamp();
+  assertTrue('&quot;Star Wars&quot; was created after user Jane', starWarsTimestamp &gt; janesTimestamp);
+}
+ 
+
+function testConnections() { 
+  var utah = world.newItem(&quot;Utah&quot;);
+  var provo = world.newItem(&quot;Provo&quot;);
+  var ogden = world.newItem(&quot;Ogden&quot;);
+  
+  var locatedIn = world.newAttribute(&quot;Located in&quot;);
+  var cities = world.newAttribute(&quot;Cities&quot;);
+  
+  utah.addEntry({attribute: cities, value: provo, inverseAttribute: locatedIn});
+  var listOfCities = utah.getValuesForAttribute(cities);
+  assertTrue('Utah now has Provo as a city.', listOfCities[0] == provo);
+  assertTrue('Provo is now located in Utah.', provo.hasAttributeValue(locatedIn, utah));
+  
+  utah.addEntry({
+    attribute: cities, 
+    value: ogden, 
+    inverseAttribute: locatedIn});
+  assertTrue('Utah still has Provo as a city.', utah.hasAttributeValue(cities, provo));
+  assertTrue('Utah now has Ogden as a city.', utah.hasAttributeValue(cities, ogden));
+  assertTrue('Provo is still located in Utah.', provo.hasAttributeValue(locatedIn, utah));
+  assertTrue('Ogden is now located in Utah.', ogden.hasAttributeValue(locatedIn, utah));
+}
+
+function testCategories() {
+  var attributeCalledCategory = world.getAttributeCalledCategory();
+  var attributeCalledName = world.getAttributeCalledName();
+  var categoryCalledAttribute = world.getCategoryCalledAttribute();
+
+  var isInCategory;
+  isInCategory = attributeCalledName.isInCategory(categoryCalledAttribute);
+  assertTrue('The attribute &quot;Name&quot; is in the category &quot;Attribute&quot;', isInCategory);
+  isInCategory = categoryCalledAttribute.isInCategory(categoryCalledAttribute);
+  assertTrue('The category &quot;Attribute&quot; is NOT in the category &quot;Attribute&quot;', !isInCategory);
+  
+  var theHobbit = world.newItem(&quot;The Hobbit&quot;);
+  var theWisdomOfCrowds = world.newItem(&quot;The Wisdom of Crowds&quot;);
+  var theTransparentSociety = world.newItem(&quot;The Transparent Society&quot;);
+  isInCategory = theHobbit.isInCategory(categoryCalledAttribute);
+  assertTrue('&quot;The Hobbit&quot; is NOT in the category &quot;Attribute&quot;', !isInCategory);
+  
+  var categoryCalledBook = world.newCategory(&quot;Book&quot;);
+  isInCategory = theHobbit.isInCategory(categoryCalledBook);
+  assertTrue('&quot;The Hobbit&quot; is NOT in the category &quot;Book&quot;', !isInCategory);
+  
+  theHobbit.assignToCategory(categoryCalledBook);
+  theWisdomOfCrowds.assignToCategory(categoryCalledBook);
+  theTransparentSociety.assignToCategory(categoryCalledBook);
+  isInCategory = theHobbit.isInCategory(categoryCalledBook);
+  assertTrue('&quot;The Hobbit&quot; is in the category &quot;Book&quot;', isInCategory);
+ 
+  var allBooks = world.getItemsInCategory(categoryCalledBook);
+  var hasAll = orp.util.areObjectsInSet([theHobbit, theWisdomOfCrowds, theTransparentSociety], allBooks);
+  assertTrue('All three books are in the category &quot;Book&quot;', hasAll);
+}
+
+function testOrdinals() {
+  var attributeCalledCategory = world.getAttributeCalledCategory();
+  
+  var apple = world.newItem(&quot;Apple&quot;);
+  var cupcake = world.newItem(&quot;Cupcake&quot;);
+  var brownie = world.newItem(&quot;Brownie&quot;);  
+
+  var categoryCalledFood = world.newCategory(&quot;Food&quot;);
+  apple.assignToCategory(categoryCalledFood);
+  cupcake.assignToCategory(categoryCalledFood);
+  brownie.assignToCategory(categoryCalledFood);
+
+  var foodItems = world.getItemsInCategory(categoryCalledFood);
+  assertTrue('Apple starts out first in the list&quot;', foodItems[0] == apple);
+  assertTrue('Cupcake starts out second in the list&quot;', foodItems[1] == cupcake);
+  assertTrue('Brownie starts out second in the list&quot;', foodItems[2] == brownie);
+
+  brownie.reorderBetween(apple, cupcake);
+  foodItems = world.getItemsInCategory(categoryCalledFood);
+  assertTrue('Apple is now first in the list&quot;', foodItems[0] == apple);
+  assertTrue('Brownie is now second in the list&quot;', foodItems[1] == brownie);
+  assertTrue('Cupcake is now third in the list&quot;', foodItems[2] == cupcake);
+
+  cupcake.reorderBetween(null, apple);
+  foodItems = world.getItemsInCategory(categoryCalledFood);
+  assertTrue('Cupcake is now first in the list&quot;', foodItems[0] == cupcake);
+  assertTrue('Apple is now second in the list&quot;', foodItems[1] == apple);
+  assertTrue('Brownie is now third in the list&quot;', foodItems[2] == brownie);
+
+  cupcake.reorderBetween(brownie, null);
+  foodItems = world.getItemsInCategory(categoryCalledFood);
+  assertTrue('Apple is now first in the list&quot;', foodItems[0] == apple);
+  assertTrue('Brownie is now second in the list&quot;', foodItems[1] == brownie);
+  assertTrue('Cupcake is now third in the list&quot;', foodItems[2] == cupcake);
+}
+  
+function testDeletion() {
+  var hydrogen = world.newItem(&quot;Hydrogen&quot;);
+  var oxygen = world.newItem(&quot;Oxygen&quot;);
+  
+  assertTrue('Hydrogen starts out not having been deleted&quot;', !hydrogen.hasBeenDeleted());
+
+  hydrogen.voteToDelete();
+  assertTrue('After a voteToDelete(), hydrogen hasBeenDeleted()&quot;', hydrogen.hasBeenDeleted());
+  
+  hydrogen.voteToRetain();
+  assertTrue('After a voteToRetain(), hydrogen no longer hasBeenDeleted()', !hydrogen.hasBeenDeleted());
+}
+
+function testItemObservation() {
+  var tokyo = world.newItem(&quot;Tokyo&quot;);
+  var seattle = world.newItem(&quot;Seattle&quot;);
+  
+  var changesObservedByObject = null;
+  var tokyoObserverObject = {};
+  tokyoObserverObject.observedItemHasChanged = function (inItem, inListOfRecords) {
+    changesObservedByObject = inListOfRecords;
+  };
+  tokyo.addObserver(tokyoObserverObject);
+
+  var changesObservedByFunction = null;
+  var tokyoObserverFunction = function (inItem, inListOfRecords) {
+    changesObservedByFunction = inListOfRecords;
+  };
+  tokyo.addObserver(tokyoObserverFunction);
+  
+  seattle.voteToDelete();
+  assertTrue('tokyoObserverObject does not observe Seattle', (changesObservedByObject === null));
+  assertTrue('tokyoObserverFunction does not observe Seattle', (changesObservedByFunction === null));
+
+  tokyo.voteToDelete();
+  assertTrue('tokyoObserverObject does observe Tokyo', (changesObservedByObject !== null));
+  assertTrue('tokyoObserverObject sees exactly one change', (changesObservedByObject.length == 1));
+  assertTrue('tokyoObserverFunction does observe Tokyo', (changesObservedByFunction !== null));
+  assertTrue('tokyoObserverFunction sees exactly one change', (changesObservedByFunction.length == 1));
+
+  changesObservedByObject = null;
+  changesObservedByFunction = null;
+  world.beginTransaction();
+  tokyo.voteToRetain();
+  tokyo.addEntry({value:&quot;Japan&quot;});
+  assertTrue('tokyoObserverObject does not yet see changes', (changesObservedByObject === null));
+  assertTrue('tokyoObserverFunction does not yet see changes', (changesObservedByFunction === null));
+  world.endTransaction();
+  assertTrue('tokyoObserverObject now sees changes', (changesObservedByObject !== null));
+  assertTrue('tokyoObserverObject now sees two changes', (changesObservedByObject.length == 2));
+  assertTrue('tokyoObserverFunction now sees changes', (changesObservedByFunction !== null));
+  assertTrue('tokyoObserverFunction now sees two changes', (changesObservedByFunction.length == 2));
+
+  changesObservedByObject = null;
+  changesObservedByFunction = null;
+  tokyo.removeObserver(tokyoObserverObject);
+  tokyo.removeObserver(tokyoObserverFunction);
+  tokyo.voteToDelete();
+  assertTrue('tokyoObserverObject no longer observes Tokyo', (changesObservedByObject === null));
+  assertTrue('tokyoObserverFunction no longer observes Tokyo', (changesObservedByFunction === null));
+}
+
+
+function testListObservation() {
+  var attributeCalledCategory = world.getAttributeCalledCategory();
+  
+  var apple = world.newItem(&quot;Apple&quot;);
+  var brownie = world.newItem(&quot;Brownie&quot;);  
+  var cupcake = world.newItem(&quot;Cupcake&quot;);
+
+  var categoryCalledFood = world.newCategory(&quot;Food&quot;);
+  apple.assignToCategory(categoryCalledFood);
+  brownie.assignToCategory(categoryCalledFood);
+  cupcake.assignToCategory(categoryCalledFood);
+
+  var tokyo = world.newItem(&quot;Tokyo&quot;);
+  var seattle = world.newItem(&quot;Seattle&quot;);
+
+  var changesObservedByObject = null;
+  var foodObserverObject = {};
+  foodObserverObject.observedListHasChanged = function (inList, inListOfChangeReports) {
+    changesObservedByObject = inListOfChangeReports;
+  };
+  var foodItems = world.getItemsInCategory(categoryCalledFood, foodObserverObject);
+
+  var changesObservedByFunction = null;
+  var foodObserverFunction = function (inList, inListOfChangeReports) {
+    changesObservedByFunction = inListOfChangeReports;
+  };
+  var alsoFoodItems = world.getItemsInCategory(categoryCalledFood, foodObserverFunction);
+  
+  apple.addEntry({value:&quot;Red&quot;});
+  assertTrue('foodObserverObject sees a change to apple', (changesObservedByObject !== null));
+  assertTrue('foodObserverFunction sees a change to apple', (changesObservedByFunction !== null));
+
+  changesObservedByObject = null;
+  changesObservedByFunction = null;
+  tokyo.addEntry({value:&quot;Japan&quot;});
+  assertTrue('foodObserverObject does not see a change to tokyo', (changesObservedByObject === null));
+  assertTrue('foodObserverFunction does not see a change to tokyo', (changesObservedByFunction === null));
+
+  world.removeListObserver(foodItems, foodObserverObject);
+  world.removeListObserver(alsoFoodItems, foodObserverFunction);
+  brownie.addEntry({value:&quot;Brown&quot;});
+  assertTrue('foodObserverObject no longer sees changes to food items', (changesObservedByObject === null));
+  assertTrue('foodObserverFunction no longer sees changes to food items', (changesObservedByFunction === null));
+}
+
+
+function testQueries() {
+  var attributeCalledCategory = world.getAttributeCalledCategory();
+  
+  var apple = world.newItem(&quot;Apple&quot;);
+  var brownie = world.newItem(&quot;Brownie&quot;);  
+  var cupcake = world.newItem(&quot;Cupcake&quot;);
+
+  var categoryCalledFood = world.newCategory(&quot;Food&quot;);
+  assertTrue('The category &quot;Food&quot; is an item', (categoryCalledFood instanceof orp.model.Item));
+  apple.assignToCategory(categoryCalledFood);
+  brownie.assignToCategory(categoryCalledFood);
+  cupcake.assignToCategory(categoryCalledFood);
+
+  var tokyo = world.newItem(&quot;Tokyo&quot;);
+  var seattle = world.newItem(&quot;Seattle&quot;);
+
+  var hasAll;
+  var queryForFoods = world.newQueryForItemsByCategory(categoryCalledFood);
+  var queryRunnerForFoods = world.newQueryRunner(queryForFoods);
+  var listOfFoods = queryRunnerForFoods.getResultItems();
+  
+  hasAll = orp.util.areObjectsInSet([apple, brownie, cupcake], listOfFoods);
+  assertTrue('Food query returns 3 foods', listOfFoods.length == 3);
+  assertTrue('Food query returns all 3 foods', hasAll);
+
+  world.setItemToBeIncludedInQueryResultList(tokyo, queryForFoods);
+  assertTrue('Tokyo is now a food', tokyo.isInCategory(categoryCalledFood));
+
+  listOfFoods = queryRunnerForFoods.getResultItems();
+  hasAll = orp.util.areObjectsInSet([apple, brownie, cupcake, tokyo], listOfFoods);
+  assertTrue('Food query returns 4 foods', listOfFoods.length == 4);
+  assertTrue('Food query returns all 4 foods', hasAll);
+
+  // test for queries using non-category attribute e.g. continent
+  var attributeCalledContinent = world.newItem(&quot;Continent&quot;);
+  tokyo.addEntry({attribute:attributeCalledContinent, value:&quot;Asia&quot;});
+  var beijing = world.newItem(&quot;Beijing&quot;);
+  beijing.addEntry({attribute:attributeCalledContinent, value:&quot;Asia&quot;});
+  var seattleEntry = seattle.addEntry({attribute:attributeCalledContinent, value:&quot;North America&quot;});
+  var queryRunnerForAsia = world.newQueryRunner({attribute: attributeCalledContinent, values:[&quot;Asia&quot;]});
+  var listOfCountries = queryRunnerForAsia.getResultItems();
+  
+  assertTrue('Asia query returns 2 countries', listOfCountries.length == 2);
+  hasAll = orp.util.areObjectsInSet([tokyo,beijing], listOfCountries);
+  assertTrue('Asia query returns all 2 countries', hasAll);
+  
+  var northAmericaQuery = world.newQuery(attributeCalledContinent, &quot;North America&quot;);
+  var queryRunnerForNorthAmerica = world.newQueryRunner(northAmericaQuery);
+  listOfCountries = queryRunnerForNorthAmerica.getResultItems();
+  assertTrue('North America query returned only Seattle',
+  listOfCountries.length == 1 &amp;&amp; orp.util.isObjectInSet(seattle, listOfCountries));
+    
+  seattle.addEntry({attribute:attributeCalledContinent, value:&quot;Asia&quot;});
+  listOfCountries = queryRunnerForAsia.getResultItems();
+  assertTrue('Asia query returns 3 countries', listOfCountries.length == 3);
+  hasAll = orp.util.areObjectsInSet([tokyo,beijing,seattle], listOfCountries);
+  assertTrue('Asia query returns all 3 countries', hasAll);
+  
+  world.setItemToBeIncludedInQueryResultList(beijing, northAmericaQuery);
+  listOfCountries = queryRunnerForNorthAmerica.getResultItems();
+  assertTrue('Beijing is now in North America',orp.util.isObjectInSet(beijing, listOfCountries));
+  assertTrue('North America query returns 2 countries', listOfCountries.length == 2);
+  world.setItemToBeIncludedInQueryResultList(seattle, northAmericaQuery);
+  listOfCountries = queryRunnerForNorthAmerica.getResultItems();
+  assertTrue('North America still returns only 2 countries', listOfCountries.length == 2);
+}
+
+
+
+// Tests World._getFilteredList, via World.getUsers and World.getCategories.
+
+function testFilteredLists() {
+  var listOfCategories = world.getCategories();
+  var origNumberOfCategories = listOfCategories.length;
+  assertTrue(&quot;Should be at least 3 categories&quot;, origNumberOfCategories &gt;= 3);
+  
+  var categoryCalledBlueThings = world.newCategory(&quot;BlueThings&quot;);
+  listOfCategories = world.getCategories();
+  assertTrue(&quot;Should be exactly one more category than before.&quot;, listOfCategories.length == origNumberOfCategories + 1);
+}
+
+function testItemTypes() {
+  var anEmail = world.newItem(&quot;Money saved for you at Nigerian Bank&quot;);
+  var fromAttribute = world.newAttribute(&quot;From&quot;);
+  var dateReceivedAttribute = world.newAttribute(&quot;Received&quot;);
+  var noOfAttachments = world.newAttribute(&quot;Number of attachments&quot;);
+  var subjectAttribute = world.newAttribute(&quot;Subject&quot;);
+  var aPerson = world.newItem(&quot;John Doe&quot;);
+  var subjectEntry = anEmail.addEntry({attribute:subjectAttribute, value:&quot;Money saved for you at Nigerian Bank&quot;});
+  var fromEntry = anEmail.addEntry({attribute:fromAttribute, value:aPerson});
+  var receivedEntry = anEmail.addEntry({attribute:dateReceivedAttribute, value:(new orp.util.DateValue(&quot;6/8/05&quot;))});
+  var numAttachmentsEntry = anEmail.addEntry({attribute:noOfAttachments, value:4});
+}
+
+
+// -------------------------------------------------------------------
+// Helper functions
+// -------------------------------------------------------------------
+
+function waitForNextMillisecond() {
+  var now = new Date();
+  var then = now;
+  while (now.valueOf() == then.valueOf()) {
+    now = new Date();
+  }
+}
+
+
+// -------------------------------------------------------------------
+// End of file
+// -------------------------------------------------------------------

Added: trunk/tests/model/test_BeforeLogin.html
===================================================================
--- trunk/tests/model/test_BeforeLogin.html	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/tests/model/test_BeforeLogin.html	2005-11-01 05:23:19 UTC (rev 371)
@@ -0,0 +1,77 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
+&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.1//EN&quot; &quot;<A HREF="http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd</A>&quot;&gt;
+&lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot; xml:lang=&quot;en&quot; &gt;
+
+&lt;!-- 
+ Written in 2005 by Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
+  
+ Copyright rights relinquished under the Creative Commons  
+ Public Domain Dedication:
+    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
+--&gt;
+
+  &lt;head&gt;
+    &lt;title&gt;Unit tests for the data model&lt;/title&gt;
+
+    &lt;script type=&quot;text/javascript&quot; src=&quot;../../third_party/jsunit/jsunit2_1/app/jsUnitCore.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;../../third_party/dojo/dojo-rev1759/dojo.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;../../third_party/md5/md5.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;test_BeforeLogin.js&quot;&gt;&lt;/script&gt;
+  &lt;/head&gt;
+  
+  &lt;body&gt;
+    &lt;h1&gt;Unit tests for the data model&lt;/h1&gt;
+
+    &lt;p&gt;This page is used to run unit tests for the JavaScript code in the 
+    OpenRecord project.&lt;/p&gt;
+    
+    &lt;p&gt;&nbsp;&lt;/p&gt;
+    &lt;hr/&gt;
+    &lt;p&gt;You should be able to run these unit tests by going to
+    &lt;a href=&quot;../../third_party/jsunit/jsunit2_1/testRunner.html?testpage=&quot; 
+    onclick=&quot;href+=window.location.href;&quot; rel=&quot;external&quot;&gt;the local testRunner 
+    page&lt;/a&gt;, and hitting the &lt;b&gt;Run&lt;/b&gt; button.&lt;/p&gt;
+
+    &lt;p&gt;To see the tests, open this .html file in a text editor. Or, within a  
+    web browser, you should be able see the source for this file by using 
+    some menu like &lt;b&gt;View&lt;/b&gt; followed by &lt;b&gt;Page Source&lt;/b&gt;. The tests 
+    may be in this file, or they may be in a separate file that has the
+    same name as this one, except with a .js extension instead of a .html
+    extension.&lt;/p&gt;
+ 
+    &lt;p&gt;The unit tests are set up to run in the
+    &lt;a href=&quot;<A HREF="http://www.edwardh.com/jsunit/">http://www.edwardh.com/jsunit/</A>&quot; rel=&quot;external&quot;&gt;JsUnit framework&lt;/a&gt;
+    written by 
+    &lt;a href=&quot;<A HREF="http://www.edwardh.com/">http://www.edwardh.com/</A>&quot; rel=&quot;external&quot;&gt;Edward Hieatt&lt;/a&gt;. &lt;/p&gt;
+
+    &lt;p&gt;&nbsp;&lt;/p&gt;
+    &lt;hr/&gt;
+    &lt;p class=&quot;copyright&quot;&gt;You can copy freely from this work &mdash; copyright 
+    rights relinquished under the Creative Commons  
+    &lt;a rel=&quot;license external&quot; 
+    href=&quot;<A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>&quot;&gt;Public Domain 
+    Dedication&lt;/a&gt;.&lt;/p&gt;
+
+&lt;!-- Creative Commons metadata for Public Domain License 
+
+&lt;rdf:RDF xmlns=&quot;<A HREF="http://web.resource.org/cc/">http://web.resource.org/cc/</A>&quot;
+    xmlns:dc=&quot;<A HREF="http://purl.org/dc/elements/1.1/">http://purl.org/dc/elements/1.1/</A>&quot;
+    xmlns:rdf=&quot;<A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#">http://www.w3.org/1999/02/22-rdf-syntax-ns#</A>&quot;&gt;
+&lt;Work rdf:about=&quot;&quot;&gt;
+   &lt;dc:title&gt;openrecord.org&lt;/dc:title&gt;
+   &lt;dc:type rdf:resource=&quot;<A HREF="http://purl.org/dc/dcmitype/Text">http://purl.org/dc/dcmitype/Text</A>&quot; /&gt;
+   &lt;license rdf:resource=&quot;<A HREF="http://web.resource.org/cc/PublicDomain">http://web.resource.org/cc/PublicDomain</A>&quot; /&gt;
+&lt;/Work&gt;
+
+&lt;License rdf:about=&quot;<A HREF="http://web.resource.org/cc/PublicDomain">http://web.resource.org/cc/PublicDomain</A>&quot;&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Reproduction">http://web.resource.org/cc/Reproduction</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Distribution">http://web.resource.org/cc/Distribution</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/DerivativeWorks">http://web.resource.org/cc/DerivativeWorks</A>&quot; /&gt;
+&lt;/License&gt;
+
+&lt;/rdf:RDF&gt;
+
+--&gt;
+  &lt;/body&gt;
+&lt;/html&gt;
+

Added: trunk/tests/model/test_BeforeLogin.js
===================================================================
--- trunk/tests/model/test_BeforeLogin.js	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/tests/model/test_BeforeLogin.js	2005-11-01 05:23:19 UTC (rev 371)
@@ -0,0 +1,154 @@
+/*****************************************************************************
+ test_BeforeLogin.js
+ 
+******************************************************************************
+ Written in 2005 by Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
+  
+ Copyright rights relinquished under the Creative Commons  
+ Public Domain Dedication:
+    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
+  
+ You can copy freely from this file.  This work may be freely reproduced, 
+ distributed, transmitted, used, modified, built upon, or otherwise exploited
+ by anyone for any purpose.
+  
+ This work is provided on an &quot;AS IS&quot; basis, without warranties or conditions 
+ of any kind, either express or implied, including, without limitation, any 
+ warranties or conditions of title, non-infringement, merchantability, or 
+ fitness for a particular purpose. You are solely responsible for determining 
+ the appropriateness of using or distributing the work and assume all risks 
+ associated with use of this work, including but not limited to the risks and 
+ costs of errors, compliance with applicable laws, damage to or loss of data 
+ or equipment, and unavailability or interruption of operations.
+
+ In no event shall the authors or contributors have any liability for any 
+ direct, indirect, incidental, special, exemplary, or consequential damages,
+ however caused and on any theory of liability, whether in contract, strict 
+ liability, or tort (including negligence), arising in any way out of or in 
+ connection with the use or distribution of the work.
+*****************************************************************************/
+ 
+// -------------------------------------------------------------------
+// Dependencies, expressed in the syntax that JSLint understands:
+// 
+/*global Util */
+/*global World, Item, Entry */
+/*global StubArchive */
+/*global assertTrue, assertFalse, setUp, tearDown */
+// -------------------------------------------------------------------
+
+
+var world;
+
+// -------------------------------------------------------------------
+// setUp and tearDown
+// -------------------------------------------------------------------
+
+function setUp() {
+  dojo.hostenv.setModulePrefix(&quot;dojo&quot;, &quot;../../../dojo/dojo-rev1759/src&quot;);
+  dojo.hostenv.setModulePrefix(&quot;orp&quot;, &quot;../../../../source&quot;);
+  dojo.require(&quot;orp.model.World&quot;);
+  dojo.require(&quot;orp.archive.StubArchive&quot;);
+  dojo.require(&quot;orp.util.DateValue&quot;);
+
+  var pathToTrunkDirectory = &quot;../..&quot;;
+  var stubArchive = new orp.archive.StubArchive(pathToTrunkDirectory);
+  world = new orp.model.World(stubArchive);
+}
+
+function tearDown() {
+}
+
+
+// -------------------------------------------------------------------
+// Test functions
+// -------------------------------------------------------------------
+  
+function testIllegalAttemptToCreateItem() {
+  var caughtError = false;
+  try {
+    var newItem = world.newItem(&quot;The Great Wall of China&quot;);
+  } catch (error) {
+    caughtError = true;
+  }
+  assertTrue(&quot;We can't create a new item without being logged in&quot;, caughtError);
+}
+
+function testIllegalAttemptToCreateEntry() {
+  var caughtError = false;
+  var attributeCalledName = world.getAttributeCalledName();
+  try {
+    var newEntry = attributeCalledName.addEntry({value: &quot;Name Too&quot;});
+  } catch (error) {
+    caughtError = true;
+  }
+  assertTrue(&quot;We can't create a new entry without being logged in&quot;, caughtError);
+}
+
+function testAccessorsForAxiomaticItems() {
+  var i;
+  var item;
+  var uuid;
+  var listOfAssignedNames;
+  var nameEntry;
+  
+  var categoryCalledAttribute = world.getCategoryCalledAttribute();
+  var listOfAttributes = [];
+  listOfAttributes.push(world.getAttributeCalledName());
+  listOfAttributes.push(world.getAttributeCalledShortName());
+  listOfAttributes.push(world.getAttributeCalledSummary());
+  listOfAttributes.push(world.getAttributeCalledCategory());
+  listOfAttributes.push(world.getAttributeCalledUnfiled());
+  listOfAttributes.push(world.getAttributeCalledTag());
+  for (i in listOfAttributes) {
+    item = listOfAttributes[i];
+    listOfAssignedNames = item.getNameEntries();
+    assertTrue('Every axiomatic attribute has an array of names', dojo.lang.isArray(listOfAssignedNames));
+    assertTrue('Every axiomatic attribute has one name assigned', listOfAssignedNames.length == 1);
+    nameEntry = listOfAssignedNames[0];
+    assertTrue('Every axiomatic attribute has a name which is an entry', (nameEntry instanceof orp.model.Entry));
+    assertTrue('Every entry can be displayed as a string', dojo.lang.isString(nameEntry.getDisplayString()));
+    assertTrue('Every axiomatic attribute is in the category &quot;Attribute&quot;', item.isInCategory(categoryCalledAttribute));
+    var uuid = item.getUuid();
+    assertTrue('Every axiomatic attribute has a UUID', (uuid instanceof orp.uuid.Uuid));
+    assertTrue('getItemFromUuid() returns the right attribute', (world.getItemFromUuid(uuid) == item));
+  }
+  
+  var listOfCategories = [];
+  listOfCategories.push(world.getCategoryCalledAttribute());
+  listOfCategories.push(world.getCategoryCalledCategory());
+  listOfCategories.push(world.getCategoryCalledType());
+  for (i in listOfCategories) {
+    item = listOfCategories[i];
+    listOfAssignedNames = item.getNameEntries();
+    assertTrue('Every axiomatic category has an array of names', dojo.lang.isArray(listOfAssignedNames));
+    assertTrue('Every axiomatic category has one name assigned', listOfAssignedNames.length == 1);
+    nameEntry = listOfAssignedNames[0];
+    assertTrue('Every axiomatic category has a name which is entry', (nameEntry instanceof orp.model.Entry));
+    assertTrue('Every entry can be displayed as a string', dojo.lang.isString(nameEntry.getDisplayString()));
+  }
+  
+  var listOfTypes = [];
+  listOfTypes.push(world.getTypeCalledText());
+  listOfTypes.push(world.getTypeCalledNumber());
+  listOfTypes.push(world.getTypeCalledDate());
+  listOfTypes.push(world.getTypeCalledCheckMark());
+  listOfTypes.push(world.getTypeCalledUrl());
+  listOfTypes.push(world.getTypeCalledItem());
+  listOfTypes.push(world.getTypeCalledConnection());
+  for (i in listOfTypes) {
+    item = listOfTypes[i];
+    listOfAssignedNames = item.getNameEntries();
+    assertTrue('Every axiomatic type has an array of names', dojo.lang.isArray(listOfAssignedNames));
+    assertTrue('Every axiomatic type has one name assigned', listOfAssignedNames.length == 1);
+    nameEntry = listOfAssignedNames[0];
+    assertTrue('Every axiomatic type has a name which is entry', (nameEntry instanceof orp.model.Entry));
+    assertTrue('Every entry can be displayed as a string', dojo.lang.isString(nameEntry.getDisplayString()));
+  }
+}
+
+
+
+// -------------------------------------------------------------------
+// End of file
+// -------------------------------------------------------------------

Added: trunk/tests/model/test_SequentialUsers.html
===================================================================
--- trunk/tests/model/test_SequentialUsers.html	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/tests/model/test_SequentialUsers.html	2005-11-01 05:23:19 UTC (rev 371)
@@ -0,0 +1,77 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
+&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.1//EN&quot; &quot;<A HREF="http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd</A>&quot;&gt;
+&lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot; xml:lang=&quot;en&quot; &gt;
+
+&lt;!-- 
+ Written in 2005 by Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
+  
+ Copyright rights relinquished under the Creative Commons  
+ Public Domain Dedication:
+    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
+--&gt;
+
+  &lt;head&gt;
+    &lt;title&gt;Unit tests for the data model&lt;/title&gt;
+
+    &lt;script type=&quot;text/javascript&quot; src=&quot;../../third_party/jsunit/jsunit2_1/app/jsUnitCore.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;../../third_party/dojo/dojo-rev1759/dojo.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;../../third_party/md5/md5.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;test_SequentialUsers.js&quot;&gt;&lt;/script&gt;
+  &lt;/head&gt;
+  
+  &lt;body&gt;
+    &lt;h1&gt;Unit tests for the data model&lt;/h1&gt;
+
+    &lt;p&gt;This page is used to run unit tests for the JavaScript code in the 
+    OpenRecord project.&lt;/p&gt;
+    
+    &lt;p&gt;&nbsp;&lt;/p&gt;
+    &lt;hr/&gt;
+    &lt;p&gt;You should be able to run these unit tests by going to
+    &lt;a href=&quot;../../third_party/jsunit/jsunit2_1/testRunner.html?testpage=&quot; 
+    onclick=&quot;href+=window.location.href;&quot; rel=&quot;external&quot;&gt;the local testRunner 
+    page&lt;/a&gt;, and hitting the &lt;b&gt;Run&lt;/b&gt; button.&lt;/p&gt;
+
+    &lt;p&gt;To see the tests, open this .html file in a text editor. Or, within a  
+    web browser, you should be able see the source for this file by using 
+    some menu like &lt;b&gt;View&lt;/b&gt; followed by &lt;b&gt;Page Source&lt;/b&gt;. The tests 
+    may be in this file, or they may be in a separate file that has the
+    same name as this one, except with a .js extension instead of a .html
+    extension.&lt;/p&gt;
+ 
+    &lt;p&gt;The unit tests are set up to run in the
+    &lt;a href=&quot;<A HREF="http://www.edwardh.com/jsunit/">http://www.edwardh.com/jsunit/</A>&quot; rel=&quot;external&quot;&gt;JsUnit framework&lt;/a&gt;
+    written by 
+    &lt;a href=&quot;<A HREF="http://www.edwardh.com/">http://www.edwardh.com/</A>&quot; rel=&quot;external&quot;&gt;Edward Hieatt&lt;/a&gt;. &lt;/p&gt;
+
+    &lt;p&gt;&nbsp;&lt;/p&gt;
+    &lt;hr/&gt;
+    &lt;p class=&quot;copyright&quot;&gt;You can copy freely from this work &mdash; copyright 
+    rights relinquished under the Creative Commons  
+    &lt;a rel=&quot;license external&quot; 
+    href=&quot;<A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>&quot;&gt;Public Domain 
+    Dedication&lt;/a&gt;.&lt;/p&gt;
+
+&lt;!-- Creative Commons metadata for Public Domain License 
+
+&lt;rdf:RDF xmlns=&quot;<A HREF="http://web.resource.org/cc/">http://web.resource.org/cc/</A>&quot;
+    xmlns:dc=&quot;<A HREF="http://purl.org/dc/elements/1.1/">http://purl.org/dc/elements/1.1/</A>&quot;
+    xmlns:rdf=&quot;<A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#">http://www.w3.org/1999/02/22-rdf-syntax-ns#</A>&quot;&gt;
+&lt;Work rdf:about=&quot;&quot;&gt;
+   &lt;dc:title&gt;openrecord.org&lt;/dc:title&gt;
+   &lt;dc:type rdf:resource=&quot;<A HREF="http://purl.org/dc/dcmitype/Text">http://purl.org/dc/dcmitype/Text</A>&quot; /&gt;
+   &lt;license rdf:resource=&quot;<A HREF="http://web.resource.org/cc/PublicDomain">http://web.resource.org/cc/PublicDomain</A>&quot; /&gt;
+&lt;/Work&gt;
+
+&lt;License rdf:about=&quot;<A HREF="http://web.resource.org/cc/PublicDomain">http://web.resource.org/cc/PublicDomain</A>&quot;&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Reproduction">http://web.resource.org/cc/Reproduction</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Distribution">http://web.resource.org/cc/Distribution</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/DerivativeWorks">http://web.resource.org/cc/DerivativeWorks</A>&quot; /&gt;
+&lt;/License&gt;
+
+&lt;/rdf:RDF&gt;
+
+--&gt;
+  &lt;/body&gt;
+&lt;/html&gt;
+

Added: trunk/tests/model/test_SequentialUsers.js
===================================================================
--- trunk/tests/model/test_SequentialUsers.js	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/tests/model/test_SequentialUsers.js	2005-11-01 05:23:19 UTC (rev 371)
@@ -0,0 +1,282 @@
+/*****************************************************************************
+ test_SequentialUsers.js
+ 
+******************************************************************************
+ Written in 2005 by Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
+  
+ Copyright rights relinquished under the Creative Commons  
+ Public Domain Dedication:
+    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
+  
+ You can copy freely from this file.  This work may be freely reproduced, 
+ distributed, transmitted, used, modified, built upon, or otherwise exploited
+ by anyone for any purpose.
+  
+ This work is provided on an &quot;AS IS&quot; basis, without warranties or conditions 
+ of any kind, either express or implied, including, without limitation, any 
+ warranties or conditions of title, non-infringement, merchantability, or 
+ fitness for a particular purpose. You are solely responsible for determining 
+ the appropriateness of using or distributing the work and assume all risks 
+ associated with use of this work, including but not limited to the risks and 
+ costs of errors, compliance with applicable laws, damage to or loss of data 
+ or equipment, and unavailability or interruption of operations.
+
+ In no event shall the authors or contributors have any liability for any 
+ direct, indirect, incidental, special, exemplary, or consequential damages,
+ however caused and on any theory of liability, whether in contract, strict 
+ liability, or tort (including negligence), arising in any way out of or in 
+ connection with the use or distribution of the work.
+*****************************************************************************/
+ 
+// -------------------------------------------------------------------
+// Dependencies, expressed in the syntax that JSLint understands:
+// 
+/*global Util */
+/*global World, Item, Entry */
+/*global StubArchive */
+/*global assertTrue, assertFalse, setUp, tearDown */
+// -------------------------------------------------------------------
+
+
+var world;
+
+// -------------------------------------------------------------------
+// setUp and tearDown
+// -------------------------------------------------------------------
+
+function setUp() {
+  dojo.hostenv.setModulePrefix(&quot;dojo&quot;, &quot;../../../dojo/dojo-rev1759/src&quot;);
+  dojo.hostenv.setModulePrefix(&quot;orp&quot;, &quot;../../../../source&quot;);
+  dojo.require(&quot;orp.model.World&quot;);
+  dojo.require(&quot;orp.archive.StubArchive&quot;);
+  dojo.require(&quot;orp.util.DateValue&quot;);
+
+  var pathToTrunkDirectory = &quot;../..&quot;;
+  var stubArchive = new orp.archive.StubArchive(pathToTrunkDirectory);
+  world = new orp.model.World(stubArchive);
+}
+
+function tearDown() {
+}
+
+
+// -------------------------------------------------------------------
+// Test functions
+// -------------------------------------------------------------------
+
+
+function testGetUserstamp() {
+  var listOfUsers = world.getUsers();  
+
+  var janesPassword = &quot;jane's password&quot;;
+  var userJane = world.newUser(&quot;Jane Doe&quot;, janesPassword);
+  var passwordForChris = &quot;Kringlishous!&quot;;
+  var userChris = world.newUser(&quot;Chris Kringle&quot;, passwordForChris);
+
+  world.login(userJane, janesPassword);
+
+  assertTrue('The user Jane created the user Jane', (userJane.getUserstamp() == userJane));
+  
+  var starWars = world.newItem(&quot;Star Wars&quot;);
+  var recoveredUser = starWars.getUserstamp();
+  assertTrue(&quot;The user that created 'starWars' should be Jane&quot;, recoveredUser == userJane);
+  
+  world.logout();
+  world.login(userChris, passwordForChris);
+  var elephant = world.newItem(&quot;Elephant&quot;);
+  recoveredUser = elephant.getUserstamp();
+  assertTrue(&quot;The user that created 'elephant' should be Chris&quot;, recoveredUser == userChris);
+  recoveredUser = starWars.getUserstamp();
+  assertTrue(&quot;The user that created 'starWars' should be Jane&quot;, recoveredUser == userJane);  
+  world.logout();
+}
+
+
+function testLoginLogout() {
+  var listOfUsers;
+  var loginSuccess;
+  
+  listOfUsers = world.getUsers();
+  var originalLength = listOfUsers.length;
+  // assertTrue(&quot;Initially, there's only an axiomatic user&quot;, listOfUsers.length == 1);
+  // assertTrue('Nobody is logged in', world.getCurrentUser() === null);
+
+  var janesPassword = &quot;jane's password&quot;;
+  var userJane = world.newUser(&quot;Jane Doe&quot;, janesPassword);  
+  listOfUsers = world.getUsers();
+  assertTrue(&quot;Now there is another user&quot;, listOfUsers.length == (originalLength + 1));
+  assertTrue('Nobody is logged in', world.getCurrentUser() === null);
+
+  loginSuccess = world.login(userJane, &quot;wrong password&quot;);
+  assertFalse('Can not log in with wrong password', loginSuccess);
+  assertTrue('Jane is not logged in', world.getCurrentUser() === null);
+
+  loginSuccess = world.login(userJane, janesPassword);
+  assertTrue('Can log in with right password', loginSuccess);
+  assertTrue('Jane is logged in', world.getCurrentUser() == userJane);
+  
+  world.logout();
+  assertTrue('Nobody is logged in', world.getCurrentUser() === null);
+  
+  var passwordForChris = &quot;Kringlishous!&quot;;
+  var userChris = world.newUser(&quot;Chris Kringle&quot;, passwordForChris);
+  world.login(userChris, passwordForChris);
+  assertTrue('Chris is logged in', world.getCurrentUser() == userChris);
+  world.logout();
+  
+  world.login(userJane, janesPassword);
+  assertTrue('Jane is logged in', world.getCurrentUser() == userJane);
+  assertFalse('Chris is not logged in', world.getCurrentUser() == userChris);
+  var caughtError = false;
+  var oprahsPassword = &quot;Oprah's password&quot;;
+  try {
+    var userOprah = world.newUser(&quot;Oprah&quot;, oprahsPassword);
+  } catch (error) {
+    caughtError = true;
+  }
+  assertTrue(&quot;We can't create a new user while Jane is logged in&quot;, caughtError);
+  world.logout();
+  
+  caughtError = false;
+  try {
+    var newItem = world.newItem(&quot;The Great Wall of China&quot;);
+  } catch (error) {
+    caughtError = true;
+  }
+  assertTrue(&quot;We can't create a new item without being logged in&quot;, caughtError);
+}
+ 
+
+  
+function testAdditionsAndRetrievals() {
+  var nameAttribute = world.getAttributeCalledName();
+  
+  var janesPassword = &quot;jane's password&quot;;
+  var listOfCharacters = null;
+  var listOfEntries = null;
+  var listOfAttributes = null;
+  var worldRetrievalFilter = null;
+  var hasAll;
+  
+  var tZero = new Date();
+  
+  // operations done by Jane
+  var userJane = world.newUser(&quot;Jane Doe&quot;, janesPassword);
+  assertTrue('The user Jane created the user Jane', (userJane.getUserstamp() == userJane));
+   
+  world.login(userJane, janesPassword);
+
+  var characterAttribute = world.newAttribute(&quot;Characters&quot;);
+  var starWars = world.newItem(&quot;Star Wars&quot;);
+  assertTrue('getDisplayName() works for &quot;Star Wars&quot;', (starWars.getDisplayName() == &quot;Star Wars&quot;));
+
+  var luck = starWars.addEntry({attribute:characterAttribute, value:&quot;Luck Skywalker&quot;});
+  var c3po = starWars.addEntry({attribute:characterAttribute, value:&quot;C3PO&quot;});
+  var r2d2 = starWars.addEntry({value:&quot;R2D2&quot;});
+  assertTrue('&quot;Star Wars&quot; has not been deleted', !starWars.hasBeenDeleted());
+  assertTrue('&quot;R2D2&quot; has not been deleted', !r2d2.hasBeenDeleted());
+  assertTrue('&quot;R2D2&quot; has not been replaced', !r2d2.hasBeenReplaced());
+
+  listOfCharacters = starWars.getEntriesForAttribute(characterAttribute);
+  hasAll = orp.util.areObjectsInSet([luck, c3po], listOfCharacters);
+  assertTrue('&quot;Star Wars&quot; has characters: luck, c3po', hasAll);
+  assertTrue('Exactly 2 characters in Star Wars', listOfCharacters.length == 2);
+
+  var listOfValues = starWars.getValuesForAttribute(characterAttribute);
+  hasAll = orp.util.areObjectsInSet([&quot;Luck Skywalker&quot;, &quot;C3PO&quot;], listOfValues);
+  assertTrue('&quot;Star Wars&quot; has characters: &quot;Luck Skywalker&quot;, &quot;C3PO&quot;', hasAll);
+  assertTrue('Exactly 2 values for Star Wars characters', listOfValues.length == 2);
+
+  listOfEntries = starWars.getEntries();
+  hasAll = orp.util.areObjectsInSet([luck, c3po, r2d2], listOfEntries);
+  assertTrue('&quot;Star Wars&quot; has entries: luck, c3po, r2d2', hasAll);  
+  
+  var ordinalA = starWars.getOrdinalNumberAtCreation();
+  var ordinalB = starWars.getOrdinalNumber();
+  assertTrue('&quot;Star Wars&quot; ordinal values match', ordinalA == ordinalB);  
+  
+  var starWarsTimestamp = starWars.getTimestamp();
+  var now = new Date();
+  // alert(&quot;now: &quot; + now + &quot;\nstar wars: &quot; + starWarsTimestamp);
+  assertTrue('&quot;Star Wars&quot; has a timestamp in the past', now.valueOf() &gt;= starWarsTimestamp);  
+  assertTrue('&quot;Star Wars&quot; was created after tZero', starWarsTimestamp &gt;= tZero.valueOf());  
+
+  var starWarsUserstamp = starWars.getUserstamp();
+  assertTrue('&quot;Star Wars&quot; was made by Jane', starWarsUserstamp == userJane);    
+
+  listOfAttributes = starWars.getAttributes();
+  hasAll = orp.util.areObjectsInSet([nameAttribute, characterAttribute], listOfAttributes);
+  assertTrue('&quot;Star Wars&quot; has both expected attributes', hasAll);
+  
+  worldRetrievalFilter = world.getRetrievalFilter();
+  assertTrue('Default retrieval filter is &quot;last edit wins&quot;', worldRetrievalFilter == orp.model.World.RetrievalFilter.LAST_EDIT_WINS);
+  
+  var luke = starWars.replaceEntry({previousEntry:luck, value:&quot;Luke Skywalker&quot;});
+  var previousEntry = luke.getPreviousEntry();
+  assertTrue('&quot;Luke&quot; has the previous version &quot;Luck&quot;', previousEntry !== null);
+  assertTrue('&quot;Luck&quot; has been replaced', luck.hasBeenReplaced());
+  assertTrue('&quot;Luck&quot; is a entry in &quot;Star Wars&quot;', luck.getItem() == starWars);
+
+  listOfEntries = starWars.getEntries();
+  hasAll = orp.util.areObjectsInSet([luke, c3po, r2d2], listOfEntries);
+  assertTrue('&quot;Star Wars&quot; has entries: luke, c3po, r2d2', hasAll);  
+
+  listOfCharacters = starWars.getEntriesForAttribute(characterAttribute);
+  hasAll = orp.util.areObjectsInSet([luke, c3po], listOfCharacters);
+  assertTrue('&quot;Star Wars&quot; has characters: luke, c3po', hasAll);
+  assertTrue('Exactly 2 characters in the star wars', listOfCharacters.length == 2);
+
+  world.logout();
+  
+  // operations done by Chris
+  var passwordForChris = &quot;Kringlishous!&quot;;
+  var userChris = world.newUser(&quot;Chris Kringle&quot;, passwordForChris);
+  world.login(userChris, passwordForChris);
+
+  r2d2 = starWars.addEntry({previousEntry:r2d2, attribute:characterAttribute, value:&quot;R2D2&quot;});
+  assertTrue('&quot;R2D2&quot; is now character', r2d2.getAttribute() == characterAttribute);
+  previousEntry = r2d2.getPreviousEntry();
+  assertTrue('&quot;R2D2&quot; has a previous version', previousEntry !== null);
+
+  var failure = starWars.addEntry({previousEntry:r2d2, value:&quot;R2D2&quot;});
+  assertTrue(&quot;Can't replace a value with an identical value&quot;, failure === null);
+
+  listOfCharacters = starWars.getEntriesForAttribute(characterAttribute);
+  var hasR2d2 = orp.util.isObjectInSet(r2d2, listOfCharacters);
+  hasAll = orp.util.areObjectsInSet([luke, c3po, r2d2], listOfCharacters);
+  assertTrue('Chris sees R2D2 as a character', hasR2d2);
+  assertTrue('Chris sees characters: luke, c3po, r2d2', hasAll);
+  assertTrue('Chris sees 3 characters in &quot;Star Wars&quot;', listOfCharacters.length == 3);
+  
+  var attributeCalledName = world.getAttributeCalledName();
+  var theHobbit = world.newItem(&quot;The Hobbit&quot;);
+  theHobbit.addEntry({attribute:attributeCalledName, value:&quot;There and Back Again&quot;});
+  listOfEntries = theHobbit.getEntriesForAttribute(attributeCalledName);
+  assertTrue('&quot;The Hobbit&quot; has two names', listOfEntries.length == 2);
+  assertTrue('getDisplayName() returns the first name', (starWars.getDisplayName() == &quot;Star Wars&quot;));
+  var listOfNames = theHobbit.getNameEntries();
+  assertTrue('getContentData() returns a string', listOfNames[0].getValue() == &quot;The Hobbit&quot;);
+  hasAll = orp.util.areObjectsInSet(listOfNames, listOfEntries);
+  hasAll = hasAll &amp;&amp; orp.util.areObjectsInSet(listOfEntries, listOfNames);
+  assertTrue('getName() matches getEntriesForAttribute(attributeCalledName)', hasAll);
+  
+  world.logout();
+}
+
+
+// -------------------------------------------------------------------
+// Helper functions
+// -------------------------------------------------------------------
+
+function waitForNextMillisecond() {
+  var now = new Date();
+  var then = now;
+  while (now.valueOf() == then.valueOf()) {
+    now = new Date();
+  }
+}
+
+
+// -------------------------------------------------------------------
+// End of file
+// -------------------------------------------------------------------

Added: trunk/tests/model/test_dependencies.html
===================================================================
--- trunk/tests/model/test_dependencies.html	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/tests/model/test_dependencies.html	2005-11-01 05:23:19 UTC (rev 371)
@@ -0,0 +1,77 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
+&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.1//EN&quot; &quot;<A HREF="http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd</A>&quot;&gt;
+&lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot; xml:lang=&quot;en&quot; &gt;
+
+&lt;!-- 
+ Written in 2005 by Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
+  
+ Copyright rights relinquished under the Creative Commons  
+ Public Domain Dedication:
+    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
+--&gt;
+
+  &lt;head&gt;
+    &lt;title&gt;Dependency tests for the orp.model package&lt;/title&gt;
+
+    &lt;script type=&quot;text/javascript&quot; src=&quot;../../third_party/jsunit/jsunit2_1/app/jsUnitCore.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;../../third_party/dojo/dojo-rev1759/dojo.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;../../third_party/md5/md5.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;test_dependencies.js&quot;&gt;&lt;/script&gt;
+  &lt;/head&gt;
+  
+  &lt;body&gt;
+    &lt;h1&gt;Dependency tests for the orp.model package&lt;/h1&gt;
+
+    &lt;p&gt;This page is used to run unit tests for the JavaScript code in the 
+    OpenRecord project.&lt;/p&gt;
+    
+    &lt;p&gt;&nbsp;&lt;/p&gt;
+    &lt;hr/&gt;
+    &lt;p&gt;You should be able to run these unit tests by going to
+    &lt;a href=&quot;../../third_party/jsunit/jsunit2_1/testRunner.html?testpage=&quot; 
+    onclick=&quot;href+=window.location.href;&quot; rel=&quot;external&quot;&gt;the local testRunner 
+    page&lt;/a&gt;, and hitting the &lt;b&gt;Run&lt;/b&gt; button. &lt;/p&gt;
+
+    &lt;p&gt;To see the tests, open this .html file in a text editor. Or, within a  
+    web browser, you should be able see the source for this file by using 
+    some menu like &lt;b&gt;View&lt;/b&gt; followed by &lt;b&gt;Page Source&lt;/b&gt;. The tests 
+    may be in this file, or they may be in a separate file that has the
+    same name as this one, except with a .js extension instead of a .html
+    extension.&lt;/p&gt;
+ 
+    &lt;p&gt;The unit tests are set up to run in the
+    &lt;a href=&quot;<A HREF="http://www.edwardh.com/jsunit/">http://www.edwardh.com/jsunit/</A>&quot; rel=&quot;external&quot;&gt;JsUnit framework&lt;/a&gt;
+    written by 
+    &lt;a href=&quot;<A HREF="http://www.edwardh.com/">http://www.edwardh.com/</A>&quot; rel=&quot;external&quot;&gt;Edward Hieatt&lt;/a&gt;. &lt;/p&gt;
+
+    &lt;p&gt;&nbsp;&lt;/p&gt;
+    &lt;hr/&gt;
+    &lt;p class=&quot;copyright&quot;&gt;You can copy freely from this work &mdash; copyright 
+    rights relinquished under the Creative Commons  
+    &lt;a rel=&quot;license external&quot; 
+    href=&quot;<A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>&quot;&gt;Public Domain 
+    Dedication&lt;/a&gt;.&lt;/p&gt;
+
+&lt;!-- Creative Commons metadata for Public Domain License 
+
+&lt;rdf:RDF xmlns=&quot;<A HREF="http://web.resource.org/cc/">http://web.resource.org/cc/</A>&quot;
+    xmlns:dc=&quot;<A HREF="http://purl.org/dc/elements/1.1/">http://purl.org/dc/elements/1.1/</A>&quot;
+    xmlns:rdf=&quot;<A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#">http://www.w3.org/1999/02/22-rdf-syntax-ns#</A>&quot;&gt;
+&lt;Work rdf:about=&quot;&quot;&gt;
+   &lt;dc:title&gt;openrecord.org&lt;/dc:title&gt;
+   &lt;dc:type rdf:resource=&quot;<A HREF="http://purl.org/dc/dcmitype/Text">http://purl.org/dc/dcmitype/Text</A>&quot; /&gt;
+   &lt;license rdf:resource=&quot;<A HREF="http://web.resource.org/cc/PublicDomain">http://web.resource.org/cc/PublicDomain</A>&quot; /&gt;
+&lt;/Work&gt;
+
+&lt;License rdf:about=&quot;<A HREF="http://web.resource.org/cc/PublicDomain">http://web.resource.org/cc/PublicDomain</A>&quot;&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Reproduction">http://web.resource.org/cc/Reproduction</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Distribution">http://web.resource.org/cc/Distribution</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/DerivativeWorks">http://web.resource.org/cc/DerivativeWorks</A>&quot; /&gt;
+&lt;/License&gt;
+
+&lt;/rdf:RDF&gt;
+
+--&gt;
+  &lt;/body&gt;
+&lt;/html&gt;
+

Added: trunk/tests/model/test_dependencies.js
===================================================================
--- trunk/tests/model/test_dependencies.js	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/tests/model/test_dependencies.js	2005-11-01 05:23:19 UTC (rev 371)
@@ -0,0 +1,66 @@
+/*****************************************************************************
+ test_dependencies.js
+ 
+******************************************************************************
+ Written in 2005 by 
+    Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
+  
+ Copyright rights relinquished under the Creative Commons  
+ Public Domain Dedication:
+    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
+  
+ You can copy freely from this file.  This work may be freely reproduced, 
+ distributed, transmitted, used, modified, built upon, or otherwise exploited
+ by anyone for any purpose.
+  
+ This work is provided on an &quot;AS IS&quot; basis, without warranties or conditions 
+ of any kind, either express or implied, including, without limitation, any 
+ warranties or conditions of title, non-infringement, merchantability, or 
+ fitness for a particular purpose. You are solely responsible for determining 
+ the appropriateness of using or distributing the work and assume all risks 
+ associated with use of this work, including but not limited to the risks and 
+ costs of errors, compliance with applicable laws, damage to or loss of data 
+ or equipment, and unavailability or interruption of operations.
+
+ In no event shall the authors or contributors have any liability for any 
+ direct, indirect, incidental, special, exemplary, or consequential damages,
+ however caused and on any theory of liability, whether in contract, strict 
+ liability, or tort (including negligence), arising in any way out of or in 
+ connection with the use or distribution of the work.
+*****************************************************************************/
+ 
+
+// -------------------------------------------------------------------
+// setUp and tearDown
+// -------------------------------------------------------------------
+
+function setUp() {
+  dojo.hostenv.setModulePrefix(&quot;dojo&quot;, &quot;../../../dojo/dojo-rev1759/src&quot;);
+  dojo.hostenv.setModulePrefix(&quot;orp&quot;, &quot;../../../../source&quot;);
+  dojo.require(&quot;orp.model.ContentRecord&quot;);
+  dojo.require(&quot;orp.model.Entry&quot;);
+  dojo.require(&quot;orp.model.Item&quot;);
+  dojo.require(&quot;orp.model.Ordinal&quot;);
+  dojo.require(&quot;orp.model.ProxyEntry&quot;);
+  dojo.require(&quot;orp.model.QueryRunner&quot;);
+  dojo.require(&quot;orp.model.Record&quot;);
+  dojo.require(&quot;orp.model.Transaction&quot;);
+  dojo.require(&quot;orp.model.Vote&quot;);
+  dojo.require(&quot;orp.model.World&quot;);
+}
+
+function tearDown() {
+}
+
+
+// -------------------------------------------------------------------
+// Test functions
+// -------------------------------------------------------------------
+
+function testDependencies() {
+  assertTrue(&quot;orp.model depends only on lang, util, uuid, archive, and storage&quot;, orp.util.hasExactlyTheseProperties(orp, [&quot;model&quot;, &quot;lang&quot;, &quot;util&quot;, &quot;uuid&quot;, &quot;archive&quot;, &quot;storage&quot;]));
+}
+
+// -------------------------------------------------------------------
+// End of file
+// -------------------------------------------------------------------

Modified: trunk/tests/storage/DirectoryReadingTest.js
===================================================================
--- trunk/tests/storage/DirectoryReadingTest.js	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/tests/storage/DirectoryReadingTest.js	2005-11-01 05:23:19 UTC (rev 371)
@@ -35,7 +35,7 @@
 function setUp() {
   dojo.hostenv.setModulePrefix(&quot;dojo&quot;, &quot;../../../dojo/dojo-rev1759/src&quot;);
   dojo.hostenv.setModulePrefix(&quot;orp&quot;, &quot;../../../../source&quot;);
-  dojo.require(&quot;orp.storage.FileSystem&quot;);
+  dojo.require(&quot;orp.storage.directoryList&quot;);
   dojo.require(&quot;orp.util.Util&quot;);
   orp.storage.PATH_TO_TRUNK_DIRECTORY_FROM_WINDOW_LOCATION = &quot;../..&quot;;
   orp.storage.PATH_TO_WINDOW_LOCATION_FROM_TRUNK_DIRECTORY = &quot;tests/storage&quot;;
@@ -60,7 +60,11 @@
   assertTrue(&quot;List should include 'suffixless_file_1'.&quot;, orp.util.isObjectInSet(&quot;suffixless_file_1&quot;, dirList));
   assertTrue(&quot;List should include 'javascript_file_2.js'.&quot;, orp.util.isObjectInSet(&quot;javascript_file_2.js&quot;, dirList));
   assertTrue(&quot;List should include 'text_file_1.txt'.&quot;, orp.util.isObjectInSet(&quot;text_file_1.txt&quot;, dirList));
-  assertTrue(&quot;List should include exactly six files.&quot;, dirList.length == 6);
+  var expectedNumberOfFiles = 6;
+  if (orp.util.isObjectInSet(&quot;.svn&quot;, dirList)) {
+    expectedNumberOfFiles += 1;
+  }
+  assertTrue(&quot;List should include the expected number of files.&quot;, dirList.length == expectedNumberOfFiles);
 }
 
 function testGetDirListForMissingDir() {

Modified: trunk/tests/storage/LintTest.js
===================================================================
--- trunk/tests/storage/LintTest.js	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/tests/storage/LintTest.js	2005-11-01 05:23:19 UTC (rev 371)
@@ -57,9 +57,10 @@
   var listOfSourceCodeFiles = [
     &quot;Storage.js&quot;,
     &quot;FakeStorage.js&quot;,
-    &quot;FileStorage.js&quot;,
-    &quot;HttpStorage.js&quot;,
-    &quot;FileSystem.js&quot;];
+    &quot;FileProtocolStorage.js&quot;,
+    &quot;HttpProtocolStorage.js&quot;,
+    &quot;directoryList.js&quot;,
+    &quot;fileProtocolUtil.js&quot;];
   var prefix = &quot;../../../source/storage/&quot;;
   var errorReport = orp.util.LintTool.getErrorReportFromListOfFilesnames(listOfSourceCodeFiles, prefix);
   var message = &quot;Lint check \n&quot; + errorReport;

Modified: trunk/tests/storage/StorageTest.js
===================================================================
--- trunk/tests/storage/StorageTest.js	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/tests/storage/StorageTest.js	2005-11-01 05:23:19 UTC (rev 371)
@@ -41,15 +41,15 @@
   dojo.hostenv.setModulePrefix(&quot;dojo&quot;, &quot;../../../dojo/dojo-rev1759/src&quot;);
   dojo.hostenv.setModulePrefix(&quot;orp&quot;, &quot;../../../../source&quot;);
   dojo.require(&quot;orp.util.Util&quot;);
-  dojo.require(&quot;orp.storage.FileStorage&quot;);
-  dojo.require(&quot;orp.storage.HttpStorage&quot;);
+  dojo.require(&quot;orp.storage.FileProtocolStorage&quot;);
+  dojo.require(&quot;orp.storage.HttpProtocolStorage&quot;);
 
   utilAssertReportedError = false;
   orp.util.setErrorReportCallback(errorReporter)
 
-  var isHttp = window.location.protocol == &quot;http:&quot;;
-  saver = isHttp? new orp.storage.HttpStorage(repositoryName, repositoryDirectoryName, pathToTrunkDirectoryFromThisDirectory) 
-                : new orp.storage.FileStorage(repositoryName, repositoryDirectoryName, pathToTrunkDirectoryFromThisDirectory);
+  var isHttp = (window.location.protocol == &quot;http:&quot;);
+  saver = isHttp? new orp.storage.HttpProtocolStorage(repositoryName, repositoryDirectoryName, pathToTrunkDirectoryFromThisDirectory) 
+                : new orp.storage.FileProtocolStorage(repositoryName, repositoryDirectoryName, pathToTrunkDirectoryFromThisDirectory);
 
   // Examples of what window.location.pathname should look like:
   // for http: protocol: /openrecord/trunk/source/model/TestRepositoryWriting.html
@@ -124,22 +124,18 @@
 }
 
 function fileHasExpectedContents(expectedContents) {
-  // var contents = orp.util.getStringContentsOfFileAtURL(fileUrl);
   var contents = dojo.hostenv.getText(fileUrl);
   for (var i = 0; contents != expectedContents &amp;&amp; i &lt; 5; ++i) {
     waitASecond();
-    // contents = orp.util.getStringContentsOfFileAtURL(fileUrl);
     contents = dojo.hostenv.getText(fileUrl);
   }
   return (contents == expectedContents);
 }
 
 function fileHasExpectedSubstring(expectedSubstring) {
-  // var contents = orp.util.getStringContentsOfFileAtURL(fileUrl);
   var contents = dojo.hostenv.getText(fileUrl);
   for (var i = 0; contents.indexOf(expectedSubstring) == -1 &amp;&amp; i &lt; 5; ++i) {
     waitASecond();
-    // contents = orp.util.getStringContentsOfFileAtURL(fileUrl);
     contents = dojo.hostenv.getText(fileUrl);
   }
   return (contents.indexOf(expectedSubstring) != -1);

Modified: trunk/tests/storage/TestSuite.html
===================================================================
--- trunk/tests/storage/TestSuite.html	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/tests/storage/TestSuite.html	2005-11-01 05:23:19 UTC (rev 371)
@@ -26,6 +26,7 @@
         testSuite.addTestPage(&quot;../../../tests/storage/StorageTest.html&quot;);
         testSuite.addTestPage(&quot;../../../tests/storage/DirectoryReadingTest.html&quot;);
         testSuite.addTestPage(&quot;../../../tests/storage/LintTest.html&quot;);
+        testSuite.addTestPage(&quot;../../../tests/storage/test_dependencies.html&quot;);
         return testSuite;
       }
     &lt;/script&gt;

Added: trunk/tests/storage/test_dependencies.html
===================================================================
--- trunk/tests/storage/test_dependencies.html	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/tests/storage/test_dependencies.html	2005-11-01 05:23:19 UTC (rev 371)
@@ -0,0 +1,76 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
+&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.1//EN&quot; &quot;<A HREF="http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd</A>&quot;&gt;
+&lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot; xml:lang=&quot;en&quot; &gt;
+
+&lt;!-- 
+ Written in 2005 by Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
+  
+ Copyright rights relinquished under the Creative Commons  
+ Public Domain Dedication:
+    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
+--&gt;
+
+  &lt;head&gt;
+    &lt;title&gt;Dependency tests for the orp.storage package&lt;/title&gt;
+
+    &lt;script type=&quot;text/javascript&quot; src=&quot;../../third_party/jsunit/jsunit2_1/app/jsUnitCore.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;../../third_party/dojo/dojo-rev1759/dojo.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;test_dependencies.js&quot;&gt;&lt;/script&gt;
+  &lt;/head&gt;
+  
+  &lt;body&gt;
+    &lt;h1&gt;Dependency tests for the orp.storage package&lt;/h1&gt;
+
+    &lt;p&gt;This page is used to run unit tests for the JavaScript code in the 
+    OpenRecord project.&lt;/p&gt;
+    
+    &lt;p&gt;&nbsp;&lt;/p&gt;
+    &lt;hr/&gt;
+    &lt;p&gt;You should be able to run these unit tests by going to
+    &lt;a href=&quot;../../third_party/jsunit/jsunit2_1/testRunner.html?testpage=&quot; 
+    onclick=&quot;href+=window.location.href;&quot; rel=&quot;external&quot;&gt;the local testRunner 
+    page&lt;/a&gt;, and hitting the &lt;b&gt;Run&lt;/b&gt; button. &lt;/p&gt;
+
+    &lt;p&gt;To see the tests, open this .html file in a text editor. Or, within a  
+    web browser, you should be able see the source for this file by using 
+    some menu like &lt;b&gt;View&lt;/b&gt; followed by &lt;b&gt;Page Source&lt;/b&gt;. The tests 
+    may be in this file, or they may be in a separate file that has the
+    same name as this one, except with a .js extension instead of a .html
+    extension.&lt;/p&gt;
+ 
+    &lt;p&gt;The unit tests are set up to run in the
+    &lt;a href=&quot;<A HREF="http://www.edwardh.com/jsunit/">http://www.edwardh.com/jsunit/</A>&quot; rel=&quot;external&quot;&gt;JsUnit framework&lt;/a&gt;
+    written by 
+    &lt;a href=&quot;<A HREF="http://www.edwardh.com/">http://www.edwardh.com/</A>&quot; rel=&quot;external&quot;&gt;Edward Hieatt&lt;/a&gt;. &lt;/p&gt;
+
+    &lt;p&gt;&nbsp;&lt;/p&gt;
+    &lt;hr/&gt;
+    &lt;p class=&quot;copyright&quot;&gt;You can copy freely from this work &mdash; copyright 
+    rights relinquished under the Creative Commons  
+    &lt;a rel=&quot;license external&quot; 
+    href=&quot;<A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>&quot;&gt;Public Domain 
+    Dedication&lt;/a&gt;.&lt;/p&gt;
+
+&lt;!-- Creative Commons metadata for Public Domain License 
+
+&lt;rdf:RDF xmlns=&quot;<A HREF="http://web.resource.org/cc/">http://web.resource.org/cc/</A>&quot;
+    xmlns:dc=&quot;<A HREF="http://purl.org/dc/elements/1.1/">http://purl.org/dc/elements/1.1/</A>&quot;
+    xmlns:rdf=&quot;<A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#">http://www.w3.org/1999/02/22-rdf-syntax-ns#</A>&quot;&gt;
+&lt;Work rdf:about=&quot;&quot;&gt;
+   &lt;dc:title&gt;openrecord.org&lt;/dc:title&gt;
+   &lt;dc:type rdf:resource=&quot;<A HREF="http://purl.org/dc/dcmitype/Text">http://purl.org/dc/dcmitype/Text</A>&quot; /&gt;
+   &lt;license rdf:resource=&quot;<A HREF="http://web.resource.org/cc/PublicDomain">http://web.resource.org/cc/PublicDomain</A>&quot; /&gt;
+&lt;/Work&gt;
+
+&lt;License rdf:about=&quot;<A HREF="http://web.resource.org/cc/PublicDomain">http://web.resource.org/cc/PublicDomain</A>&quot;&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Reproduction">http://web.resource.org/cc/Reproduction</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Distribution">http://web.resource.org/cc/Distribution</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/DerivativeWorks">http://web.resource.org/cc/DerivativeWorks</A>&quot; /&gt;
+&lt;/License&gt;
+
+&lt;/rdf:RDF&gt;
+
+--&gt;
+  &lt;/body&gt;
+&lt;/html&gt;
+

Added: trunk/tests/storage/test_dependencies.js
===================================================================
--- trunk/tests/storage/test_dependencies.js	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/tests/storage/test_dependencies.js	2005-11-01 05:23:19 UTC (rev 371)
@@ -0,0 +1,68 @@
+/*****************************************************************************
+ test_dependencies.js
+ 
+******************************************************************************
+ Written in 2005 by 
+    Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
+  
+ Copyright rights relinquished under the Creative Commons  
+ Public Domain Dedication:
+    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
+  
+ You can copy freely from this file.  This work may be freely reproduced, 
+ distributed, transmitted, used, modified, built upon, or otherwise exploited
+ by anyone for any purpose.
+  
+ This work is provided on an &quot;AS IS&quot; basis, without warranties or conditions 
+ of any kind, either express or implied, including, without limitation, any 
+ warranties or conditions of title, non-infringement, merchantability, or 
+ fitness for a particular purpose. You are solely responsible for determining 
+ the appropriateness of using or distributing the work and assume all risks 
+ associated with use of this work, including but not limited to the risks and 
+ costs of errors, compliance with applicable laws, damage to or loss of data 
+ or equipment, and unavailability or interruption of operations.
+
+ In no event shall the authors or contributors have any liability for any 
+ direct, indirect, incidental, special, exemplary, or consequential damages,
+ however caused and on any theory of liability, whether in contract, strict 
+ liability, or tort (including negligence), arising in any way out of or in 
+ connection with the use or distribution of the work.
+*****************************************************************************/
+ 
+
+// -------------------------------------------------------------------
+// setUp and tearDown
+// -------------------------------------------------------------------
+
+function setUp() {
+  dojo.hostenv.setModulePrefix(&quot;dojo&quot;, &quot;../../../dojo/dojo-rev1759/src&quot;);
+  dojo.hostenv.setModulePrefix(&quot;orp&quot;, &quot;../../../../source&quot;);
+  dojo.require(&quot;orp.storage.Storage&quot;);
+  dojo.require(&quot;orp.storage.FakeStorage&quot;);
+  dojo.require(&quot;orp.storage.FileProtocolStorage&quot;);
+  dojo.require(&quot;orp.storage.HttpProtocolStorage&quot;);
+  dojo.require(&quot;orp.storage.directoryList&quot;);
+  dojo.require(&quot;orp.storage.fileProtocolUtil&quot;);
+}
+
+function tearDown() {
+}
+
+
+// -------------------------------------------------------------------
+// Test functions
+// -------------------------------------------------------------------
+
+function testDependencies() {
+  assertTrue(&quot;orp.lang is defined&quot;, ((typeof orp.lang) === 'object'));
+  assertTrue(&quot;orp.storage is defined&quot;, ((typeof orp.storage) === 'object'));
+  var i = 0;  
+  for (var key in orp) {
+    ++i;
+  }
+  assertTrue(&quot;Only orp.lang and orp.storage are defined&quot;, (i === 2));
+}
+
+// -------------------------------------------------------------------
+// End of file
+// -------------------------------------------------------------------

Modified: trunk/tests/util/TestSuite.html
===================================================================
--- trunk/tests/util/TestSuite.html	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/tests/util/TestSuite.html	2005-11-01 05:23:19 UTC (rev 371)
@@ -29,6 +29,7 @@
         testSuite.addTestPage(&quot;../../../tests/util/UtilTest.html&quot;);
         testSuite.addTestPage(&quot;../../../tests/util/XmlConverterTest.html&quot;);
         testSuite.addTestPage(&quot;../../../tests/util/XmlConverterMultiplePassesTest.html&quot;);
+        testSuite.addTestPage(&quot;../../../tests/util/test_dependencies.html&quot;);
         return testSuite;
       }
     &lt;/script&gt;

Modified: trunk/tests/util/UtilTest.js
===================================================================
--- trunk/tests/util/UtilTest.js	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/tests/util/UtilTest.js	2005-11-01 05:23:19 UTC (rev 371)
@@ -106,6 +106,8 @@
 }
 
 function testHasProperty() {
+  var expectedProperties = {name: &quot;name&quot;, provinces: &quot;provinces&quot; };
+  var unexpectedProperties = {foo: &quot;foo&quot;, bar: &quot;bar&quot; };
   var canada = {name:&quot;Canada&quot;, provinces:8};
   var atlantis = {};
 
@@ -115,17 +117,24 @@
   assertTrue('Atlantis does not have a name', !orp.util.hasProperty(atlantis, &quot;name&quot;));
 
   assertTrue('Atlantis has []', orp.util.hasProperties(atlantis, []));
+  assertTrue('Atlantis has {}', orp.util.hasProperties(atlantis, {}));
   assertTrue('Canada has [&quot;name&quot;, &quot;provinces&quot;]', orp.util.hasProperties(canada, [&quot;name&quot;, &quot;provinces&quot;]));
+  assertTrue('Canada has expectedProperties', orp.util.hasProperties(canada, expectedProperties));
   assertTrue('Canada has [&quot;name&quot;]', orp.util.hasProperties(canada, [&quot;name&quot;]));
   assertTrue('Canada has []', orp.util.hasProperties(canada, []));
+  assertTrue('Canada has {}', orp.util.hasProperties(canada, {}));
   assertTrue('Canada does not have [&quot;foo&quot;, &quot;bar&quot;]', !orp.util.hasProperties(canada, [&quot;foo&quot;, &quot;bar&quot;]));
+  assertTrue('Canada does not have unexpectedProperties', !orp.util.hasProperties(canada, unexpectedProperties));
 
   assertTrue('Canada has only [&quot;name&quot;, &quot;provinces&quot;]', orp.util.hasNoUnexpectedProperties(canada, [&quot;name&quot;, &quot;provinces&quot;]));
+  assertTrue('Canada has only expectedProperties', orp.util.hasNoUnexpectedProperties(canada, expectedProperties));
   assertTrue('Canada does not have just [&quot;name&quot;]', !orp.util.hasNoUnexpectedProperties(canada, [&quot;name&quot;]));
   
   assertTrue('Canada does not have just [&quot;name&quot;]', !orp.util.hasExactlyTheseProperties(canada, [&quot;name&quot;]));
   assertTrue('Canada has [&quot;name&quot;, &quot;provinces&quot;]', orp.util.hasExactlyTheseProperties(canada, [&quot;name&quot;, &quot;provinces&quot;]));
+  assertTrue('Canada has expectedProperties', orp.util.hasExactlyTheseProperties(canada, expectedProperties));
   assertTrue('Canada does not have [&quot;name&quot;, &quot;provinces&quot;, &quot;foo&quot;]', !orp.util.hasExactlyTheseProperties(canada, [&quot;name&quot;, &quot;provinces&quot;, &quot;foo&quot;]));
+  assertTrue('Canada does not have unexpectedProperties', !orp.util.hasExactlyTheseProperties(canada, unexpectedProperties));
 }
 
 // -------------------------------------------------------------------

Added: trunk/tests/util/test_dependencies.html
===================================================================
--- trunk/tests/util/test_dependencies.html	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/tests/util/test_dependencies.html	2005-11-01 05:23:19 UTC (rev 371)
@@ -0,0 +1,77 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
+&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.1//EN&quot; &quot;<A HREF="http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd</A>&quot;&gt;
+&lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot; xml:lang=&quot;en&quot; &gt;
+
+&lt;!-- 
+ Written in 2005 by Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
+  
+ Copyright rights relinquished under the Creative Commons  
+ Public Domain Dedication:
+    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
+--&gt;
+
+  &lt;head&gt;
+    &lt;title&gt;Dependency tests for the orp.util package&lt;/title&gt;
+
+    &lt;script type=&quot;text/javascript&quot; src=&quot;../../third_party/jsunit/jsunit2_1/app/jsUnitCore.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;../../third_party/dojo/dojo-rev1759/dojo.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;../../third_party/md5/md5.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;test_dependencies.js&quot;&gt;&lt;/script&gt;
+  &lt;/head&gt;
+  
+  &lt;body&gt;
+    &lt;h1&gt;Dependency tests for the orp.util package&lt;/h1&gt;
+
+    &lt;p&gt;This page is used to run unit tests for the JavaScript code in the 
+    OpenRecord project.&lt;/p&gt;
+    
+    &lt;p&gt;&nbsp;&lt;/p&gt;
+    &lt;hr/&gt;
+    &lt;p&gt;You should be able to run these unit tests by going to
+    &lt;a href=&quot;../../third_party/jsunit/jsunit2_1/testRunner.html?testpage=&quot; 
+    onclick=&quot;href+=window.location.href;&quot; rel=&quot;external&quot;&gt;the local testRunner 
+    page&lt;/a&gt;, and hitting the &lt;b&gt;Run&lt;/b&gt; button. &lt;/p&gt;
+
+    &lt;p&gt;To see the tests, open this .html file in a text editor. Or, within a  
+    web browser, you should be able see the source for this file by using 
+    some menu like &lt;b&gt;View&lt;/b&gt; followed by &lt;b&gt;Page Source&lt;/b&gt;. The tests 
+    may be in this file, or they may be in a separate file that has the
+    same name as this one, except with a .js extension instead of a .html
+    extension.&lt;/p&gt;
+ 
+    &lt;p&gt;The unit tests are set up to run in the
+    &lt;a href=&quot;<A HREF="http://www.edwardh.com/jsunit/">http://www.edwardh.com/jsunit/</A>&quot; rel=&quot;external&quot;&gt;JsUnit framework&lt;/a&gt;
+    written by 
+    &lt;a href=&quot;<A HREF="http://www.edwardh.com/">http://www.edwardh.com/</A>&quot; rel=&quot;external&quot;&gt;Edward Hieatt&lt;/a&gt;. &lt;/p&gt;
+
+    &lt;p&gt;&nbsp;&lt;/p&gt;
+    &lt;hr/&gt;
+    &lt;p class=&quot;copyright&quot;&gt;You can copy freely from this work &mdash; copyright 
+    rights relinquished under the Creative Commons  
+    &lt;a rel=&quot;license external&quot; 
+    href=&quot;<A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>&quot;&gt;Public Domain 
+    Dedication&lt;/a&gt;.&lt;/p&gt;
+
+&lt;!-- Creative Commons metadata for Public Domain License 
+
+&lt;rdf:RDF xmlns=&quot;<A HREF="http://web.resource.org/cc/">http://web.resource.org/cc/</A>&quot;
+    xmlns:dc=&quot;<A HREF="http://purl.org/dc/elements/1.1/">http://purl.org/dc/elements/1.1/</A>&quot;
+    xmlns:rdf=&quot;<A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#">http://www.w3.org/1999/02/22-rdf-syntax-ns#</A>&quot;&gt;
+&lt;Work rdf:about=&quot;&quot;&gt;
+   &lt;dc:title&gt;openrecord.org&lt;/dc:title&gt;
+   &lt;dc:type rdf:resource=&quot;<A HREF="http://purl.org/dc/dcmitype/Text">http://purl.org/dc/dcmitype/Text</A>&quot; /&gt;
+   &lt;license rdf:resource=&quot;<A HREF="http://web.resource.org/cc/PublicDomain">http://web.resource.org/cc/PublicDomain</A>&quot; /&gt;
+&lt;/Work&gt;
+
+&lt;License rdf:about=&quot;<A HREF="http://web.resource.org/cc/PublicDomain">http://web.resource.org/cc/PublicDomain</A>&quot;&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Reproduction">http://web.resource.org/cc/Reproduction</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Distribution">http://web.resource.org/cc/Distribution</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/DerivativeWorks">http://web.resource.org/cc/DerivativeWorks</A>&quot; /&gt;
+&lt;/License&gt;
+
+&lt;/rdf:RDF&gt;
+
+--&gt;
+  &lt;/body&gt;
+&lt;/html&gt;
+

Added: trunk/tests/util/test_dependencies.js
===================================================================
--- trunk/tests/util/test_dependencies.js	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/tests/util/test_dependencies.js	2005-11-01 05:23:19 UTC (rev 371)
@@ -0,0 +1,63 @@
+/*****************************************************************************
+ test_dependencies.js
+ 
+******************************************************************************
+ Written in 2005 by 
+    Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
+  
+ Copyright rights relinquished under the Creative Commons  
+ Public Domain Dedication:
+    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
+  
+ You can copy freely from this file.  This work may be freely reproduced, 
+ distributed, transmitted, used, modified, built upon, or otherwise exploited
+ by anyone for any purpose.
+  
+ This work is provided on an &quot;AS IS&quot; basis, without warranties or conditions 
+ of any kind, either express or implied, including, without limitation, any 
+ warranties or conditions of title, non-infringement, merchantability, or 
+ fitness for a particular purpose. You are solely responsible for determining 
+ the appropriateness of using or distributing the work and assume all risks 
+ associated with use of this work, including but not limited to the risks and 
+ costs of errors, compliance with applicable laws, damage to or loss of data 
+ or equipment, and unavailability or interruption of operations.
+
+ In no event shall the authors or contributors have any liability for any 
+ direct, indirect, incidental, special, exemplary, or consequential damages,
+ however caused and on any theory of liability, whether in contract, strict 
+ liability, or tort (including negligence), arising in any way out of or in 
+ connection with the use or distribution of the work.
+*****************************************************************************/
+ 
+
+// -------------------------------------------------------------------
+// setUp and tearDown
+// -------------------------------------------------------------------
+
+function setUp() {
+  dojo.hostenv.setModulePrefix(&quot;dojo&quot;, &quot;../../../dojo/dojo-rev1759/src&quot;);
+  dojo.hostenv.setModulePrefix(&quot;orp&quot;, &quot;../../../../source&quot;);
+  dojo.require(&quot;orp.util.Util&quot;);
+  dojo.require(&quot;orp.util.Cookie&quot;);
+  dojo.require(&quot;orp.util.CsvParser&quot;);
+  dojo.require(&quot;orp.util.DateValue&quot;);
+  dojo.require(&quot;orp.util.LintTool&quot;);
+  // dojo.require(&quot;orp.util.XmlConverter&quot;);  // FIX_ME: need to move XmlConverter out of util
+}
+
+function tearDown() {
+  UtilTestVars = null;
+}
+
+
+// -------------------------------------------------------------------
+// Test functions
+// -------------------------------------------------------------------
+
+function testDependencies() {
+  assertTrue(&quot;Only orp.lang and orp.util are defined&quot;, orp.util.hasExactlyTheseProperties(orp, [&quot;lang&quot;, &quot;util&quot;]));
+}
+
+// -------------------------------------------------------------------
+// End of file
+// -------------------------------------------------------------------

Modified: trunk/tests/uuid/UuidTest.js
===================================================================
--- trunk/tests/uuid/UuidTest.js	2005-11-01 04:16:22 UTC (rev 370)
+++ trunk/tests/uuid/UuidTest.js	2005-11-01 05:23:19 UTC (rev 371)
@@ -60,6 +60,10 @@
 // Test functions
 // -------------------------------------------------------------------
 
+function testDependencies() {
+  assertTrue(&quot;orp.uuid depends on only opr.lang and orp.util.&quot;, orp.util.hasExactlyTheseProperties(orp, [&quot;uuid&quot;, &quot;lang&quot;, &quot;util&quot;]));
+}
+
 function testGet64bitArrayFromFloat() {
   var x = Math.pow(2, 63) + Math.pow(2, 15);
   var result = TimeBasedUuid._get64bitArrayFromFloat(x);
@@ -206,61 +210,6 @@
   arrayOfParts = uuid4.split(&quot;-&quot;);
   section4 = arrayOfParts[4];
   assertTrue('Section 4 = node input', section4 == &quot;123456789ABC&quot;);
-
-  /* 
-  // Old code that Brian wrote to try to get a sense of how
-  // many UUIDs we can create in a single millisecond 
-  var array = [];
-  var now = new Date();
-  var then = new Date();
-  while (now.valueOf() == then.valueOf()) {
-    then = new Date();
-  }
-  array.push(Uuid.generateTimeBasedUuid());
-  array.push(Uuid.generateTimeBasedUuid());
-  array.push(Uuid.generateTimeBasedUuid());
-  array.push(Uuid.generateTimeBasedUuid());
-  array.push(Uuid.generateTimeBasedUuid());
-  array.push(Uuid.generateTimeBasedUuid());
-  array.push(Uuid.generateTimeBasedUuid());
-  array.push(Uuid.generateTimeBasedUuid());
-  array.push(Uuid.generateTimeBasedUuid());
-  array.push(Uuid.generateTimeBasedUuid());
-  array.push(Uuid.generateTimeBasedUuid());
-  array.push(Uuid.generateTimeBasedUuid());
-  array.push(Uuid.generateTimeBasedUuid());
-  array.push(Uuid.generateTimeBasedUuid());
-  array.push(Uuid.generateTimeBasedUuid());
-  array.push(Uuid.generateTimeBasedUuid());
-  array.push(Uuid.generateTimeBasedUuid());
-  array.push(Uuid.generateTimeBasedUuid());
-  array.push(Uuid.generateTimeBasedUuid());
-  array.push(Uuid.generateTimeBasedUuid());
-  array.push(Uuid.generateTimeBasedUuid());
-  array.push(Uuid.generateTimeBasedUuid());
-  array.push(Uuid.generateTimeBasedUuid());
-  array.push(Uuid.generateTimeBasedUuid());
-  alert(array[0] + &quot;\n&quot; + 
-        array[1] + &quot;\n&quot; + 
-        array[2] + &quot;\n&quot; + 
-        array[3] + &quot;\n&quot; + 
-        array[4] + &quot;\n&quot; + 
-        array[5] + &quot;\n&quot; + 
-        array[6] + &quot;\n&quot; + 
-        array[7] + &quot;\n&quot; + 
-        array[8] + &quot;\n&quot; + 
-        array[9] + &quot;\n&quot; + 
-        array[10] + &quot;\n&quot; + 
-        array[11] + &quot;\n&quot; + 
-        array[12] + &quot;\n&quot; + 
-        array[13] + &quot;\n&quot; + 
-        array[14] + &quot;\n&quot; + 
-        array[15] + &quot;\n&quot; + 
-        array[16] + &quot;\n&quot; + 
-        array[17] + &quot;\n&quot; + 
-        array[18] + &quot;\n&quot; + 
-        array[19] + &quot;\n&quot;);
-  */
 }
 
 function testGenericUuids() {


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000352.html">[openrecord-svn] r370 - trunk/source/storage
</A></li>
	<LI>Next message: <A HREF="000354.html">[openrecord-svn] r372 - trunk/repositories
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#353">[ date ]</a>
              <a href="thread.html#353">[ thread ]</a>
              <a href="subject.html#353">[ subject ]</a>
              <a href="author.html#353">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openrecord-svn">More information about the openrecord-svn
mailing list</a><br>
</body></html>
