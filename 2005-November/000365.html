<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openrecord-svn] r383 - in trunk: source source/model source/storage source/view tests tests/lang tests/nonemptyPluginDir tests/storage tests/storage/directory_1 tests/view
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openrecord-svn/2005-November/index.html" >
   <LINK REL="made" HREF="mailto:openrecord-svn%40lists.berlios.de?Subject=Re%3A%20%5Bopenrecord-svn%5D%20r383%20-%20in%20trunk%3A%20source%20source/model%20source/storage%20source/view%20tests%20tests/lang%20tests/nonemptyPluginDir%20tests/storage%20tests/storage/directory_1%20tests/view&In-Reply-To=%3C200511290645.jAT6jg6r010212%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000364.html">
   <LINK REL="Next"  HREF="000366.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openrecord-svn] r383 - in trunk: source source/model source/storage source/view tests tests/lang tests/nonemptyPluginDir tests/storage tests/storage/directory_1 tests/view</H1>
    <B>mignon at BerliOS</B> 
    <A HREF="mailto:openrecord-svn%40lists.berlios.de?Subject=Re%3A%20%5Bopenrecord-svn%5D%20r383%20-%20in%20trunk%3A%20source%20source/model%20source/storage%20source/view%20tests%20tests/lang%20tests/nonemptyPluginDir%20tests/storage%20tests/storage/directory_1%20tests/view&In-Reply-To=%3C200511290645.jAT6jg6r010212%40sheep.berlios.de%3E"
       TITLE="[openrecord-svn] r383 - in trunk: source source/model source/storage source/view tests tests/lang tests/nonemptyPluginDir tests/storage tests/storage/directory_1 tests/view">mignon at berlios.de
       </A><BR>
    <I>Tue Nov 29 07:45:42 CET 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000364.html">[openrecord-svn] r382 - in trunk: source/archive source/model tests/model
</A></li>
        <LI>Next message: <A HREF="000366.html">[openrecord-svn] r384 - trunk/source
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#365">[ date ]</a>
              <a href="thread.html#365">[ thread ]</a>
              <a href="subject.html#365">[ subject ]</a>
              <a href="author.html#365">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mignon
Date: 2005-11-29 07:45:28 +0100 (Tue, 29 Nov 2005)
New Revision: 383

Added:
   trunk/tests/emptyPluginDir/
   trunk/tests/nonemptyPluginDir/
   trunk/tests/nonemptyPluginDir/OutlinePlugin2.js
   trunk/tests/storage/directory_1/emptyDirectory/
   trunk/tests/view/SectionViewConstructorTest.html
   trunk/tests/view/SectionViewConstructorTest.js
   trunk/tests/view/TestSuite.html
Modified:
   trunk/source/BarChartPlugin.js
   trunk/source/OutlinePlugin.js
   trunk/source/model/2005_june_axiomatic_items.json
   trunk/source/storage/Storage.js
   trunk/source/storage/get_list_of_files_in_dir.php
   trunk/source/view/PluginView.js
   trunk/source/view/SectionView.js
   trunk/tests/TestSuite.html
   trunk/tests/lang/LangTest.js
   trunk/tests/storage/DirectoryReadingTest.js
Log:
Made extensive changes to SectionView involving plugins.  Wrote unit tests for the new functionality in SectionViewConstructorTest.js.  Made other miscellaneous minor changes.



Modified: trunk/source/BarChartPlugin.js
===================================================================
--- trunk/source/BarChartPlugin.js	2005-11-20 00:14:23 UTC (rev 382)
+++ trunk/source/BarChartPlugin.js	2005-11-29 06:45:28 UTC (rev 383)
@@ -71,10 +71,10 @@
 // -------------------------------------------------------------------
 // Register this plugin in the SectionView registry
 // -------------------------------------------------------------------
+
 orp.BarChartPlugin.UUID = { PLUGIN_VIEW_BAR_CHART: &quot;00040304-ce7f-11d9-8cd5-0011113ae5d6&quot; };
-// FIXME:
-// orp.view.SectionView.registerPlugin(orp.BarChartPlugin);
 
+orp.view.SectionView.registerPlugin(orp.BarChartPlugin);
 
 // -------------------------------------------------------------------
 // Public class methods

Modified: trunk/source/OutlinePlugin.js
===================================================================
--- trunk/source/OutlinePlugin.js	2005-11-20 00:14:23 UTC (rev 382)
+++ trunk/source/OutlinePlugin.js	2005-11-29 06:45:28 UTC (rev 383)
@@ -70,10 +70,10 @@
 // -------------------------------------------------------------------
 // Register this plugin in the SectionView registry
 // -------------------------------------------------------------------
+
 orp.OutlinePlugin.UUID = { PLUGIN_VIEW_OUTLINE: &quot;00040302-ce7f-11d9-8cd5-0011113ae5d6&quot; };
-// FIXME:
-// orp.view.SectionView.registerPlugin(orp.OutlinePlugin);
 
+orp.view.SectionView.registerPlugin(orp.OutlinePlugin);
 
 // -------------------------------------------------------------------
 // Public class methods

Modified: trunk/source/model/2005_june_axiomatic_items.json
===================================================================
--- trunk/source/model/2005_june_axiomatic_items.json	2005-11-20 00:14:23 UTC (rev 382)
+++ trunk/source/model/2005_june_axiomatic_items.json	2005-11-29 06:45:28 UTC (rev 383)
@@ -1178,6 +1178,14 @@
             &quot;value&quot;: &quot;Table&quot; }
     },
     // -----------------------------------------------------------------------
+    { &quot;Entry&quot;: {                                              // TablePlugin
+             &quot;uuid&quot;: &quot;0040301d-ce7f-11d9-8cd5-0011113ae5d6&quot;,
+        &quot;attribute&quot;: &quot;0000100f-ce7f-11d9-8cd5-0011113ae5d6&quot;,  // attributeCalledClassName
+             &quot;item&quot;: &quot;00040301-ce7f-11d9-8cd5-0011113ae5d6&quot;,  // Table View (Plugin View)
+             &quot;type&quot;: &quot;00001020-ce7f-11d9-8cd5-0011113ae5d6&quot;,  // TextValue
+            &quot;value&quot;: &quot;TablePlugin&quot; }
+    },
+    // -----------------------------------------------------------------------
     { &quot;Entry&quot;: {                                              // Outline View
              &quot;uuid&quot;: &quot;0040302a-ce7f-11d9-8cd5-0011113ae5d6&quot;,
         &quot;attribute&quot;: &quot;00001001-ce7f-11d9-8cd5-0011113ae5d6&quot;,  // Name
@@ -1203,6 +1211,14 @@
             &quot;value&quot;: &quot;Outline&quot; }
     },
     // -----------------------------------------------------------------------
+    { &quot;Entry&quot;: {                                              // OutlinePlugin
+             &quot;uuid&quot;: &quot;0040302d-ce7f-11d9-8cd5-0011113ae5d6&quot;,
+        &quot;attribute&quot;: &quot;0000100f-ce7f-11d9-8cd5-0011113ae5d6&quot;,  // attributeCalledClassName
+             &quot;item&quot;: &quot;00040302-ce7f-11d9-8cd5-0011113ae5d6&quot;,  // Outline View (Plugin View)
+             &quot;type&quot;: &quot;00001020-ce7f-11d9-8cd5-0011113ae5d6&quot;,  // TextValue
+            &quot;value&quot;: &quot;OutlinePlugin&quot; }
+    },
+    // -----------------------------------------------------------------------
     { &quot;Entry&quot;: {                                              // Detail View
              &quot;uuid&quot;: &quot;0040303a-ce7f-11d9-8cd5-0011113ae5d6&quot;,
         &quot;attribute&quot;: &quot;00001001-ce7f-11d9-8cd5-0011113ae5d6&quot;,  // Name
@@ -1220,7 +1236,7 @@
         &quot;attribute&quot;: [&quot;00001005-ce7f-11d9-8cd5-0011113ae5d6&quot;, &quot;0000100c-ce7f-11d9-8cd5-0011113ae5d6&quot;]  }
     },  
     // -----------------------------------------------------------------------
-    { &quot;Entry&quot;: {                                              // Outline
+    { &quot;Entry&quot;: {                                              // Detail
              &quot;uuid&quot;: &quot;0040303c-ce7f-11d9-8cd5-0011113ae5d6&quot;,
         &quot;attribute&quot;: &quot;00001002-ce7f-11d9-8cd5-0011113ae5d6&quot;,  // Short Name
              &quot;item&quot;: &quot;00040303-ce7f-11d9-8cd5-0011113ae5d6&quot;,  // Detail View (Plugin View)
@@ -1228,6 +1244,14 @@
             &quot;value&quot;: &quot;Detail&quot; }
     },
     // -----------------------------------------------------------------------
+    { &quot;Entry&quot;: {                                              // DetailPlugin
+             &quot;uuid&quot;: &quot;0040303d-ce7f-11d9-8cd5-0011113ae5d6&quot;,
+        &quot;attribute&quot;: &quot;0000100f-ce7f-11d9-8cd5-0011113ae5d6&quot;,  // attributeCalledClassName
+             &quot;item&quot;: &quot;00040303-ce7f-11d9-8cd5-0011113ae5d6&quot;,  // Detail View (Plugin View)
+             &quot;type&quot;: &quot;00001020-ce7f-11d9-8cd5-0011113ae5d6&quot;,  // TextValue
+            &quot;value&quot;: &quot;DetailPlugin&quot; }
+    },
+    // -----------------------------------------------------------------------
     { &quot;Entry&quot;: {                                              // Bar Chart View
              &quot;uuid&quot;: &quot;0040304a-ce7f-11d9-8cd5-0011113ae5d6&quot;,
         &quot;attribute&quot;: &quot;00001001-ce7f-11d9-8cd5-0011113ae5d6&quot;,  // Name
@@ -1251,6 +1275,14 @@
              &quot;item&quot;: &quot;00040304-ce7f-11d9-8cd5-0011113ae5d6&quot;,  // Bar Chart View (Plugin View)
              &quot;type&quot;: &quot;00001020-ce7f-11d9-8cd5-0011113ae5d6&quot;,  // TextValue
             &quot;value&quot;: &quot;Bar Chart&quot; }
+    },
+    // -----------------------------------------------------------------------
+    { &quot;Entry&quot;: {                                              // BarChartPlugin
+             &quot;uuid&quot;: &quot;0040304d-ce7f-11d9-8cd5-0011113ae5d6&quot;,
+        &quot;attribute&quot;: &quot;0000100f-ce7f-11d9-8cd5-0011113ae5d6&quot;,  // attributeCalledClassName
+             &quot;item&quot;: &quot;00040304-ce7f-11d9-8cd5-0011113ae5d6&quot;,  // Bar Chart View (Plugin View)
+             &quot;type&quot;: &quot;00001020-ce7f-11d9-8cd5-0011113ae5d6&quot;,  // TextValue
+            &quot;value&quot;: &quot;BarChartPlugin&quot; }
     } ]
   },
   // =======================================================================

Modified: trunk/source/storage/Storage.js
===================================================================
--- trunk/source/storage/Storage.js	2005-11-20 00:14:23 UTC (rev 382)
+++ trunk/source/storage/Storage.js	2005-11-29 06:45:28 UTC (rev 383)
@@ -103,6 +103,12 @@
   dj_unimplemented(&quot;writeText&quot;);
 };
 
+orp.storage.Storage.prototype.getCurrentLocationDirectory = function() {
+  var thisUrl = window.location.pathname; //e.g. /openrecord/trunk/demo_page.html or /openrecord/trunk/source/model/TestRepositoryWriting.html.
+  var arrayOfPathComponents = thisUrl.split('/');
+  arrayOfPathComponents.pop();
+  return arrayOfPathComponents.join('/'); //e.g. /openrecord/trunk or /openrecord/trunk/source/model
+};
 
 // -------------------------------------------------------------------
 // End of file

Modified: trunk/source/storage/get_list_of_files_in_dir.php
===================================================================
--- trunk/source/storage/get_list_of_files_in_dir.php	2005-11-20 00:14:23 UTC (rev 382)
+++ trunk/source/storage/get_list_of_files_in_dir.php	2005-11-29 06:45:28 UTC (rev 383)
@@ -6,12 +6,12 @@
   $suffix = $_GET['suffix'];
 }
 if (!file_exists($dir)) {
-  exit(&quot;$dir not found.&quot;); 
+  exit(&quot;$dir not found.&quot;);
 }
-;
 if (!($dh = opendir($dir))) {
-  exit(&quot;Could not open $dir.&quot;); 
+  exit(&quot;Could not open $dir.&quot;);
 }
+$num_files = 0;
 while (false !== ($filename = readdir($dh))) {
   if ($filename == &quot;.&quot; || $filename == &quot;..&quot;) {
     continue;
@@ -19,7 +19,13 @@
   $array_of_file_name_parts = explode(&quot;.&quot;, $filename);
   if (!$suffix_specified || $array_of_file_name_parts[1] == $suffix) {
     $array_js[] = &quot;\&quot;&quot; . $filename . &quot;\&quot;&quot;;
+    $num_files++;
   }
 }
-echo &quot;[&quot; . implode(',', $array_js) . &quot;]&quot;;
+if ($num_files == 0) {
+  echo &quot;[]&quot;;
+}
+else {
+  echo &quot;[&quot; . implode(',', $array_js) . &quot;]&quot;;
+}
 ?&gt;

Modified: trunk/source/view/PluginView.js
===================================================================
--- trunk/source/view/PluginView.js	2005-11-20 00:14:23 UTC (rev 382)
+++ trunk/source/view/PluginView.js	2005-11-29 06:45:28 UTC (rev 383)
@@ -70,13 +70,19 @@
 
 dojo.inherits(orp.view.PluginView, orp.view.View);  // makes PluginView be a subclass of View
 
+// -------------------------------------------------------------------
+// Public class constants
+// -------------------------------------------------------------------
 
+orp.view.PluginView.PATH_TO_CORE_PLUGIN_DIRECTORY_FROM_TRUNK = &quot;source&quot;;
+orp.view.PluginView.PATH_TO_PLUGIN_DIRECTORY_FROM_TRUNK = &quot;source/plugins&quot;;
+
 // -------------------------------------------------------------------
 // Public instance methods
 // -------------------------------------------------------------------
 
 /**
- * Returns the registered name of this PluginView.
+ * Returns the item of this PluginView.
  *
  * @scope    public instance method
  * @return   A string.

Modified: trunk/source/view/SectionView.js
===================================================================
--- trunk/source/view/SectionView.js	2005-11-20 00:14:23 UTC (rev 382)
+++ trunk/source/view/SectionView.js	2005-11-29 06:45:28 UTC (rev 383)
@@ -41,13 +41,9 @@
 dojo.require(&quot;orp.view.RootView&quot;);
 dojo.require(&quot;orp.model.Item&quot;);
 dojo.require(&quot;orp.lang.Lang&quot;);
+dojo.require(&quot;orp.storage.directoryList&quot;);
 dojo.require(&quot;dojo.event.*&quot;);
 
-// FIXME: We shouldn't need to include these three lines:
-dojo.require(&quot;orp.DetailPlugin&quot;);
-dojo.require(&quot;orp.OutlinePlugin&quot;);
-dojo.require(&quot;orp.BarChartPlugin&quot;);
-
 // -------------------------------------------------------------------
 // Dependencies, expressed in the syntax that JSLint understands:
 // 
@@ -62,14 +58,14 @@
 // Constructor
 // -------------------------------------------------------------------
 /**
- * A PageView uses instances of a SectionViews to display the Sections 
+ * A PageView uses instances of SectionViews to display the Sections 
  * of a page. 
  *
  * @scope    public instance constructor
  * @extends  View
  * @param    superview    The view that serves as the superview for this view. 
  * @param    htmlElement    The HTMLElement to display the HTML in. 
- * @param    sectionItem    The Section item to be displayed in by this view. 
+ * @param    sectionItem    The Section item to be displayed by this view. 
  * @syntax   var sectionView = new orp.view.SectionView()
  */
 orp.view.SectionView = function(superview, htmlElement, sectionItem) {
@@ -85,30 +81,75 @@
   this._headerView = null;
   this._queryEditSpan = null;
   
-  // -----------------------------------------------------------------------
-  // FIXME: temporary hack
-  // 
-  // Brian inserted this hack on 2005/09/21 as part of converting everything  
-  // to use the Dojo package system.  Now that we explicitly control the order 
-  // in which files are loaded, the old calls to &quot;SectionView.registerPlugin()&quot; 
-  // in (TablePlugin.js, OutlinePlugin.js etc.) no longer work, I think because 
-  // SectionView.registerPlugin doesn't exist at the time the calls are made.
   if (orp.view.SectionView._ourListOfRegisteredPluginClasses.length === 0) {
-    orp.view.SectionView.registerPlugin(orp.TablePlugin);
-    orp.view.SectionView.registerPlugin(orp.OutlinePlugin);
-    orp.view.SectionView.registerPlugin(orp.DetailPlugin);
-    orp.view.SectionView.registerPlugin(orp.BarChartPlugin);
-  }
-  // 
-  // -----------------------------------------------------------------------
-  
-  if (!orp.view.SectionView._ourHashTableOfPluginClassesKeyedByPluginItemUuid) {
+    var categoryCalledPlugin = this.getWorld().getItemFromUuid(orp.view.SectionView.UUID.CATEGORY_PLUGIN_VIEW);
+    var listOfItems = this.getWorld().getItemsInCategory(categoryCalledPlugin);
+    var attributeCalledClassName = this.getWorld().getAttributeCalledClassName();
+    for (var key in listOfItems) {
+      var item = listOfItems[key];
+      var entry = item.getSingleEntryFromAttribute(attributeCalledClassName);
+      if (!entry) {
+        alert(&quot;Item '&quot; + item.getDisplayName() + &quot;' in category PluginView has no entry for attribute 'Class Name', and will be skipped.&quot;);
+        continue;
+      }
+      var className = entry.getValue();
+      
+      // This deals with any plugins which are already loaded.  Such pre-loaded plugins could not 
+      // self-register when they loaded, because of the order in which files are loaded, so we register them here.
+      // Currently, TableView and DetailView are the only plugins which should already be loaded.
+      if (orp[className]) {
+        orp.view.SectionView.registerPlugin(orp[className]);
+        continue;
+      }
+      
+      var sourceUrl = orp.storage.Storage.prototype.getCurrentLocationDirectory() + '/';
+      if (orp.storage.PATH_TO_TRUNK_DIRECTORY_FROM_WINDOW_LOCATION) {
+        sourceUrl += orp.storage.PATH_TO_TRUNK_DIRECTORY_FROM_WINDOW_LOCATION + '/';
+      }
+      sourceUrl += orp.view.PluginView.PATH_TO_CORE_PLUGIN_DIRECTORY_FROM_TRUNK +
+                    &quot;/&quot; + className + &quot;.js&quot;;
+      var success = orp.view.SectionView._loadUri(sourceUrl);
+      if (!success) {
+        sourceUrl = orp.storage.Storage.prototype.getCurrentLocationDirectory() + '/';
+        if (orp.storage.PATH_TO_TRUNK_DIRECTORY_FROM_WINDOW_LOCATION) {
+          sourceUrl += orp.storage.PATH_TO_TRUNK_DIRECTORY_FROM_WINDOW_LOCATION + '/';
+        }
+        sourceUrl += orp.view.PluginView.PATH_TO_PLUGIN_DIRECTORY_FROM_TRUNK +
+                     &quot;/&quot; + className + &quot;.js&quot;;
+        success = orp.view.SectionView._loadUri(sourceUrl);
+        if (!success) {
+          throw new Error(sourceUrl + &quot; not found.&quot;);
+        }
+      }
+    }
+
     orp.view.SectionView._ourHashTableOfPluginClassesKeyedByPluginItemUuid = {};
-    for (var key in orp.view.SectionView._ourListOfRegisteredPluginClasses) {
+    for (key in orp.view.SectionView._ourListOfRegisteredPluginClasses) {
       var pluginClass = orp.view.SectionView._ourListOfRegisteredPluginClasses[key];
       var pluginItemUuid = pluginClass.getPluginItemUuid();
       orp.view.SectionView._ourHashTableOfPluginClassesKeyedByPluginItemUuid[pluginItemUuid] = pluginClass;
     }
+  
+    var pathToPluginDirectoryFromWindowLocation = &quot;&quot;;
+    if (orp.storage.PATH_TO_TRUNK_DIRECTORY_FROM_WINDOW_LOCATION) {
+      pathToPluginDirectoryFromWindowLocation += orp.storage.PATH_TO_TRUNK_DIRECTORY_FROM_WINDOW_LOCATION + '/';
+    }
+    pathToPluginDirectoryFromWindowLocation += orp.view.PluginView.PATH_TO_PLUGIN_DIRECTORY_FROM_TRUNK;
+    
+    var dirList = orp.storage.getDirList(pathToPluginDirectoryFromWindowLocation, &quot;js&quot;);
+    for (var i = 0; i &lt; dirList.length; ++i) {
+      var filenameWithoutExtension = (dirList[i].split('.'))[0];
+      var correspondingClassDefined = orp.plugins &amp;&amp; orp.plugins[filenameWithoutExtension];
+      if (!correspondingClassDefined) {
+        sourceUrl = orp.storage.Storage.prototype.getCurrentLocationDirectory() + '/';
+        if (orp.storage.PATH_TO_TRUNK_DIRECTORY_FROM_WINDOW_LOCATION) {
+          sourceUrl += orp.storage.PATH_TO_TRUNK_DIRECTORY_FROM_WINDOW_LOCATION + '/';
+        }
+        sourceUrl += orp.view.PluginView.PATH_TO_PLUGIN_DIRECTORY_FROM_TRUNK +
+                     '/' + dirList[i];
+        this._installPlugin(sourceUrl);
+      }
+    }
   }
 };
 
@@ -159,18 +200,20 @@
 // -------------------------------------------------------------------
 
 /**
- * Given the name of a plugin (&quot;Table&quot;, &quot;Outline&quot;, etc.), returns a newly
- * created plugin object of that type, initialized to be the plugin for this 
- * SectionView.
- *
  * @scope    public class method
- * @param    pluginClass    A JavaScript class, such as TablePlugin. 
- * @param    pluginItemUuid    The UUID of the item representing that class of plugin. 
+ * @param    pluginClass    A JavaScript class, such as TablePlugin.
  */
-orp.view.SectionView.registerPlugin = function(pluginClass, pluginItemUuid) {
+orp.view.SectionView.registerPlugin = function(pluginClass) {
   orp.view.SectionView._ourListOfRegisteredPluginClasses.push(pluginClass);
 };
 
+/**
+ * @scope    public class method
+ * @return   number of plugins
+ */
+orp.view.SectionView.getNumPlugins = function() {
+  return orp.view.SectionView._ourListOfRegisteredPluginClasses.length;
+};
 
 // -------------------------------------------------------------------
 // Public instance methods
@@ -194,6 +237,9 @@
   pluginClass = orp.view.SectionView._ourHashTableOfPluginClassesKeyedByPluginItemUuid[pluginItem.getUuid()];
   if (pluginClass) {
     var pluginType = this.getWorld().getItemFromUuid(pluginClass.getPluginItemUuid());
+
+orp.lang.assert(pluginItem == pluginType); // This seems to be true, so why not just use pluginItem?
+
     var layoutData = this._getLayoutDataForPlugin(pluginType);
     newPlugin = new pluginClass(this, pluginDiv, this.getQuerySpec(), layoutData);
   }
@@ -259,7 +305,9 @@
     selectedPluginItem = selectedPluginViewEntry.getValue();
     selectedPluginClass = orp.view.SectionView._ourHashTableOfPluginClassesKeyedByPluginItemUuid[selectedPluginItem.getUuid()];
   } else {
-    selectedPluginClass = orp.TablePlugin; 
+    selectedPluginClass = orp.TablePlugin;
+    //  This will result in an error when calling this.getPluginInstanceFromPluginItem(selectedPluginItem, this._pluginDiv) 
+    //  below, because selectedPluginItem will be undefined.
   }
   
   var sectionDiv = this.getHtmlElement();
@@ -392,7 +440,44 @@
   myQuery.addObserver(this);
 };
 
+/**
+ * Stores a new item representing a plugin class, with associated entries, as 
+ * specified in the source code for the plugin.
+ * 
+ * @scope    private instance method
+ * @param    world             An object of class World.
+ * @param    newPluginClass    A JavaScript class, such as TablePlugin.
+ */    
+orp.view.SectionView.prototype._addNewItemForNewPluginClass = function(world, newPluginClass) {
+  world.beginTransaction();
+  var newItem = world.importItem(newPluginClass.getPluginItemUuid());
+  var entries = newPluginClass.getEntriesForItemRepresentingPluginClass(newItem, world);
+  for (var i in entries) {
+    world.importEntry(entries[i]);
+  }
+  world.endTransaction();
+  return newItem;
+};
 
+/* FIXME: This is a hack.  Undoubtedly there is a more elegant way to accomplish
+   this using dojo, but I don't understand dojo well enough yet to find it.
+*/
+orp.view.SectionView._loadUri = function(sourceUrl) {
+  var success = false;
+  try {
+    if (dojo.hostenv.oldLoadUri) {
+      success = dojo.hostenv.oldLoadUri(sourceUrl, null, true);
+    }
+    else {
+      success = dojo.hostenv.loadUri(sourceUrl, null, true);
+    }
+  }
+  catch (e) {
+    success = false;
+  }
+  return success;
+};
+
 // -------------------------------------------------------------------
 // Event handler methods
 // -------------------------------------------------------------------
@@ -414,7 +499,7 @@
 
 
 /**
- * Called when the query belong to this section has changed
+ * Called when the query belonging to this section has changed
  *
  * @scope    public instance method
  */
@@ -501,10 +586,10 @@
     matchingAttribute = listOfMatchingAttrs[0].getValue();
   }
   if (matchingAttribute.getDisplayString() != newChoiceName) {
-      myQuery.addEntry({
-        previousEntry:entryToBeReplaced, 
-        attribute:attributeCalledQueryMatchingAttribute, 
-        value:newQueryMatchingAttribute});
+    myQuery.addEntry({
+      previousEntry:entryToBeReplaced, 
+      attribute:attributeCalledQueryMatchingAttribute, 
+      value:newQueryMatchingAttribute});
 /*  if (listOfMatchingAttrs.length === 0) {
       myQuery.addEntry({attribute:attributeCalledQueryMatchingAttribute, value:newQueryMatchingAttribute});
     } else {
@@ -536,6 +621,26 @@
   }
 };
 
+/**
+ * Loads the JavaScript code for a plugin.
+ * 
+ * @scope    private instance method
+ * @param    pluginUrl    Location of JavaScript file defining a plugin.
+ */
+orp.view.SectionView.prototype._installPlugin = function(pluginUrl) {
+  var numPluginsRegisteredBefore = orp.view.SectionView._ourListOfRegisteredPluginClasses.length;
+  var success = orp.view.SectionView._loadUri(pluginUrl);
+  if (!success) {
+    throw new Error(&quot;Error loading &quot; + pluginUrl);
+  }
+  var numPluginsRegistered = orp.view.SectionView._ourListOfRegisteredPluginClasses.length;
+  orp.lang.assert(numPluginsRegistered == numPluginsRegisteredBefore + 1);
+  var newestPluginClass = orp.view.SectionView._ourListOfRegisteredPluginClasses[numPluginsRegistered - 1];
+  var newPluginViewItem = this._addNewItemForNewPluginClass(this.getWorld(), newestPluginClass);
+  var uuidOfNewPlugin = newPluginViewItem.getUuid();
+  orp.view.SectionView._ourHashTableOfPluginClassesKeyedByPluginItemUuid[uuidOfNewPlugin] = newestPluginClass;
+};
+
 // -------------------------------------------------------------------
 // End of file
 // -------------------------------------------------------------------

Modified: trunk/tests/TestSuite.html
===================================================================
--- trunk/tests/TestSuite.html	2005-11-20 00:14:23 UTC (rev 382)
+++ trunk/tests/TestSuite.html	2005-11-29 06:45:28 UTC (rev 383)
@@ -32,7 +32,7 @@
         testSuite.addTestPage(&quot;../../../tests/model/TestSuite.html&quot;);
         testSuite.addTestPage(&quot;../../../tests/archive/TestSuite.html&quot;);
         testSuite.addTestPage(&quot;../../../tests/storage/TestSuite.html&quot;);
-        testSuite.addTestPage(&quot;../../../tests/view/LintTest.html&quot;);
+        testSuite.addTestPage(&quot;../../../tests/view/TestSuite.html&quot;);
         testSuite.addTestPage(&quot;../../../tests/LintTest.html&quot;);
         return testSuite;
       }

Modified: trunk/tests/lang/LangTest.js
===================================================================
--- trunk/tests/lang/LangTest.js	2005-11-20 00:14:23 UTC (rev 382)
+++ trunk/tests/lang/LangTest.js	2005-11-29 06:45:28 UTC (rev 383)
@@ -229,7 +229,7 @@
   // make the box be a zero-dimensional point
   var point = orp.lang.bind(box, &quot;setDimensions&quot;);
   point();
-  assertTrue(&quot;Bind works with 1 argument.&quot;, (box.getVolume() == (1)) );  
+  assertTrue(&quot;Bind works with 0 arguments.&quot;, (box.getVolume() == (1)) );  
 }
 
 

Added: trunk/tests/nonemptyPluginDir/OutlinePlugin2.js
===================================================================
--- trunk/tests/nonemptyPluginDir/OutlinePlugin2.js	2005-11-20 00:14:23 UTC (rev 382)
+++ trunk/tests/nonemptyPluginDir/OutlinePlugin2.js	2005-11-29 06:45:28 UTC (rev 383)
@@ -0,0 +1,153 @@
+/*****************************************************************************
+ OutlinePlugin2.js
+ 
+******************************************************************************
+ Written in 2005 by Brian Douglas Skinner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openrecord-svn">brian.skinner at gumption.org</A>&gt;
+  
+ Copyright rights relinquished under the Creative Commons  
+ Public Domain Dedication:
+    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
+  
+ You can copy freely from this file.  This work may be freely reproduced, 
+ distributed, transmitted, used, modified, built upon, or otherwise exploited
+ by anyone for any purpose.
+  
+ This work is provided on an &quot;AS IS&quot; basis, without warranties or conditions 
+ of any kind, either express or implied, including, without limitation, any 
+ warranties or conditions of title, non-infringement, merchantability, or 
+ fitness for a particular purpose. You are solely responsible for determining 
+ the appropriateness of using or distributing the work and assume all risks 
+ associated with use of this work, including but not limited to the risks and 
+ costs of errors, compliance with applicable laws, damage to or loss of data 
+ or equipment, and unavailability or interruption of operations.
+
+ In no event shall the authors or contributors have any liability for any 
+ direct, indirect, incidental, special, exemplary, or consequential damages,
+ however caused and on any theory of liability, whether in contract, strict 
+ liability, or tort (including negligence), arising in any way out of or in 
+ connection with the use or distribution of the work.
+*****************************************************************************/
+
+
+// -------------------------------------------------------------------
+// Provides and Requires
+// -------------------------------------------------------------------
+dojo.provide(&quot;orp.plugins.OutlinePlugin2&quot;);
+dojo.require(&quot;orp.view.PluginView&quot;);
+dojo.require(&quot;orp.view.SectionView&quot;);
+
+// -------------------------------------------------------------------
+// Dependencies, expressed in the syntax that JSLint understands:
+// 
+/*global Util  */
+/*global View  */
+/*global RootView  */
+// -------------------------------------------------------------------
+
+/**
+ * An OutlinePlugin2 displays a set of content items for a SectionView. 
+ *
+ * @scope    public instance constructor
+ * @extends  PluginView
+ * @param    superview    The View that serves as the superview for this view. 
+ * @param    htmlElement    The HTMLElement to display this view in. 
+ * @param    querySpec    The Query Spec item that provides the items for this PluginView to display
+ * @param    layoutItem    ???. 
+ * @syntax   var plugin = new orp.plugins.OutlinePlugin2()
+ */
+orp.plugins.OutlinePlugin2 = function(superview, htmlElement, querySpec, layoutItem) {
+  orp.view.PluginView.call(this, superview, htmlElement, querySpec, layoutItem, &quot;OutlinePlugin2&quot;);
+};
+
+dojo.inherits(orp.plugins.OutlinePlugin2, orp.view.PluginView);  // makes OutlinePlugin2 be a subclass of PluginView
+
+
+// -------------------------------------------------------------------
+// Register this plugin in the SectionView registry
+// -------------------------------------------------------------------
+
+orp.plugins.OutlinePlugin2.UUID = &quot;99a09d90-598a-11da-87ac-c103016080e1&quot;;
+
+orp.view.SectionView.registerPlugin(orp.plugins.OutlinePlugin2);
+
+// -------------------------------------------------------------------
+// Public class methods
+// -------------------------------------------------------------------
+
+/**
+ * Returns the UUID of the item that represents this class of plugin.
+ *
+ * @scope    public class method
+ * @return   The UUID of the item that represents this class of plugin
+ */
+orp.plugins.OutlinePlugin2.getPluginItemUuid = function() {
+  return orp.plugins.OutlinePlugin2.UUID;
+};
+
+orp.plugins.OutlinePlugin2.getEntriesForItemRepresentingPluginClass = function(pluginItem, world) {
+  return [
+    { uuid: &quot;99a187f0-598a-11da-87ac-c103016080e1&quot;,
+      item: pluginItem,
+      attribute: world.getAttributeCalledName(),
+      value: &quot;Outline2 View&quot; },
+    { uuid: &quot;99a24b40-598a-11da-87ac-c103016080e1&quot;,
+      item: pluginItem,
+      attribute: world.getAttributeCalledShortName(),
+      value: &quot;Outline2&quot; },
+    { uuid: &quot;99a335a0-598a-11da-87ac-c103016080e1&quot;,
+      item: pluginItem,
+      attribute: world.getAttributeCalledClassName(),
+      value: &quot;OutlinePlugin2&quot; },
+    { uuid: &quot;99a3f8f0-598a-11da-87ac-c103016080e1&quot;,
+      item: pluginItem,
+      attribute: world.getAttributeCalledCategory(),
+      inverseAttribute: world.getAttributeCalledItemsInCategory(),
+      value: world.getItemFromUuid(orp.view.SectionView.UUID.CATEGORY_PLUGIN_VIEW) }
+  ];
+};
+
+// -------------------------------------------------------------------
+// Public instance methods
+// -------------------------------------------------------------------
+
+/**
+ * Returns the class of this instance.
+ *
+ * @scope    public instance method
+ * @return   A JavaScript class. 
+ */
+orp.plugins.OutlinePlugin2.prototype.getClass = function() {
+  return orp.plugins.OutlinePlugin2;
+};
+
+/**
+ * Re-creates all the HTML for the OutlinePlugin2, and hands the HTML to the 
+ * browser to be re-drawn.
+ *
+ * @scope    public instance method
+ */
+orp.plugins.OutlinePlugin2.prototype.refresh = function() {
+  var listOfContentItems = this.fetchItems();
+  var outlineDiv = this.getHtmlElement();
+  orp.view.View.removeChildrenOfElement(outlineDiv);
+  var ulElement = orp.view.View.appendNewElement(outlineDiv, &quot;ul&quot;);
+  for (var contentItemKey in listOfContentItems) {
+    var contentItem = listOfContentItems[contentItemKey];
+    var liText = contentItem.getDisplayName(&quot;{no name}&quot;) + &quot; &quot;;
+    var liElement = orp.view.View.appendNewElement(ulElement, &quot;li&quot;, null, null, liText);
+    var anchorElement = orp.view.View.appendNewElement(liElement, &quot;a&quot;, orp.view.SectionView.cssClass.MORE_LINK);
+
+    // PENDING: 
+    //  We need a better way to get the URL for a content item
+    anchorElement.setAttribute(&quot;href&quot;, orp.view.RootView.URL_HASH_ITEM_PREFIX + contentItem.getUuidString());
+
+    // orp.view.View.appendNewTextNode(anchorElement, &quot;(more &#8658;)&quot;);
+    anchorElement.innerHTML = &quot;(more &#8658;)&quot;;
+
+    dojo.event.connect(anchorElement, &quot;onclick&quot;, orp.view.RootView.clickOnLocalLink);
+  }
+};
+
+// -------------------------------------------------------------------
+// End of file
+// -------------------------------------------------------------------

Modified: trunk/tests/storage/DirectoryReadingTest.js
===================================================================
--- trunk/tests/storage/DirectoryReadingTest.js	2005-11-20 00:14:23 UTC (rev 382)
+++ trunk/tests/storage/DirectoryReadingTest.js	2005-11-29 06:45:28 UTC (rev 383)
@@ -78,6 +78,11 @@
   assertTrue(&quot;Exception should have been caught.&quot;, exceptionCaught);    
 }
 
+function testGetDirListForEmptyDir() {
+  var dirList = orp.storage.getDirList(&quot;directory_1/emptyDirectory&quot;, &quot;js&quot;);
+  assertTrue(&quot;List should have length zero.&quot;, dirList.length == 0);
+}
+
 // -------------------------------------------------------------------
 // Helper functions
 // -------------------------------------------------------------------

Added: trunk/tests/view/SectionViewConstructorTest.html
===================================================================
--- trunk/tests/view/SectionViewConstructorTest.html	2005-11-20 00:14:23 UTC (rev 382)
+++ trunk/tests/view/SectionViewConstructorTest.html	2005-11-29 06:45:28 UTC (rev 383)
@@ -0,0 +1,74 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
+&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.1//EN&quot; &quot;<A HREF="http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd</A>&quot;&gt;
+&lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot; xml:lang=&quot;en&quot; &gt;
+
+&lt;!-- 
+ Copyright rights relinquished under the Creative Commons  
+ Public Domain Dedication:
+    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
+--&gt;
+
+  &lt;head&gt;
+    &lt;title&gt;Test SectionView Constructor&lt;/title&gt;
+
+    &lt;script type=&quot;text/javascript&quot; src=&quot;../../third_party/jsunit/jsunit2_1/app/jsUnitCore.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;../../third_party/dojo/dojo-rev1759/dojo.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;../../third_party/md5/md5.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot; src=&quot;SectionViewConstructorTest.js&quot;&gt;&lt;/script&gt;
+  &lt;/head&gt;
+  
+  &lt;body&gt;
+    &lt;h1&gt;Test SectionView Constructor&lt;/h1&gt;
+
+    &lt;p&gt;This page is used to run unit tests for the JavaScript code in the 
+    OpenRecord project.&lt;/p&gt;
+    
+    &lt;p&gt;&nbsp;&lt;/p&gt;
+    &lt;hr/&gt;
+    &lt;p&gt;You should be able to run these unit tests by going to
+    &lt;a href=&quot;../../third_party/jsunit/jsunit2_1/testRunner.html?testpage=&quot; 
+    onclick=&quot;href+=window.location.href;&quot; rel=&quot;external&quot;&gt;the local testRunner 
+    page&lt;/a&gt;, and hitting the &lt;b&gt;Run&lt;/b&gt; button.&lt;/p&gt;
+
+    &lt;p&gt;To see the tests, open this .html file in a text editor. Or, within a  
+    web browser, you should be able see the source for this file by using 
+    some menu like &lt;b&gt;View&lt;/b&gt; followed by &lt;b&gt;Page Source&lt;/b&gt;. The tests 
+    may be in this file, or they may be in a separate file that has the
+    same name as this one, except with a .js extension instead of a .html
+    extension.&lt;/p&gt;
+ 
+    &lt;p&gt;The unit tests are set up to run in the
+    &lt;a href=&quot;<A HREF="http://www.edwardh.com/jsunit/">http://www.edwardh.com/jsunit/</A>&quot; rel=&quot;external&quot;&gt;JsUnit framework&lt;/a&gt;
+    written by 
+    &lt;a href=&quot;<A HREF="http://www.edwardh.com/">http://www.edwardh.com/</A>&quot; rel=&quot;external&quot;&gt;Edward Hieatt&lt;/a&gt;. &lt;/p&gt;
+
+    &lt;p&gt;&nbsp;&lt;/p&gt;
+    &lt;hr/&gt;
+    &lt;p class=&quot;copyright&quot;&gt;You can copy freely from this work &mdash; copyright 
+    rights relinquished under the Creative Commons  
+    &lt;a rel=&quot;license external&quot; 
+    href=&quot;<A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>&quot;&gt;Public Domain 
+    Dedication&lt;/a&gt;.&lt;/p&gt;
+
+&lt;!-- Creative Commons metadata for Public Domain License 
+
+&lt;rdf:RDF xmlns=&quot;<A HREF="http://web.resource.org/cc/">http://web.resource.org/cc/</A>&quot;
+    xmlns:dc=&quot;<A HREF="http://purl.org/dc/elements/1.1/">http://purl.org/dc/elements/1.1/</A>&quot;
+    xmlns:rdf=&quot;<A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#">http://www.w3.org/1999/02/22-rdf-syntax-ns#</A>&quot;&gt;
+&lt;Work rdf:about=&quot;&quot;&gt;
+   &lt;dc:title&gt;openrecord.org&lt;/dc:title&gt;
+   &lt;dc:type rdf:resource=&quot;<A HREF="http://purl.org/dc/dcmitype/Text">http://purl.org/dc/dcmitype/Text</A>&quot; /&gt;
+   &lt;license rdf:resource=&quot;<A HREF="http://web.resource.org/cc/PublicDomain">http://web.resource.org/cc/PublicDomain</A>&quot; /&gt;
+&lt;/Work&gt;
+
+&lt;License rdf:about=&quot;<A HREF="http://web.resource.org/cc/PublicDomain">http://web.resource.org/cc/PublicDomain</A>&quot;&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Reproduction">http://web.resource.org/cc/Reproduction</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Distribution">http://web.resource.org/cc/Distribution</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/DerivativeWorks">http://web.resource.org/cc/DerivativeWorks</A>&quot; /&gt;
+&lt;/License&gt;
+
+&lt;/rdf:RDF&gt;
+
+--&gt;
+  &lt;/body&gt;
+&lt;/html&gt;

Added: trunk/tests/view/SectionViewConstructorTest.js
===================================================================
--- trunk/tests/view/SectionViewConstructorTest.js	2005-11-20 00:14:23 UTC (rev 382)
+++ trunk/tests/view/SectionViewConstructorTest.js	2005-11-29 06:45:28 UTC (rev 383)
@@ -0,0 +1,227 @@
+/*****************************************************************************
+ SectionViewConstructorTest.js
+ 
+******************************************************************************
+ Written in 2005 by Mignon Belongie
+
+ Copyright rights relinquished under the Creative Commons  
+ Public Domain Dedication:
+    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
+  
+ You can copy freely from this file.  This work may be freely reproduced, 
+ distributed, transmitted, used, modified, built upon, or otherwise exploited
+ by anyone for any purpose.
+  
+ This work is provided on an &quot;AS IS&quot; basis, without warranties or conditions 
+ of any kind, either express or implied, including, without limitation, any 
+ warranties or conditions of title, non-infringement, merchantability, or 
+ fitness for a particular purpose. You are solely responsible for determining 
+ the appropriateness of using or distributing the work and assume all risks 
+ associated with use of this work, including but not limited to the risks and 
+ costs of errors, compliance with applicable laws, damage to or loss of data 
+ or equipment, and unavailability or interruption of operations.
+
+ In no event shall the authors or contributors have any liability for any 
+ direct, indirect, incidental, special, exemplary, or consequential damages,
+ however caused and on any theory of liability, whether in contract, strict 
+ liability, or tort (including negligence), arising in any way out of or in 
+ connection with the use or distribution of the work.
+*****************************************************************************/
+
+var world;
+var rootView;
+var categoryCalledPlugin;
+var sectionViewDiv;
+var sectionItem;
+var numAxiomaticPlugins = 4;
+
+MockRootView = function(world) {
+  orp.lang.assert(world instanceof orp.model.World);
+  this._world = world;
+}
+
+MockRootView.prototype.getWorld = function() {
+  return this._world;
+};
+
+// -------------------------------------------------------------------
+// setUp and tearDown
+// -------------------------------------------------------------------
+
+function setUp() {
+  dojo.hostenv.setModulePrefix(&quot;dojo&quot;, &quot;../../../dojo/dojo-rev1759/src&quot;);
+  dojo.hostenv.setModulePrefix(&quot;orp&quot;, &quot;../../../../source&quot;);
+  dojo.require(&quot;orp.archive.StubArchive&quot;);
+  dojo.require(&quot;orp.model.World&quot;);
+  dojo.require(&quot;orp.view.SectionView&quot;);
+  orp.storage.PATH_TO_TRUNK_DIRECTORY_FROM_WINDOW_LOCATION = &quot;../..&quot;;
+  orp.storage.PATH_TO_WINDOW_LOCATION_FROM_TRUNK_DIRECTORY = &quot;tests/view&quot;;
+
+  // This simulates 'reloading' SectionView.js, so that for each test, it will be as if 
+  // the constructor had never been called before.
+  orp.view.SectionView._ourListOfRegisteredPluginClasses = [];
+
+  var archive = new orp.archive.StubArchive(orp.storage.PATH_TO_TRUNK_DIRECTORY_FROM_WINDOW_LOCATION);
+  world = new orp.model.World(archive);
+  var annsPassword = &quot;Ann's password&quot;;
+  var userAnn = world.newUser(&quot;Ann Doe&quot;, annsPassword);
+  world.login(userAnn, annsPassword);
+  rootView = new MockRootView(world);
+//  alert(&quot;dojo.hostenv.getBaseScriptUri() = &quot; + dojo.hostenv.getBaseScriptUri()); 
+//  dojo.hostenv.setBaseScriptUri(&quot;../../../&quot;);
+  categoryCalledPlugin = world.getItemFromUuid(orp.view.SectionView.UUID.CATEGORY_PLUGIN_VIEW);
+  sectionViewDiv = document.createElement(&quot;div&quot;);
+  sectionItem = world.newItem(&quot;FakeSectionItem&quot;);
+}
+
+function tearDown() {
+  delete orp.plugins;
+  world.logout();
+}
+
+// -------------------------------------------------------------------
+// Test functions
+// -------------------------------------------------------------------
+
+function testCorePluginsLoaded() {
+  orp.view.PluginView.PATH_TO_PLUGIN_DIRECTORY_FROM_TRUNK = &quot;tests/emptyPluginDir&quot;;
+  assertTrue2(orp.view.SectionView.getNumPlugins() == 0,                          &quot;orp.view.SectionView.getNumPlugins should return 0.&quot;);
+
+  var sectionView = new orp.view.SectionView(rootView, sectionViewDiv, sectionItem);
+  assertTrue2(orp.view.SectionView.getNumPlugins() == numAxiomaticPlugins,        &quot;orp.view.SectionView.getNumPlugins should return numAxiomaticPlugins.&quot;);
+
+  var sectionView2 = new orp.view.SectionView(rootView, sectionViewDiv, sectionItem);
+  assertTrue2(orp.view.SectionView.getNumPlugins() == numAxiomaticPlugins,        &quot;orp.view.SectionView.getNumPlugins should return numAxiomaticPlugins.&quot;);
+}
+
+function testPluginFileWithoutPreexistingPluginItem() {
+  orp.view.PluginView.PATH_TO_PLUGIN_DIRECTORY_FROM_TRUNK = &quot;tests/nonemptyPluginDir&quot;;
+
+  var listOfPluginItemsBefore = world.getItemsInCategory(categoryCalledPlugin);
+  assertTrue2(orp.view.SectionView.getNumPlugins() == 0,                          &quot;orp.view.SectionView.getNumPlugins should return 0.&quot;);
+  assertTrue2(!dojo.lang.inArray(getListOfNamesOfPluginItems(), &quot;Outline2 View&quot;), &quot;List of names of plugin items should not include 'Outline2 View'.&quot;);
+  assertTrue2(listOfPluginItemsBefore.length == numAxiomaticPlugins,              &quot;List of plugin items should have length = numAxiomaticPlugins.&quot;);
+  assertTrue2(dojo.lang.isUndefined(orp.plugins),                                 &quot;orp.plugins should be undefined.&quot;);
+
+  var sectionView = new orp.view.SectionView(rootView, sectionViewDiv, sectionItem);
+
+  var listOfPluginItemsAfter = world.getItemsInCategory(categoryCalledPlugin);
+  assertTrue2(orp.view.SectionView.getNumPlugins() == numAxiomaticPlugins + 1,    &quot;orp.view.SectionView.getNumPlugins should return numAxiomaticPlugins + 1.&quot;);
+  assertTrue2(dojo.lang.inArray(getListOfNamesOfPluginItems(), &quot;Outline2 View&quot;),  &quot;List of names of plugin items should include 'Outline2 View'.&quot;);
+  assertTrue2(listOfPluginItemsAfter.length == numAxiomaticPlugins + 1,           &quot;List of plugin items should have length = numAxiomaticPlugins + 1.&quot;);
+  assertTrue2(!dojo.lang.isUndefined(orp.plugins.OutlinePlugin2),                 &quot;orp.plugins.OutlinePlugin2 should be defined.&quot;);
+
+  var sectionView2 = new orp.view.SectionView(rootView, sectionViewDiv, sectionItem);
+  
+  var listOfPluginItemsAfterTwo = world.getItemsInCategory(categoryCalledPlugin);
+  assertTrue2(orp.view.SectionView.getNumPlugins() == numAxiomaticPlugins + 1,    &quot;orp.view.SectionView.getNumPlugins should return numAxiomaticPlugins + 1.&quot;);
+  assertTrue2(listOfPluginItemsAfterTwo.length == numAxiomaticPlugins + 1,        &quot;List of plugin items should have length = numAxiomaticPlugins + 1.&quot;);
+}
+
+function testCreatedPluginItemIsCorrect() {
+  orp.view.PluginView.PATH_TO_PLUGIN_DIRECTORY_FROM_TRUNK = &quot;tests/nonemptyPluginDir&quot;;
+
+  var listOfPluginItemsBefore = world.getItemsInCategory(categoryCalledPlugin);
+  assertTrue2(listOfPluginItemsBefore.length == numAxiomaticPlugins,              &quot;List of plugin items should have length = numAxiomaticPlugins.&quot;);
+
+  var sectionView = new orp.view.SectionView(rootView, sectionViewDiv, sectionItem);
+
+  var listOfPluginItemsAfter = world.getItemsInCategory(categoryCalledPlugin);
+  assertTrue2(listOfPluginItemsAfter.length == numAxiomaticPlugins + 1,           &quot;List of plugin items should have length = numAxiomaticPlugins + 1.&quot;);
+
+  var item = world.getItemFromUuid(orp.plugins.OutlinePlugin2.getPluginItemUuid());
+  assertTrue2(item.getDisplayName() == &quot;Outline2 View&quot;,                           &quot;item should have name 'Outline2 View'.&quot;);
+  assertTrue2(getShortName(item) == &quot;Outline2&quot;,                                   &quot;item should have short name 'Outline2'.&quot;);
+  assertTrue2(getClassName(item) == &quot;OutlinePlugin2&quot;,                             &quot;item should have class name 'OutlinePlugin2'.&quot;);
+}
+
+// Here we test the SectionView constructor in the following situation: there is
+// an item representing OutlinePlugin2, and a file OutlinePlugin2.js in the plugin
+// folder, but class OutlinePlugin2 is undefined.  We'll check that afterwards,
+// OutlinePlugin2 is defined.
+function testPluginFileWithPreexistingPluginItem() {
+  orp.view.PluginView.PATH_TO_PLUGIN_DIRECTORY_FROM_TRUNK = &quot;tests/nonemptyPluginDir&quot;;
+
+  // This is orp.plugins.OutlinePlugin2.UUID, but at this point of the test, orp.plugins.OutlinePlugin2 is undefined.
+  knownUuid = &quot;99a09d90-598a-11da-87ac-c103016080e1&quot;;
+
+  var item = world.importItem(knownUuid);
+  world.importEntry({uuid: &quot;99a187f0-598a-11da-87ac-c103016080e1&quot;,
+                     item: item,
+                     attribute: world.getAttributeCalledName(),
+                     value: &quot;Outline2 View&quot; });
+  world.importEntry({uuid: &quot;99a24b40-598a-11da-87ac-c103016080e1&quot;,
+                     item: item,
+                     attribute: world.getAttributeCalledShortName(),
+                     value: &quot;Outline2&quot; });
+  world.importEntry({uuid: &quot;99a335a0-598a-11da-87ac-c103016080e1&quot;,
+                     item: item,
+                     attribute: world.getAttributeCalledClassName(),
+                     value: &quot;OutlinePlugin2&quot; });
+  world.importEntry({uuid: &quot;99a3f8f0-598a-11da-87ac-c103016080e1&quot;,
+                     item: item,
+                     attribute: world.getAttributeCalledCategory(),
+                     inverseAttribute: world.getAttributeCalledItemsInCategory(),
+                     value: world.getItemFromUuid(orp.view.SectionView.UUID.CATEGORY_PLUGIN_VIEW) });
+
+  assertTrue2(dojo.lang.isUndefined(orp.plugins),                                 &quot;orp.plugins should be undefined.&quot;);
+
+  var sectionView = new orp.view.SectionView(rootView, sectionViewDiv, sectionItem);
+
+  assertTrue2(!dojo.lang.isUndefined(orp.plugins.OutlinePlugin2),                 &quot;orp.plugins.OutlinePlugin2 should be defined.&quot;);
+  assertTrue2(orp.plugins.OutlinePlugin2.getPluginItemUuid() == knownUuid,        &quot;orp.plugins should be undefined.&quot;);
+  assertTrue2(orp.view.SectionView.getNumPlugins() == numAxiomaticPlugins + 1,    &quot;orp.view.SectionView.getNumPlugins should return numAxiomaticPlugins + 1.&quot;);
+
+  var sectionView2 = new orp.view.SectionView(rootView, sectionViewDiv, sectionItem);
+
+  assertTrue2(orp.view.SectionView.getNumPlugins() == numAxiomaticPlugins + 1,    &quot;orp.view.SectionView.getNumPlugins should return numAxiomaticPlugins + 1.&quot;);
+}
+
+function testPluginItemWithMissingPluginFile() {
+  orp.view.PluginView.PATH_TO_PLUGIN_DIRECTORY_FROM_TRUNK = &quot;tests/emptyPluginDir&quot;;
+
+  //Make a plugin item for class BogusPlugin that doesn't have a corresponding file BogusPlugin.js in the plugin directory.
+  var bogusPluginItem = world.newItem(&quot;BogusPluginItem&quot;);
+  bogusPluginItem.addEntry({attribute: world.getAttributeCalledClassName(),
+                           value: &quot;BogusPlugin&quot;});
+  var uuid = orp.view.SectionView.UUID.CATEGORY_PLUGIN_VIEW;
+  bogusPluginItem.addConnectionEntry(world.getAttributeCalledCategory(),
+                                     world.getItemFromUuid(uuid),
+                                     world.getAttributeCalledItemsInCategory());
+
+  var exceptionCaught = false;
+  try {
+    var sectionView = new orp.view.SectionView(rootView, sectionViewDiv, sectionItem);
+  }
+  catch (exception) {
+    exceptionCaught = true;
+  }
+  assertTrue(&quot;Exception should have been caught.&quot;, exceptionCaught);    
+}
+
+// -------------------------------------------------------------------
+// Helper functions
+// -------------------------------------------------------------------
+
+assertTrue2 = function(assertion, comment) {
+  assertTrue(comment, assertion);
+}
+
+function getListOfNamesOfPluginItems() {
+  var listOfPluginItems = world.getItemsInCategory(categoryCalledPlugin);
+  var listOfNamesOfPluginItems = [];
+  dojo.lang.map(listOfPluginItems, listOfNamesOfPluginItems, function(x){this.push(x.getDisplayName())});
+  return listOfNamesOfPluginItems;
+}
+
+function getShortName(item) {
+  return item.getSingleEntryFromAttribute(world.getAttributeCalledShortName()).getDisplayString();
+}
+
+function getClassName(item) {
+  return item.getSingleEntryFromAttribute(world.getAttributeCalledClassName()).getDisplayString();
+}
+
+// -------------------------------------------------------------------
+// End of file
+// -------------------------------------------------------------------

Added: trunk/tests/view/TestSuite.html
===================================================================
--- trunk/tests/view/TestSuite.html	2005-11-20 00:14:23 UTC (rev 382)
+++ trunk/tests/view/TestSuite.html	2005-11-29 06:45:28 UTC (rev 383)
@@ -0,0 +1,87 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
+&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.1//EN&quot; &quot;<A HREF="http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd</A>&quot;&gt;
+&lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot; xml:lang=&quot;en&quot; &gt;
+
+&lt;!-- 
+ Written in 2005 by Mignon Belongie
+  
+ Copyright rights relinquished under the Creative Commons  
+ Public Domain Dedication:
+    <A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>
+--&gt;
+
+  &lt;head&gt;
+    &lt;title&gt;View Test Suite&lt;/title&gt;
+
+    &lt;script type=&quot;text/javascript&quot; src=&quot;../../third_party/jsunit/jsunit2_1/app/jsUnitCore.js&quot;&gt;&lt;/script&gt;
+    &lt;script type=&quot;text/javascript&quot;&gt;
+      function suite() {
+        var testSuite = new window.top.jsUnitTestSuite();
+        testSuite.addTestSuite(viewTestSuite());
+        return testSuite;
+      }
+      
+      function viewTestSuite() {
+        var testSuite = new window.top.jsUnitTestSuite();
+        testSuite.addTestPage(&quot;../../../tests/view/SectionViewConstructorTest.html&quot;);
+        testSuite.addTestPage(&quot;../../../tests/view/LintTest.html&quot;);
+        return testSuite;
+      }
+    &lt;/script&gt;
+  &lt;/head&gt;
+  
+  &lt;body&gt;
+    &lt;h1&gt;View Test Suite&lt;/h1&gt;
+
+    &lt;p&gt;This page is used to run unit tests for the JavaScript code in the 
+    OpenRecord project.&lt;/p&gt;
+    
+    &lt;p&gt;&nbsp;&lt;/p&gt;
+    &lt;hr/&gt;
+    &lt;p&gt;You should be able to run these unit tests by going to
+    &lt;a href=&quot;../../third_party/jsunit/jsunit2_1/testRunner.html?testpage=&quot; 
+    onclick=&quot;href+=window.location.href;&quot; rel=&quot;external&quot;&gt;the local testRunner 
+    page&lt;/a&gt;, and hitting the &lt;b&gt;Run&lt;/b&gt; button.&lt;/p&gt;
+
+    &lt;p&gt;To see the tests, open this .html file in a text editor. Or, within a  
+    web browser, you should be able see the source for this file by using 
+    some menu like &lt;b&gt;View&lt;/b&gt; followed by &lt;b&gt;Page Source&lt;/b&gt;. The tests 
+    may be in this file, or they may be in a separate file that has the
+    same name as this one, except with a .js extension instead of a .html
+    extension.&lt;/p&gt;
+ 
+    &lt;p&gt;The unit tests are set up to run in the
+    &lt;a href=&quot;<A HREF="http://www.edwardh.com/jsunit/">http://www.edwardh.com/jsunit/</A>&quot; rel=&quot;external&quot;&gt;JsUnit framework&lt;/a&gt;
+    written by 
+    &lt;a href=&quot;<A HREF="http://www.edwardh.com/">http://www.edwardh.com/</A>&quot; rel=&quot;external&quot;&gt;Edward Hieatt&lt;/a&gt;. &lt;/p&gt;
+
+    &lt;p&gt;&nbsp;&lt;/p&gt;
+    &lt;hr/&gt;
+    &lt;p class=&quot;copyright&quot;&gt;You can copy freely from this work &mdash; copyright 
+    rights relinquished under the Creative Commons  
+    &lt;a rel=&quot;license external&quot; 
+    href=&quot;<A HREF="http://creativecommons.org/licenses/publicdomain/">http://creativecommons.org/licenses/publicdomain/</A>&quot;&gt;Public Domain 
+    Dedication&lt;/a&gt;.&lt;/p&gt;
+
+&lt;!-- Creative Commons metadata for Public Domain License 
+
+&lt;rdf:RDF xmlns=&quot;<A HREF="http://web.resource.org/cc/">http://web.resource.org/cc/</A>&quot;
+    xmlns:dc=&quot;<A HREF="http://purl.org/dc/elements/1.1/">http://purl.org/dc/elements/1.1/</A>&quot;
+    xmlns:rdf=&quot;<A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#">http://www.w3.org/1999/02/22-rdf-syntax-ns#</A>&quot;&gt;
+&lt;Work rdf:about=&quot;&quot;&gt;
+   &lt;dc:title&gt;openrecord.org&lt;/dc:title&gt;
+   &lt;dc:type rdf:resource=&quot;<A HREF="http://purl.org/dc/dcmitype/Text">http://purl.org/dc/dcmitype/Text</A>&quot; /&gt;
+   &lt;license rdf:resource=&quot;<A HREF="http://web.resource.org/cc/PublicDomain">http://web.resource.org/cc/PublicDomain</A>&quot; /&gt;
+&lt;/Work&gt;
+
+&lt;License rdf:about=&quot;<A HREF="http://web.resource.org/cc/PublicDomain">http://web.resource.org/cc/PublicDomain</A>&quot;&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Reproduction">http://web.resource.org/cc/Reproduction</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Distribution">http://web.resource.org/cc/Distribution</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/DerivativeWorks">http://web.resource.org/cc/DerivativeWorks</A>&quot; /&gt;
+&lt;/License&gt;
+
+&lt;/rdf:RDF&gt;
+
+--&gt;
+  &lt;/body&gt;
+&lt;/html&gt;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000364.html">[openrecord-svn] r382 - in trunk: source/archive source/model tests/model
</A></li>
	<LI>Next message: <A HREF="000366.html">[openrecord-svn] r384 - trunk/source
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#365">[ date ]</a>
              <a href="thread.html#365">[ thread ]</a>
              <a href="subject.html#365">[ subject ]</a>
              <a href="author.html#365">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openrecord-svn">More information about the openrecord-svn
mailing list</a><br>
</body></html>
